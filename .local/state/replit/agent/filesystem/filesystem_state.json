{"file_contents":{"client/src/components/welcome-section.tsx":{"content":"import { Plus, Flame, User as UserIcon, Target, Zap } from \"lucide-react\";\nimport { useNewAuth } from \"@/hooks/useNewAuth\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport type { User } from \"@shared/schema\";\n\nexport default function WelcomeSection() {\n  const { isLoading } = useNewAuth();\n  const currentHour = new Date().getHours();\n  const greeting = currentHour < 12 ? \"Good morning\" : currentHour < 18 ? \"Good afternoon\" : \"Good evening\";\n  \n  // Get full user data with streak\n  const { data: user } = useQuery<User>({\n    queryKey: [\"/api/auth/user\"],\n  });\n  \n  // Get user's name for greeting\n  const userName = user ? `${user.firstName || ''} ${user.lastName || ''}`.trim() || user.email : null;\n  \n  // Get user's current streak\n  const userStreak = user?.streak || 0;\n  const streakText = userStreak === 0 ? \"Start today!\" : userStreak === 1 ? \"1 day\" : `${userStreak} days`;\n\n  // Parse personal plan data if available\n  const personalPlan = user?.personalPlanData ? (() => {\n    try {\n      return JSON.parse(user.personalPlanData);\n    } catch {\n      return null;\n    }\n  })() : null;\n\n  return (\n    <section className=\"mb-8\">\n      <div className=\"bg-gradient-to-r from-primary to-secondary rounded-2xl p-6 text-white relative overflow-hidden\">\n        <div className=\"absolute inset-0 opacity-20 flex items-center justify-center\">\n          <img \n            src=\"https://images.unsplash.com/photo-1571019613454-1cb2f99b2d8b?ixlib=rb-4.0.3&ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&auto=format&fit=crop&w=800&h=300\" \n            alt=\"Person doing workout\" \n            className=\"w-auto h-auto max-w-full max-h-full object-contain\" \n          />\n        </div>\n        <div className=\"relative z-10\">\n          <div className=\"flex items-center gap-4 mb-4\">\n            <div className=\"w-16 h-16 rounded-full overflow-hidden bg-white bg-opacity-20 flex items-center justify-center flex-shrink-0\">\n              {user?.profileImageUrl ? (\n                <img \n                  src={user.profileImageUrl} \n                  alt=\"Profile\" \n                  className=\"w-full h-full object-cover\"\n                  data-testid=\"welcome-profile-image\"\n                />\n              ) : (\n                <UserIcon className=\"text-white text-xl\" />\n              )}\n            </div>\n            <div>\n              <h2 className=\"text-2xl md:text-3xl font-bold\">\n                {greeting}{userName ? `, ${userName}` : ''}!\n              </h2>\n              <p className=\"text-lg font-semibold text-black mb-2\">Eat Clean, Think Smart, Train HARD!</p>\n              {personalPlan?.plan ? (\n                <div className=\"space-y-1\">\n                  <p className=\"text-lg opacity-90\">Your {personalPlan.plan.title} is ready!</p>\n                  <p className=\"text-sm opacity-75\">\n                    {personalPlan.plan.workoutsPerWeek} workouts per week • {personalPlan.plan.sessionDuration}\n                    {personalPlan.plan.calories && ` • ${personalPlan.plan.calories.goal} calories/day`}\n                  </p>\n                </div>\n              ) : (\n                <p className=\"text-lg opacity-90\">Ready to crush your fitness goals today?</p>\n              )}\n            </div>\n          </div>\n          <div className=\"flex flex-col sm:flex-row gap-4\">\n            <button \n              onClick={() => {\n                const workoutLogger = document.getElementById('workout-logger');\n                if (workoutLogger) {\n                  workoutLogger.scrollIntoView({ \n                    behavior: 'smooth',\n                    block: 'start' \n                  });\n                }\n              }}\n              className=\"bg-accent hover:bg-orange-600 text-white px-6 py-3 rounded-xl font-medium transition-colors flex items-center justify-center space-x-2\"\n            >\n              <Plus />\n              <span>Start Workout</span>\n            </button>\n            <div className=\"bg-white bg-opacity-20 rounded-xl p-3 flex items-center space-x-3\">\n              <Flame className=\"text-accent text-xl\" />\n              <div>\n                <p className=\"text-sm opacity-80\">Current Streak</p>\n                <p className=\"font-bold text-lg\">{streakText}</p>\n              </div>\n            </div>\n          </div>\n        </div>\n      </div>\n    </section>\n  );\n}\n","size_bytes":4345},"client/src/components/ui/input-otp.tsx":{"content":"import * as React from \"react\"\nimport { OTPInput, OTPInputContext } from \"input-otp\"\nimport { Dot } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst InputOTP = React.forwardRef<\n  React.ElementRef<typeof OTPInput>,\n  React.ComponentPropsWithoutRef<typeof OTPInput>\n>(({ className, containerClassName, ...props }, ref) => (\n  <OTPInput\n    ref={ref}\n    containerClassName={cn(\n      \"flex items-center gap-2 has-[:disabled]:opacity-50\",\n      containerClassName\n    )}\n    className={cn(\"disabled:cursor-not-allowed\", className)}\n    {...props}\n  />\n))\nInputOTP.displayName = \"InputOTP\"\n\nconst InputOTPGroup = React.forwardRef<\n  React.ElementRef<\"div\">,\n  React.ComponentPropsWithoutRef<\"div\">\n>(({ className, ...props }, ref) => (\n  <div ref={ref} className={cn(\"flex items-center\", className)} {...props} />\n))\nInputOTPGroup.displayName = \"InputOTPGroup\"\n\nconst InputOTPSlot = React.forwardRef<\n  React.ElementRef<\"div\">,\n  React.ComponentPropsWithoutRef<\"div\"> & { index: number }\n>(({ index, className, ...props }, ref) => {\n  const inputOTPContext = React.useContext(OTPInputContext)\n  const { char, hasFakeCaret, isActive } = inputOTPContext.slots[index]\n\n  return (\n    <div\n      ref={ref}\n      className={cn(\n        \"relative flex h-10 w-10 items-center justify-center border-y border-r border-input text-sm transition-all first:rounded-l-md first:border-l last:rounded-r-md\",\n        isActive && \"z-10 ring-2 ring-ring ring-offset-background\",\n        className\n      )}\n      {...props}\n    >\n      {char}\n      {hasFakeCaret && (\n        <div className=\"pointer-events-none absolute inset-0 flex items-center justify-center\">\n          <div className=\"h-4 w-px animate-caret-blink bg-foreground duration-1000\" />\n        </div>\n      )}\n    </div>\n  )\n})\nInputOTPSlot.displayName = \"InputOTPSlot\"\n\nconst InputOTPSeparator = React.forwardRef<\n  React.ElementRef<\"div\">,\n  React.ComponentPropsWithoutRef<\"div\">\n>(({ ...props }, ref) => (\n  <div ref={ref} role=\"separator\" {...props}>\n    <Dot />\n  </div>\n))\nInputOTPSeparator.displayName = \"InputOTPSeparator\"\n\nexport { InputOTP, InputOTPGroup, InputOTPSlot, InputOTPSeparator }\n","size_bytes":2154},"client/src/components/barcode-scanner.tsx":{"content":"import { useRef, useEffect, useState } from \"react\";\nimport { BrowserMultiFormatReader } from \"@zxing/browser\";\nimport { Result } from \"@zxing/library\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { X, Camera, ScanLine } from \"lucide-react\";\n\ninterface BarcodeScannerProps {\n  onScan: (barcode: string) => void;\n  onClose: () => void;\n  isOpen: boolean;\n}\n\nexport default function BarcodeScanner({ onScan, onClose, isOpen }: BarcodeScannerProps) {\n  const videoRef = useRef<HTMLVideoElement>(null);\n  const readerRef = useRef<BrowserMultiFormatReader | null>(null);\n  const [isScanning, setIsScanning] = useState(false);\n  const [error, setError] = useState<string | null>(null);\n  const lastScannedBarcodeRef = useRef<string | null>(null);\n  const isProcessingRef = useRef<boolean>(false);\n\n  useEffect(() => {\n    if (isOpen && !readerRef.current) {\n      readerRef.current = new BrowserMultiFormatReader();\n    }\n\n    if (isOpen && videoRef.current && readerRef.current && !isScanning) {\n      startScanning();\n    }\n\n    return () => {\n      stopScanning();\n    };\n  }, [isOpen]);\n\n  const startScanning = async () => {\n    if (!videoRef.current || !readerRef.current) return;\n\n    try {\n      setIsScanning(true);\n      setError(null);\n\n      const videoInputDevices = await BrowserMultiFormatReader.listVideoInputDevices();\n      \n      if (videoInputDevices.length === 0) {\n        throw new Error(\"No camera devices found\");\n      }\n\n      // Prefer back camera if available\n      const selectedDevice = videoInputDevices.find((device: MediaDeviceInfo) => \n        device.label.toLowerCase().includes('back') || \n        device.label.toLowerCase().includes('rear')\n      ) || videoInputDevices[0];\n\n      await readerRef.current.decodeFromVideoDevice(\n        selectedDevice.deviceId,\n        videoRef.current,\n        (result?: Result, err?: Error) => {\n          if (result && !isProcessingRef.current) {\n            const barcode = result.getText();\n            \n            // Prevent duplicate scans of the same barcode\n            if (lastScannedBarcodeRef.current === barcode) {\n              return;\n            }\n            \n            console.log(\"Barcode detected:\", barcode);\n            lastScannedBarcodeRef.current = barcode;\n            isProcessingRef.current = true;\n            \n            setIsScanning(false);\n            stopScanning();\n            onScan(barcode);\n          }\n          if (err && !err.message.includes('No MultiFormat Readers were able to detect the code')) {\n            console.log(\"Scanning error:\", err);\n          }\n        }\n      );\n    } catch (err) {\n      console.error(\"Scanner error:\", err);\n      setError(err instanceof Error ? err.message : \"Failed to start camera\");\n      setIsScanning(false);\n    }\n  };\n\n  const stopScanning = () => {\n    if (readerRef.current) {\n      try {\n        // Stop the video stream\n        const video = videoRef.current;\n        if (video && video.srcObject) {\n          const stream = video.srcObject as MediaStream;\n          stream.getTracks().forEach(track => track.stop());\n          video.srcObject = null;\n        }\n        // Note: BrowserMultiFormatReader doesn't have a reset method\n        // Resources are cleaned up when video stream is stopped\n      } catch (e) {\n        // Ignore errors when stopping\n      }\n    }\n    setIsScanning(false);\n  };\n\n  const handleClose = () => {\n    stopScanning();\n    // Reset scanning state when closing\n    lastScannedBarcodeRef.current = null;\n    isProcessingRef.current = false;\n    onClose();\n  };\n\n  if (!isOpen) return null;\n\n  return (\n    <div className=\"fixed inset-0 bg-black/90 backdrop-blur-sm flex items-center justify-center z-50 p-4\">\n      <Card className=\"w-full max-w-lg bg-black/95 border-red-600/50 shadow-2xl\">\n        <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-4 border-b border-red-800/30\">\n          <CardTitle className=\"flex items-center gap-3 text-white\">\n            <div className=\"p-2 bg-gradient-to-r from-red-600 to-red-800 rounded-lg shadow-lg\">\n              <ScanLine className=\"w-5 h-5 text-white\" />\n            </div>\n            <span className=\"font-bold\">Professional Scanner</span>\n          </CardTitle>\n          <Button \n            variant=\"ghost\" \n            size=\"sm\" \n            onClick={handleClose}\n            data-testid=\"button-close-scanner\"\n            className=\"text-gray-300 hover:text-white hover:bg-red-600/20 border border-red-800/30 hover:border-red-600\"\n          >\n            <X className=\"w-4 h-4\" />\n          </Button>\n        </CardHeader>\n        <CardContent className=\"space-y-6 p-6\">\n          {error ? (\n            <div className=\"text-center space-y-6\">\n              <div className=\"bg-red-950/50 border border-red-800/50 rounded-lg p-6\">\n                <div className=\"w-16 h-16 bg-red-900/50 rounded-full flex items-center justify-center mx-auto mb-4\">\n                  <Camera className=\"w-8 h-8 text-red-400\" />\n                </div>\n                <p className=\"text-red-300 font-medium\">{error}</p>\n                <p className=\"text-gray-400 text-sm mt-2\">Please check camera permissions and try again</p>\n              </div>\n              <Button \n                onClick={startScanning} \n                className=\"bg-gradient-to-r from-red-600 to-red-700 hover:from-red-700 hover:to-red-800 text-white font-semibold px-6 py-3 rounded-lg shadow-lg transform hover:scale-105 transition-all duration-200\"\n                data-testid=\"button-retry-scanner\"\n              >\n                <Camera className=\"w-4 h-4 mr-2\" />\n                Retry Scanner\n              </Button>\n            </div>\n          ) : (\n            <div className=\"space-y-6\">\n              <div className=\"relative bg-black rounded-xl overflow-hidden border-2 border-red-600/30 shadow-2xl\" style={{ aspectRatio: '4/3' }}>\n                <video\n                  ref={videoRef}\n                  className=\"w-full h-full object-cover\"\n                  playsInline\n                  data-testid=\"video-scanner\"\n                />\n                {isScanning && (\n                  <div className=\"absolute inset-0 flex items-center justify-center\">\n                    <div className=\"relative\">\n                      {/* Scanning Frame */}\n                      <div className=\"w-56 h-36 border-2 border-red-500 rounded-lg relative shadow-lg\">\n                        {/* Corner decorations */}\n                        <div className=\"absolute -top-1 -left-1 w-6 h-6 border-t-4 border-l-4 border-red-400 rounded-tl-lg\"></div>\n                        <div className=\"absolute -top-1 -right-1 w-6 h-6 border-t-4 border-r-4 border-red-400 rounded-tr-lg\"></div>\n                        <div className=\"absolute -bottom-1 -left-1 w-6 h-6 border-b-4 border-l-4 border-red-400 rounded-bl-lg\"></div>\n                        <div className=\"absolute -bottom-1 -right-1 w-6 h-6 border-b-4 border-r-4 border-red-400 rounded-br-lg\"></div>\n                        \n                        {/* Scanning line */}\n                        <div className=\"absolute inset-x-0 top-1/2 h-0.5 bg-gradient-to-r from-transparent via-red-400 to-transparent animate-pulse shadow-lg\" />\n                        \n                        {/* Pulsing glow effect */}\n                        <div className=\"absolute inset-0 border-2 border-red-400/50 rounded-lg animate-ping\"></div>\n                      </div>\n                      \n                      {/* Instructions */}\n                      <div className=\"absolute -top-12 left-1/2 transform -translate-x-1/2\">\n                        <div className=\"bg-black/80 backdrop-blur-sm px-4 py-2 rounded-lg border border-red-600/30\">\n                          <p className=\"text-white text-sm font-medium whitespace-nowrap\">\n                            Position barcode within frame\n                          </p>\n                        </div>\n                      </div>\n                    </div>\n                  </div>\n                )}\n                \n                {/* Status indicator */}\n                <div className=\"absolute top-4 right-4\">\n                  <div className=\"flex items-center gap-2 bg-black/80 backdrop-blur-sm px-3 py-2 rounded-lg border border-red-600/30\">\n                    <div className=\"w-2 h-2 bg-red-500 rounded-full animate-pulse\"></div>\n                    <span className=\"text-white text-xs font-medium\">SCANNING</span>\n                  </div>\n                </div>\n              </div>\n              \n              <div className=\"text-center bg-gray-900/50 rounded-lg p-4 border border-red-800/20\">\n                <div className=\"flex items-center justify-center gap-2 mb-2\">\n                  <ScanLine className=\"w-4 h-4 text-red-400\" />\n                  <span className=\"text-white font-semibold text-sm\">Professional Barcode Scanner</span>\n                </div>\n                <p className=\"text-gray-300 text-sm mb-1\">Hold device steady and ensure good lighting</p>\n                <p className=\"text-gray-400 text-xs\">Automatic detection • High precision scanning</p>\n              </div>\n            </div>\n          )}\n        </CardContent>\n      </Card>\n    </div>\n  );\n}","size_bytes":9314},"client/src/pages/settings.tsx":{"content":"import { useQuery, useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport { Settings, CreditCard, Calendar, Crown, Check, X, Trash2, AlertTriangle, Bell, Award, Trophy, Flame, Zap } from \"lucide-react\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Button } from \"@/components/ui/button\";\nimport { Separator } from \"@/components/ui/separator\";\nimport { useNewAuth } from \"@/hooks/useNewAuth\";\nimport ProfileEditor from \"@/components/profile-editor\";\nimport type { User } from \"@shared/schema\";\nimport {\n  AlertDialog,\n  AlertDialogAction,\n  AlertDialogCancel,\n  AlertDialogContent,\n  AlertDialogDescription,\n  AlertDialogFooter,\n  AlertDialogHeader,\n  AlertDialogTitle,\n  AlertDialogTrigger,\n} from \"@/components/ui/alert-dialog\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport { useState } from \"react\";\nimport { Switch } from \"@/components/ui/switch\";\nimport { Label } from \"@/components/ui/label\";\nimport { Input } from \"@/components/ui/input\";\n\ninterface NotificationPreferences {\n  id: string;\n  userId: string;\n  workoutRemindersEnabled: boolean;\n  mealNotificationsEnabled: boolean;\n  breakfastTime: string;\n  lunchTime: string;\n  dinnerTime: string;\n  notificationPermissionGranted: boolean;\n  createdAt: Date;\n  updatedAt: Date;\n}\n\ninterface UserBadgeWithDetails {\n  id: string;\n  userId: string;\n  badgeId: string;\n  earnedAt: Date;\n  badge: {\n    id: string;\n    name: string;\n    description: string;\n    iconName: string;\n    category: string;\n    requiredDays: number | null;\n    createdAt: Date;\n  };\n}\n\nexport default function SettingsPage() {\n  const { user } = useNewAuth() as { user: User | null };\n  const { toast } = useToast();\n  const queryClient = useQueryClient();\n  const [isDeleteDialogOpen, setIsDeleteDialogOpen] = useState(false);\n\n  // Fetch notification preferences\n  const { data: notificationPreferences, isLoading: isLoadingPreferences } = useQuery<NotificationPreferences>({\n    queryKey: [\"/api/notification-preferences\"],\n    enabled: !!user,\n  });\n\n  // Fetch user badges\n  const { data: userBadges, isLoading: isLoadingBadges } = useQuery<UserBadgeWithDetails[]>({\n    queryKey: [\"/api/user/badges\"],\n    enabled: !!user,\n  });\n\n  // Update notification preferences mutation\n  const updateNotificationPreferences = useMutation({\n    mutationFn: async (updates: Partial<NotificationPreferences>) => {\n      const response = await apiRequest(\"PUT\", \"/api/notification-preferences\", updates);\n      return response.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/notification-preferences\"] });\n      toast({\n        title: \"Preferences Updated\",\n        description: \"Your notification preferences have been saved.\",\n      });\n    },\n    onError: () => {\n      toast({\n        title: \"Error\",\n        description: \"Failed to update notification preferences.\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const deleteAccountMutation = useMutation({\n    mutationFn: async () => {\n      const response = await apiRequest(\"DELETE\", \"/api/user/account\", {});\n      return response.json();\n    },\n    onSuccess: () => {\n      toast({\n        title: \"Account Deleted\",\n        description: \"Your account and all associated data have been permanently deleted.\",\n      });\n      // Redirect to landing page after a brief delay\n      setTimeout(() => {\n        window.location.href = \"/\";\n      }, 2000);\n    },\n    onError: () => {\n      toast({\n        title: \"Error\",\n        description: \"Failed to delete account. Please try again or contact support.\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const formatDate = (date: string | Date | null | undefined) => {\n    if (!date) return \"N/A\";\n    return new Date(date).toLocaleDateString(\"en-US\", {\n      year: \"numeric\",\n      month: \"long\",\n      day: \"numeric\",\n    });\n  };\n\n  const getStatusBadge = (status: string) => {\n    switch (status) {\n      case \"active\":\n        return <Badge className=\"bg-green-100 text-green-800 border-green-200\"><Check className=\"w-3 h-3 mr-1\" />Active</Badge>;\n      case \"free_trial\":\n        return <Badge className=\"bg-blue-100 text-blue-800 border-blue-200\"><Crown className=\"w-3 h-3 mr-1\" />Free Trial</Badge>;\n      case \"expired\":\n        return <Badge className=\"bg-red-100 text-red-800 border-red-200\"><X className=\"w-3 h-3 mr-1\" />Expired</Badge>;\n      case \"inactive\":\n        return <Badge className=\"bg-gray-100 text-gray-800 border-gray-200\">Inactive</Badge>;\n      default:\n        return <Badge variant=\"secondary\">{status}</Badge>;\n    }\n  };\n\n  const getSubscriptionDescription = (status: string) => {\n    switch (status) {\n      case \"active\":\n        return \"You have full access to all premium features including advanced analytics, unlimited workout logging, and priority support.\";\n      case \"free_trial\":\n        return \"You're currently enjoying your free trial with access to all premium features. Upgrade to continue after your trial ends.\";\n      case \"expired\":\n        return \"Your subscription has expired. Upgrade to regain access to premium features and continue your fitness journey.\";\n      case \"inactive\":\n        return \"Your subscription is currently inactive. Reactivate to access premium features.\";\n      default:\n        return \"Manage your subscription to access premium features.\";\n    }\n  };\n\n  const getBadgeIcon = (iconName: string) => {\n    const iconProps = { className: \"w-12 h-12\" };\n    switch (iconName.toLowerCase()) {\n      case \"flame\":\n        return <Flame {...iconProps} className=\"w-12 h-12 text-orange-500\" />;\n      case \"zap\":\n        return <Zap {...iconProps} className=\"w-12 h-12 text-yellow-500\" />;\n      case \"trophy\":\n        return <Trophy {...iconProps} className=\"w-12 h-12 text-amber-500\" />;\n      case \"award\":\n        return <Award {...iconProps} className=\"w-12 h-12 text-blue-500\" />;\n      default:\n        return <Award {...iconProps} className=\"w-12 h-12 text-purple-500\" />;\n    }\n  };\n\n  return (\n    <div className=\"max-w-4xl mx-auto p-6 space-y-6\">\n      <div className=\"flex items-center gap-3 mb-8\">\n        <Settings className=\"w-8 h-8 text-primary\" />\n        <div>\n          <h1 className=\"text-3xl font-bold text-gray-900\" data-testid=\"settings-title\">Settings</h1>\n          <p className=\"text-gray-600\">Manage your account and subscription preferences</p>\n        </div>\n      </div>\n\n      {/* Profile Section */}\n      <Card data-testid=\"profile-settings-card\">\n        <CardHeader>\n          <CardTitle className=\"flex items-center gap-2\">\n            <Settings className=\"w-5 h-5\" />\n            Profile Settings\n          </CardTitle>\n          <CardDescription>\n            Update your personal information and profile picture\n          </CardDescription>\n        </CardHeader>\n        <CardContent>\n          <div className=\"flex items-center justify-between\">\n            <div>\n              <h3 className=\"font-medium\">Personal Information</h3>\n              <p className=\"text-sm text-gray-600\">\n                Name: {user?.firstName || user?.lastName \n                  ? `${user.firstName || ''} ${user.lastName || ''}`.trim()\n                  : \"Not set\"}\n              </p>\n              <p className=\"text-sm text-gray-600\">Email: {user?.email || \"Not available\"}</p>\n            </div>\n            <ProfileEditor trigger={\n              <Button variant=\"outline\" data-testid=\"edit-profile-settings\">\n                Edit Profile\n              </Button>\n            } />\n          </div>\n        </CardContent>\n      </Card>\n\n      {/* Notification Preferences Section */}\n      <Card data-testid=\"notification-settings-card\">\n        <CardHeader>\n          <CardTitle className=\"flex items-center gap-2\">\n            <Bell className=\"w-5 h-5\" />\n            Notification Preferences\n          </CardTitle>\n          <CardDescription>\n            Manage workout reminders and meal time notifications\n          </CardDescription>\n        </CardHeader>\n        <CardContent className=\"space-y-6\">\n          {isLoadingPreferences ? (\n            <p className=\"text-sm text-gray-500\">Loading preferences...</p>\n          ) : (\n            <>\n              {/* Workout Reminders */}\n              <div className=\"flex items-center justify-between\">\n                <div className=\"space-y-0.5\">\n                  <Label htmlFor=\"workout-reminders\" className=\"text-base\">\n                    Workout Reminders\n                  </Label>\n                  <p className=\"text-sm text-gray-500\">\n                    Get notified if you haven't logged a workout in 24 hours\n                  </p>\n                </div>\n                <Switch\n                  id=\"workout-reminders\"\n                  checked={notificationPreferences?.workoutRemindersEnabled ?? true}\n                  onCheckedChange={(checked) => {\n                    updateNotificationPreferences.mutate({ workoutRemindersEnabled: checked });\n                  }}\n                  data-testid=\"switch-workout-reminders\"\n                />\n              </div>\n\n              <Separator />\n\n              {/* Meal Notifications */}\n              <div className=\"space-y-4\">\n                <div className=\"flex items-center justify-between\">\n                  <div className=\"space-y-0.5\">\n                    <Label htmlFor=\"meal-notifications\" className=\"text-base\">\n                      Meal Time Notifications\n                    </Label>\n                    <p className=\"text-sm text-gray-500\">\n                      Receive reminders for breakfast, lunch, and dinner times\n                    </p>\n                  </div>\n                  <Switch\n                    id=\"meal-notifications\"\n                    checked={notificationPreferences?.mealNotificationsEnabled ?? true}\n                    onCheckedChange={(checked) => {\n                      updateNotificationPreferences.mutate({ mealNotificationsEnabled: checked });\n                    }}\n                    data-testid=\"switch-meal-notifications\"\n                  />\n                </div>\n\n                {notificationPreferences?.mealNotificationsEnabled && (\n                  <div className=\"ml-4 space-y-4 pl-4 border-l-2 border-gray-200\">\n                    <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\n                      <div className=\"space-y-2\">\n                        <Label htmlFor=\"breakfast-time\">Breakfast Time</Label>\n                        <Input\n                          id=\"breakfast-time\"\n                          type=\"time\"\n                          value={notificationPreferences?.breakfastTime || \"08:00\"}\n                          onChange={(e) => {\n                            updateNotificationPreferences.mutate({ breakfastTime: e.target.value });\n                          }}\n                          data-testid=\"input-breakfast-time\"\n                        />\n                      </div>\n                      <div className=\"space-y-2\">\n                        <Label htmlFor=\"lunch-time\">Lunch Time</Label>\n                        <Input\n                          id=\"lunch-time\"\n                          type=\"time\"\n                          value={notificationPreferences?.lunchTime || \"12:00\"}\n                          onChange={(e) => {\n                            updateNotificationPreferences.mutate({ lunchTime: e.target.value });\n                          }}\n                          data-testid=\"input-lunch-time\"\n                        />\n                      </div>\n                      <div className=\"space-y-2\">\n                        <Label htmlFor=\"dinner-time\">Dinner Time</Label>\n                        <Input\n                          id=\"dinner-time\"\n                          type=\"time\"\n                          value={notificationPreferences?.dinnerTime || \"18:00\"}\n                          onChange={(e) => {\n                            updateNotificationPreferences.mutate({ dinnerTime: e.target.value });\n                          }}\n                          data-testid=\"input-dinner-time\"\n                        />\n                      </div>\n                    </div>\n                  </div>\n                )}\n              </div>\n\n              <Separator />\n\n              {/* Browser Notification Permission */}\n              <div className=\"bg-blue-50 border border-blue-200 rounded-lg p-4\">\n                <div className=\"flex items-start gap-3\">\n                  <Bell className=\"w-5 h-5 text-blue-600 mt-0.5\" />\n                  <div className=\"flex-1\">\n                    <h4 className=\"font-medium text-blue-900\">Browser Notifications</h4>\n                    <p className=\"text-sm text-blue-800 mt-1\">\n                      {notificationPreferences?.notificationPermissionGranted\n                        ? \"Browser notifications are enabled. You'll receive reminders even when the app is closed.\"\n                        : \"Enable browser notifications to receive reminders even when the app is not open.\"}\n                    </p>\n                    {!notificationPreferences?.notificationPermissionGranted && (\n                      <Button\n                        className=\"mt-3\"\n                        size=\"sm\"\n                        variant=\"outline\"\n                        onClick={async () => {\n                          if ('Notification' in window) {\n                            const permission = await Notification.requestPermission();\n                            if (permission === 'granted') {\n                              updateNotificationPreferences.mutate({ notificationPermissionGranted: true });\n                              toast({\n                                title: \"Notifications Enabled\",\n                                description: \"You'll now receive browser notifications for reminders.\",\n                              });\n                            }\n                          } else {\n                            toast({\n                              title: \"Not Supported\",\n                              description: \"Your browser doesn't support notifications.\",\n                              variant: \"destructive\",\n                            });\n                          }\n                        }}\n                        data-testid=\"button-enable-notifications\"\n                      >\n                        Enable Browser Notifications\n                      </Button>\n                    )}\n                  </div>\n                </div>\n              </div>\n            </>\n          )}\n        </CardContent>\n      </Card>\n\n      {/* Badges Section */}\n      <Card data-testid=\"badges-card\">\n        <CardHeader>\n          <CardTitle className=\"flex items-center gap-2\">\n            <Award className=\"w-5 h-5 text-primary\" />\n            Achievements & Badges\n          </CardTitle>\n          <CardDescription>\n            Earn badges for consistency and dedication to your fitness journey\n          </CardDescription>\n        </CardHeader>\n        <CardContent>\n          {isLoadingBadges ? (\n            <p className=\"text-sm text-gray-500\">Loading your achievements...</p>\n          ) : (\n            <div className=\"space-y-6\">\n              {userBadges && userBadges.length > 0 ? (\n                <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                  {userBadges.map((userBadge) => (\n                    <div\n                      key={userBadge.id}\n                      className=\"flex items-start gap-4 p-4 border rounded-lg bg-gradient-to-br from-amber-50 to-orange-50 border-amber-200\"\n                      data-testid={`badge-${userBadge.badge.name.toLowerCase().replace(/\\s+/g, '-')}`}\n                    >\n                      <div className=\"flex-shrink-0\">\n                        {getBadgeIcon(userBadge.badge.iconName)}\n                      </div>\n                      <div className=\"flex-1 min-w-0\">\n                        <h3 className=\"font-semibold text-lg text-gray-900\">\n                          {userBadge.badge.name}\n                        </h3>\n                        <p className=\"text-sm text-gray-600 mt-1\">\n                          {userBadge.badge.description}\n                        </p>\n                        <p className=\"text-xs text-gray-500 mt-2\">\n                          Earned on {new Date(userBadge.earnedAt).toLocaleDateString(\"en-US\", {\n                            year: \"numeric\",\n                            month: \"long\",\n                            day: \"numeric\",\n                          })}\n                        </p>\n                      </div>\n                    </div>\n                  ))}\n                </div>\n              ) : (\n                <div className=\"bg-gray-50 border border-gray-200 rounded-lg p-6 text-center\">\n                  <Award className=\"w-12 h-12 text-gray-400 mx-auto mb-3\" />\n                  <h4 className=\"font-medium text-gray-900 mb-2\">No badges earned yet</h4>\n                  <p className=\"text-sm text-gray-600 mb-4\">\n                    Keep logging your workouts daily to earn consistency badges!\n                  </p>\n                  <div className=\"space-y-2 text-sm text-gray-700\">\n                    <p className=\"flex items-center justify-center gap-2\">\n                      <Flame className=\"w-4 h-4 text-orange-500\" />\n                      <span>Week Warrior - 7 days streak</span>\n                    </p>\n                    <p className=\"flex items-center justify-center gap-2\">\n                      <Zap className=\"w-4 h-4 text-yellow-500\" />\n                      <span>Fortnight Champion - 14 days streak</span>\n                    </p>\n                    <p className=\"flex items-center justify-center gap-2\">\n                      <Trophy className=\"w-4 h-4 text-amber-500\" />\n                      <span>Monthly Master - 30 days streak</span>\n                    </p>\n                  </div>\n                </div>\n              )}\n              \n              {/* Current Streak Info */}\n              <div className=\"bg-blue-50 border border-blue-200 rounded-lg p-4\">\n                <div className=\"flex items-start gap-3\">\n                  <Flame className=\"w-5 h-5 text-blue-600 mt-0.5\" />\n                  <div>\n                    <h4 className=\"font-medium text-blue-900\">Current Streak: {user?.streak || 0} days</h4>\n                    <p className=\"text-sm text-blue-800 mt-1\">\n                      {user?.streak && user.streak >= 7\n                        ? \"Great job! Keep up the consistent work to maintain your badges.\"\n                        : `Keep logging workouts daily! ${7 - (user?.streak || 0)} more days until your first badge.`}\n                    </p>\n                  </div>\n                </div>\n              </div>\n            </div>\n          )}\n        </CardContent>\n      </Card>\n\n      {/* Subscription Section */}\n      <Card data-testid=\"subscription-card\">\n        <CardHeader>\n          <CardTitle className=\"flex items-center gap-2\">\n            <Crown className=\"w-5 h-5 text-primary\" />\n            Subscription Details\n          </CardTitle>\n          <CardDescription>\n            View and manage your FlexFlow subscription\n          </CardDescription>\n        </CardHeader>\n        <CardContent className=\"space-y-4\">\n          <div className=\"flex items-center justify-between\">\n            <div>\n              <h3 className=\"font-medium flex items-center gap-2\">\n                Current Plan\n                {getStatusBadge(user?.subscriptionStatus || \"inactive\")}\n              </h3>\n              <p className=\"text-sm text-gray-600 mt-1 max-w-md\">\n                {getSubscriptionDescription(user?.subscriptionStatus || \"inactive\")}\n              </p>\n            </div>\n          </div>\n\n          <Separator />\n\n          <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n            <div>\n              <h4 className=\"font-medium text-sm text-gray-700 mb-2\">Subscription Details</h4>\n              <div className=\"space-y-2 text-sm\">\n                <div className=\"flex justify-between\">\n                  <span className=\"text-gray-600\">Status:</span>\n                  <span className=\"font-medium capitalize\">{user?.subscriptionStatus || \"N/A\"}</span>\n                </div>\n                <div className=\"flex justify-between\">\n                  <span className=\"text-gray-600\">Started:</span>\n                  <span className=\"font-medium\">{formatDate(user?.subscriptionStartDate || null)}</span>\n                </div>\n                <div className=\"flex justify-between\">\n                  <span className=\"text-gray-600\">\n                    {user?.subscriptionStatus === \"free_trial\" ? \"Trial Ends:\" : \"Next Billing:\"}\n                  </span>\n                  <span className=\"font-medium\">{formatDate(user?.subscriptionExpiresAt || null)}</span>\n                </div>\n              </div>\n            </div>\n\n            <div>\n              <h4 className=\"font-medium text-sm text-gray-700 mb-2\">Account Information</h4>\n              <div className=\"space-y-2 text-sm\">\n                <div className=\"flex justify-between\">\n                  <span className=\"text-gray-600\">Member Since:</span>\n                  <span className=\"font-medium\">{formatDate(user?.createdAt || null)}</span>\n                </div>\n                <div className=\"flex justify-between\">\n                  <span className=\"text-gray-600\">Last Updated:</span>\n                  <span className=\"font-medium\">{formatDate(user?.updatedAt || null)}</span>\n                </div>\n                {user?.lastPaymentDate && (\n                  <div className=\"flex justify-between\">\n                    <span className=\"text-gray-600\">Last Payment:</span>\n                    <span className=\"font-medium\">{formatDate(user.lastPaymentDate)}</span>\n                  </div>\n                )}\n              </div>\n            </div>\n          </div>\n\n          {user?.subscriptionStatus === \"free_trial\" && (\n            <div className=\"bg-blue-50 border border-blue-200 rounded-lg p-4 mt-4\">\n              <div className=\"flex items-start gap-3\">\n                <Crown className=\"w-5 h-5 text-blue-600 mt-0.5\" />\n                <div>\n                  <h4 className=\"font-medium text-blue-900\">Free Trial Active</h4>\n                  <p className=\"text-sm text-blue-800 mt-1\">\n                    You're currently enjoying full access to all premium features. \n                    Your trial expires on {formatDate(user?.subscriptionExpiresAt)}. \n                    Upgrade now to continue your fitness journey without interruption.\n                  </p>\n                  <Button \n                    className=\"mt-3\" \n                    size=\"sm\"\n                    onClick={() => window.location.href = '#subscription'}\n                    data-testid=\"upgrade-trial-button\"\n                  >\n                    <CreditCard className=\"w-4 h-4 mr-2\" />\n                    Upgrade Now\n                  </Button>\n                </div>\n              </div>\n            </div>\n          )}\n\n          {user?.subscriptionStatus === \"expired\" && (\n            <div className=\"bg-red-50 border border-red-200 rounded-lg p-4 mt-4\">\n              <div className=\"flex items-start gap-3\">\n                <X className=\"w-5 h-5 text-red-600 mt-0.5\" />\n                <div>\n                  <h4 className=\"font-medium text-red-900\">Subscription Expired</h4>\n                  <p className=\"text-sm text-red-800 mt-1\">\n                    Your subscription expired on {formatDate(user?.subscriptionExpiresAt)}. \n                    Renew your subscription to regain access to premium features and continue tracking your progress.\n                  </p>\n                  <Button \n                    className=\"mt-3\" \n                    size=\"sm\"\n                    onClick={() => window.location.href = '#subscription'}\n                    data-testid=\"renew-subscription-button\"\n                  >\n                    <CreditCard className=\"w-4 h-4 mr-2\" />\n                    Renew Subscription\n                  </Button>\n                </div>\n              </div>\n            </div>\n          )}\n\n          {user?.subscriptionStatus === \"active\" && (\n            <div className=\"bg-green-50 border border-green-200 rounded-lg p-4 mt-4\">\n              <div className=\"flex items-start gap-3\">\n                <Check className=\"w-5 h-5 text-green-600 mt-0.5\" />\n                <div>\n                  <h4 className=\"font-medium text-green-900\">Premium Active</h4>\n                  <p className=\"text-sm text-green-800 mt-1\">\n                    You have full access to all premium features. Your subscription will renew on {formatDate(user?.subscriptionExpiresAt)}.\n                  </p>\n                  <div className=\"flex gap-2 mt-3\">\n                    <Button \n                      variant=\"outline\" \n                      size=\"sm\"\n                      onClick={() => window.location.href = '#subscription'}\n                      data-testid=\"manage-subscription-button\"\n                    >\n                      <Settings className=\"w-4 h-4 mr-2\" />\n                      Manage Subscription\n                    </Button>\n                  </div>\n                </div>\n              </div>\n            </div>\n          )}\n        </CardContent>\n      </Card>\n\n      {/* Features Section */}\n      <Card data-testid=\"features-card\">\n        <CardHeader>\n          <CardTitle>Premium Features</CardTitle>\n          <CardDescription>\n            See what's included with your FlexFlow subscription\n          </CardDescription>\n        </CardHeader>\n        <CardContent>\n          <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n            <div className=\"space-y-3\">\n              <div className=\"flex items-center gap-2\">\n                <Check className=\"w-4 h-4 text-green-600\" />\n                <span className=\"text-sm\">Unlimited workout logging</span>\n              </div>\n              <div className=\"flex items-center gap-2\">\n                <Check className=\"w-4 h-4 text-green-600\" />\n                <span className=\"text-sm\">Advanced progress analytics</span>\n              </div>\n              <div className=\"flex items-center gap-2\">\n                <Check className=\"w-4 h-4 text-green-600\" />\n                <span className=\"text-sm\">Personal trainer connections</span>\n              </div>\n              <div className=\"flex items-center gap-2\">\n                <Check className=\"w-4 h-4 text-green-600\" />\n                <span className=\"text-sm\">AI-powered workout recommendations</span>\n              </div>\n            </div>\n            <div className=\"space-y-3\">\n              <div className=\"flex items-center gap-2\">\n                <Check className=\"w-4 h-4 text-green-600\" />\n                <span className=\"text-sm\">Custom goal setting & tracking</span>\n              </div>\n              <div className=\"flex items-center gap-2\">\n                <Check className=\"w-4 h-4 text-green-600\" />\n                <span className=\"text-sm\">Detailed nutrition insights</span>\n              </div>\n              <div className=\"flex items-center gap-2\">\n                <Check className=\"w-4 h-4 text-green-600\" />\n                <span className=\"text-sm\">Export workout data</span>\n              </div>\n              <div className=\"flex items-center gap-2\">\n                <Check className=\"w-4 h-4 text-green-600\" />\n                <span className=\"text-sm\">Priority customer support</span>\n              </div>\n            </div>\n          </div>\n        </CardContent>\n      </Card>\n\n      {/* Account Deletion Section */}\n      <Card className=\"border-red-200\" data-testid=\"account-deletion-card\">\n        <CardHeader>\n          <CardTitle className=\"flex items-center gap-2 text-red-600\">\n            <Trash2 className=\"w-5 h-5\" />\n            Delete Account\n          </CardTitle>\n          <CardDescription>\n            Permanently delete your account and all associated data\n          </CardDescription>\n        </CardHeader>\n        <CardContent>\n          <div className=\"space-y-4\">\n            <div className=\"bg-red-50 border border-red-200 rounded-lg p-4\">\n              <div className=\"flex items-start gap-3\">\n                <AlertTriangle className=\"w-5 h-5 text-red-600 mt-0.5 flex-shrink-0\" />\n                <div>\n                  <h4 className=\"font-medium text-red-900\">Warning: This action cannot be undone</h4>\n                  <p className=\"text-sm text-red-800 mt-1\">\n                    Deleting your account will permanently remove:\n                  </p>\n                  <ul className=\"text-sm text-red-800 mt-2 space-y-1 ml-4 list-disc\">\n                    <li>All your workout history and progress photos</li>\n                    <li>All your goals, meal plans, and food tracking data</li>\n                    <li>Your community posts and trainer reviews</li>\n                    <li>Your subscription and payment information</li>\n                    <li>Your personal profile and preferences</li>\n                  </ul>\n                </div>\n              </div>\n            </div>\n\n            <AlertDialog open={isDeleteDialogOpen} onOpenChange={setIsDeleteDialogOpen}>\n              <AlertDialogTrigger asChild>\n                <Button \n                  variant=\"destructive\" \n                  data-testid=\"delete-account-button\"\n                  className=\"w-full sm:w-auto\"\n                >\n                  <Trash2 className=\"w-4 h-4 mr-2\" />\n                  Delete My Account\n                </Button>\n              </AlertDialogTrigger>\n              <AlertDialogContent>\n                <AlertDialogHeader>\n                  <AlertDialogTitle>Are you absolutely sure?</AlertDialogTitle>\n                  <AlertDialogDescription>\n                    This action cannot be undone. This will permanently delete your account\n                    and remove all of your data from our servers, including:\n                    <ul className=\"mt-2 space-y-1 ml-4 list-disc\">\n                      <li>All workout history and exercise logs</li>\n                      <li>Progress photos and measurements</li>\n                      <li>Meal plans and nutrition tracking data</li>\n                      <li>Goals and achievements</li>\n                      <li>Community posts and interactions</li>\n                      <li>Subscription and billing information</li>\n                    </ul>\n                  </AlertDialogDescription>\n                </AlertDialogHeader>\n                <AlertDialogFooter>\n                  <AlertDialogCancel data-testid=\"cancel-delete-button\">\n                    Cancel\n                  </AlertDialogCancel>\n                  <AlertDialogAction\n                    onClick={() => deleteAccountMutation.mutate()}\n                    disabled={deleteAccountMutation.isPending}\n                    className=\"bg-red-600 hover:bg-red-700\"\n                    data-testid=\"confirm-delete-button\"\n                  >\n                    {deleteAccountMutation.isPending ? \"Deleting...\" : \"Yes, delete my account\"}\n                  </AlertDialogAction>\n                </AlertDialogFooter>\n              </AlertDialogContent>\n            </AlertDialog>\n          </div>\n        </CardContent>\n      </Card>\n    </div>\n  );\n}","size_bytes":31482},"client/src/components/workout-recommendations.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { Dumbbell, Heart, Leaf, ChevronRight, RefreshCw, Activity, Weight, Bike } from \"lucide-react\";\n\nexport default function WorkoutRecommendations() {\n  const [currentRecommendations, setCurrentRecommendations] = useState<any[]>([]);\n  const [isRefreshing, setIsRefreshing] = useState(false);\n\n  // Pool of all possible workouts\n  const workoutPool = [\n    { name: \"Full Body HIIT\", details: \"30 min • High intensity\", icon: Dumbbell, color: \"primary\", bgColor: \"blue\" },\n    { name: \"Cardio Blast\", details: \"20 min • Moderate intensity\", icon: Heart, color: \"secondary\", bgColor: \"green\" },\n    { name: \"Recovery Yoga\", details: \"25 min • Low intensity\", icon: Leaf, color: \"purple-600\", bgColor: \"purple\" },\n    { name: \"Strength Training\", details: \"45 min • High intensity\", icon: Weight, color: \"primary\", bgColor: \"red\" },\n    { name: \"Morning Run\", details: \"25 min • Moderate intensity\", icon: Activity, color: \"secondary\", bgColor: \"green\" },\n    { name: \"Cycling Adventure\", details: \"40 min • Moderate intensity\", icon: Bike, color: \"secondary\", bgColor: \"yellow\" },\n    { name: \"Core Crusher\", details: \"15 min • High intensity\", icon: Dumbbell, color: \"primary\", bgColor: \"orange\" },\n    { name: \"Flexibility Flow\", details: \"20 min • Low intensity\", icon: Leaf, color: \"purple-600\", bgColor: \"pink\" },\n    { name: \"Upper Body Blast\", details: \"35 min • High intensity\", icon: Weight, color: \"primary\", bgColor: \"blue\" },\n    { name: \"Dance Cardio\", details: \"30 min • Moderate intensity\", icon: Heart, color: \"secondary\", bgColor: \"purple\" },\n    { name: \"Swimming Laps\", details: \"45 min • Low intensity\", icon: Activity, color: \"secondary\", bgColor: \"blue\" },\n    { name: \"Pilates Power\", details: \"30 min • Moderate intensity\", icon: Leaf, color: \"purple-600\", bgColor: \"green\" },\n    { name: \"Kettlebell Circuit\", details: \"25 min • High intensity\", icon: Weight, color: \"primary\", bgColor: \"red\" },\n    { name: \"Beach Body Bootcamp\", details: \"35 min • High intensity\", icon: Dumbbell, color: \"primary\", bgColor: \"orange\" },\n    { name: \"Mindful Stretching\", details: \"15 min • Low intensity\", icon: Leaf, color: \"purple-600\", bgColor: \"pink\" }\n  ];\n\n  // Get daily seed based on date\n  const getDailySeed = () => {\n    const today = new Date();\n    return today.getFullYear() * 10000 + (today.getMonth() + 1) * 100 + today.getDate();\n  };\n\n  // Seeded random function for consistent daily recommendations\n  const seededRandom = (seed: number) => {\n    const x = Math.sin(seed) * 10000;\n    return x - Math.floor(x);\n  };\n\n  // Generate daily recommendations\n  const generateDailyRecommendations = (forceRefresh = false) => {\n    const seed = forceRefresh ? Date.now() : getDailySeed();\n    const shuffled = [...workoutPool];\n    \n    // Shuffle array using seeded random\n    for (let i = shuffled.length - 1; i > 0; i--) {\n      const j = Math.floor(seededRandom(seed + i) * (i + 1));\n      [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];\n    }\n    \n    return shuffled.slice(0, 3);\n  };\n\n  // Handle refresh button click\n  const handleRefresh = () => {\n    setIsRefreshing(true);\n    \n    setTimeout(() => {\n      const newRecommendations = generateDailyRecommendations(true);\n      setCurrentRecommendations(newRecommendations);\n      setIsRefreshing(false);\n    }, 500);\n  };\n\n  // Initialize daily recommendations on component mount\n  useEffect(() => {\n    const dailyRecommendations = generateDailyRecommendations();\n    setCurrentRecommendations(dailyRecommendations);\n  }, []);\n\n  return (\n    <section className=\"relative bg-gradient-to-br from-black via-red-900/30 to-black rounded-3xl shadow-2xl border border-red-600/50 p-8 overflow-hidden hexagon-bg hexagon-pattern\">\n      {/* Animated red and black background elements */}\n      <div className=\"absolute inset-0\">\n        {/* Floating red hexagons */}\n        <div className=\"absolute top-0 left-0 w-32 h-28 opacity-30 animate-pulse\" style={{animationDuration: '4s'}}>\n          <svg viewBox=\"0 0 120 104\" className=\"w-full h-full\">\n            <polygon points=\"30,2 90,2 120,52 90,102 30,102 0,52\" fill=\"#dc2626\" stroke=\"#dc2626\" strokeWidth=\"2\" opacity=\"0.6\"/>\n          </svg>\n        </div>\n        <div className=\"absolute top-1/4 right-0 w-24 h-21 opacity-20 animate-bounce\" style={{animationDuration: '6s'}}>\n          <svg viewBox=\"0 0 120 104\" className=\"w-full h-full\">\n            <polygon points=\"30,2 90,2 120,52 90,102 30,102 0,52\" fill=\"none\" stroke=\"#dc2626\" strokeWidth=\"2\" opacity=\"0.8\"/>\n          </svg>\n        </div>\n        <div className=\"absolute bottom-0 left-1/3 w-28 h-24 opacity-25 animate-ping\" style={{animationDuration: '8s', animationDelay: '1s'}}>\n          <svg viewBox=\"0 0 120 104\" className=\"w-full h-full\">\n            <polygon points=\"30,2 90,2 120,52 90,102 30,102 0,52\" fill=\"#000000\" stroke=\"#dc2626\" strokeWidth=\"1\" opacity=\"0.7\"/>\n          </svg>\n        </div>\n        <div className=\"absolute bottom-1/4 right-1/4 w-20 h-17 opacity-15 animate-pulse\" style={{animationDuration: '5s', animationDelay: '2s'}}>\n          <svg viewBox=\"0 0 120 104\" className=\"w-full h-full\">\n            <polygon points=\"30,2 90,2 120,52 90,102 30,102 0,52\" fill=\"#dc2626\" stroke=\"#000000\" strokeWidth=\"1\" opacity=\"0.5\"/>\n          </svg>\n        </div>\n        <div className=\"absolute top-1/2 left-10 w-22 h-19 opacity-20 animate-bounce\" style={{animationDuration: '7s', animationDelay: '0.5s'}}>\n          <svg viewBox=\"0 0 120 104\" className=\"w-full h-full\">\n            <polygon points=\"30,2 90,2 120,52 90,102 30,102 0,52\" fill=\"none\" stroke=\"#dc2626\" strokeWidth=\"2\" opacity=\"0.4\"/>\n          </svg>\n        </div>\n        \n        {/* Animated red gradient orbs */}\n        <div className=\"absolute top-1/3 right-1/3 w-40 h-40 bg-gradient-to-br from-red-600/20 to-black/40 rounded-full blur-3xl opacity-30 animate-pulse\" style={{animationDuration: '6s'}}></div>\n        <div className=\"absolute bottom-1/3 left-1/4 w-32 h-32 bg-gradient-to-br from-black/60 to-red-600/20 rounded-full blur-2xl opacity-20 animate-ping\" style={{animationDuration: '10s'}}></div>\n        \n        {/* Dynamic radial gradient overlay */}\n        <div className=\"absolute inset-0 bg-gradient-radial from-transparent via-red-900/10 to-black/60 animate-pulse\" style={{animationDuration: '8s'}}></div>\n      </div>\n      {/* Content wrapper */}\n      <div className=\"relative z-10\">\n      <div className=\"flex items-center justify-between mb-6\">\n        <h3 className=\"text-2xl font-bold text-white drop-shadow-lg\">Recommended Workouts</h3>\n        <button \n          onClick={handleRefresh}\n          disabled={isRefreshing}\n          className=\"flex items-center space-x-1 text-gray-300 hover:text-cyan-300 text-sm font-medium transition-colors disabled:opacity-50\"\n          data-testid=\"refresh-workouts-button\"\n        >\n          <RefreshCw className={`w-4 h-4 ${isRefreshing ? 'animate-spin' : ''}`} />\n          <span>{isRefreshing ? 'Refreshing...' : 'Refresh'}</span>\n        </button>\n      </div>\n\n      <div className=\"space-y-3\">\n        {currentRecommendations.map((recommendation, index) => {\n          const IconComponent = recommendation.icon;\n          return (\n            <div\n              key={`${recommendation.name}-${index}`}\n              className=\"flex items-center space-x-4 p-3 bg-white/10 backdrop-blur-sm rounded-xl hover:bg-white/15 transition-all cursor-pointer border border-white/20\"\n              data-testid={`workout-recommendation-${index}`}\n            >\n              <div className=\"bg-white/20 rounded-lg p-2\">\n                <IconComponent className=\"text-cyan-300\" />\n              </div>\n              <div className=\"flex-1\">\n                <h4 className=\"font-medium text-white\">{recommendation.name}</h4>\n                <p className=\"text-sm text-gray-300\">{recommendation.details}</p>\n              </div>\n              <ChevronRight className=\"text-gray-300\" />\n            </div>\n          );\n        })}\n      </div>\n      </div>\n    </section>\n  );\n}","size_bytes":8092},"client/src/components/difficulty-notifications.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery, useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport { Bell, BellRing, CheckCircle, X, TrendingUp, Zap, Brain, Target } from \"lucide-react\";\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport { useToast } from \"@/hooks/use-toast\";\n\ninterface PendingAdjustment {\n  id: string;\n  exerciseId: string;\n  currentDifficulty: number;\n  suggestedDifficulty: number;\n  confidenceScore: number;\n  reasoningFactors: any;\n  performanceTrend: \"improving\" | \"declining\" | \"stable\";\n  createdAt: string;\n}\n\ninterface AIRecommendation {\n  exerciseId: string;\n  exerciseName: string;\n  recommendedDifficulty: number;\n  reason: string;\n  confidence: number;\n}\n\ninterface RecommendationsData {\n  exercises: AIRecommendation[];\n  overallRecommendation: string;\n}\n\nexport default function DifficultyNotifications() {\n  const [showNotifications, setShowNotifications] = useState(false);\n  const { toast } = useToast();\n  const queryClient = useQueryClient();\n\n  // Fetch pending AI adjustments\n  const { data: pendingAdjustments, isLoading: loadingPending } = useQuery<PendingAdjustment[]>({\n    queryKey: [\"/api/ai-adjustments/pending\"],\n    refetchInterval: 30000, // Refetch every 30 seconds\n  });\n\n  // Fetch AI recommendations\n  const { data: recommendations, isLoading: loadingRecommendations } = useQuery<RecommendationsData>({\n    queryKey: [\"/api/ai-recommendations\"],\n    refetchInterval: 60000, // Refetch every minute\n  });\n\n  // Apply adjustments mutation\n  const applyAdjustmentsMutation = useMutation({\n    mutationFn: async (exerciseIds: string[]) => {\n      const response = await apiRequest(\"POST\", \"/api/ai-adjustments/apply\", { exerciseIds });\n      return response.json();\n    },\n    onSuccess: (data) => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/ai-adjustments/pending\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/ai-recommendations\"] });\n      toast({\n        title: \"🎯 Adjustments Applied!\",\n        description: `Successfully applied ${data.appliedCount} difficulty adjustments`,\n      });\n    },\n    onError: () => {\n      toast({\n        title: \"Error\",\n        description: \"Failed to apply difficulty adjustments. Please try again.\",\n        variant: \"destructive\",\n      });\n    }\n  });\n\n  const handleApplyAll = () => {\n    if (pendingAdjustments && pendingAdjustments.length > 0) {\n      const exerciseIds = pendingAdjustments.map(adj => adj.exerciseId);\n      applyAdjustmentsMutation.mutate(exerciseIds);\n    }\n  };\n\n  const handleApplySpecific = (exerciseId: string) => {\n    applyAdjustmentsMutation.mutate([exerciseId]);\n  };\n\n  const getTrendIcon = (trend: string) => {\n    switch (trend) {\n      case \"improving\":\n        return <TrendingUp className=\"w-4 h-4 text-green-500\" />;\n      case \"declining\":\n        return <Target className=\"w-4 h-4 text-red-500\" />;\n      default:\n        return <Zap className=\"w-4 h-4 text-yellow-500\" />;\n    }\n  };\n\n  const getConfidenceColor = (confidence: number) => {\n    if (confidence >= 80) return \"bg-green-100 text-green-800 border-green-300\";\n    if (confidence >= 60) return \"bg-yellow-100 text-yellow-800 border-yellow-300\";\n    return \"bg-blue-100 text-blue-800 border-blue-300\";\n  };\n\n  const getDifficultyBadge = (current: number, suggested: number) => {\n    const isIncrease = suggested > current;\n    return (\n      <div className=\"flex items-center gap-2\">\n        <Badge variant=\"outline\" className=\"bg-gray-100\">\n          Level {current}\n        </Badge>\n        <span className=\"text-gray-400\">→</span>\n        <Badge \n          variant=\"outline\" \n          className={isIncrease ? \"bg-red-100 text-red-800\" : \"bg-green-100 text-green-800\"}\n        >\n          Level {suggested}\n        </Badge>\n      </div>\n    );\n  };\n\n  const totalNotifications = (pendingAdjustments?.length || 0) + (recommendations?.exercises?.length || 0);\n\n  return (\n    <div className=\"relative\">\n      {/* Notification Bell */}\n      <button\n        onClick={() => setShowNotifications(!showNotifications)}\n        className={`relative p-2 rounded-full transition-colors ${\n          totalNotifications > 0\n            ? \"bg-red-500 text-white hover:bg-red-600\"\n            : \"bg-gray-100 text-gray-600 hover:bg-gray-200\"\n        }`}\n        data-testid=\"notification-bell\"\n      >\n        {totalNotifications > 0 ? <BellRing className=\"w-6 h-6\" /> : <Bell className=\"w-6 h-6\" />}\n        \n        {totalNotifications > 0 && (\n          <div className=\"absolute -top-1 -right-1 bg-yellow-500 text-white text-xs rounded-full w-5 h-5 flex items-center justify-center\">\n            {totalNotifications > 9 ? \"9+\" : totalNotifications}\n          </div>\n        )}\n      </button>\n\n      {/* Notifications Panel */}\n      {showNotifications && (\n        <div className=\"absolute -right-36 sm:-right-32 md:-right-24 top-12 w-72 sm:w-80 md:w-96 bg-white rounded-2xl shadow-2xl border border-gray-200 z-40 max-h-[50vh] md:max-h-[70vh] overflow-hidden\">\n          {/* Header */}\n          <div className=\"bg-gradient-to-r from-red-600 to-orange-600 text-white p-3 md:p-4 rounded-t-2xl\">\n            <div className=\"flex items-center justify-between\">\n              <div className=\"flex items-center gap-2\">\n                <Brain className=\"w-4 h-4 md:w-5 md:h-5\" />\n                <h3 className=\"font-semibold text-sm md:text-base\">AI Fitness Coach</h3>\n              </div>\n              <button\n                onClick={() => setShowNotifications(false)}\n                className=\"text-white/80 hover:text-white\"\n                data-testid=\"close-notifications\"\n              >\n                <X className=\"w-4 h-4 md:w-5 md:h-5\" />\n              </button>\n            </div>\n            <p className=\"text-red-100 text-xs md:text-sm mt-1\">\n              {totalNotifications > 0 \n                ? `${totalNotifications} intelligent suggestions waiting`\n                : \"No new suggestions\"\n              }\n            </p>\n          </div>\n\n          <div className=\"max-h-64 md:max-h-80 overflow-y-auto\">\n            {/* Overall Recommendation */}\n            {recommendations?.overallRecommendation && (\n              <div className=\"p-3 md:p-4 bg-gradient-to-r from-purple-50 to-blue-50 border-b\">\n                <h4 className=\"font-medium text-purple-800 mb-2 text-sm md:text-base\">🎯 Overall Assessment</h4>\n                <p className=\"text-xs md:text-sm text-purple-700\">{recommendations.overallRecommendation}</p>\n              </div>\n            )}\n\n            {/* Pending Adjustments */}\n            {pendingAdjustments && pendingAdjustments.length > 0 && (\n              <div className=\"border-b\">\n                <div className=\"p-3 md:p-4 bg-gray-50\">\n                  <div className=\"flex items-center justify-between\">\n                    <h4 className=\"font-medium text-gray-800 flex items-center gap-2 text-sm md:text-base\">\n                      <CheckCircle className=\"w-4 h-4 text-green-500\" />\n                      Ready to Apply ({pendingAdjustments.length})\n                    </h4>\n                    <Button\n                      size=\"sm\"\n                      onClick={handleApplyAll}\n                      disabled={applyAdjustmentsMutation.isPending}\n                      className=\"bg-red-600 hover:bg-red-700 text-xs md:text-sm\"\n                      data-testid=\"apply-all-button\"\n                    >\n                      Apply All\n                    </Button>\n                  </div>\n                </div>\n\n                <div className=\"space-y-0\">\n                  {pendingAdjustments.map((adjustment) => (\n                    <div key={adjustment.id} className=\"p-3 md:p-4 border-b border-gray-100 hover:bg-gray-50\">\n                      <div className=\"flex items-start justify-between\">\n                        <div className=\"flex-1\">\n                          <div className=\"flex items-center gap-2 mb-2\">\n                            {getTrendIcon(adjustment.performanceTrend)}\n                            <span className=\"font-medium text-gray-800 text-sm md:text-base\">Exercise Adjustment</span>\n                            <Badge \n                              variant=\"outline\" \n                              className={`${getConfidenceColor(adjustment.confidenceScore)} text-xs`}\n                            >\n                              {adjustment.confidenceScore}% confident\n                            </Badge>\n                          </div>\n                          \n                          {getDifficultyBadge(adjustment.currentDifficulty, adjustment.suggestedDifficulty)}\n                          \n                          <p className=\"text-xs md:text-sm text-gray-600 mt-2\">\n                            Performance trend: <strong>{adjustment.performanceTrend}</strong>\n                          </p>\n                        </div>\n                        \n                        <Button\n                          size=\"sm\"\n                          variant=\"outline\"\n                          onClick={() => handleApplySpecific(adjustment.exerciseId)}\n                          disabled={applyAdjustmentsMutation.isPending}\n                          className=\"ml-2 shrink-0 text-xs md:text-sm\"\n                          data-testid={`apply-${adjustment.exerciseId}`}\n                        >\n                          Apply\n                        </Button>\n                      </div>\n                    </div>\n                  ))}\n                </div>\n              </div>\n            )}\n\n            {/* AI Recommendations */}\n            {recommendations?.exercises && recommendations.exercises.length > 0 && (\n              <div>\n                <div className=\"p-3 md:p-4 bg-blue-50\">\n                  <h4 className=\"font-medium text-blue-800 flex items-center gap-2 text-sm md:text-base\">\n                    <Brain className=\"w-4 h-4\" />\n                    Smart Recommendations ({recommendations.exercises.length})\n                  </h4>\n                  <p className=\"text-xs text-blue-600 mt-1\">Based on your performance patterns</p>\n                </div>\n\n                <div className=\"space-y-0\">\n                  {recommendations.exercises.map((rec) => (\n                    <div key={rec.exerciseId} className=\"p-3 md:p-4 border-b border-gray-100\">\n                      <div className=\"flex items-start justify-between\">\n                        <div className=\"flex-1\">\n                          <h5 className=\"font-medium text-gray-800 text-sm md:text-base\">{rec.exerciseName}</h5>\n                          <div className=\"flex items-center gap-2 mt-1 mb-2\">\n                            <Badge variant=\"outline\" className=\"bg-orange-100 text-orange-800 text-xs\">\n                              Level {rec.recommendedDifficulty}\n                            </Badge>\n                            <Badge \n                              variant=\"outline\" \n                              className={`${getConfidenceColor(rec.confidence)} text-xs`}\n                            >\n                              {rec.confidence}% match\n                            </Badge>\n                          </div>\n                          <p className=\"text-xs md:text-sm text-gray-600\">{rec.reason}</p>\n                        </div>\n                      </div>\n                    </div>\n                  ))}\n                </div>\n              </div>\n            )}\n\n            {/* No Notifications */}\n            {totalNotifications === 0 && !loadingPending && !loadingRecommendations && (\n              <div className=\"p-6 md:p-8 text-center\">\n                <div className=\"text-gray-400 mb-4\">\n                  <Brain className=\"w-10 h-10 md:w-12 md:h-12 mx-auto opacity-50\" />\n                </div>\n                <h4 className=\"font-medium text-gray-600 mb-2 text-sm md:text-base\">All Caught Up!</h4>\n                <p className=\"text-xs md:text-sm text-gray-500\">\n                  Complete more workouts for personalized difficulty suggestions.\n                </p>\n              </div>\n            )}\n\n            {/* Loading State */}\n            {(loadingPending || loadingRecommendations) && (\n              <div className=\"p-6 md:p-8 text-center\">\n                <div className=\"animate-spin w-6 h-6 border-2 border-red-600 border-t-transparent rounded-full mx-auto mb-4\"></div>\n                <p className=\"text-xs md:text-sm text-gray-500\">Loading AI suggestions...</p>\n              </div>\n            )}\n          </div>\n\n          {/* Footer */}\n          <div className=\"p-2 md:p-3 bg-gray-50 rounded-b-2xl border-t text-center\">\n            <p className=\"text-xs text-gray-500\">\n              🤖 Powered by AI • Updates automatically based on your workouts\n            </p>\n          </div>\n        </div>\n      )}\n    </div>\n  );\n}","size_bytes":12922},"client/src/components/profile-completion-guard.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { useNewAuth } from \"@/hooks/useNewAuth\";\nimport ProfileEditor from \"@/components/profile-editor\";\nimport type { User } from \"@shared/schema\";\n\ninterface ProfileCompletionGuardProps {\n  children: React.ReactNode;\n}\n\nexport default function ProfileCompletionGuard({ children }: ProfileCompletionGuardProps) {\n  const { user, isLoading } = useNewAuth();\n  const [showProfileSetup, setShowProfileSetup] = useState(false);\n\n  useEffect(() => {\n    if (!isLoading && user) {\n      // Check if user needs to complete their profile\n      const userData = user as User;\n      const needsProfileCompletion = !userData.firstName || !userData.lastName;\n      setShowProfileSetup(needsProfileCompletion);\n    } else if (!isLoading && !user) {\n      // User is not authenticated, let the router handle it\n      setShowProfileSetup(false);\n    }\n  }, [user, isLoading]);\n\n  if (isLoading) {\n    return (\n      <div className=\"h-screen flex items-center justify-center bg-gray-50 dark:bg-black\">\n        <div className=\"animate-spin w-8 h-8 border-4 border-primary border-t-transparent rounded-full\" aria-label=\"Loading\"/>\n      </div>\n    );\n  }\n\n  if (showProfileSetup) {\n    return (\n      <div className=\"min-h-screen bg-gray-50 dark:bg-black flex items-center justify-center p-4\">\n        <div className=\"bg-white dark:bg-gray-900 rounded-2xl shadow-2xl p-8 max-w-md w-full\">\n          <div className=\"text-center mb-6\">\n            <div className=\"w-16 h-16 bg-red-600 rounded-full flex items-center justify-center mx-auto mb-4\">\n              <span className=\"text-2xl text-white\">👋</span>\n            </div>\n            <h1 className=\"text-2xl font-bold text-gray-900 dark:text-white mb-2\">\n              Welcome to FlexFlow!\n            </h1>\n            <p className=\"text-gray-600 dark:text-gray-300\">\n              Let's complete your profile to personalize your fitness journey.\n            </p>\n          </div>\n\n          <ProfileEditor \n            isOpen={true}\n            setIsOpen={(open) => {\n              if (!open) {\n                // When profile editor closes, check if profile is now complete\n                setTimeout(() => {\n                  window.location.reload();\n                }, 500);\n              }\n            }}\n          />\n        </div>\n      </div>\n    );\n  }\n\n  return <>{children}</>;\n}","size_bytes":2376},"server/replitAuth.ts":{"content":"import * as client from \"openid-client\";\nimport { Strategy, type VerifyFunction } from \"openid-client/passport\";\n\nimport passport from \"passport\";\nimport session from \"express-session\";\nimport type { Express, RequestHandler } from \"express\";\nimport memoize from \"memoizee\";\nimport connectPg from \"connect-pg-simple\";\nimport { storage } from \"./storage\";\n\nif (!process.env.REPLIT_DOMAINS) {\n  throw new Error(\"Environment variable REPLIT_DOMAINS not provided\");\n}\n\nconst getOidcConfig = memoize(\n  async () => {\n    return await client.discovery(\n      new URL(process.env.ISSUER_URL ?? \"https://replit.com/oidc\"),\n      process.env.REPL_ID!\n    );\n  },\n  { maxAge: 3600 * 1000 }\n);\n\nexport function getSession() {\n  const sessionTtl = 7 * 24 * 60 * 60 * 1000; // 1 week\n  const pgStore = connectPg(session);\n  const sessionStore = new pgStore({\n    conString: process.env.DATABASE_URL,\n    createTableIfMissing: false,\n    ttl: sessionTtl,\n    tableName: \"sessions\",\n  });\n  return session({\n    secret: process.env.SESSION_SECRET!,\n    store: sessionStore,\n    resave: false,\n    saveUninitialized: false,\n    cookie: {\n      httpOnly: true,\n      secure: process.env.NODE_ENV === \"production\",\n      maxAge: sessionTtl,\n    },\n  });\n}\n\nfunction updateUserSession(\n  user: any,\n  tokens: client.TokenEndpointResponse & client.TokenEndpointResponseHelpers\n) {\n  user.claims = tokens.claims();\n  user.access_token = tokens.access_token;\n  user.refresh_token = tokens.refresh_token;\n  user.expires_at = user.claims?.exp;\n}\n\nasync function upsertUser(\n  claims: any,\n) {\n  await storage.upsertUser({\n    id: claims[\"sub\"],\n    email: claims[\"email\"],\n    firstName: claims[\"first_name\"],\n    lastName: claims[\"last_name\"],\n    profileImageUrl: claims[\"profile_image_url\"],\n  });\n}\n\nexport async function setupAuth(app: Express) {\n  app.set(\"trust proxy\", 1);\n  app.use(getSession());\n  app.use(passport.initialize());\n  app.use(passport.session());\n\n  const config = await getOidcConfig();\n\n  const verify: VerifyFunction = async (\n    tokens: client.TokenEndpointResponse & client.TokenEndpointResponseHelpers,\n    verified: passport.AuthenticateCallback\n  ) => {\n    const user = {};\n    updateUserSession(user, tokens);\n    await upsertUser(tokens.claims());\n    verified(null, user);\n  };\n\n  for (const domain of process.env\n    .REPLIT_DOMAINS!.split(\",\")) {\n    const strategy = new Strategy(\n      {\n        name: `replitauth:${domain}`,\n        config,\n        scope: \"openid email profile offline_access\",\n        callbackURL: `https://${domain}/api/callback`,\n      },\n      verify,\n    );\n    passport.use(strategy);\n  }\n\n  passport.serializeUser((user: Express.User, cb) => cb(null, user));\n  passport.deserializeUser((user: Express.User, cb) => cb(null, user));\n\n  app.get(\"/api/login\", (req, res, next) => {\n    passport.authenticate(`replitauth:${req.hostname}`, {\n      prompt: \"login consent\",\n      scope: [\"openid\", \"email\", \"profile\", \"offline_access\"],\n    })(req, res, next);\n  });\n\n  app.get(\"/api/callback\", (req, res, next) => {\n    passport.authenticate(`replitauth:${req.hostname}`, {\n      successReturnToOrRedirect: \"/\",\n      failureRedirect: \"/api/login\",\n    })(req, res, next);\n  });\n\n  app.get(\"/api/logout\", (req, res) => {\n    req.logout(() => {\n      res.redirect(\n        client.buildEndSessionUrl(config, {\n          client_id: process.env.REPL_ID!,\n          post_logout_redirect_uri: `${req.protocol}://${req.hostname}`,\n        }).href\n      );\n    });\n  });\n}\n\nexport const isAuthenticated: RequestHandler = async (req, res, next) => {\n  const user = req.user as any;\n\n  if (!req.isAuthenticated() || !user.expires_at) {\n    return res.status(401).json({ message: \"Unauthorized\" });\n  }\n\n  const now = Math.floor(Date.now() / 1000);\n  if (now <= user.expires_at) {\n    return next();\n  }\n\n  const refreshToken = user.refresh_token;\n  if (!refreshToken) {\n    res.status(401).json({ message: \"Unauthorized\" });\n    return;\n  }\n\n  try {\n    const config = await getOidcConfig();\n    const tokenResponse = await client.refreshTokenGrant(config, refreshToken);\n    updateUserSession(user, tokenResponse);\n    return next();\n  } catch (error) {\n    res.status(401).json({ message: \"Unauthorized\" });\n    return;\n  }\n};","size_bytes":4253},"client/src/components/ui/dropdown-menu.tsx":{"content":"import * as React from \"react\"\nimport * as DropdownMenuPrimitive from \"@radix-ui/react-dropdown-menu\"\nimport { Check, ChevronRight, Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst DropdownMenu = DropdownMenuPrimitive.Root\n\nconst DropdownMenuTrigger = DropdownMenuPrimitive.Trigger\n\nconst DropdownMenuGroup = DropdownMenuPrimitive.Group\n\nconst DropdownMenuPortal = DropdownMenuPrimitive.Portal\n\nconst DropdownMenuSub = DropdownMenuPrimitive.Sub\n\nconst DropdownMenuRadioGroup = DropdownMenuPrimitive.RadioGroup\n\nconst DropdownMenuSubTrigger = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.SubTrigger>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.SubTrigger> & {\n    inset?: boolean\n  }\n>(({ className, inset, children, ...props }, ref) => (\n  <DropdownMenuPrimitive.SubTrigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent data-[state=open]:bg-accent [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <ChevronRight className=\"ml-auto\" />\n  </DropdownMenuPrimitive.SubTrigger>\n))\nDropdownMenuSubTrigger.displayName =\n  DropdownMenuPrimitive.SubTrigger.displayName\n\nconst DropdownMenuSubContent = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.SubContent>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.SubContent>\n>(({ className, ...props }, ref) => (\n  <DropdownMenuPrimitive.SubContent\n    ref={ref}\n    className={cn(\n      \"z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-dropdown-menu-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nDropdownMenuSubContent.displayName =\n  DropdownMenuPrimitive.SubContent.displayName\n\nconst DropdownMenuContent = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Content>\n>(({ className, sideOffset = 4, ...props }, ref) => (\n  <DropdownMenuPrimitive.Portal>\n    <DropdownMenuPrimitive.Content\n      ref={ref}\n      sideOffset={sideOffset}\n      className={cn(\n        \"z-50 max-h-[var(--radix-dropdown-menu-content-available-height)] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-dropdown-menu-content-transform-origin]\",\n        className\n      )}\n      {...props}\n    />\n  </DropdownMenuPrimitive.Portal>\n))\nDropdownMenuContent.displayName = DropdownMenuPrimitive.Content.displayName\n\nconst DropdownMenuItem = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Item> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <DropdownMenuPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nDropdownMenuItem.displayName = DropdownMenuPrimitive.Item.displayName\n\nconst DropdownMenuCheckboxItem = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.CheckboxItem>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.CheckboxItem>\n>(({ className, children, checked, ...props }, ref) => (\n  <DropdownMenuPrimitive.CheckboxItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    checked={checked}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <DropdownMenuPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </DropdownMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </DropdownMenuPrimitive.CheckboxItem>\n))\nDropdownMenuCheckboxItem.displayName =\n  DropdownMenuPrimitive.CheckboxItem.displayName\n\nconst DropdownMenuRadioItem = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.RadioItem>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.RadioItem>\n>(({ className, children, ...props }, ref) => (\n  <DropdownMenuPrimitive.RadioItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <DropdownMenuPrimitive.ItemIndicator>\n        <Circle className=\"h-2 w-2 fill-current\" />\n      </DropdownMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </DropdownMenuPrimitive.RadioItem>\n))\nDropdownMenuRadioItem.displayName = DropdownMenuPrimitive.RadioItem.displayName\n\nconst DropdownMenuLabel = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Label> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <DropdownMenuPrimitive.Label\n    ref={ref}\n    className={cn(\n      \"px-2 py-1.5 text-sm font-semibold\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nDropdownMenuLabel.displayName = DropdownMenuPrimitive.Label.displayName\n\nconst DropdownMenuSeparator = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <DropdownMenuPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-muted\", className)}\n    {...props}\n  />\n))\nDropdownMenuSeparator.displayName = DropdownMenuPrimitive.Separator.displayName\n\nconst DropdownMenuShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\"ml-auto text-xs tracking-widest opacity-60\", className)}\n      {...props}\n    />\n  )\n}\nDropdownMenuShortcut.displayName = \"DropdownMenuShortcut\"\n\nexport {\n  DropdownMenu,\n  DropdownMenuTrigger,\n  DropdownMenuContent,\n  DropdownMenuItem,\n  DropdownMenuCheckboxItem,\n  DropdownMenuRadioItem,\n  DropdownMenuLabel,\n  DropdownMenuSeparator,\n  DropdownMenuShortcut,\n  DropdownMenuGroup,\n  DropdownMenuPortal,\n  DropdownMenuSub,\n  DropdownMenuSubContent,\n  DropdownMenuSubTrigger,\n  DropdownMenuRadioGroup,\n}\n","size_bytes":7609},"client/src/hooks/use-toast.ts":{"content":"import * as React from \"react\"\n\nimport type {\n  ToastActionElement,\n  ToastProps,\n} from \"@/components/ui/toast\"\n\nconst TOAST_LIMIT = 1\nconst TOAST_REMOVE_DELAY = 5000\n\ntype ToasterToast = ToastProps & {\n  id: string\n  title?: React.ReactNode\n  description?: React.ReactNode\n  action?: ToastActionElement\n}\n\nconst actionTypes = {\n  ADD_TOAST: \"ADD_TOAST\",\n  UPDATE_TOAST: \"UPDATE_TOAST\",\n  DISMISS_TOAST: \"DISMISS_TOAST\",\n  REMOVE_TOAST: \"REMOVE_TOAST\",\n} as const\n\nlet count = 0\n\nfunction genId() {\n  count = (count + 1) % Number.MAX_SAFE_INTEGER\n  return count.toString()\n}\n\ntype ActionType = typeof actionTypes\n\ntype Action =\n  | {\n      type: ActionType[\"ADD_TOAST\"]\n      toast: ToasterToast\n    }\n  | {\n      type: ActionType[\"UPDATE_TOAST\"]\n      toast: Partial<ToasterToast>\n    }\n  | {\n      type: ActionType[\"DISMISS_TOAST\"]\n      toastId?: ToasterToast[\"id\"]\n    }\n  | {\n      type: ActionType[\"REMOVE_TOAST\"]\n      toastId?: ToasterToast[\"id\"]\n    }\n\ninterface State {\n  toasts: ToasterToast[]\n}\n\nconst toastTimeouts = new Map<string, ReturnType<typeof setTimeout>>()\n\nconst addToRemoveQueue = (toastId: string) => {\n  if (toastTimeouts.has(toastId)) {\n    return\n  }\n\n  const timeout = setTimeout(() => {\n    toastTimeouts.delete(toastId)\n    dispatch({\n      type: \"REMOVE_TOAST\",\n      toastId: toastId,\n    })\n  }, TOAST_REMOVE_DELAY)\n\n  toastTimeouts.set(toastId, timeout)\n}\n\nexport const reducer = (state: State, action: Action): State => {\n  switch (action.type) {\n    case \"ADD_TOAST\":\n      return {\n        ...state,\n        toasts: [action.toast, ...state.toasts].slice(0, TOAST_LIMIT),\n      }\n\n    case \"UPDATE_TOAST\":\n      return {\n        ...state,\n        toasts: state.toasts.map((t) =>\n          t.id === action.toast.id ? { ...t, ...action.toast } : t\n        ),\n      }\n\n    case \"DISMISS_TOAST\": {\n      const { toastId } = action\n\n      // ! Side effects ! - This could be extracted into a dismissToast() action,\n      // but I'll keep it here for simplicity\n      if (toastId) {\n        addToRemoveQueue(toastId)\n      } else {\n        state.toasts.forEach((toast) => {\n          addToRemoveQueue(toast.id)\n        })\n      }\n\n      return {\n        ...state,\n        toasts: state.toasts.map((t) =>\n          t.id === toastId || toastId === undefined\n            ? {\n                ...t,\n                open: false,\n              }\n            : t\n        ),\n      }\n    }\n    case \"REMOVE_TOAST\":\n      if (action.toastId === undefined) {\n        return {\n          ...state,\n          toasts: [],\n        }\n      }\n      return {\n        ...state,\n        toasts: state.toasts.filter((t) => t.id !== action.toastId),\n      }\n  }\n}\n\nconst listeners: Array<(state: State) => void> = []\n\nlet memoryState: State = { toasts: [] }\n\nfunction dispatch(action: Action) {\n  memoryState = reducer(memoryState, action)\n  listeners.forEach((listener) => {\n    listener(memoryState)\n  })\n}\n\ntype Toast = Omit<ToasterToast, \"id\">\n\nfunction toast({ ...props }: Toast) {\n  const id = genId()\n\n  const update = (props: ToasterToast) =>\n    dispatch({\n      type: \"UPDATE_TOAST\",\n      toast: { ...props, id },\n    })\n  const dismiss = () => dispatch({ type: \"DISMISS_TOAST\", toastId: id })\n\n  dispatch({\n    type: \"ADD_TOAST\",\n    toast: {\n      ...props,\n      id,\n      open: true,\n      onOpenChange: (open) => {\n        if (!open) dismiss()\n      },\n    },\n  })\n\n  return {\n    id: id,\n    dismiss,\n    update,\n  }\n}\n\nfunction useToast() {\n  const [state, setState] = React.useState<State>(memoryState)\n\n  React.useEffect(() => {\n    listeners.push(setState)\n    return () => {\n      const index = listeners.indexOf(setState)\n      if (index > -1) {\n        listeners.splice(index, 1)\n      }\n    }\n  }, [state])\n\n  return {\n    ...state,\n    toast,\n    dismiss: (toastId?: string) => dispatch({ type: \"DISMISS_TOAST\", toastId }),\n  }\n}\n\nexport { useToast, toast }\n","size_bytes":3892},"client/src/components/ui/chart.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as RechartsPrimitive from \"recharts\"\n\nimport { cn } from \"@/lib/utils\"\n\n// Format: { THEME_NAME: CSS_SELECTOR }\nconst THEMES = { light: \"\", dark: \".dark\" } as const\n\nexport type ChartConfig = {\n  [k in string]: {\n    label?: React.ReactNode\n    icon?: React.ComponentType\n  } & (\n    | { color?: string; theme?: never }\n    | { color?: never; theme: Record<keyof typeof THEMES, string> }\n  )\n}\n\ntype ChartContextProps = {\n  config: ChartConfig\n}\n\nconst ChartContext = React.createContext<ChartContextProps | null>(null)\n\nfunction useChart() {\n  const context = React.useContext(ChartContext)\n\n  if (!context) {\n    throw new Error(\"useChart must be used within a <ChartContainer />\")\n  }\n\n  return context\n}\n\nconst ChartContainer = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> & {\n    config: ChartConfig\n    children: React.ComponentProps<\n      typeof RechartsPrimitive.ResponsiveContainer\n    >[\"children\"]\n  }\n>(({ id, className, children, config, ...props }, ref) => {\n  const uniqueId = React.useId()\n  const chartId = `chart-${id || uniqueId.replace(/:/g, \"\")}`\n\n  return (\n    <ChartContext.Provider value={{ config }}>\n      <div\n        data-chart={chartId}\n        ref={ref}\n        className={cn(\n          \"flex aspect-video justify-center text-xs [&_.recharts-cartesian-axis-tick_text]:fill-muted-foreground [&_.recharts-cartesian-grid_line[stroke='#ccc']]:stroke-border/50 [&_.recharts-curve.recharts-tooltip-cursor]:stroke-border [&_.recharts-dot[stroke='#fff']]:stroke-transparent [&_.recharts-layer]:outline-none [&_.recharts-polar-grid_[stroke='#ccc']]:stroke-border [&_.recharts-radial-bar-background-sector]:fill-muted [&_.recharts-rectangle.recharts-tooltip-cursor]:fill-muted [&_.recharts-reference-line_[stroke='#ccc']]:stroke-border [&_.recharts-sector[stroke='#fff']]:stroke-transparent [&_.recharts-sector]:outline-none [&_.recharts-surface]:outline-none\",\n          className\n        )}\n        {...props}\n      >\n        <ChartStyle id={chartId} config={config} />\n        <RechartsPrimitive.ResponsiveContainer>\n          {children}\n        </RechartsPrimitive.ResponsiveContainer>\n      </div>\n    </ChartContext.Provider>\n  )\n})\nChartContainer.displayName = \"Chart\"\n\nconst ChartStyle = ({ id, config }: { id: string; config: ChartConfig }) => {\n  const colorConfig = Object.entries(config).filter(\n    ([, config]) => config.theme || config.color\n  )\n\n  if (!colorConfig.length) {\n    return null\n  }\n\n  return (\n    <style\n      dangerouslySetInnerHTML={{\n        __html: Object.entries(THEMES)\n          .map(\n            ([theme, prefix]) => `\n${prefix} [data-chart=${id}] {\n${colorConfig\n  .map(([key, itemConfig]) => {\n    const color =\n      itemConfig.theme?.[theme as keyof typeof itemConfig.theme] ||\n      itemConfig.color\n    return color ? `  --color-${key}: ${color};` : null\n  })\n  .join(\"\\n\")}\n}\n`\n          )\n          .join(\"\\n\"),\n      }}\n    />\n  )\n}\n\nconst ChartTooltip = RechartsPrimitive.Tooltip\n\nconst ChartTooltipContent = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<typeof RechartsPrimitive.Tooltip> &\n    React.ComponentProps<\"div\"> & {\n      hideLabel?: boolean\n      hideIndicator?: boolean\n      indicator?: \"line\" | \"dot\" | \"dashed\"\n      nameKey?: string\n      labelKey?: string\n    }\n>(\n  (\n    {\n      active,\n      payload,\n      className,\n      indicator = \"dot\",\n      hideLabel = false,\n      hideIndicator = false,\n      label,\n      labelFormatter,\n      labelClassName,\n      formatter,\n      color,\n      nameKey,\n      labelKey,\n    },\n    ref\n  ) => {\n    const { config } = useChart()\n\n    const tooltipLabel = React.useMemo(() => {\n      if (hideLabel || !payload?.length) {\n        return null\n      }\n\n      const [item] = payload\n      const key = `${labelKey || item?.dataKey || item?.name || \"value\"}`\n      const itemConfig = getPayloadConfigFromPayload(config, item, key)\n      const value =\n        !labelKey && typeof label === \"string\"\n          ? config[label as keyof typeof config]?.label || label\n          : itemConfig?.label\n\n      if (labelFormatter) {\n        return (\n          <div className={cn(\"font-medium\", labelClassName)}>\n            {labelFormatter(value, payload)}\n          </div>\n        )\n      }\n\n      if (!value) {\n        return null\n      }\n\n      return <div className={cn(\"font-medium\", labelClassName)}>{value}</div>\n    }, [\n      label,\n      labelFormatter,\n      payload,\n      hideLabel,\n      labelClassName,\n      config,\n      labelKey,\n    ])\n\n    if (!active || !payload?.length) {\n      return null\n    }\n\n    const nestLabel = payload.length === 1 && indicator !== \"dot\"\n\n    return (\n      <div\n        ref={ref}\n        className={cn(\n          \"grid min-w-[8rem] items-start gap-1.5 rounded-lg border border-border/50 bg-background px-2.5 py-1.5 text-xs shadow-xl\",\n          className\n        )}\n      >\n        {!nestLabel ? tooltipLabel : null}\n        <div className=\"grid gap-1.5\">\n          {payload.map((item, index) => {\n            const key = `${nameKey || item.name || item.dataKey || \"value\"}`\n            const itemConfig = getPayloadConfigFromPayload(config, item, key)\n            const indicatorColor = color || item.payload.fill || item.color\n\n            return (\n              <div\n                key={item.dataKey}\n                className={cn(\n                  \"flex w-full flex-wrap items-stretch gap-2 [&>svg]:h-2.5 [&>svg]:w-2.5 [&>svg]:text-muted-foreground\",\n                  indicator === \"dot\" && \"items-center\"\n                )}\n              >\n                {formatter && item?.value !== undefined && item.name ? (\n                  formatter(item.value, item.name, item, index, item.payload)\n                ) : (\n                  <>\n                    {itemConfig?.icon ? (\n                      <itemConfig.icon />\n                    ) : (\n                      !hideIndicator && (\n                        <div\n                          className={cn(\n                            \"shrink-0 rounded-[2px] border-[--color-border] bg-[--color-bg]\",\n                            {\n                              \"h-2.5 w-2.5\": indicator === \"dot\",\n                              \"w-1\": indicator === \"line\",\n                              \"w-0 border-[1.5px] border-dashed bg-transparent\":\n                                indicator === \"dashed\",\n                              \"my-0.5\": nestLabel && indicator === \"dashed\",\n                            }\n                          )}\n                          style={\n                            {\n                              \"--color-bg\": indicatorColor,\n                              \"--color-border\": indicatorColor,\n                            } as React.CSSProperties\n                          }\n                        />\n                      )\n                    )}\n                    <div\n                      className={cn(\n                        \"flex flex-1 justify-between leading-none\",\n                        nestLabel ? \"items-end\" : \"items-center\"\n                      )}\n                    >\n                      <div className=\"grid gap-1.5\">\n                        {nestLabel ? tooltipLabel : null}\n                        <span className=\"text-muted-foreground\">\n                          {itemConfig?.label || item.name}\n                        </span>\n                      </div>\n                      {item.value && (\n                        <span className=\"font-mono font-medium tabular-nums text-foreground\">\n                          {item.value.toLocaleString()}\n                        </span>\n                      )}\n                    </div>\n                  </>\n                )}\n              </div>\n            )\n          })}\n        </div>\n      </div>\n    )\n  }\n)\nChartTooltipContent.displayName = \"ChartTooltip\"\n\nconst ChartLegend = RechartsPrimitive.Legend\n\nconst ChartLegendContent = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> &\n    Pick<RechartsPrimitive.LegendProps, \"payload\" | \"verticalAlign\"> & {\n      hideIcon?: boolean\n      nameKey?: string\n    }\n>(\n  (\n    { className, hideIcon = false, payload, verticalAlign = \"bottom\", nameKey },\n    ref\n  ) => {\n    const { config } = useChart()\n\n    if (!payload?.length) {\n      return null\n    }\n\n    return (\n      <div\n        ref={ref}\n        className={cn(\n          \"flex items-center justify-center gap-4\",\n          verticalAlign === \"top\" ? \"pb-3\" : \"pt-3\",\n          className\n        )}\n      >\n        {payload.map((item) => {\n          const key = `${nameKey || item.dataKey || \"value\"}`\n          const itemConfig = getPayloadConfigFromPayload(config, item, key)\n\n          return (\n            <div\n              key={item.value}\n              className={cn(\n                \"flex items-center gap-1.5 [&>svg]:h-3 [&>svg]:w-3 [&>svg]:text-muted-foreground\"\n              )}\n            >\n              {itemConfig?.icon && !hideIcon ? (\n                <itemConfig.icon />\n              ) : (\n                <div\n                  className=\"h-2 w-2 shrink-0 rounded-[2px]\"\n                  style={{\n                    backgroundColor: item.color,\n                  }}\n                />\n              )}\n              {itemConfig?.label}\n            </div>\n          )\n        })}\n      </div>\n    )\n  }\n)\nChartLegendContent.displayName = \"ChartLegend\"\n\n// Helper to extract item config from a payload.\nfunction getPayloadConfigFromPayload(\n  config: ChartConfig,\n  payload: unknown,\n  key: string\n) {\n  if (typeof payload !== \"object\" || payload === null) {\n    return undefined\n  }\n\n  const payloadPayload =\n    \"payload\" in payload &&\n    typeof payload.payload === \"object\" &&\n    payload.payload !== null\n      ? payload.payload\n      : undefined\n\n  let configLabelKey: string = key\n\n  if (\n    key in payload &&\n    typeof payload[key as keyof typeof payload] === \"string\"\n  ) {\n    configLabelKey = payload[key as keyof typeof payload] as string\n  } else if (\n    payloadPayload &&\n    key in payloadPayload &&\n    typeof payloadPayload[key as keyof typeof payloadPayload] === \"string\"\n  ) {\n    configLabelKey = payloadPayload[\n      key as keyof typeof payloadPayload\n    ] as string\n  }\n\n  return configLabelKey in config\n    ? config[configLabelKey]\n    : config[key as keyof typeof config]\n}\n\nexport {\n  ChartContainer,\n  ChartTooltip,\n  ChartTooltipContent,\n  ChartLegend,\n  ChartLegendContent,\n  ChartStyle,\n}\n","size_bytes":10481},"client/src/components/ui/badge.tsx":{"content":"import * as React from \"react\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst badgeVariants = cva(\n  \"inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2\",\n  {\n    variants: {\n      variant: {\n        default:\n          \"border-transparent bg-primary text-primary-foreground hover:bg-primary/80\",\n        secondary:\n          \"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80\",\n        destructive:\n          \"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80\",\n        outline: \"text-foreground\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  }\n)\n\nexport interface BadgeProps\n  extends React.HTMLAttributes<HTMLDivElement>,\n    VariantProps<typeof badgeVariants> {}\n\nfunction Badge({ className, variant, ...props }: BadgeProps) {\n  return (\n    <div className={cn(badgeVariants({ variant }), className)} {...props} />\n  )\n}\n\nexport { Badge, badgeVariants }\n","size_bytes":1128},"shared/schema.ts":{"content":"import { sql } from \"drizzle-orm\";\nimport { pgTable, text, varchar, integer, timestamp, boolean, jsonb, index, decimal } from \"drizzle-orm/pg-core\";\nimport { createInsertSchema } from \"drizzle-zod\";\nimport { z } from \"zod\";\n\n// Session storage table.\n// (IMPORTANT) This table is mandatory for Replit Auth, don't drop it.\nexport const sessions = pgTable(\n  \"sessions\",\n  {\n    sid: varchar(\"sid\").primaryKey(),\n    sess: jsonb(\"sess\").notNull(),\n    expire: timestamp(\"expire\").notNull(),\n  },\n  (table) => [index(\"IDX_session_expire\").on(table.expire)],\n);\n\n// User storage table.\n// (IMPORTANT) This table is mandatory for Replit Auth, don't drop it.\nexport const users = pgTable(\"users\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  email: varchar(\"email\").unique(),\n  username: varchar(\"username\").unique(),\n  passwordHash: varchar(\"password_hash\"), // For username/password auth\n  firstName: varchar(\"first_name\"),\n  lastName: varchar(\"last_name\"),\n  profileImageUrl: varchar(\"profile_image_url\"),\n  authProvider: varchar(\"auth_provider\").default(\"local\"), // 'local', 'replit'\n  isEmailVerified: boolean(\"is_email_verified\").default(false),\n  streak: integer(\"streak\").notNull().default(0),\n  lastWorkoutDate: timestamp(\"last_workout_date\"),\n  lastActivityDate: timestamp(\"last_activity_date\"), // Tracks ANY activity (workout, meal, scan)\n  subscriptionStatus: varchar(\"subscription_status\").default(\"free_trial\"), // free_trial, active, inactive, expired\n  subscriptionStartDate: timestamp(\"subscription_start_date\"),\n  lastPaymentDate: timestamp(\"last_payment_date\"),\n  subscriptionExpiresAt: timestamp(\"subscription_expires_at\"),\n  trialStartDate: timestamp(\"trial_start_date\").defaultNow(),\n  trialEndDate: timestamp(\"trial_end_date\").default(sql`NOW() + INTERVAL '7 days'`),\n  stripeCustomerId: varchar(\"stripe_customer_id\"),\n  stripeSubscriptionId: varchar(\"stripe_subscription_id\"),\n  appleOriginalTransactionId: varchar(\"apple_original_transaction_id\"),\n  personalPlanData: text(\"personal_plan_data\"), // JSON string storing the user's personal plan and onboarding data\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n});\n\nexport const exercises = pgTable(\"exercises\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  name: text(\"name\").notNull(),\n  category: text(\"category\").notNull(), // strength, cardio, yoga, swimming\n  description: text(\"description\"),\n  muscleGroups: text(\"muscle_groups\").array(),\n  equipment: text(\"equipment\"),\n  createdAt: timestamp(\"created_at\").defaultNow().notNull(),\n});\n\nexport const workouts = pgTable(\"workouts\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  userId: varchar(\"user_id\").references(() => users.id).notNull(),\n  name: text(\"name\").notNull(),\n  category: text(\"category\").notNull(),\n  duration: integer(\"duration\").notNull(), // in minutes\n  caloriesBurned: integer(\"calories_burned\").notNull(),\n  notes: text(\"notes\"),\n  date: timestamp(\"date\").notNull(),\n  difficultyLevel: integer(\"difficulty_level\").default(3), // 1-5 scale (1=very easy, 5=very hard)\n  perceivedExertion: integer(\"perceived_exertion\"), // 1-10 RPE scale\n  completionRate: integer(\"completion_rate\").default(100), // percentage of workout completed\n  aiDifficultyRecommendation: integer(\"ai_difficulty_recommendation\"), // AI suggested difficulty for next workout\n  performanceScore: integer(\"performance_score\"), // AI calculated performance score\n  createdAt: timestamp(\"created_at\").defaultNow().notNull(),\n});\n\nexport const workoutExercises = pgTable(\"workout_exercises\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  workoutId: varchar(\"workout_id\").references(() => workouts.id).notNull(),\n  exerciseId: varchar(\"exercise_id\").references(() => exercises.id).notNull(),\n  sets: integer(\"sets\"),\n  reps: integer(\"reps\"),\n  weight: integer(\"weight\"), // in lbs\n  distance: integer(\"distance\"), // in meters\n  duration: integer(\"duration\"), // in seconds\n  notes: text(\"notes\"),\n  targetSets: integer(\"target_sets\"), // AI recommended sets\n  targetReps: integer(\"target_reps\"), // AI recommended reps  \n  targetWeight: integer(\"target_weight\"), // AI recommended weight\n  targetDuration: integer(\"target_duration\"), // AI recommended duration\n  completed: boolean(\"completed\").default(true), // whether exercise was completed\n  difficultyAdjustment: integer(\"difficulty_adjustment\").default(0), // -2 to +2 adjustment from base difficulty\n});\n\n// User workout preferences for the planner\nexport const workoutPreferences = pgTable(\"workout_preferences\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  userId: varchar(\"user_id\").references(() => users.id).notNull().unique(),\n  fitnessLevel: text(\"fitness_level\").notNull(), // beginner, intermediate, advanced\n  primaryGoals: text(\"primary_goals\").array().notNull(), // lose_weight, build_muscle, improve_endurance, etc.\n  workoutDaysPerWeek: integer(\"workout_days_per_week\").notNull().default(3),\n  sessionDuration: integer(\"session_duration\").notNull().default(45), // in minutes\n  availableEquipment: text(\"available_equipment\").array().notNull().default(sql`ARRAY[]::text[]`), // dumbbells, barbell, resistance_bands, etc.\n  preferredWorkoutTypes: text(\"preferred_workout_types\").array().notNull(), // strength, cardio, yoga, etc.\n  injuriesOrLimitations: text(\"injuries_or_limitations\").array().default(sql`ARRAY[]::text[]`),\n  createdAt: timestamp(\"created_at\").defaultNow().notNull(),\n  updatedAt: timestamp(\"updated_at\").defaultNow().notNull(),\n});\n\n// Generated workout plans\nexport const workoutPlans = pgTable(\"workout_plans\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  userId: varchar(\"user_id\").references(() => users.id).notNull(),\n  name: text(\"name\").notNull(),\n  description: text(\"description\"),\n  durationWeeks: integer(\"duration_weeks\").notNull().default(4),\n  isActive: boolean(\"is_active\").default(false),\n  generatedAt: timestamp(\"generated_at\").defaultNow().notNull(),\n  startDate: timestamp(\"start_date\"),\n  endDate: timestamp(\"end_date\"),\n});\n\n// Daily workout schedules within a plan\nexport const plannedWorkouts = pgTable(\"planned_workouts\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  planId: varchar(\"plan_id\").references(() => workoutPlans.id).notNull(),\n  dayOfWeek: integer(\"day_of_week\").notNull(), // 0-6 (Sunday-Saturday)\n  weekNumber: integer(\"week_number\").notNull(), // 1-N within the plan\n  workoutType: text(\"workout_type\").notNull(), // strength, cardio, yoga, rest\n  name: text(\"name\").notNull(),\n  description: text(\"description\"),\n  estimatedDuration: integer(\"estimated_duration\").notNull(), // in minutes\n  targetCalories: integer(\"target_calories\"),\n  exercises: jsonb(\"exercises\").default(sql`'[]'::jsonb`), // array of exercise objects with name, sets, reps, notes\n  isRestDay: boolean(\"is_rest_day\").default(false),\n  completed: boolean(\"completed\").default(false),\n  completedAt: timestamp(\"completed_at\"),\n});\n\nexport const goals = pgTable(\"goals\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  userId: varchar(\"user_id\").references(() => users.id).notNull(),\n  type: text(\"type\").notNull(), // workouts, minutes, calories\n  target: integer(\"target\").notNull(),\n  current: integer(\"current\").notNull().default(0),\n  period: text(\"period\").notNull().default(\"weekly\"), // weekly, monthly\n  isActive: boolean(\"is_active\").notNull().default(true),\n  createdAt: timestamp(\"created_at\").defaultNow().notNull(),\n});\n\n// Payment history table\nexport const payments = pgTable(\"payments\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  userId: varchar(\"user_id\").references(() => users.id).notNull(),\n  stripePaymentIntentId: varchar(\"stripe_payment_intent_id\").unique().notNull(),\n  amount: integer(\"amount\").notNull(), // in cents\n  currency: varchar(\"currency\").default(\"usd\").notNull(),\n  status: varchar(\"status\").notNull(), // pending, succeeded, failed, canceled\n  description: text(\"description\"),\n  createdAt: timestamp(\"created_at\").defaultNow().notNull(),\n  updatedAt: timestamp(\"updated_at\").defaultNow().notNull(),\n});\n\nexport const trainers = pgTable(\"trainers\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  userId: varchar(\"user_id\").references(() => users.id).notNull(),\n  bio: text(\"bio\").notNull(),\n  specialties: text(\"specialties\").array().notNull(),\n  certifications: text(\"certifications\").array(),\n  experience: integer(\"experience\").notNull(), // years of experience\n  hourlyRate: integer(\"hourly_rate\").notNull(), // in cents\n  location: text(\"location\"),\n  isActive: boolean(\"is_active\").notNull().default(true),\n  rating: integer(\"rating\").default(0), // average rating * 100 (for precision)\n  totalReviews: integer(\"total_reviews\").default(0),\n  subscriptionStatus: varchar(\"subscription_status\").default(\"inactive\"), // active, inactive, expired, grace_period\n  lastPaymentDate: timestamp(\"last_payment_date\"),\n  subscriptionExpiresAt: timestamp(\"subscription_expires_at\"),\n  createdAt: timestamp(\"created_at\").defaultNow().notNull(),\n});\n\nexport const trainerServices = pgTable(\"trainer_services\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  trainerId: varchar(\"trainer_id\").references(() => trainers.id).notNull(),\n  name: text(\"name\").notNull(),\n  description: text(\"description\").notNull(),\n  duration: integer(\"duration\").notNull(), // in minutes\n  price: integer(\"price\").notNull(), // in cents\n  isActive: boolean(\"is_active\").notNull().default(true),\n  createdAt: timestamp(\"created_at\").defaultNow().notNull(),\n});\n\nexport const bookings = pgTable(\"bookings\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  userId: varchar(\"user_id\").references(() => users.id).notNull(),\n  trainerId: varchar(\"trainer_id\").references(() => trainers.id).notNull(),\n  serviceId: varchar(\"service_id\").references(() => trainerServices.id).notNull(),\n  scheduledAt: timestamp(\"scheduled_at\").notNull(),\n  status: text(\"status\").notNull().default(\"pending\"), // pending, confirmed, completed, cancelled, paid\n  totalPrice: integer(\"total_price\").notNull(), // in cents\n  trainerEarnings: integer(\"trainer_earnings\"), // in cents - what trainer gets after 15% commission\n  platformCommission: integer(\"platform_commission\"), // in cents - 15% commission for platform\n  stripePaymentIntentId: text(\"stripe_payment_intent_id\"),\n  notes: text(\"notes\"),\n  createdAt: timestamp(\"created_at\").defaultNow().notNull(),\n});\n\nexport const trainerReviews = pgTable(\"trainer_reviews\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  userId: varchar(\"user_id\").references(() => users.id).notNull(),\n  trainerId: varchar(\"trainer_id\").references(() => trainers.id).notNull(),\n  bookingId: varchar(\"booking_id\").references(() => bookings.id).notNull(),\n  rating: integer(\"rating\").notNull(), // 1-5 stars\n  comment: text(\"comment\"),\n  createdAt: timestamp(\"created_at\").defaultNow().notNull(),\n});\n\n// User activity logging for comprehensive tracking\nexport const userActivityLog = pgTable(\"user_activity_log\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  userId: varchar(\"user_id\").references(() => users.id).notNull(),\n  actionType: varchar(\"action_type\").notNull(), // login, logout, workout_logged, goal_set, profile_updated, etc.\n  actionDetails: text(\"action_details\"), // JSON string with additional details\n  ipAddress: varchar(\"ip_address\"),\n  userAgent: text(\"user_agent\"),\n  sessionId: varchar(\"session_id\"),\n  createdAt: timestamp(\"created_at\").defaultNow().notNull(),\n});\n\n// Badges for user achievements\nexport const badges = pgTable(\"badges\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  name: text(\"name\").notNull(),\n  description: text(\"description\").notNull(),\n  iconName: text(\"icon_name\").notNull(), // Icon identifier for rendering\n  category: text(\"category\").notNull(), // consistency, milestone, achievement\n  requiredDays: integer(\"required_days\"), // For consistency badges (7, 14, 30)\n  createdAt: timestamp(\"created_at\").defaultNow().notNull(),\n});\n\n// User badges tracking - which badges each user has earned\nexport const userBadges = pgTable(\"user_badges\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  userId: varchar(\"user_id\").references(() => users.id).notNull(),\n  badgeId: varchar(\"badge_id\").references(() => badges.id).notNull(),\n  earnedAt: timestamp(\"earned_at\").defaultNow().notNull(),\n});\n\n// News and announcements for app updates\nexport const news = pgTable(\"news\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  title: text(\"title\").notNull(),\n  content: text(\"content\").notNull(),\n  category: varchar(\"category\").notNull(), // update, feature, bug_fix, announcement\n  imageUrl: varchar(\"image_url\"), // optional banner image\n  isPublished: boolean(\"is_published\").notNull().default(true),\n  publishedAt: timestamp(\"published_at\").defaultNow().notNull(),\n  createdAt: timestamp(\"created_at\").defaultNow().notNull(),\n});\n\nexport type UpsertUser = typeof users.$inferInsert;\n\n// Insert schemas\nexport const insertUserSchema = createInsertSchema(users).omit({\n  id: true,\n  createdAt: true,\n  updatedAt: true,\n});\n\n// Authentication schemas\nexport const signUpSchema = z.object({\n  username: z.string().min(3).max(30).regex(/^[a-zA-Z0-9_]+$/, \"Username can only contain letters, numbers, and underscores\"),\n  email: z.string().email(),\n  password: z.string().min(8).regex(/^(?=.*[a-z])(?=.*[A-Z])(?=.*\\d)/, \"Password must contain at least one uppercase letter, one lowercase letter, and one number\"),\n  firstName: z.string().min(1).max(50),\n  lastName: z.string().min(1).max(50),\n  personalPlanData: z.any().optional(), // Optional personal plan data from onboarding\n});\n\nexport const signInSchema = z.object({\n  identifier: z.string().min(1), // can be username or email\n  password: z.string().min(1),\n});\n\n\nexport const insertExerciseSchema = createInsertSchema(exercises).omit({\n  id: true,\n  createdAt: true,\n});\n\nexport const insertWorkoutSchema = createInsertSchema(workouts).omit({\n  id: true,\n  createdAt: true,\n});\n\nexport const insertWorkoutExerciseSchema = createInsertSchema(workoutExercises).omit({\n  id: true,\n});\n\nexport const insertGoalSchema = createInsertSchema(goals).omit({\n  id: true,\n  createdAt: true,\n});\n\nexport const insertWorkoutPreferencesSchema = createInsertSchema(workoutPreferences).omit({\n  id: true,\n  createdAt: true,\n  updatedAt: true,\n});\n\nexport const insertWorkoutPlanSchema = createInsertSchema(workoutPlans).omit({\n  id: true,\n  generatedAt: true,\n});\n\nexport const insertPlannedWorkoutSchema = createInsertSchema(plannedWorkouts).omit({\n  id: true,\n});\n\nexport const insertUserActivityLogSchema = createInsertSchema(userActivityLog).omit({\n  id: true,\n  createdAt: true,\n});\n\nexport const insertBadgeSchema = createInsertSchema(badges).omit({\n  id: true,\n  createdAt: true,\n});\n\nexport const insertNewsSchema = createInsertSchema(news).omit({\n  id: true,\n  createdAt: true,\n  publishedAt: true,\n});\n\nexport const insertUserBadgeSchema = createInsertSchema(userBadges).omit({\n  id: true,\n  earnedAt: true,\n});\n\nexport const insertPaymentSchema = createInsertSchema(payments).omit({\n  id: true,\n  createdAt: true,\n  updatedAt: true,\n});\n\nexport const insertTrainerSchema = createInsertSchema(trainers).omit({\n  id: true,\n  rating: true,\n  totalReviews: true,\n  subscriptionStatus: true,\n  lastPaymentDate: true,\n  subscriptionExpiresAt: true,\n  createdAt: true,\n});\n\nexport const insertTrainerServiceSchema = createInsertSchema(trainerServices).omit({\n  id: true,\n  createdAt: true,\n});\n\nexport const insertBookingSchema = createInsertSchema(bookings).omit({\n  id: true,\n  createdAt: true,\n});\n\nexport const insertTrainerReviewSchema = createInsertSchema(trainerReviews).omit({\n  id: true,\n  createdAt: true,\n});\n\n// Types\nexport type InsertUser = z.infer<typeof insertUserSchema>;\nexport type User = typeof users.$inferSelect;\n\nexport type InsertExercise = z.infer<typeof insertExerciseSchema>;\nexport type Exercise = typeof exercises.$inferSelect;\n\nexport type InsertWorkout = z.infer<typeof insertWorkoutSchema>;\nexport type Workout = typeof workouts.$inferSelect;\n\nexport type InsertWorkoutExercise = z.infer<typeof insertWorkoutExerciseSchema>;\nexport type WorkoutExercise = typeof workoutExercises.$inferSelect;\n\nexport type InsertGoal = z.infer<typeof insertGoalSchema>;\nexport type Goal = typeof goals.$inferSelect;\n\nexport type InsertWorkoutPreferences = z.infer<typeof insertWorkoutPreferencesSchema>;\nexport type WorkoutPreferences = typeof workoutPreferences.$inferSelect;\n\nexport type InsertWorkoutPlan = z.infer<typeof insertWorkoutPlanSchema>;\nexport type WorkoutPlan = typeof workoutPlans.$inferSelect;\n\nexport type InsertPlannedWorkout = z.infer<typeof insertPlannedWorkoutSchema>;\nexport type PlannedWorkout = typeof plannedWorkouts.$inferSelect;\n\nexport type InsertUserActivityLog = z.infer<typeof insertUserActivityLogSchema>;\nexport type UserActivityLog = typeof userActivityLog.$inferSelect;\n\nexport type InsertBadge = z.infer<typeof insertBadgeSchema>;\nexport type Badge = typeof badges.$inferSelect;\n\nexport type InsertUserBadge = z.infer<typeof insertUserBadgeSchema>;\nexport type UserBadge = typeof userBadges.$inferSelect;\n\nexport type InsertNews = z.infer<typeof insertNewsSchema>;\nexport type News = typeof news.$inferSelect;\n\nexport type InsertPayment = z.infer<typeof insertPaymentSchema>;\nexport type Payment = typeof payments.$inferSelect;\n\nexport type InsertTrainer = z.infer<typeof insertTrainerSchema>;\nexport type Trainer = typeof trainers.$inferSelect;\n\nexport type InsertTrainerService = z.infer<typeof insertTrainerServiceSchema>;\nexport type TrainerService = typeof trainerServices.$inferSelect;\n\nexport type InsertBooking = z.infer<typeof insertBookingSchema>;\nexport type Booking = typeof bookings.$inferSelect;\n\nexport type InsertTrainerReview = z.infer<typeof insertTrainerReviewSchema>;\nexport type TrainerReview = typeof trainerReviews.$inferSelect;\n\n// Extended types for API responses\nexport type WorkoutWithExercises = Workout & {\n  exercises: (WorkoutExercise & { exercise: Exercise })[];\n};\n\nexport type TrainerWithServices = Trainer & {\n  services: TrainerService[];\n  user: Pick<User, \"firstName\" | \"lastName\" | \"email\">;\n};\n\nexport type BookingWithDetails = Booking & {\n  trainer: Pick<Trainer, \"id\" | \"userId\" | \"bio\" | \"rating\" | \"totalReviews\">;\n  service: TrainerService;\n  user: Pick<User, \"firstName\" | \"lastName\" | \"email\">;\n};\n\nexport type TrainerReviewWithUser = TrainerReview & {\n  user: Pick<User, \"firstName\" | \"lastName\" | \"email\">;\n};\n\nexport type UserBadgeWithDetails = UserBadge & {\n  badge: Badge;\n};\n\n// Food entries for nutrition tracking\nexport const foodEntries = pgTable(\"food_entries\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  userId: varchar(\"user_id\").notNull(),\n  name: varchar(\"name\").notNull(),\n  description: varchar(\"description\"),\n  calories: integer(\"calories\").notNull(),\n  protein: integer(\"protein\").default(0), // grams\n  carbs: integer(\"carbs\").default(0), // grams\n  fat: integer(\"fat\").default(0), // grams\n  fiber: integer(\"fiber\").default(0), // grams\n  sugar: integer(\"sugar\").default(0), // grams\n  sodium: integer(\"sodium\").default(0), // mg\n  servingSize: varchar(\"serving_size\"), // e.g., \"1 cup\", \"100g\"\n  imageUrl: varchar(\"image_url\"), // URL to uploaded food image\n  confidence: integer(\"confidence\"), // AI confidence score (0-100)\n  loggedAt: timestamp(\"logged_at\").defaultNow(),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n});\n\n// Zod schemas for food entries\nexport const insertFoodEntrySchema = createInsertSchema(foodEntries).omit({\n  id: true,\n  createdAt: true,\n});\n\nexport type InsertFoodEntry = z.infer<typeof insertFoodEntrySchema>;\nexport type FoodEntry = typeof foodEntries.$inferSelect;\n\nexport type UserStats = {\n  totalWorkouts: number;\n  totalHours: number;\n  caloriesBurned: number;\n  personalRecords: number;\n};\n\nexport type LeaderboardEntry = {\n  userId: string;\n  firstName: string;\n  lastName: string;\n  email: string;\n  totalReps: number;\n  rank: number;\n};\n\n// Mile Tracker tables\nexport const mileTrackerSessions = pgTable(\"mile_tracker_sessions\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  userId: varchar(\"user_id\").references(() => users.id).notNull(),\n  activityType: text(\"activity_type\").notNull(), // run, walk, bike\n  totalDistance: integer(\"total_distance\").notNull(), // distance in miles * 1000 (for precision)\n  totalTime: integer(\"total_time\").notNull(), // total time in seconds\n  averagePace: integer(\"average_pace\"), // average seconds per mile\n  status: text(\"status\").notNull().default(\"active\"), // active, completed, paused\n  startedAt: timestamp(\"started_at\").defaultNow().notNull(),\n  completedAt: timestamp(\"completed_at\"),\n  createdAt: timestamp(\"created_at\").defaultNow().notNull(),\n});\n\nexport const mileTrackerSplits = pgTable(\"mile_tracker_splits\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  sessionId: varchar(\"session_id\").references(() => mileTrackerSessions.id).notNull(),\n  mileNumber: integer(\"mile_number\").notNull(), // 1, 2, 3, etc.\n  splitTime: integer(\"split_time\").notNull(), // time for this mile in seconds\n  cumulativeTime: integer(\"cumulative_time\").notNull(), // total time up to this mile\n  pace: integer(\"pace\").notNull(), // seconds per mile for this split\n  completedAt: timestamp(\"completed_at\").defaultNow().notNull(),\n});\n\n// Mile Tracker insert schemas\nexport const insertMileTrackerSessionSchema = createInsertSchema(mileTrackerSessions).omit({\n  id: true,\n  createdAt: true,\n});\n\nexport const insertMileTrackerSplitSchema = createInsertSchema(mileTrackerSplits).omit({\n  id: true,\n});\n\n// Mile Tracker types\nexport type InsertMileTrackerSession = z.infer<typeof insertMileTrackerSessionSchema>;\nexport type MileTrackerSession = typeof mileTrackerSessions.$inferSelect;\n\nexport type InsertMileTrackerSplit = z.infer<typeof insertMileTrackerSplitSchema>;\nexport type MileTrackerSplit = typeof mileTrackerSplits.$inferSelect;\n\n// Extended types for API responses\nexport type MileTrackerSessionWithSplits = MileTrackerSession & {\n  splits: MileTrackerSplit[];\n};\n\n// Community Posts\nexport const communityPosts = pgTable(\"community_posts\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  userId: varchar(\"user_id\").references(() => users.id).notNull(),\n  content: text(\"content\").notNull(),\n  postType: text(\"post_type\").notNull().default(\"message\"), // message, workout_progress, goal_achievement\n  workoutId: varchar(\"workout_id\").references(() => workouts.id), // optional, for workout progress posts\n  imageUrl: varchar(\"image_url\"), // optional, for posts with images\n  likes: integer(\"likes\").notNull().default(0),\n  dislikes: integer(\"dislikes\").notNull().default(0),\n  createdAt: timestamp(\"created_at\").defaultNow().notNull(),\n});\n\n// Community Posts insert schemas\nexport const insertCommunityPostSchema = createInsertSchema(communityPosts).omit({\n  id: true,\n  likes: true,\n  dislikes: true,\n  createdAt: true,\n});\n\n// Community Posts types\nexport type InsertCommunityPost = z.infer<typeof insertCommunityPostSchema>;\nexport type CommunityPost = typeof communityPosts.$inferSelect;\n\n// Extended types for API responses\nexport type CommunityPostWithUser = CommunityPost & {\n  user: {\n    id: string;\n    firstName: string;\n    lastName: string;\n    email: string;\n    streak: number;\n    profileImageUrl: string | null;\n  };\n  workout?: {\n    id: string;\n    name: string;\n    category: string;\n    duration: number;\n    caloriesBurned: number;\n  };\n};\n\n// Meal Plans\nexport const mealPlans = pgTable(\"meal_plans\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  name: text(\"name\").notNull(),\n  description: text(\"description\").notNull(),\n  goal: text(\"goal\").notNull(), // weight_loss, weight_gain, maintenance\n  dailyCalories: integer(\"daily_calories\").notNull(),\n  dailyProtein: integer(\"daily_protein\").notNull(), // grams\n  dailyCarbs: integer(\"daily_carbs\").notNull(), // grams\n  dailyFat: integer(\"daily_fat\").notNull(), // grams\n  duration: integer(\"duration\").notNull().default(7), // days\n  isActive: boolean(\"is_active\").notNull().default(true),\n  createdAt: timestamp(\"created_at\").defaultNow().notNull(),\n});\n\nexport const mealPlanDays = pgTable(\"meal_plan_days\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  mealPlanId: varchar(\"meal_plan_id\").references(() => mealPlans.id).notNull(),\n  dayNumber: integer(\"day_number\").notNull(), // 1, 2, 3, etc.\n  name: text(\"name\").notNull(), // e.g., \"Day 1\", \"Monday\"\n});\n\nexport const mealPlanMeals = pgTable(\"meal_plan_meals\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  mealPlanDayId: varchar(\"meal_plan_day_id\").references(() => mealPlanDays.id).notNull(),\n  mealType: text(\"meal_type\").notNull(), // breakfast, lunch, dinner, snack\n  name: text(\"name\").notNull(),\n  description: text(\"description\"),\n  calories: integer(\"calories\").notNull(),\n  protein: integer(\"protein\").notNull(),\n  carbs: integer(\"carbs\").notNull(),\n  fat: integer(\"fat\").notNull(),\n  ingredients: text(\"ingredients\").array().notNull(),\n  instructions: text(\"instructions\").array(),\n  prepTime: integer(\"prep_time\"), // minutes\n  servings: integer(\"servings\").notNull().default(1),\n  imageUrl: text(\"image_url\"), // URL to meal image\n  ingredientImages: jsonb(\"ingredient_images\"), // Object mapping ingredient names to image URLs\n});\n\nexport const userMealPlans = pgTable(\"user_meal_plans\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  userId: varchar(\"user_id\").references(() => users.id).notNull(),\n  mealPlanId: varchar(\"meal_plan_id\").references(() => mealPlans.id).notNull(),\n  startDate: timestamp(\"start_date\").notNull(),\n  endDate: timestamp(\"end_date\"),\n  isActive: boolean(\"is_active\").notNull().default(true),\n  createdAt: timestamp(\"created_at\").defaultNow().notNull(),\n});\n\n// Food Items Database\nexport const foodItems = pgTable(\"food_items\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  name: text(\"name\").notNull(),\n  category: text(\"category\").notNull(), // fruits, vegetables, proteins, grains, dairy, etc.\n  caloriesPer100g: integer(\"calories_per_100g\").notNull(),\n  proteinPer100g: integer(\"protein_per_100g\").default(0), // grams\n  carbsPer100g: integer(\"carbs_per_100g\").default(0), // grams\n  fatPer100g: integer(\"fat_per_100g\").default(0), // grams\n  fiberPer100g: integer(\"fiber_per_100g\").default(0), // grams\n  commonServingSize: text(\"common_serving_size\"), // e.g., \"1 medium apple (182g)\"\n  isCommon: boolean(\"is_common\").default(true), // popular foods shown first\n  imageUrl: text(\"image_url\"), // URL to food item image\n  createdAt: timestamp(\"created_at\").defaultNow().notNull(),\n});\n\n// User Food Preferences\nexport const userFoodPreferences = pgTable(\"user_food_preferences\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  userId: varchar(\"user_id\").references(() => users.id).notNull(),\n  foodItemId: varchar(\"food_item_id\").references(() => foodItems.id).notNull(),\n  preference: text(\"preference\").notNull(), // \"like\", \"love\", \"dislike\", \"never\"\n  createdAt: timestamp(\"created_at\").defaultNow().notNull(),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n});\n\n// Meal Plan insert schemas\nexport const insertMealPlanSchema = createInsertSchema(mealPlans).omit({\n  id: true,\n  createdAt: true,\n});\n\nexport const insertMealPlanDaySchema = createInsertSchema(mealPlanDays).omit({\n  id: true,\n});\n\nexport const insertMealPlanMealSchema = createInsertSchema(mealPlanMeals).omit({\n  id: true,\n});\n\nexport const insertUserMealPlanSchema = createInsertSchema(userMealPlans).omit({\n  id: true,\n  createdAt: true,\n});\n\nexport const insertFoodItemSchema = createInsertSchema(foodItems).omit({\n  id: true,\n  createdAt: true,\n});\n\nexport const insertUserFoodPreferenceSchema = createInsertSchema(userFoodPreferences).omit({\n  id: true,\n  createdAt: true,\n  updatedAt: true,\n});\n\n// Meal Plan types\nexport type InsertMealPlan = z.infer<typeof insertMealPlanSchema>;\nexport type MealPlan = typeof mealPlans.$inferSelect;\n\nexport type InsertMealPlanDay = z.infer<typeof insertMealPlanDaySchema>;\nexport type MealPlanDay = typeof mealPlanDays.$inferSelect;\n\nexport type InsertMealPlanMeal = z.infer<typeof insertMealPlanMealSchema>;\nexport type MealPlanMeal = typeof mealPlanMeals.$inferSelect;\n\nexport type InsertUserMealPlan = z.infer<typeof insertUserMealPlanSchema>;\nexport type UserMealPlan = typeof userMealPlans.$inferSelect;\n\nexport type InsertFoodItem = z.infer<typeof insertFoodItemSchema>;\nexport type FoodItem = typeof foodItems.$inferSelect;\n\nexport type InsertUserFoodPreference = z.infer<typeof insertUserFoodPreferenceSchema>;\nexport type UserFoodPreference = typeof userFoodPreferences.$inferSelect;\n\n// Extended types for API responses\nexport type MealPlanWithDetails = MealPlan & {\n  days: (MealPlanDay & {\n    meals: MealPlanMeal[];\n  })[];\n};\n\nexport type UserMealPlanWithDetails = UserMealPlan & {\n  mealPlan: MealPlanWithDetails;\n};\n\nexport type FoodItemWithPreference = FoodItem & {\n  userPreference?: UserFoodPreference;\n};\n\n// Calendar Notes\nexport const calendarNotes = pgTable(\"calendar_notes\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  userId: varchar(\"user_id\").references(() => users.id).notNull(),\n  date: timestamp(\"date\").notNull(), // The date this note is for\n  note: text(\"note\").notNull(),\n  createdAt: timestamp(\"created_at\").defaultNow().notNull(),\n  updatedAt: timestamp(\"updated_at\").defaultNow().notNull(),\n});\n\n// Calendar Notes insert schemas\nexport const insertCalendarNoteSchema = createInsertSchema(calendarNotes).omit({\n  id: true,\n  createdAt: true,\n  updatedAt: true,\n});\n\n// Calendar Notes types\nexport type InsertCalendarNote = z.infer<typeof insertCalendarNoteSchema>;\nexport type CalendarNote = typeof calendarNotes.$inferSelect;\n\n// User Meal Preferences for AI generation\nexport const userMealPreferences = pgTable(\"user_meal_preferences\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  userId: varchar(\"user_id\").references(() => users.id).notNull(),\n  goal: text(\"goal\").notNull(), // weight_loss, weight_gain, maintenance\n  dailyCalories: integer(\"daily_calories\").notNull(),\n  dietaryRestrictions: text(\"dietary_restrictions\").array().default([]),\n  allergies: text(\"allergies\").array().default([]),\n  preferences: text(\"preferences\").array().default([]),\n  lastGeneratedAt: timestamp(\"last_generated_at\"),\n  autoGenerate: boolean(\"auto_generate\").default(true), // weekly auto-generation\n  createdAt: timestamp(\"created_at\").defaultNow().notNull(),\n  updatedAt: timestamp(\"updated_at\").defaultNow().notNull(),\n});\n\n// User Meal Preferences insert schemas\nexport const insertUserMealPreferencesSchema = createInsertSchema(userMealPreferences).omit({\n  id: true,\n  createdAt: true,\n  updatedAt: true,\n});\n\n// User Meal Preferences types\nexport type InsertUserMealPreferences = z.infer<typeof insertUserMealPreferencesSchema>;\nexport type UserMealPreferences = typeof userMealPreferences.$inferSelect;\n\n// AI Difficulty Adjustments for tracking performance and suggestions\nexport const aiDifficultyAdjustments = pgTable(\"ai_difficulty_adjustments\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  userId: varchar(\"user_id\").references(() => users.id).notNull(),\n  exerciseId: varchar(\"exercise_id\").references(() => exercises.id).notNull(),\n  currentDifficulty: integer(\"current_difficulty\").notNull().default(3), // 1-5 scale\n  suggestedDifficulty: integer(\"suggested_difficulty\").notNull(), // AI suggested difficulty\n  confidenceScore: integer(\"confidence_score\").notNull(), // 1-100 AI confidence in suggestion\n  reasoningFactors: jsonb(\"reasoning_factors\"), // JSON with factors: performance_trend, completion_rate, etc.\n  performanceTrend: text(\"performance_trend\"), // improving, declining, stable\n  applied: boolean(\"applied\").default(false), // whether user accepted the suggestion\n  appliedAt: timestamp(\"applied_at\"),\n  createdAt: timestamp(\"created_at\").defaultNow().notNull(),\n  updatedAt: timestamp(\"updated_at\").defaultNow().notNull(),\n});\n\n// Meal Tracking Schema - AI-powered calorie and macro tracking\nexport const mealEntries = pgTable(\"meal_entries\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  userId: varchar(\"user_id\").references(() => users.id).notNull(),\n  mealType: varchar(\"meal_type\").notNull(), // breakfast, lunch, dinner, snack\n  mealName: varchar(\"meal_name\").notNull(),\n  description: text(\"description\"),\n  imageUrl: varchar(\"image_url\"),\n  // Nutritional information from AI analysis\n  totalCalories: integer(\"total_calories\").notNull(),\n  protein: decimal(\"protein\", { precision: 8, scale: 2 }).notNull(), // in grams\n  carbs: decimal(\"carbs\", { precision: 8, scale: 2 }).notNull(), // in grams\n  fat: decimal(\"fat\", { precision: 8, scale: 2 }).notNull(), // in grams\n  fiber: decimal(\"fiber\", { precision: 8, scale: 2 }).default(\"0\"),\n  sugar: decimal(\"sugar\", { precision: 8, scale: 2 }).default(\"0\"),\n  sodium: decimal(\"sodium\", { precision: 8, scale: 2 }).default(\"0\"), // in mg\n  // Analysis metadata\n  confidence: decimal(\"confidence\", { precision: 3, scale: 2 }).default(\"0.85\"), // AI confidence score\n  analysisRaw: text(\"analysis_raw\"), // Raw AI response for debugging\n  createdAt: timestamp(\"created_at\").defaultNow().notNull(),\n  loggedAt: timestamp(\"logged_at\").defaultNow().notNull() // When the meal was consumed\n});\n\n// AI Difficulty Adjustments insert schemas\nexport const insertAiDifficultyAdjustmentSchema = createInsertSchema(aiDifficultyAdjustments).omit({\n  id: true,\n  createdAt: true,\n  updatedAt: true,\n});\n\n// AI Difficulty Adjustments types\nexport type InsertAiDifficultyAdjustment = z.infer<typeof insertAiDifficultyAdjustmentSchema>;\nexport type AiDifficultyAdjustment = typeof aiDifficultyAdjustments.$inferSelect;\n\n// Meal Tracking insert schemas\nexport const insertMealEntrySchema = createInsertSchema(mealEntries).omit({\n  id: true,\n  createdAt: true,\n});\n\n// Meal Tracking types\nexport type InsertMealEntry = z.infer<typeof insertMealEntrySchema>;\nexport type MealEntry = typeof mealEntries.$inferSelect;\n\n// Progress Photos for before/after tracking\nexport const progressPhotos = pgTable(\"progress_photos\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  userId: varchar(\"user_id\").references(() => users.id).notNull(),\n  imageUrl: varchar(\"image_url\").notNull(),\n  photoType: varchar(\"photo_type\").notNull().default(\"progress\"), // before, after, progress, milestone\n  workoutId: varchar(\"workout_id\").references(() => workouts.id), // optional link to specific workout\n  notes: text(\"notes\"), // user notes about their progress\n  weight: decimal(\"weight\", { precision: 5, scale: 2 }), // optional weight at time of photo\n  bodyPart: varchar(\"body_part\"), // front, side, back, specific_muscle_group\n  isPublic: boolean(\"is_public\").default(false), // allow sharing in community\n  createdAt: timestamp(\"created_at\").defaultNow().notNull(),\n});\n\n// Progress Photos insert schemas\nexport const insertProgressPhotoSchema = createInsertSchema(progressPhotos).omit({\n  id: true,\n  createdAt: true,\n});\n\n// Progress Photos types\nexport type InsertProgressPhoto = z.infer<typeof insertProgressPhotoSchema>;\nexport type ProgressPhoto = typeof progressPhotos.$inferSelect;\n\n// Extended types for API responses\nexport type ProgressPhotoWithWorkout = ProgressPhoto & {\n  workout?: {\n    id: string;\n    name: string;\n    category: string;\n    date: Date;\n  };\n};\n\n// Notification Preferences for workout reminders and meal times\nexport const notificationPreferences = pgTable(\"notification_preferences\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  userId: varchar(\"user_id\").references(() => users.id).notNull().unique(),\n  workoutRemindersEnabled: boolean(\"workout_reminders_enabled\").default(true).notNull(),\n  mealNotificationsEnabled: boolean(\"meal_notifications_enabled\").default(true).notNull(),\n  breakfastTime: varchar(\"breakfast_time\").default(\"08:00\"), // HH:MM format\n  lunchTime: varchar(\"lunch_time\").default(\"12:00\"), // HH:MM format\n  dinnerTime: varchar(\"dinner_time\").default(\"18:00\"), // HH:MM format\n  lastWorkoutReminderSent: timestamp(\"last_workout_reminder_sent\"),\n  notificationPermissionGranted: boolean(\"notification_permission_granted\").default(false),\n  createdAt: timestamp(\"created_at\").defaultNow().notNull(),\n  updatedAt: timestamp(\"updated_at\").defaultNow().notNull(),\n});\n\n// Subscription Audit Table for tracking subscription state changes\nexport const subscriptionAudit = pgTable(\"subscription_audit\", {\n  id: varchar(\"id\").primaryKey().default(sql`gen_random_uuid()`),\n  userId: varchar(\"user_id\").references(() => users.id).notNull(),\n  fromStatus: varchar(\"from_status\").notNull(),\n  toStatus: varchar(\"to_status\").notNull(),\n  reason: varchar(\"reason\").notNull(), // trial_expired, payment_success, payment_failed, cancelled, etc.\n  timestamp: timestamp(\"timestamp\").defaultNow().notNull(),\n  metadata: jsonb(\"metadata\"), // Additional data like Stripe event ID, error details, etc.\n});\n\n// Notification Preferences insert schema\nexport const insertNotificationPreferencesSchema = createInsertSchema(notificationPreferences).omit({\n  id: true,\n  createdAt: true,\n  updatedAt: true,\n});\n\n// Notification Preferences types\nexport type InsertNotificationPreferences = z.infer<typeof insertNotificationPreferencesSchema>;\nexport type NotificationPreferences = typeof notificationPreferences.$inferSelect;\n\n// Subscription Audit insert schema\nexport const insertSubscriptionAuditSchema = createInsertSchema(subscriptionAudit).omit({\n  id: true,\n  timestamp: true,\n});\n\n// Subscription Audit types\nexport type InsertSubscriptionAudit = z.infer<typeof insertSubscriptionAuditSchema>;\nexport type SubscriptionAudit = typeof subscriptionAudit.$inferSelect;\n\n// Premium Features Definition\nexport const PREMIUM_FEATURES = {\n  WORKOUT_PLANNER: 'workout_planner',\n  MILE_TRACKER: 'mile_tracker',\n  MEAL_PLANS: 'meal_plans',\n  MEAL_TRACKER: 'meal_tracker',\n  PROGRESS_PHOTOS: 'progress_photos'\n} as const;\n\nexport type PremiumFeature = typeof PREMIUM_FEATURES[keyof typeof PREMIUM_FEATURES];\n\n// Premium-only features (no trial access) - subscription required\nexport const PREMIUM_ONLY_FEATURES: PremiumFeature[] = [\n  PREMIUM_FEATURES.WORKOUT_PLANNER,\n  PREMIUM_FEATURES.MEAL_PLANS,\n  PREMIUM_FEATURES.MEAL_TRACKER\n];\n\n// Feature access helper function\nexport const isPremiumFeature = (feature: string): feature is PremiumFeature => {\n  return Object.values(PREMIUM_FEATURES).includes(feature as PremiumFeature);\n};\n\n// Check if feature requires active subscription (no trial access)\nexport const isPremiumOnlyFeature = (feature: PremiumFeature): boolean => {\n  return PREMIUM_ONLY_FEATURES.includes(feature);\n};\n\n// Trial expiration checker\nexport const isTrialExpired = (user: { trialEndDate: Date | null; subscriptionStatus: string }): boolean => {\n  if (!user.trialEndDate) return true;\n  return user.subscriptionStatus === 'free_trial' && new Date() > new Date(user.trialEndDate);\n};\n\n// Feature access checker\nexport const hasFeatureAccess = (user: { subscriptionStatus: string; trialEndDate: Date | null }, feature: PremiumFeature): boolean => {\n  // Active subscription has access to everything\n  if (user.subscriptionStatus === 'active') return true;\n  \n  // Check if feature is premium-only (requires subscription, no trial access)\n  if (isPremiumOnlyFeature(feature)) return false;\n  \n  // For non-premium-only features, trial users have access if trial hasn't expired\n  if (user.subscriptionStatus === 'free_trial' && !isTrialExpired(user)) return true;\n  \n  return false;\n};\n\n// Authentication types\nexport type SignUpData = z.infer<typeof signUpSchema>;\nexport type SignInData = z.infer<typeof signInSchema>;\n","size_bytes":40200},"client/src/components/workout-logger.tsx":{"content":"import { useState } from \"react\";\nimport { useLocation } from \"wouter\";\nimport { useQuery, useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport { Search, Expand, Hand, Activity, ArrowUpDown, Leaf, Weight, Bike, Dumbbell, X, Play, Star, TrendingUp, Camera, CheckCircle } from \"lucide-react\";\nimport { Input } from \"@/components/ui/input\";\nimport { Button } from \"@/components/ui/button\";\nimport { Slider } from \"@/components/ui/slider\";\nimport { Label } from \"@/components/ui/label\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport type { Exercise } from \"@shared/schema\";\nimport VoiceSearchButton from \"@/components/voice-search-button\";\nimport dumbbellExercisesImage from \"@assets/IMG_6694_1758675702051.jpeg\";\nimport pushUpExerciseImage from \"@assets/generated_images/Man_performing_push-up_exercise_19b36844.png\";\nimport benchPressImage from \"@assets/generated_images/Man_performing_bench_press_60a51258.png\";\nimport pullUpExerciseImage from \"@assets/generated_images/Black_man_performing_pull-ups_3605874d.png\";\nimport chinUpExerciseImage from \"@assets/generated_images/Black_man_and_woman_chin-ups_7848bb87.png\";\nimport dipExerciseImage from \"@assets/generated_images/Man_and_woman_dips_e6984611.png\";\nimport overheadPressImage from \"@assets/generated_images/Man_and_woman_dumbbell_shoulder_press_0adea308.png\";\nimport bicepCurlsImage from \"@assets/generated_images/Man_and_woman_dumbbell_curls_f43bb36e.png\";\nimport dumbbellFlyesImage from \"@assets/generated_images/Man_and_woman_dumbbell_flyes_de771e8c.png\";\nimport dumbbellRollsImage from \"@assets/stock_images/black_woman_performi_21123039.jpg\";\nimport tricepExtensionsImage from \"@assets/generated_images/Black_guy_and_lady_tricep_extensions_3cce0d7d.png\";\nimport latPulldownImage from \"@assets/generated_images/Man_and_woman_lat_pulldown_dbce7bd1.png\";\nimport rowsImage from \"@assets/IMG_6694_1758675702051.jpeg\";\nimport squatsImage from \"@assets/generated_images/Man_and_woman_dumbbell_squats_2743b80a.png\";\nimport deadliftsImage from \"@assets/generated_images/Black_guy_and_lady_deadlifts_3066fc1b.png\";\nimport lungesImage from \"@assets/generated_images/Man_and_woman_dumbbell_lunges_c5474eaf.png\";\nimport legPressImage from \"@assets/generated_images/Black_woman_leg_press_exercise_c612272f.png\";\nimport calfRaisesImage from \"@assets/generated_images/Black_guy_and_lady_calf_raises_3cb5cf18.png\";\nimport romanianDeadliftsImage from \"@assets/generated_images/Black_guy_and_lady_Romanian_deadlifts_cba72218.png\";\nimport hipThrustsImage from \"@assets/generated_images/Black_woman_performing_hip_thrusts_ebc9e75c.png\";\nimport plankImage from \"@assets/generated_images/Man_performing_plank_exercise_5bcbc71c.png\";\nimport crunchesImage from \"@assets/generated_images/Woman_performing_crunches_exercise_2d16cfd0.png\";\nimport russianTwistsImage from \"@assets/generated_images/Man_performing_Russian_twists_ca261386.png\";\nimport mountainClimbersImage from \"@assets/generated_images/Woman_performing_mountain_climbers_35705bbe.png\";\nimport deadBugImage from \"@assets/generated_images/Man_performing_dead_bug_7bdcdb1e.png\";\nimport hangingLegRaisesImage from \"@assets/generated_images/Woman_performing_hanging_leg_raises_ef4d5db2.png\";\nimport lateralRaisesImage from \"@assets/generated_images/Man_and_woman_dumbbell_lateral_raises_a9e51d80.png\";\nimport frontRaisesImage from \"@assets/generated_images/Man_and_woman_dumbbell_front_raises_f19c02ce.png\";\nimport dumbbellShrugsImage from \"@assets/generated_images/Woman_performing_dumbbell_shrugs_ac5db82c.png\";\nimport dumbbellStepUpsImage from \"@assets/generated_images/Man_performing_dumbbell_step-ups_da98f98d.png\";\nimport dumbbellThrustersImage from \"@assets/generated_images/Woman_performing_dumbbell_thrusters_e6b4460d.png\";\nimport workoutBgImage from \"@assets/stock_images/men_and_women_workin_dbbf742b.jpg\";\n\nexport default function WorkoutLogger() {\n  const [searchQuery, setSearchQuery] = useState(\"\");\n  const [selectedCategory, setSelectedCategory] = useState(\"strength\");\n  const [selectedMuscleGroup, setSelectedMuscleGroup] = useState<string>(\"all\");\n  const [showAllExercises, setShowAllExercises] = useState(false);\n  const [selectedExercise, setSelectedExercise] = useState<any>(null);\n  const [difficultyLevel, setDifficultyLevel] = useState([3]);\n  const [perceivedExertion, setPerceivedExertion] = useState([5]);\n  const [workoutDuration, setWorkoutDuration] = useState([30]);\n  const [showWorkoutForm, setShowWorkoutForm] = useState(false);\n  const [showProgressPhotoPrompt, setShowProgressPhotoPrompt] = useState(false);\n  const [lastCompletedWorkout, setLastCompletedWorkout] = useState<any>(null);\n  \n  // Exercise-specific input states\n  const [exerciseSets, setExerciseSets] = useState(3);\n  const [exerciseReps, setExerciseReps] = useState(10);\n  const [exerciseWeight, setExerciseWeight] = useState(0);\n  const [exerciseDuration, setExerciseDuration] = useState(0);\n  const [exerciseNotes, setExerciseNotes] = useState(\"\");\n  const [, setLocation] = useLocation();\n  const queryClient = useQueryClient();\n  const { toast } = useToast();\n\n  // Helper function to calculate calories based on exercise details\n  const calculateExerciseCalories = (exercise: any, sets: number, reps: number, weight: number, duration: number, difficultyLevel: number) => {\n    let baseCalories = 0;\n    const exerciseName = exercise.name.toLowerCase();\n    const category = exercise.category.toLowerCase();\n\n    // Base calorie calculation by exercise category\n    if (category === 'strength') {\n      // Strength training: ~5-8 calories per minute, plus weight factor\n      baseCalories = (sets * reps * 0.5) + (weight * 0.1) + (workoutDuration[0] * 6);\n      if (exerciseName.includes('squat') || exerciseName.includes('deadlift')) {\n        baseCalories *= 1.3; // Compound movements burn more\n      }\n    } else if (category === 'cardio') {\n      // Cardio: ~8-12 calories per minute based on intensity\n      baseCalories = workoutDuration[0] * (8 + difficultyLevel * 0.8);\n      if (duration > 0) {\n        baseCalories = duration / 60 * (8 + difficultyLevel * 0.8); // Use actual duration if provided\n      }\n    } else if (category === 'yoga' || category === 'flexibility') {\n      // Yoga/Flexibility: ~3-5 calories per minute\n      baseCalories = workoutDuration[0] * (3 + difficultyLevel * 0.4);\n    } else {\n      // Default: moderate intensity\n      baseCalories = workoutDuration[0] * (5 + difficultyLevel * 0.6);\n    }\n\n    // Apply difficulty multiplier\n    baseCalories *= (0.8 + difficultyLevel * 0.1);\n    \n    return Math.round(baseCalories);\n  };\n\n  // Helper function to get the appropriate demo image based on exercise name\n  const getDemoImage = (exerciseName: string) => {\n    const exerciseNameLower = exerciseName.toLowerCase();\n    if (exerciseNameLower.includes('push-up') || exerciseNameLower.includes('pushup')) {\n      return pushUpExerciseImage;\n    }\n    if (exerciseNameLower.includes('bench press') || exerciseNameLower.includes('dumbbell press')) {\n      return benchPressImage;\n    }\n    if (exerciseNameLower.includes('chin-up') || exerciseNameLower.includes('chinup')) {\n      return chinUpExerciseImage;\n    }\n    if (exerciseNameLower.includes('pull-up') || exerciseNameLower.includes('pullup')) {\n      return pullUpExerciseImage;\n    }\n    if (exerciseNameLower.includes('dip') && !exerciseNameLower.includes('dumbbell')) {\n      return dipExerciseImage;\n    }\n    if (exerciseNameLower.includes('overhead press') || exerciseNameLower.includes('military press') || exerciseNameLower.includes('shoulder press')) {\n      return overheadPressImage;\n    }\n    if (exerciseNameLower.includes('lateral raise') || exerciseNameLower.includes('lateral raises')) {\n      return lateralRaisesImage;\n    }\n    if (exerciseNameLower.includes('front raise') || exerciseNameLower.includes('front raises')) {\n      return frontRaisesImage;\n    }\n    if (exerciseNameLower.includes('bicep') && (exerciseNameLower.includes('curl') || exerciseNameLower.includes('curls'))) {\n      return bicepCurlsImage;\n    }\n    if (exerciseNameLower.includes('dumbbell') && (exerciseNameLower.includes('curl') || exerciseNameLower.includes('curls'))) {\n      return bicepCurlsImage;\n    }\n    if (exerciseNameLower.includes('dumbbell') && (exerciseNameLower.includes('fly') || exerciseNameLower.includes('flyes') || exerciseNameLower.includes('flys'))) {\n      return dumbbellFlyesImage;\n    }\n    if (exerciseNameLower.includes('dumbbell') && (exerciseNameLower.includes('roll') || exerciseNameLower.includes('rolls'))) {\n      return dumbbellRollsImage;\n    }\n    if (exerciseNameLower.includes('tricep') && (exerciseNameLower.includes('extension') || exerciseNameLower.includes('extensions'))) {\n      return tricepExtensionsImage;\n    }\n    if (exerciseNameLower.includes('lat pulldown') || exerciseNameLower.includes('lat pull down') || exerciseNameLower.includes('pulldown')) {\n      return latPulldownImage;\n    }\n    if (exerciseNameLower.includes('row') && !exerciseNameLower.includes('barrow')) {\n      return rowsImage;\n    }\n    if (exerciseNameLower.includes('squat') || exerciseNameLower.includes('squats')) {\n      return squatsImage;\n    }\n    if (exerciseNameLower.includes('dumbbell') && (exerciseNameLower.includes('squat') || exerciseNameLower.includes('squats'))) {\n      return squatsImage;\n    }\n    if (exerciseNameLower.includes('deadlift') && !exerciseNameLower.includes('romanian')) {\n      return deadliftsImage;\n    }\n    if (exerciseNameLower.includes('romanian deadlift')) {\n      return romanianDeadliftsImage;\n    }\n    if (exerciseNameLower.includes('lunge') || exerciseNameLower.includes('lunges')) {\n      return lungesImage;\n    }\n    if (exerciseNameLower.includes('dumbbell') && (exerciseNameLower.includes('lunge') || exerciseNameLower.includes('lunges'))) {\n      return lungesImage;\n    }\n    if (exerciseNameLower.includes('leg press')) {\n      return legPressImage;\n    }\n    if (exerciseNameLower.includes('calf raise') || exerciseNameLower.includes('calf raises')) {\n      return calfRaisesImage;\n    }\n    if (exerciseNameLower.includes('hip thrust') || exerciseNameLower.includes('hip thrusts')) {\n      return hipThrustsImage;\n    }\n    if (exerciseNameLower.includes('plank')) {\n      return plankImage;\n    }\n    if (exerciseNameLower.includes('crunch') || exerciseNameLower.includes('crunches')) {\n      return crunchesImage;\n    }\n    if (exerciseNameLower.includes('russian twist') || exerciseNameLower.includes('russian twists')) {\n      return russianTwistsImage;\n    }\n    if (exerciseNameLower.includes('mountain climber') || exerciseNameLower.includes('mountain climbers')) {\n      return mountainClimbersImage;\n    }\n    if (exerciseNameLower.includes('dead bug')) {\n      return deadBugImage;\n    }\n    if (exerciseNameLower.includes('hanging leg raise') || exerciseNameLower.includes('hanging leg raises')) {\n      return hangingLegRaisesImage;\n    }\n    if (exerciseNameLower.includes('dumbbell') && (exerciseNameLower.includes('shrug') || exerciseNameLower.includes('shrugs'))) {\n      return dumbbellShrugsImage;\n    }\n    if (exerciseNameLower.includes('dumbbell') && (exerciseNameLower.includes('step-up') || exerciseNameLower.includes('step up') || exerciseNameLower.includes('stepup'))) {\n      return dumbbellStepUpsImage;\n    }\n    if (exerciseNameLower.includes('dumbbell') && (exerciseNameLower.includes('thruster') || exerciseNameLower.includes('thrusters'))) {\n      return dumbbellThrustersImage;\n    }\n    // Default to dumbbell exercises image for other exercises\n    return dumbbellExercisesImage;\n  };\n\n  const { data: exercises, isLoading } = useQuery<Exercise[]>({\n    queryKey: [\"/api/exercises\", { category: selectedCategory, search: searchQuery }],\n  });\n\n  const createWorkoutMutation = useMutation({\n    mutationFn: async (workout: { \n      name: string; \n      category: string; \n      duration: number; \n      caloriesBurned: number;\n      difficultyLevel?: number;\n      perceivedExertion?: number;\n      completionRate?: number;\n    }) => {\n      const response = await apiRequest(\"POST\", \"/api/workouts\", workout);\n      return response.json();\n    },\n    onSuccess: (workoutData) => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/workouts\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/stats\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/progress/metrics\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/goals\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/progress/weight\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/performance-analytics\"] });\n      \n      // Store completed workout data and show progress photo prompt\n      setLastCompletedWorkout(workoutData);\n      setShowProgressPhotoPrompt(true);\n      toast({\n        title: \"Workout Logged! 🔥\",\n        description: \"Your workout has been successfully recorded with AI difficulty tracking.\",\n      });\n    },\n  });\n\n  const categories = [\n    { id: \"strength\", name: \"Strength\", icon: Dumbbell },\n    { id: \"dumbbells\", name: \"Dumbbells\", icon: Weight },\n    { id: \"cardio\", name: \"Cardio\", icon: Activity },\n    { id: \"yoga\", name: \"Yoga\", icon: Leaf },\n    { id: \"swimming\", name: \"Swimming\", icon: Activity },\n  ];\n\n  const quickExercises = [\n    // Strength Training - Upper Body\n    { name: \"Push-ups\", category: \"strength\", icon: Hand, color: \"blue\", description: \"Upper body strength\" },\n    { name: \"Bench Press\", category: \"strength\", icon: Weight, color: \"blue\", description: \"Chest strength\" },\n    { name: \"Pull-ups\", category: \"strength\", icon: ArrowUpDown, color: \"green\", description: \"Back and arms\" },\n    { name: \"Chin-ups\", category: \"strength\", icon: ArrowUpDown, color: \"green\", description: \"Biceps and back\" },\n    { name: \"Dips\", category: \"strength\", icon: Hand, color: \"blue\", description: \"Triceps and chest\" },\n    { name: \"Overhead Press\", category: \"strength\", icon: Weight, color: \"purple\", description: \"Shoulder strength\" },\n    { name: \"Bicep Curls\", category: \"strength\", icon: Weight, color: \"blue\", description: \"Arm muscle building\" },\n    { name: \"Tricep Extensions\", category: \"strength\", icon: Weight, color: \"purple\", description: \"Tricep isolation\" },\n    { name: \"Lat Pulldowns\", category: \"strength\", icon: ArrowUpDown, color: \"green\", description: \"Back width\" },\n    { name: \"Rows\", category: \"strength\", icon: Weight, color: \"green\", description: \"Back thickness\" },\n    \n    // Strength Training - Lower Body\n    { name: \"Squats\", category: \"strength\", icon: ArrowUpDown, color: \"purple\", description: \"Lower body power\" },\n    { name: \"Deadlifts\", category: \"strength\", icon: Weight, color: \"red\", description: \"Full body strength\" },\n    { name: \"Lunges\", category: \"strength\", icon: ArrowUpDown, color: \"purple\", description: \"Leg stability\" },\n    { name: \"Leg Press\", category: \"strength\", icon: Weight, color: \"purple\", description: \"Quad development\" },\n    { name: \"Calf Raises\", category: \"strength\", icon: ArrowUpDown, color: \"blue\", description: \"Calf muscle\" },\n    { name: \"Romanian Deadlifts\", category: \"strength\", icon: Weight, color: \"red\", description: \"Hamstring focus\" },\n    { name: \"Bulgarian Split Squats\", category: \"strength\", icon: ArrowUpDown, color: \"purple\", description: \"Single leg strength\" },\n    { name: \"Hip Thrusts\", category: \"strength\", icon: Weight, color: \"pink\", description: \"Glute activation\" },\n    \n    // Strength Training - Core\n    { name: \"Plank\", category: \"strength\", icon: Hand, color: \"purple\", description: \"Core strength\" },\n    { name: \"Crunches\", category: \"strength\", icon: Hand, color: \"purple\", description: \"Abdominal focus\" },\n    { name: \"Russian Twists\", category: \"strength\", icon: Hand, color: \"purple\", description: \"Oblique strength\" },\n    { name: \"Mountain Climbers\", category: \"strength\", icon: Activity, color: \"red\", description: \"Core cardio\" },\n    { name: \"Dead Bug\", category: \"strength\", icon: Hand, color: \"purple\", description: \"Core stability\" },\n    { name: \"Hanging Leg Raises\", category: \"strength\", icon: ArrowUpDown, color: \"green\", description: \"Lower abs\" },\n    \n    // Cardio Exercises\n    { name: \"Running\", category: \"cardio\", icon: Activity, color: \"green\", description: \"Cardio endurance\" },\n    { name: \"Cycling\", category: \"cardio\", icon: Bike, color: \"yellow\", description: \"Leg endurance\" },\n    { name: \"Burpees\", category: \"cardio\", icon: Activity, color: \"red\", description: \"Full body cardio\" },\n    { name: \"Jumping Jacks\", category: \"cardio\", icon: Activity, color: \"green\", description: \"Quick cardio burst\" },\n    { name: \"High Knees\", category: \"cardio\", icon: Activity, color: \"yellow\", description: \"Leg cardio\" },\n    { name: \"Treadmill\", category: \"cardio\", icon: Activity, color: \"green\", description: \"Indoor running\" },\n    { name: \"Elliptical\", category: \"cardio\", icon: Activity, color: \"blue\", description: \"Low impact cardio\" },\n    { name: \"Rowing Machine\", category: \"cardio\", icon: Activity, color: \"red\", description: \"Full body cardio\" },\n    { name: \"Stair Climber\", category: \"cardio\", icon: Activity, color: \"purple\", description: \"Leg cardio\" },\n    { name: \"Battle Ropes\", category: \"cardio\", icon: Activity, color: \"red\", description: \"Upper body cardio\" },\n    { name: \"Box Jumps\", category: \"cardio\", icon: ArrowUpDown, color: \"yellow\", description: \"Explosive power\" },\n    { name: \"Sprint Intervals\", category: \"cardio\", icon: Activity, color: \"red\", description: \"High intensity\" },\n    \n    // Yoga & Flexibility\n    { name: \"Yoga\", category: \"yoga\", icon: Leaf, color: \"pink\", description: \"Flexibility & mind\" },\n    { name: \"Meditation\", category: \"yoga\", icon: Leaf, color: \"pink\", description: \"Mental wellness\" },\n    { name: \"Sun Salutation\", category: \"yoga\", icon: Leaf, color: \"pink\", description: \"Flow sequence\" },\n    { name: \"Warrior Pose\", category: \"yoga\", icon: Leaf, color: \"pink\", description: \"Strength & balance\" },\n    { name: \"Downward Dog\", category: \"yoga\", icon: Leaf, color: \"pink\", description: \"Full body stretch\" },\n    { name: \"Child's Pose\", category: \"yoga\", icon: Leaf, color: \"pink\", description: \"Relaxation pose\" },\n    { name: \"Pigeon Pose\", category: \"yoga\", icon: Leaf, color: \"pink\", description: \"Hip flexibility\" },\n    { name: \"Stretching\", category: \"yoga\", icon: Leaf, color: \"pink\", description: \"Muscle recovery\" },\n    \n    // Swimming\n    { name: \"Swimming\", category: \"swimming\", icon: Activity, color: \"blue\", description: \"Full body cardio\" },\n    { name: \"Freestyle\", category: \"swimming\", icon: Activity, color: \"blue\", description: \"Front crawl stroke\" },\n    { name: \"Backstroke\", category: \"swimming\", icon: Activity, color: \"blue\", description: \"Back swimming\" },\n    { name: \"Breaststroke\", category: \"swimming\", icon: Activity, color: \"blue\", description: \"Chest stroke\" },\n    { name: \"Butterfly\", category: \"swimming\", icon: Activity, color: \"blue\", description: \"Advanced stroke\" },\n    { name: \"Water Aerobics\", category: \"swimming\", icon: Activity, color: \"blue\", description: \"Low impact exercise\" },\n    { name: \"Treading Water\", category: \"swimming\", icon: Activity, color: \"blue\", description: \"Core & leg workout\" },\n    \n    // Dumbbell Exercises\n    { name: \"Dumbbell Press\", category: \"dumbbells\", icon: Weight, color: \"blue\", description: \"Chest development\" },\n    { name: \"Dumbbell Rows\", category: \"dumbbells\", icon: Weight, color: \"green\", description: \"Back muscle building\" },\n    { name: \"Dumbbell Curls\", category: \"dumbbells\", icon: Weight, color: \"blue\", description: \"Bicep isolation\" },\n    { name: \"Dumbbell Flyes\", category: \"dumbbells\", icon: Weight, color: \"blue\", description: \"Chest isolation\" },\n    { name: \"Dumbbell Squats\", category: \"dumbbells\", icon: Weight, color: \"purple\", description: \"Leg strength\" },\n    { name: \"Dumbbell Lunges\", category: \"dumbbells\", icon: Weight, color: \"purple\", description: \"Single leg work\" },\n    { name: \"Dumbbell Shoulder Press\", category: \"dumbbells\", icon: Weight, color: \"yellow\", description: \"Shoulder development\" },\n    { name: \"Dumbbell Lateral Raises\", category: \"dumbbells\", icon: Weight, color: \"yellow\", description: \"Side deltoid focus\" },\n    { name: \"Dumbbell Front Raises\", category: \"dumbbells\", icon: Weight, color: \"yellow\", description: \"Front deltoid work\" },\n    { name: \"Dumbbell Shrugs\", category: \"dumbbells\", icon: Weight, color: \"green\", description: \"Trap muscle building\" },\n    { name: \"Dumbbell Deadlifts\", category: \"dumbbells\", icon: Weight, color: \"red\", description: \"Posterior chain\" },\n    { name: \"Dumbbell Step-ups\", category: \"dumbbells\", icon: Weight, color: \"purple\", description: \"Functional leg work\" },\n    { name: \"Dumbbell Tricep Extensions\", category: \"dumbbells\", icon: Weight, color: \"blue\", description: \"Tricep isolation\" },\n    { name: \"Dumbbell Hammer Curls\", category: \"dumbbells\", icon: Weight, color: \"blue\", description: \"Bicep variation\" },\n    { name: \"Dumbbell Thrusters\", category: \"dumbbells\", icon: Weight, color: \"red\", description: \"Full body exercise\" },\n    { name: \"Dumbbell Russian Twists\", category: \"dumbbells\", icon: Weight, color: \"purple\", description: \"Weighted core work\" },\n    { name: \"Dumbbell Walking Lunges\", category: \"dumbbells\", icon: Weight, color: \"purple\", description: \"Dynamic leg exercise\" },\n    { name: \"Dumbbell Goblet Squats\", category: \"dumbbells\", icon: Weight, color: \"purple\", description: \"Front-loaded squats\" },\n    { name: \"Dumbbell Bulgarian Split Squats\", category: \"dumbbells\", icon: Weight, color: \"purple\", description: \"Single leg focus\" },\n  ];\n\n  // Filter exercises based on search query\n  const getFilteredExercises = () => {\n    // Use quickExercises as the base and enrich with API data if available\n    const exercisesWithProps = quickExercises.map(quickEx => {\n      // Find matching API exercise for additional data\n      const apiExercise = (exercises || []).find(ex => ex.name === quickEx.name);\n      return {\n        ...quickEx,\n        ...(apiExercise || {}), // Merge API data if available\n        icon: quickEx.icon,\n        color: quickEx.color,\n        description: apiExercise?.description || quickEx.description\n      };\n    });\n    \n    if (!searchQuery.trim()) {\n      return exercisesWithProps.filter(exercise => exercise.category === selectedCategory);\n    }\n    \n    return exercisesWithProps.filter(exercise => \n      exercise.name.toLowerCase().includes(searchQuery.toLowerCase()) ||\n      (exercise.description && exercise.description.toLowerCase().includes(searchQuery.toLowerCase())) ||\n      exercise.category.toLowerCase().includes(searchQuery.toLowerCase())\n    );\n  };\n\n  const filteredExercises = getFilteredExercises();\n\n  // Exercise instructions database\n  const exerciseInstructions: Record<string, { steps: string[], tips: string[], muscles: string[] }> = {\n    // Strength Training - Upper Body\n    \"Push-ups\": {\n      steps: [\n        \"Start in a plank position with hands shoulder-width apart\",\n        \"Lower your body until chest nearly touches the floor\",\n        \"Push back up to starting position\",\n        \"Keep your core tight throughout the movement\"\n      ],\n      tips: [\"Keep your body in a straight line\", \"Don't let your hips sag\", \"Control the movement\"],\n      muscles: [\"Chest\", \"Triceps\", \"Shoulders\", \"Core\"]\n    },\n    \"Pull-ups\": {\n      steps: [\n        \"Hang from bar with palms facing away\",\n        \"Pull body up until chin clears the bar\",\n        \"Lower with control to full arm extension\",\n        \"Repeat without swinging\"\n      ],\n      tips: [\"Engage lats\", \"Don't use momentum\", \"Full range of motion\"],\n      muscles: [\"Lats\", \"Biceps\", \"Rhomboids\", \"Core\"]\n    },\n    \"Chin-ups\": {\n      steps: [\n        \"Grab bar with palms facing toward you, hands shoulder-width apart\",\n        \"Start from dead hang with arms fully extended\",\n        \"Pull yourself up until chin goes over the bar\",\n        \"Lower yourself slowly to starting position\"\n      ],\n      tips: [\"Palms toward you targets biceps more\", \"Don't kip or swing\", \"Squeeze shoulder blades\"],\n      muscles: [\"Biceps\", \"Lats\", \"Middle Traps\", \"Rear Deltoids\"]\n    },\n    \"Dips\": {\n      steps: [\n        \"Position hands on parallel bars or bench behind you\",\n        \"Start with arms extended, supporting your body weight\",\n        \"Lower body by bending elbows until shoulders are below elbows\",\n        \"Push back up to starting position\"\n      ],\n      tips: [\"Keep torso upright\", \"Don't go too low if shoulders hurt\", \"Control the descent\"],\n      muscles: [\"Triceps\", \"Lower Chest\", \"Front Deltoids\"]\n    },\n    \"Bench Press\": {\n      steps: [\n        \"Lie on bench with eyes under the bar\",\n        \"Grip bar slightly wider than shoulder-width\",\n        \"Lower bar to chest with control\",\n        \"Press bar back up to starting position\"\n      ],\n      tips: [\"Keep feet on floor\", \"Retract shoulder blades\", \"Don't bounce off chest\"],\n      muscles: [\"Chest\", \"Triceps\", \"Front Deltoids\"]\n    },\n    \"Overhead Press\": {\n      steps: [\n        \"Stand with feet shoulder-width apart, bar at shoulder level\",\n        \"Grip bar with hands slightly wider than shoulders\",\n        \"Press bar straight overhead until arms are locked out\",\n        \"Lower bar back to shoulder level with control\"\n      ],\n      tips: [\"Keep core tight\", \"Don't arch back excessively\", \"Press in straight line\"],\n      muscles: [\"Shoulders\", \"Triceps\", \"Upper Chest\", \"Core\"]\n    },\n    \"Bicep Curls\": {\n      steps: [\n        \"Stand holding barbell or dumbbells with underhand grip\",\n        \"Keep elbows close to your sides\",\n        \"Curl weight up by flexing biceps\",\n        \"Lower weight slowly to starting position\"\n      ],\n      tips: [\"Don't swing or use momentum\", \"Squeeze at the top\", \"Control the negative\"],\n      muscles: [\"Biceps\", \"Forearms\"]\n    },\n    \"Tricep Extensions\": {\n      steps: [\n        \"Lie on bench holding weight with both hands overhead\",\n        \"Lower weight behind head by bending only at elbows\",\n        \"Keep upper arms stationary throughout movement\",\n        \"Extend arms back to starting position\"\n      ],\n      tips: [\"Keep elbows pointing forward\", \"Don't let elbows flare\", \"Use controlled movement\"],\n      muscles: [\"Triceps\"]\n    },\n    \"Lat Pulldowns\": {\n      steps: [\n        \"Sit at lat pulldown machine with thighs under pads\",\n        \"Grab bar with wide overhand grip\",\n        \"Pull bar down to upper chest while leaning slightly back\",\n        \"Slowly return bar to starting position\"\n      ],\n      tips: [\"Pull with your back, not arms\", \"Squeeze shoulder blades\", \"Don't lean too far back\"],\n      muscles: [\"Lats\", \"Rhomboids\", \"Middle Traps\", \"Biceps\"]\n    },\n    \"Rows\": {\n      steps: [\n        \"Stand with feet hip-width apart, holding barbell\",\n        \"Hinge at hips and lean forward 45 degrees\",\n        \"Pull bar to lower chest/upper stomach\",\n        \"Lower bar with control to starting position\"\n      ],\n      tips: [\"Keep back straight\", \"Pull elbows back, not out\", \"Squeeze shoulder blades\"],\n      muscles: [\"Lats\", \"Rhomboids\", \"Middle Traps\", \"Rear Deltoids\"]\n    },\n    \n    // Strength Training - Lower Body\n    \"Squats\": {\n      steps: [\n        \"Stand with feet shoulder-width apart, toes slightly out\",\n        \"Lower body by pushing hips back and bending knees\",\n        \"Descend until thighs are parallel to floor\",\n        \"Drive through heels to return to standing\"\n      ],\n      tips: [\"Keep chest up and core tight\", \"Knees track over toes\", \"Weight on heels\"],\n      muscles: [\"Quadriceps\", \"Glutes\", \"Hamstrings\", \"Core\"]\n    },\n    \"Deadlifts\": {\n      steps: [\n        \"Stand with feet hip-width apart, bar over mid-foot\",\n        \"Bend at hips and knees to grip the bar\",\n        \"Keep chest up and back straight\",\n        \"Drive through heels to stand up, extending hips and knees\"\n      ],\n      tips: [\"Bar stays close to body\", \"Don't round back\", \"Push floor away with feet\"],\n      muscles: [\"Hamstrings\", \"Glutes\", \"Lower Back\", \"Traps\"]\n    },\n    \"Lunges\": {\n      steps: [\n        \"Stand upright with feet hip-width apart\",\n        \"Step forward into a lunge position\",\n        \"Lower back knee toward ground while keeping front shin vertical\",\n        \"Push off front foot to return to starting position\"\n      ],\n      tips: [\"Keep torso upright\", \"Don't let front knee drift forward\", \"Step out far enough\"],\n      muscles: [\"Quadriceps\", \"Glutes\", \"Hamstrings\", \"Calves\"]\n    },\n    \"Leg Press\": {\n      steps: [\n        \"Sit in leg press machine with back flat against pad\",\n        \"Place feet on platform shoulder-width apart\",\n        \"Lower weight by bending knees to 90 degrees\",\n        \"Press through heels to extend legs back up\"\n      ],\n      tips: [\"Don't let knees cave inward\", \"Keep core engaged\", \"Full range of motion\"],\n      muscles: [\"Quadriceps\", \"Glutes\", \"Hamstrings\"]\n    },\n    \"Calf Raises\": {\n      steps: [\n        \"Stand on balls of feet on raised platform or step\",\n        \"Let heels drop below the level of the platform\",\n        \"Rise up onto toes as high as possible\",\n        \"Lower heels back down slowly for a stretch\"\n      ],\n      tips: [\"Go for full range of motion\", \"Pause at the top\", \"Control the descent\"],\n      muscles: [\"Calves\", \"Soleus\"]\n    },\n    \"Romanian Deadlifts\": {\n      steps: [\n        \"Hold barbell with overhand grip, feet hip-width apart\",\n        \"Start with slight bend in knees throughout movement\",\n        \"Push hips back and lower bar while keeping it close to legs\",\n        \"Feel stretch in hamstrings, then drive hips forward to return\"\n      ],\n      tips: [\"This is a hip hinge, not a squat\", \"Feel the stretch in hamstrings\", \"Keep bar close\"],\n      muscles: [\"Hamstrings\", \"Glutes\", \"Lower Back\"]\n    },\n    \"Bulgarian Split Squats\": {\n      steps: [\n        \"Stand 2-3 feet in front of bench or step\",\n        \"Place top of rear foot on bench behind you\",\n        \"Lower into lunge position by bending front knee\",\n        \"Push through front heel to return to starting position\"\n      ],\n      tips: [\"Most weight on front foot\", \"Keep torso upright\", \"Don't push off back foot\"],\n      muscles: [\"Quadriceps\", \"Glutes\", \"Hamstrings\"]\n    },\n    \"Hip Thrusts\": {\n      steps: [\n        \"Sit with upper back against bench, barbell over hips\",\n        \"Plant feet firmly on ground, knees bent 90 degrees\",\n        \"Drive through heels to lift hips up\",\n        \"Squeeze glutes at top, then lower with control\"\n      ],\n      tips: [\"Focus on glute squeeze at top\", \"Keep ribs down\", \"Don't overarch back\"],\n      muscles: [\"Glutes\", \"Hamstrings\", \"Core\"]\n    },\n    \n    // Strength Training - Core\n    \"Plank\": {\n      steps: [\n        \"Start in push-up position on forearms\",\n        \"Keep body in straight line from head to heels\",\n        \"Hold position while breathing normally\",\n        \"Don't let hips sag or pike up\"\n      ],\n      tips: [\"Engage core muscles\", \"Keep neck neutral\", \"Start with shorter holds\"],\n      muscles: [\"Core\", \"Shoulders\", \"Glutes\"]\n    },\n    \"Crunches\": {\n      steps: [\n        \"Lie on back with knees bent, feet flat on floor\",\n        \"Place hands behind head or across chest\",\n        \"Lift shoulder blades off ground by contracting abs\",\n        \"Lower back down slowly without fully relaxing\"\n      ],\n      tips: [\"Don't pull on neck\", \"Focus on ab contraction\", \"Small range of motion\"],\n      muscles: [\"Upper Abdominals\"]\n    },\n    \"Russian Twists\": {\n      steps: [\n        \"Sit on floor with knees bent, lean back slightly\",\n        \"Lift feet off ground and balance on tailbone\",\n        \"Rotate torso side to side, touching ground beside hips\",\n        \"Keep chest up and core engaged throughout\"\n      ],\n      tips: [\"Move with control, not speed\", \"Keep feet elevated\", \"Look forward\"],\n      muscles: [\"Obliques\", \"Core\", \"Hip Flexors\"]\n    },\n    \"Mountain Climbers\": {\n      steps: [\n        \"Start in plank position with arms extended\",\n        \"Bring one knee toward chest\",\n        \"Quickly switch legs, bringing other knee forward\",\n        \"Continue alternating legs at a quick pace\"\n      ],\n      tips: [\"Keep hips level\", \"Don't let form break down\", \"This is cardio and core combined\"],\n      muscles: [\"Core\", \"Shoulders\", \"Hip Flexors\"]\n    },\n    \"Dead Bug\": {\n      steps: [\n        \"Lie on back with arms extended toward ceiling\",\n        \"Bring knees up to 90 degrees (tabletop position)\",\n        \"Lower opposite arm and leg slowly toward floor\",\n        \"Return to starting position and repeat other side\"\n      ],\n      tips: [\"Keep lower back pressed to floor\", \"Move slowly and controlled\", \"Don't let ribs flare\"],\n      muscles: [\"Deep Core\", \"Hip Flexors\"]\n    },\n    \"Hanging Leg Raises\": {\n      steps: [\n        \"Hang from pull-up bar with arms fully extended\",\n        \"Keep legs straight or slightly bent\",\n        \"Raise legs up until parallel to ground or higher\",\n        \"Lower legs slowly back to starting position\"\n      ],\n      tips: [\"Control the swing\", \"Don't use momentum\", \"Focus on ab contraction\"],\n      muscles: [\"Lower Abs\", \"Hip Flexors\"]\n    },\n    \n    // Cardio Exercises\n    \"Running\": {\n      steps: [\n        \"Start with 5-10 minute warm-up walk\",\n        \"Begin running at comfortable conversational pace\",\n        \"Land on midfoot with slight forward lean\",\n        \"Keep arms relaxed, swing naturally at 90-degree angle\"\n      ],\n      tips: [\"Build distance gradually\", \"Breathe rhythmically\", \"Good shoes are essential\"],\n      muscles: [\"Legs\", \"Glutes\", \"Core\", \"Cardiovascular System\"]\n    },\n    \"Cycling\": {\n      steps: [\n        \"Adjust bike seat height so leg is slightly bent at bottom\",\n        \"Start pedaling at moderate resistance\",\n        \"Keep steady cadence between 80-100 RPM\",\n        \"Maintain upright posture with relaxed shoulders\"\n      ],\n      tips: [\"Start with shorter rides\", \"Stay hydrated\", \"Use gears appropriately\"],\n      muscles: [\"Quadriceps\", \"Hamstrings\", \"Glutes\", \"Calves\"]\n    },\n    \"Burpees\": {\n      steps: [\n        \"Start standing, then squat down and place hands on floor\",\n        \"Jump feet back into plank position\",\n        \"Do a push-up (optional for beginners)\",\n        \"Jump feet back to squat, then jump up with arms overhead\"\n      ],\n      tips: [\"Modify by stepping instead of jumping\", \"Keep core tight in plank\", \"This is high intensity\"],\n      muscles: [\"Full Body\", \"Cardiovascular System\"]\n    },\n    \"Jumping Jacks\": {\n      steps: [\n        \"Stand with feet together, arms at sides\",\n        \"Jump feet apart while raising arms overhead\",\n        \"Jump feet back together while lowering arms\",\n        \"Continue at steady, quick pace\"\n      ],\n      tips: [\"Land softly on balls of feet\", \"Keep core engaged\", \"Great for warm-up\"],\n      muscles: [\"Calves\", \"Shoulders\", \"Core\", \"Cardiovascular System\"]\n    },\n    \"High Knees\": {\n      steps: [\n        \"Stand in place with feet hip-width apart\",\n        \"Lift one knee up toward chest\",\n        \"Quickly alternate legs, bringing knees as high as possible\",\n        \"Pump arms naturally as you run in place\"\n      ],\n      tips: [\"Stay on balls of feet\", \"Keep torso upright\", \"Drive knees up high\"],\n      muscles: [\"Hip Flexors\", \"Calves\", \"Core\"]\n    },\n    \"Treadmill\": {\n      steps: [\n        \"Start with 5-minute warm-up at walking pace\",\n        \"Gradually increase speed to jogging/running pace\",\n        \"Maintain good posture, look straight ahead\",\n        \"Cool down with 5-minute walk at end\"\n      ],\n      tips: [\"Don't hold handrails while running\", \"Start with flat incline\", \"Listen to your body\"],\n      muscles: [\"Legs\", \"Glutes\", \"Cardiovascular System\"]\n    },\n    \"Elliptical\": {\n      steps: [\n        \"Step onto machine and grab handles\",\n        \"Start moving legs in elliptical motion\",\n        \"Use arms to push and pull handles\",\n        \"Maintain steady rhythm throughout workout\"\n      ],\n      tips: [\"Keep feet flat on pedals\", \"Stand upright\", \"Low impact alternative to running\"],\n      muscles: [\"Legs\", \"Arms\", \"Core\", \"Cardiovascular System\"]\n    },\n    \"Rowing Machine\": {\n      steps: [\n        \"Sit on seat with feet secured in foot straps\",\n        \"Grab handle with both hands, arms extended\",\n        \"Push with legs first, then pull handle to lower ribs\",\n        \"Reverse the motion: extend arms, then bend legs\"\n      ],\n      tips: [\"Legs, core, then arms\", \"Keep back straight\", \"It's 60% legs, 40% upper body\"],\n      muscles: [\"Full Body\", \"Lats\", \"Legs\", \"Core\"]\n    },\n    \"Stair Climber\": {\n      steps: [\n        \"Step onto machine and grab handrails lightly\",\n        \"Start stepping at comfortable pace\",\n        \"Keep full foot on pedal, don't just use toes\",\n        \"Maintain upright posture throughout\"\n      ],\n      tips: [\"Don't lean heavily on rails\", \"Take full steps\", \"Great for glute activation\"],\n      muscles: [\"Glutes\", \"Quadriceps\", \"Calves\"]\n    },\n    \"Battle Ropes\": {\n      steps: [\n        \"Stand with feet shoulder-width apart, hold rope ends\",\n        \"Create waves by alternating arms up and down\",\n        \"Keep core tight and knees slightly bent\",\n        \"Work in intervals: 30 seconds on, 30 seconds rest\"\n      ],\n      tips: [\"Use whole body, not just arms\", \"Stay light on feet\", \"High intensity workout\"],\n      muscles: [\"Arms\", \"Shoulders\", \"Core\", \"Legs\"]\n    },\n    \"Box Jumps\": {\n      steps: [\n        \"Stand arm's length from sturdy box or platform\",\n        \"Swing arms back and squat down slightly\",\n        \"Jump explosively onto box, landing softly\",\n        \"Step down carefully, don't jump down\"\n      ],\n      tips: [\"Start with lower box\", \"Land softly with bent knees\", \"Focus on safe landing\"],\n      muscles: [\"Glutes\", \"Quadriceps\", \"Calves\", \"Core\"]\n    },\n    \"Sprint Intervals\": {\n      steps: [\n        \"Warm up with 5-10 minutes of light jogging\",\n        \"Sprint at near-maximum effort for 30 seconds\",\n        \"Recover with light jogging or walking for 1-2 minutes\",\n        \"Repeat sprint-recovery cycle 6-8 times\"\n      ],\n      tips: [\"Build up gradually\", \"Focus on form even when tired\", \"Cool down properly\"],\n      muscles: [\"Full Body\", \"Cardiovascular System\"]\n    },\n    \n    // Yoga & Flexibility Exercises\n    \"Yoga\": {\n      steps: [\n        \"Begin in Mountain Pose with feet hip-width apart\",\n        \"Flow through Sun Salutation sequence\",\n        \"Hold each pose for 5-8 breaths\",\n        \"End in relaxation pose (Savasana)\"\n      ],\n      tips: [\"Focus on breath awareness\", \"Don't force poses\", \"Use props if needed\"],\n      muscles: [\"Full Body\", \"Flexibility\", \"Mind-Body Connection\"]\n    },\n    \"Meditation\": {\n      steps: [\n        \"Sit comfortably with spine straight\",\n        \"Close eyes and focus on your breath\",\n        \"When mind wanders, gently return to breath\",\n        \"Start with 5-10 minutes, gradually increase\"\n      ],\n      tips: [\"Find a quiet space\", \"Be patient with wandering thoughts\", \"Consistency matters more than duration\"],\n      muscles: [\"Mind\", \"Stress Relief\", \"Mental Focus\"]\n    },\n    \"Sun Salutation\": {\n      steps: [\n        \"Mountain Pose → Forward Fold → Half Lift → Chaturanga\",\n        \"Upward Dog → Downward Dog (hold 5 breaths)\",\n        \"Forward Fold → Half Lift → Mountain Pose\",\n        \"Repeat sequence 3-5 times with breath coordination\"\n      ],\n      tips: [\"Coordinate movement with breath\", \"Modify poses as needed\", \"This is a complete flow sequence\"],\n      muscles: [\"Full Body\", \"Flexibility\", \"Core Strength\"]\n    },\n    \"Warrior Pose\": {\n      steps: [\n        \"Step left foot back 3-4 feet, turn out 45 degrees\",\n        \"Bend right knee directly over ankle\",\n        \"Raise arms overhead, square hips forward\",\n        \"Hold for 30 seconds to 1 minute, switch sides\"\n      ],\n      tips: [\"Keep front knee over ankle\", \"Ground through back foot\", \"Engage core for stability\"],\n      muscles: [\"Legs\", \"Core\", \"Shoulders\", \"Balance\"]\n    },\n    \"Downward Dog\": {\n      steps: [\n        \"Start on hands and knees, tuck toes under\",\n        \"Lift hips up and back, straightening legs\",\n        \"Create inverted V shape with body\",\n        \"Hold for 5-10 breaths, pedal feet to stretch\"\n      ],\n      tips: [\"Press hands firmly into mat\", \"Lengthen spine\", \"Bend knees if hamstrings are tight\"],\n      muscles: [\"Shoulders\", \"Arms\", \"Hamstrings\", \"Calves\"]\n    },\n    \"Child's Pose\": {\n      steps: [\n        \"Kneel on mat with big toes touching\",\n        \"Sit back on heels, open knees wide\",\n        \"Fold forward, extending arms in front\",\n        \"Rest forehead on mat, breathe deeply\"\n      ],\n      tips: [\"Use bolster under torso if needed\", \"This is a resting pose\", \"Focus on releasing tension\"],\n      muscles: [\"Hip Flexors\", \"Shoulders\", \"Back\", \"Relaxation\"]\n    },\n    \"Pigeon Pose\": {\n      steps: [\n        \"From downward dog, bring right knee to right wrist\",\n        \"Lower right shin parallel to front of mat\",\n        \"Extend left leg straight back\",\n        \"Fold forward over front leg, hold 1-2 minutes each side\"\n      ],\n      tips: [\"Use props under hip if needed\", \"This is an intense hip opener\", \"Breathe through discomfort\"],\n      muscles: [\"Hip Flexors\", \"Glutes\", \"IT Band\"]\n    },\n    \"Stretching\": {\n      steps: [\n        \"Target major muscle groups systematically\",\n        \"Hold each stretch for 20-30 seconds\",\n        \"Breathe deeply and relax into the stretch\",\n        \"Don't bounce or force the stretch\"\n      ],\n      tips: [\"Stretch after workouts when muscles are warm\", \"Focus on tight areas\", \"Stretch both sides equally\"],\n      muscles: [\"Full Body\", \"Flexibility\", \"Recovery\"]\n    },\n    \n    // Swimming Exercises\n    \"Swimming\": {\n      steps: [\n        \"Enter water and do 5-10 minutes easy warm-up\",\n        \"Alternate between different strokes\",\n        \"Focus on technique over speed\",\n        \"Cool down with easy swimming or walking\"\n      ],\n      tips: [\"Start with shorter distances\", \"Focus on breathing technique\", \"Great low-impact exercise\"],\n      muscles: [\"Full Body\", \"Cardiovascular System\", \"Core\"]\n    },\n    \"Freestyle\": {\n      steps: [\n        \"Float face-down, extend one arm forward while other pulls\",\n        \"Rotate body slightly with each stroke\",\n        \"Breathe by turning head to side every 2-3 strokes\",\n        \"Kick steadily with straight legs from hips\"\n      ],\n      tips: [\"High elbow catch\", \"Rotate from core, not shoulders\", \"Practice bilateral breathing\"],\n      muscles: [\"Shoulders\", \"Lats\", \"Core\", \"Legs\"]\n    },\n    \"Backstroke\": {\n      steps: [\n        \"Float on back with arms at sides\",\n        \"Alternate arm strokes in windmill motion\",\n        \"Keep hips up and head still\",\n        \"Flutter kick with straight legs\"\n      ],\n      tips: [\"Keep ears underwater\", \"Don't let hips sink\", \"Imagine lying on a pillow\"],\n      muscles: [\"Shoulders\", \"Lats\", \"Core\", \"Hip Flexors\"]\n    },\n    \"Breaststroke\": {\n      steps: [\n        \"Start face-down, arms extended forward\",\n        \"Pull arms out and back in heart shape\",\n        \"Lift head to breathe as arms finish pull\",\n        \"Bring knees to chest, kick legs out and together\"\n      ],\n      tips: [\"Coordinate arm pull with breathing\", \"Kick with feet flexed\", \"Glide between strokes\"],\n      muscles: [\"Chest\", \"Arms\", \"Inner Thighs\", \"Glutes\"]\n    },\n    \"Butterfly\": {\n      steps: [\n        \"Start face-down with arms extended forward\",\n        \"Pull both arms simultaneously in circular motion\",\n        \"Use dolphin kick with both legs together\",\n        \"Breathe forward when arms exit water\"\n      ],\n      tips: [\"This is the most challenging stroke\", \"Focus on rhythm\", \"Use core for dolphin kick\"],\n      muscles: [\"Shoulders\", \"Core\", \"Chest\", \"Legs\"]\n    },\n    \"Water Aerobics\": {\n      steps: [\n        \"Stand in chest-deep water for resistance\",\n        \"Perform exercises like jumping jacks, leg lifts\",\n        \"Use water resistance for strength movements\",\n        \"Move continuously for 20-45 minutes\"\n      ],\n      tips: [\"Water provides natural resistance\", \"Great for joint-friendly exercise\", \"Stay hydrated even in water\"],\n      muscles: [\"Full Body\", \"Low Impact\", \"Cardiovascular System\"]\n    },\n    \"Treading Water\": {\n      steps: [\n        \"Stay vertical in deep water\",\n        \"Use eggbeater kick to maintain position\",\n        \"Keep arms moving in sculling motion\",\n        \"Start with 30-second intervals\"\n      ],\n      tips: [\"Relax and stay calm\", \"Use small, efficient movements\", \"Great core and leg workout\"],\n      muscles: [\"Core\", \"Legs\", \"Arms\", \"Endurance\"]\n    },\n    // Dumbbell Specific Instructions\n    \"Dumbbell Press\": {\n      steps: [\n        \"Lie on bench holding dumbbells at chest level\",\n        \"Position dumbbells with palms facing forward\",\n        \"Press weights straight up until arms are fully extended\",\n        \"Lower dumbbells slowly to starting position with control\"\n      ],\n      tips: [\"Keep wrists straight and stable\", \"Don't let dumbbells drift inward\", \"Use full range of motion\"],\n      muscles: [\"Chest\", \"Front Deltoids\", \"Triceps\"]\n    },\n    \"Dumbbell Rows\": {\n      steps: [\n        \"Place one knee and hand on bench for support\",\n        \"Hold dumbbell in opposite hand with arm hanging straight\",\n        \"Pull dumbbell up to your ribcage by squeezing shoulder blade\",\n        \"Lower weight slowly while maintaining back position\"\n      ],\n      tips: [\"Keep back flat and parallel to floor\", \"Pull with your back, not your arm\", \"Don't rotate your torso\"],\n      muscles: [\"Lats\", \"Rhomboids\", \"Middle Traps\", \"Rear Deltoids\"]\n    },\n    \"Dumbbell Flyes\": {\n      steps: [\n        \"Lie on bench with dumbbells held above chest\",\n        \"Lower weights in wide arc with slight bend in elbows\",\n        \"Feel stretch in chest at bottom position\",\n        \"Bring dumbbells back together in same arc motion\"\n      ],\n      tips: [\"Keep slight bend in elbows throughout\", \"Focus on chest squeeze at top\", \"Control the weight on the way down\"],\n      muscles: [\"Chest\", \"Front Deltoids\"]\n    },\n    \"Dumbbell Squats\": {\n      steps: [\n        \"Hold dumbbells at shoulder height or at your sides\",\n        \"Stand with feet shoulder-width apart\",\n        \"Squat down by pushing hips back and bending knees\",\n        \"Drive through heels to return to standing position\"\n      ],\n      tips: [\"Keep chest up and core engaged\", \"Don't let knees cave inward\", \"Go as deep as mobility allows\"],\n      muscles: [\"Quadriceps\", \"Glutes\", \"Hamstrings\", \"Core\"]\n    },\n    \"Dumbbell Lunges\": {\n      steps: [\n        \"Hold dumbbells at your sides or shoulders\",\n        \"Step forward into a lunge position\",\n        \"Lower back knee toward ground while keeping front knee over ankle\",\n        \"Push off front foot to return to starting position\"\n      ],\n      tips: [\"Keep torso upright\", \"Don't let front knee go past toes\", \"Alternate legs or complete all reps on one side\"],\n      muscles: [\"Quadriceps\", \"Glutes\", \"Hamstrings\", \"Calves\"]\n    },\n    \"Dumbbell Shoulder Press\": {\n      steps: [\n        \"Sit or stand with dumbbells at shoulder level\",\n        \"Position palms facing forward with elbows at 90 degrees\",\n        \"Press weights straight overhead until arms are fully extended\",\n        \"Lower dumbbells back to shoulder level with control\"\n      ],\n      tips: [\"Keep core tight to avoid arching back\", \"Don't press weights behind your head\", \"Maintain neutral wrist position\"],\n      muscles: [\"Deltoids\", \"Triceps\", \"Upper Traps\"]\n    },\n    \"Dumbbell Lateral Raises\": {\n      steps: [\n        \"Stand with dumbbells at your sides, palms facing body\",\n        \"Raise weights out to sides until arms are parallel to floor\",\n        \"Keep slight bend in elbows throughout movement\",\n        \"Lower weights slowly back to starting position\"\n      ],\n      tips: [\"Don't raise weights above shoulder height\", \"Lead with your pinkies\", \"Use lighter weight and focus on form\"],\n      muscles: [\"Middle Deltoids\", \"Supraspinatus\"]\n    },\n    \"Dumbbell Front Raises\": {\n      steps: [\n        \"Stand with dumbbells in front of thighs, palms facing back\",\n        \"Raise one or both dumbbells forward to shoulder height\",\n        \"Keep arms straight with slight bend in elbows\",\n        \"Lower weights slowly back to starting position\"\n      ],\n      tips: [\"Don't swing or use momentum\", \"Keep shoulders down and back\", \"Alternate arms for better control\"],\n      muscles: [\"Front Deltoids\", \"Upper Chest\"]\n    },\n    \"Dumbbell Shrugs\": {\n      steps: [\n        \"Stand with dumbbells at your sides, arms hanging straight\",\n        \"Shrug shoulders straight up toward your ears\",\n        \"Hold briefly at the top position\",\n        \"Lower shoulders back down slowly\"\n      ],\n      tips: [\"Don't roll shoulders forward or backward\", \"Use heavy weight with slow, controlled movement\", \"Keep arms straight throughout\"],\n      muscles: [\"Upper Traps\", \"Levator Scapulae\"]\n    },\n    \"Dumbbell Deadlifts\": {\n      steps: [\n        \"Stand with feet hip-width apart, dumbbells in front of thighs\",\n        \"Hinge at hips and push glutes back while lowering weights\",\n        \"Keep dumbbells close to legs as you lower them\",\n        \"Drive hips forward to return to standing position\"\n      ],\n      tips: [\"Keep back straight and chest up\", \"Feel stretch in hamstrings at bottom\", \"Lead with your hips, not your knees\"],\n      muscles: [\"Hamstrings\", \"Glutes\", \"Lower Back\", \"Core\"]\n    },\n    \"Dumbbell Step-ups\": {\n      steps: [\n        \"Stand facing a bench or box with dumbbells at your sides\",\n        \"Step up onto platform with one foot, placing entire foot on surface\",\n        \"Push through heel to lift your body up onto the platform\",\n        \"Step down with control and repeat on same leg or alternate\"\n      ],\n      tips: [\"Use a platform that puts your knee at 90 degrees\", \"Don't push off back foot\", \"Keep torso upright throughout\"],\n      muscles: [\"Quadriceps\", \"Glutes\", \"Hamstrings\", \"Calves\"]\n    },\n    \"Dumbbell Tricep Extensions\": {\n      steps: [\n        \"Hold one dumbbell with both hands overhead\",\n        \"Lower weight behind head by bending only at elbows\",\n        \"Keep upper arms stationary and elbows pointing forward\",\n        \"Extend arms back to starting position\"\n      ],\n      tips: [\"Keep elbows close together\", \"Don't let elbows flare out\", \"Use lighter weight to maintain form\"],\n      muscles: [\"Triceps\"]\n    },\n    \"Dumbbell Hammer Curls\": {\n      steps: [\n        \"Stand with dumbbells at sides, palms facing each other\",\n        \"Curl weights up while keeping palms facing each other\",\n        \"Squeeze biceps at the top of the movement\",\n        \"Lower weights slowly back to starting position\"\n      ],\n      tips: [\"Keep elbows stationary at your sides\", \"Don't swing or use momentum\", \"Neutral grip targets different muscle fibers\"],\n      muscles: [\"Biceps\", \"Brachialis\", \"Forearms\"]\n    },\n    \"Dumbbell Thrusters\": {\n      steps: [\n        \"Hold dumbbells at shoulder level in squat position\",\n        \"Squat down by pushing hips back and bending knees\",\n        \"Drive up explosively through heels while pressing weights overhead\",\n        \"Lower weights back to shoulders and repeat\"\n      ],\n      tips: [\"Use momentum from legs to help press\", \"Keep core tight throughout\", \"This is a compound power movement\"],\n      muscles: [\"Full Body\", \"Shoulders\", \"Legs\", \"Core\"]\n    },\n    \"Dumbbell Russian Twists\": {\n      steps: [\n        \"Sit on floor holding one dumbbell with both hands\",\n        \"Lean back slightly and lift feet off ground\",\n        \"Rotate torso to one side, touching weight to floor\",\n        \"Rotate to opposite side and repeat\"\n      ],\n      tips: [\"Keep feet elevated throughout\", \"Move with control, not speed\", \"Look forward, not at the weight\"],\n      muscles: [\"Obliques\", \"Core\", \"Hip Flexors\"]\n    },\n    \"Dumbbell Walking Lunges\": {\n      steps: [\n        \"Hold dumbbells at your sides or shoulders\",\n        \"Step forward into lunge position\",\n        \"Instead of returning to start, step forward with back leg\",\n        \"Continue alternating legs while moving forward\"\n      ],\n      tips: [\"Take larger steps for better glute activation\", \"Keep torso upright throughout\", \"Ensure adequate space to walk\"],\n      muscles: [\"Quadriceps\", \"Glutes\", \"Hamstrings\", \"Core\"]\n    },\n    \"Dumbbell Goblet Squats\": {\n      steps: [\n        \"Hold one dumbbell vertically against your chest\",\n        \"Stand with feet slightly wider than shoulder-width\",\n        \"Squat down while keeping dumbbell close to body\",\n        \"Drive through heels to return to standing\"\n      ],\n      tips: [\"Elbows should point down toward floor\", \"This position helps maintain upright torso\", \"Great for learning squat form\"],\n      muscles: [\"Quadriceps\", \"Glutes\", \"Core\"]\n    },\n    \"Dumbbell Bulgarian Split Squats\": {\n      steps: [\n        \"Hold dumbbells at sides with rear foot elevated on bench\",\n        \"Lower into lunge position by bending front knee\",\n        \"Keep most weight on front foot\",\n        \"Push through front heel to return to starting position\"\n      ],\n      tips: [\"Don't put too much weight on back foot\", \"Keep torso upright\", \"This targets one leg at a time\"],\n      muscles: [\"Quadriceps\", \"Glutes\", \"Hamstrings\"]\n    }\n  };\n\n  const getExerciseInstructions = (exerciseName: string) => {\n    return exerciseInstructions[exerciseName] || {\n      steps: [\n        \"Position yourself in the starting stance\",\n        \"Perform the movement with controlled form\",\n        \"Focus on proper breathing throughout\",\n        \"Return to starting position with control\"\n      ],\n      tips: [\"Start with lighter weight\", \"Focus on form over speed\", \"Listen to your body\"],\n      muscles: [\"Target muscle groups\", \"Stabilizing muscles\"]\n    };\n  };\n\n  const handleExerciseClick = (exercise: any) => {\n    setSelectedExercise(exercise);\n  };\n\n\n  const handleStartWorkout = (exerciseName: string) => {\n    setShowWorkoutForm(true);\n  };\n\n  const handleSubmitWorkout = () => {\n    const estimatedCalories = selectedExercise ? \n      calculateExerciseCalories(selectedExercise, exerciseSets, exerciseReps, exerciseWeight, exerciseDuration, difficultyLevel[0]) :\n      Math.round(workoutDuration[0] * (2 + difficultyLevel[0] * 0.8));\n    \n    createWorkoutMutation.mutate({\n      name: selectedExercise.name,\n      category: selectedCategory,\n      duration: workoutDuration[0],\n      caloriesBurned: estimatedCalories,\n      difficultyLevel: difficultyLevel[0],\n      perceivedExertion: perceivedExertion[0],\n      completionRate: 100, // Default to 100% for completed workouts\n      // Include exercise details for workout exercise creation\n      exerciseData: {\n        exerciseId: selectedExercise.id,\n        sets: exerciseSets,\n        reps: exerciseReps,\n        weight: exerciseWeight || null,\n        duration: exerciseDuration > 0 ? exerciseDuration * 60 : null, // Convert minutes to seconds\n        notes: exerciseNotes || null,\n      }\n    });\n    \n    setSelectedExercise(null);\n    setShowWorkoutForm(false);\n    // Reset form values\n    setDifficultyLevel([3]);\n    setPerceivedExertion([5]);\n    setWorkoutDuration([30]);\n    // Reset exercise-specific values\n    setExerciseSets(3);\n    setExerciseReps(10);\n    setExerciseWeight(0);\n    setExerciseDuration(0);\n    setExerciseNotes(\"\");\n  };\n\n  const getDifficultyLabel = (level: number) => {\n    const labels = [\"\", \"Very Easy\", \"Easy\", \"Moderate\", \"Hard\", \"Very Hard\"];\n    return labels[level] || \"Moderate\";\n  };\n\n  const getExertionLabel = (level: number) => {\n    if (level <= 2) return \"Very Light\";\n    if (level <= 4) return \"Light\";\n    if (level <= 6) return \"Moderate\";\n    if (level <= 8) return \"Hard\";\n    return \"Maximum Effort\";\n  };\n\n  // Exercise animation definitions\n  const getExerciseAnimation = (exerciseName: string) => {\n    const animations: Record<string, { movement: string, description: string, keypoints: string[] }> = {\n      // Dumbbell Exercises\n      \"Dumbbell Press\": {\n        movement: \"press-animation\",\n        description: \"Chest press with controlled movement\",\n        keypoints: [\"Keep feet flat on ground\", \"Lower weights to chest level\", \"Press up with control\", \"Maintain neutral wrist position\"]\n      },\n      \"Dumbbell Curls\": {\n        movement: \"curl-animation\", \n        description: \"Bicep curl with steady tempo\",\n        keypoints: [\"Keep elbows at sides\", \"Curl weights up smoothly\", \"Squeeze at the top\", \"Lower with control\"]\n      },\n      \"Dumbbell Shoulder Press\": {\n        movement: \"shoulder-press-animation\",\n        description: \"Overhead press movement\",\n        keypoints: [\"Start at shoulder level\", \"Press straight up\", \"Don't arch back\", \"Lower with control\"]\n      },\n      \"Dumbbell Rows\": {\n        movement: \"row-animation\",\n        description: \"Rowing motion for back muscles\",\n        keypoints: [\"Hinge at hips\", \"Pull weights to ribs\", \"Squeeze shoulder blades\", \"Lower with control\"]\n      },\n      \"Dumbbell Squats\": {\n        movement: \"squat-animation\",\n        description: \"Squat holding dumbbells\",\n        keypoints: [\"Feet shoulder-width apart\", \"Lower hips back and down\", \"Keep chest up\", \"Drive through heels\"]\n      },\n      \"Dumbbell Lunges\": {\n        movement: \"lunge-animation\",\n        description: \"Alternating lunge movement\",\n        keypoints: [\"Step forward into lunge\", \"Lower back knee down\", \"Push back to start\", \"Alternate legs\"]\n      },\n      \n      // Strength Exercises\n      \"Push-ups\": {\n        movement: \"pushup-animation\",\n        description: \"Upper body bodyweight exercise\",\n        keypoints: [\"Keep body straight\", \"Lower chest to ground\", \"Push up with control\", \"Engage core throughout\"]\n      },\n      \"Squats\": {\n        movement: \"squat-animation\",\n        description: \"Lower body compound movement\",\n        keypoints: [\"Feet shoulder-width apart\", \"Lower hips back and down\", \"Keep chest up\", \"Drive through heels\"]\n      },\n      \"Pull-ups\": {\n        movement: \"pullup-animation\",\n        description: \"Upper body pulling exercise\",\n        keypoints: [\"Hang with straight arms\", \"Pull chin over bar\", \"Lower with control\", \"Engage lats and biceps\"]\n      },\n      \"Plank\": {\n        movement: \"plank-animation\",\n        description: \"Core stability exercise\",\n        keypoints: [\"Keep body straight\", \"Engage core muscles\", \"Hold steady position\", \"Breathe normally\"]\n      },\n      \"Deadlifts\": {\n        movement: \"deadlift-animation\",\n        description: \"Full body compound lift\",\n        keypoints: [\"Keep back straight\", \"Lift with legs\", \"Stand tall at top\", \"Lower with control\"]\n      },\n      \n      // Cardio Exercises\n      \"Running\": {\n        movement: \"running-animation\",\n        description: \"Cardiovascular endurance exercise\",\n        keypoints: [\"Land on midfoot\", \"Keep arms relaxed\", \"Maintain steady rhythm\", \"Breathe rhythmically\"]\n      },\n      \"Burpees\": {\n        movement: \"burpee-animation\",\n        description: \"Full body cardio movement\",\n        keypoints: [\"Drop to pushup position\", \"Jump feet back in\", \"Stand and jump up\", \"Move with control\"]\n      },\n      \"Jumping Jacks\": {\n        movement: \"jumping-jacks-animation\",\n        description: \"Quick cardio burst\",\n        keypoints: [\"Jump feet apart\", \"Raise arms overhead\", \"Jump feet together\", \"Keep light on feet\"]\n      },\n      \"Mountain Climbers\": {\n        movement: \"mountain-climbers-animation\",\n        description: \"Core cardio exercise\",\n        keypoints: [\"Start in plank position\", \"Alternate knee drives\", \"Keep hips level\", \"Maintain fast pace\"]\n      },\n      \n      // Yoga Exercises\n      \"Yoga\": {\n        movement: \"yoga-flow-animation\",\n        description: \"Flexibility and mindfulness practice\",\n        keypoints: [\"Move with breath\", \"Hold poses steadily\", \"Focus on alignment\", \"Stay present and calm\"]\n      },\n      \"Sun Salutation\": {\n        movement: \"yoga-flow-animation\",\n        description: \"Classic yoga flow sequence\",\n        keypoints: [\"Coordinate with breath\", \"Flow between poses\", \"Keep movements smooth\", \"Stay centered\"]\n      },\n      \"Warrior Pose\": {\n        movement: \"warrior-pose-animation\",\n        description: \"Strength and balance pose\",\n        keypoints: [\"Ground through feet\", \"Extend through arms\", \"Keep front thigh parallel\", \"Breathe deeply\"]\n      },\n      \"Downward Dog\": {\n        movement: \"downward-dog-animation\",\n        description: \"Full body stretch pose\",\n        keypoints: [\"Press hands down\", \"Lift hips up\", \"Straighten legs\", \"Create inverted V shape\"]\n      },\n      \n      // Swimming Exercises\n      \"Swimming\": {\n        movement: \"swimming-animation\",\n        description: \"Full body cardio exercise\",\n        keypoints: [\"Streamline body position\", \"Coordinate breathing\", \"Maintain steady rhythm\", \"Use whole body\"]\n      },\n      \"Freestyle\": {\n        movement: \"swimming-animation\",\n        description: \"Front crawl swimming stroke\",\n        keypoints: [\"Rotate body side to side\", \"High elbow catch\", \"Breathe to one side\", \"Kick from hips\"]\n      },\n      \"Backstroke\": {\n        movement: \"swimming-animation\",\n        description: \"Back swimming stroke\",\n        keypoints: [\"Keep body flat\", \"Rotate shoulders\", \"Breathe freely\", \"Keep head still\"]\n      },\n      \"Breaststroke\": {\n        movement: \"swimming-animation\",\n        description: \"Chest stroke technique\",\n        keypoints: [\"Pull, breathe, kick, glide\", \"Keep head in line\", \"Symmetric movements\", \"Time the rhythm\"]\n      }\n    };\n    \n    return animations[exerciseName] || {\n      movement: \"generic-animation\",\n      description: \"Controlled movement pattern\",\n      keypoints: [\"Maintain proper form\", \"Control the movement\", \"Breathe steadily\", \"Focus on target muscles\"]\n    };\n  };\n\n  return (\n    <section id=\"workout-logger\" className=\"relative bg-gradient-to-br from-black via-red-900/30 to-black rounded-3xl shadow-2xl border border-red-600/50 p-8 overflow-hidden hexagon-bg hexagon-pattern\">\n      {/* Animated red and black background elements */}\n      <div className=\"absolute inset-0\">\n        {/* Floating red hexagons */}\n        <div className=\"absolute top-0 left-0 w-32 h-28 opacity-30 animate-pulse\" style={{animationDuration: '4s'}}>\n          <svg viewBox=\"0 0 120 104\" className=\"w-full h-full\">\n            <polygon points=\"30,2 90,2 120,52 90,102 30,102 0,52\" fill=\"#dc2626\" stroke=\"#dc2626\" strokeWidth=\"2\" opacity=\"0.6\"/>\n          </svg>\n        </div>\n        <div className=\"absolute top-1/4 right-0 w-24 h-21 opacity-20 animate-bounce\" style={{animationDuration: '6s'}}>\n          <svg viewBox=\"0 0 120 104\" className=\"w-full h-full\">\n            <polygon points=\"30,2 90,2 120,52 90,102 30,102 0,52\" fill=\"none\" stroke=\"#dc2626\" strokeWidth=\"2\" opacity=\"0.8\"/>\n          </svg>\n        </div>\n        <div className=\"absolute bottom-0 left-1/3 w-28 h-24 opacity-25 animate-ping\" style={{animationDuration: '8s', animationDelay: '1s'}}>\n          <svg viewBox=\"0 0 120 104\" className=\"w-full h-full\">\n            <polygon points=\"30,2 90,2 120,52 90,102 30,102 0,52\" fill=\"#000000\" stroke=\"#dc2626\" strokeWidth=\"1\" opacity=\"0.7\"/>\n          </svg>\n        </div>\n        <div className=\"absolute bottom-1/4 right-1/4 w-20 h-17 opacity-15 animate-pulse\" style={{animationDuration: '5s', animationDelay: '2s'}}>\n          <svg viewBox=\"0 0 120 104\" className=\"w-full h-full\">\n            <polygon points=\"30,2 90,2 120,52 90,102 30,102 0,52\" fill=\"#dc2626\" stroke=\"#000000\" strokeWidth=\"1\" opacity=\"0.5\"/>\n          </svg>\n        </div>\n        <div className=\"absolute top-1/2 left-10 w-22 h-19 opacity-20 animate-bounce\" style={{animationDuration: '7s', animationDelay: '0.5s'}}>\n          <svg viewBox=\"0 0 120 104\" className=\"w-full h-full\">\n            <polygon points=\"30,2 90,2 120,52 90,102 30,102 0,52\" fill=\"none\" stroke=\"#dc2626\" strokeWidth=\"2\" opacity=\"0.4\"/>\n          </svg>\n        </div>\n        \n        {/* Animated red gradient orbs */}\n        <div className=\"absolute top-1/3 right-1/3 w-40 h-40 bg-gradient-to-br from-red-600/20 to-black/40 rounded-full blur-3xl opacity-30 animate-pulse\" style={{animationDuration: '6s'}}></div>\n        <div className=\"absolute bottom-1/3 left-1/4 w-32 h-32 bg-gradient-to-br from-black/60 to-red-600/20 rounded-full blur-2xl opacity-20 animate-ping\" style={{animationDuration: '10s'}}></div>\n        \n        {/* Dynamic radial gradient overlay */}\n        <div className=\"absolute inset-0 bg-gradient-radial from-transparent via-red-900/10 to-black/60 animate-pulse\" style={{animationDuration: '8s'}}></div>\n      </div>\n      {/* Content wrapper */}\n      <div className=\"relative z-10\">\n      {/* Header with background image */}\n      <div className=\"relative mb-6 rounded-2xl overflow-hidden\">\n        {/* Background image with overlay */}\n        <div className=\"absolute inset-0\">\n          <img \n            src={workoutBgImage} \n            alt=\"Workout background\" \n            className=\"w-full h-full object-cover opacity-30\"\n          />\n          <div className=\"absolute inset-0 bg-gradient-to-r from-black via-black/80 to-transparent\"></div>\n        </div>\n        \n        {/* Header content */}\n        <div className=\"relative flex items-center justify-between p-6\">\n          <div>\n            <h3 className=\"text-3xl font-bold bg-gradient-to-r from-red-400 to-red-600 bg-clip-text text-transparent drop-shadow-lg\">Log Workout</h3>\n            <p className=\"text-gray-300 text-sm mt-1\">Track your exercises, sets, reps, and weight</p>\n          </div>\n          <button \n            className=\"p-2 bg-red-600/20 hover:bg-red-600/30 text-red-400 hover:text-red-300 rounded-lg transition-all border border-red-500/30\"\n            onClick={() => setLocation('/workouts')}\n            data-testid=\"expand-workouts-button\"\n            title=\"View all workouts\"\n          >\n            <Expand />\n          </button>\n        </div>\n      </div>\n\n      {/* Exercise Search */}\n      <div className=\"mb-6\">\n        <div className=\"relative\">\n          <Search className=\"absolute left-3 top-1/2 transform -translate-y-1/2 text-red-400\" size={16} />\n          <Input\n            type=\"text\"\n            placeholder=\"Search exercises (e.g., push-ups, running, yoga)\"\n            className=\"pl-10 pr-12 bg-black/50 border-red-500/30 text-white placeholder:text-gray-400 focus:border-red-500 focus:ring-red-500/50\"\n            value={searchQuery}\n            onChange={(e) => setSearchQuery(e.target.value)}\n            data-testid=\"input-search-exercises\"\n          />\n          <div className=\"absolute right-1 top-1/2 transform -translate-y-1/2\">\n            <VoiceSearchButton\n              onTranscript={(text) => setSearchQuery(text)}\n              className=\"h-8 w-8\"\n            />\n          </div>\n        </div>\n      </div>\n\n      {/* Workout Categories */}\n      <div className=\"mb-6\">\n        <p className=\"text-sm font-medium text-red-400 mb-3\">Popular Categories</p>\n        <div className=\"flex flex-wrap gap-3\">\n          {categories.map((category) => (\n            <Button\n              key={category.id}\n              variant={selectedCategory === category.id ? \"default\" : \"outline\"}\n              size=\"sm\"\n              onClick={() => setSelectedCategory(category.id)}\n              className={selectedCategory === category.id \n                ? \"bg-gradient-to-r from-red-600 to-red-700 text-white border-0 shadow-lg shadow-red-500/50\" \n                : \"border-red-500/30 text-gray-300 hover:bg-red-600/20 hover:text-red-400 hover:border-red-500/50\"}\n            >\n              <category.icon className=\"mr-2\" size={16} />\n              {category.name}\n            </Button>\n          ))}\n        </div>\n      </div>\n\n\n      {/* Exercise Results */}\n      {(searchQuery || filteredExercises.length > 6) ? (\n        <div className=\"mb-4 flex items-center justify-between\">\n          <p className=\"text-sm font-medium text-gray-300\">\n            {searchQuery ? \n              (filteredExercises.length > 0 ? `Found ${filteredExercises.length} exercise${filteredExercises.length === 1 ? '' : 's'}` : 'No exercises found') :\n              `Showing ${Math.min(filteredExercises.length, showAllExercises ? filteredExercises.length : 6)} of ${filteredExercises.length} exercises`\n            }\n          </p>\n          {!searchQuery && filteredExercises.length > 6 && (\n            <button\n              onClick={() => setShowAllExercises(!showAllExercises)}\n              className=\"text-red-400 hover:text-red-300 text-sm font-medium transition-colors\"\n              data-testid=\"view-all-exercises-button\"\n            >\n              {showAllExercises ? 'Show Less' : 'View All'}\n            </button>\n          )}\n        </div>\n      ) : null}\n      \n      <div className=\"grid grid-cols-2 md:grid-cols-3 gap-3\">\n        {filteredExercises.length > 0 ? \n          (searchQuery || showAllExercises ? filteredExercises : filteredExercises.slice(0, 6))\n          .map((exercise) => {\n          const IconComponent = exercise.icon;\n          return (\n            <div\n              key={exercise.name}\n              className={`bg-gradient-to-br from-gray-900 to-black border border-red-500/30 rounded-xl p-4 hover:border-red-500/60 hover:shadow-lg hover:shadow-red-500/20 transition-all group ${createWorkoutMutation.isPending ? 'opacity-50 pointer-events-none' : 'cursor-pointer'}`}\n              data-testid={`exercise-${exercise.name.toLowerCase().replace(/\\s+/g, '-')}`}\n            >\n              <div className=\"flex items-center space-x-3 mb-2\">\n                <IconComponent className=\"text-red-500 text-lg group-hover:scale-110 transition-transform\" />\n                <span className=\"font-medium text-white\">{exercise.name}</span>\n              </div>\n              <p className=\"text-xs text-gray-400\">{exercise.description}</p>\n              \n              {/* Always Show Exercise Demo for strength and dumbbell exercises */}\n              {[\"strength\", \"dumbbells\"].includes(exercise.category) && (\n                <div className=\"mt-3 pt-3 border-t border-red-500/30\" id={`demo-content-${exercise.name.toLowerCase().replace(/\\s+/g, '-')}`}>\n                  <div className=\"bg-black/50 rounded-lg p-2\">\n                    <img \n                      src={getDemoImage(exercise.name)}\n                      alt={`${exercise.name} demonstration`}\n                      className=\"w-auto max-w-full h-auto max-h-32 object-contain rounded-md mx-auto\"\n                      data-testid={`demo-image-${exercise.name.toLowerCase().replace(/\\s+/g, '-')}`}\n                    />\n                  </div>\n                </div>\n              )}\n              \n              <div className=\"flex items-center justify-center mt-2 text-xs text-gray-400\">\n                <button\n                  onClick={() => handleExerciseClick(exercise)}\n                  disabled={createWorkoutMutation.isPending}\n                  className=\"flex items-center hover:text-red-400 transition-colors\"\n                  data-testid={`instructions-${exercise.name.toLowerCase().replace(/\\s+/g, '-')}`}\n                >\n                  <Play className=\"w-3 h-3 mr-1\" />\n                  <span>Start Workout</span>\n                </button>\n              </div>\n            </div>\n          );\n        }) : (\n          <div className=\"col-span-full text-center py-8\">\n            <Search className=\"mx-auto h-12 w-12 text-red-500/50 mb-4\" />\n            <p className=\"text-lg font-medium text-gray-400 mb-2\">\n              {searchQuery ? 'No exercises found' : 'Try searching for an exercise'}\n            </p>\n            <p className=\"text-sm text-gray-500\">\n              {searchQuery ? `No exercises match \"${searchQuery}\"` : 'Search for exercises like \"push-ups\", \"running\", or \"yoga\"'}\n            </p>\n          </div>\n        )}\n      </div>\n\n      {createWorkoutMutation.isPending && (\n        <p className=\"text-center text-muted mt-4\">Creating workout...</p>\n      )}\n\n      {/* Exercise Instructions Modal */}\n      {selectedExercise && (\n        <div className=\"fixed inset-0 bg-black/80 flex items-center justify-center p-4 z-50\" onClick={() => setSelectedExercise(null)}>\n          <div className=\"bg-gradient-to-br from-gray-900 to-black border-2 border-red-500/50 rounded-2xl max-w-md w-full max-h-[70vh] overflow-y-auto shadow-2xl shadow-red-500/20\" onClick={(e) => e.stopPropagation()}>\n            <div className=\"p-6\">\n              {/* Header */}\n              <div className=\"flex items-center justify-between mb-6\">\n                <div className=\"flex items-center space-x-3\">\n                  <selectedExercise.icon className=\"text-red-500 text-2xl\" />\n                  <div>\n                    <h2 className=\"text-2xl font-bold text-white\">{selectedExercise.name}</h2>\n                    <p className=\"text-gray-400 capitalize\">{selectedExercise.category} • {selectedExercise.description}</p>\n                  </div>\n                </div>\n                <button\n                  onClick={() => setSelectedExercise(null)}\n                  className=\"text-gray-400 hover:text-red-400 transition-colors\"\n                  data-testid=\"close-exercise-modal\"\n                >\n                  <X className=\"w-6 h-6\" />\n                </button>\n              </div>\n\n              {/* Exercise Instructions */}\n              <div className=\"space-y-6\">\n                {/* Target Muscles */}\n                <div>\n                  <h3 className=\"text-lg font-semibold text-red-400 mb-3\">Target Muscles</h3>\n                  <div className=\"flex flex-wrap gap-2\">\n                    {getExerciseInstructions(selectedExercise.name).muscles.map((muscle, index) => (\n                      <span key={index} className=\"bg-red-600/20 text-red-400 border border-red-500/30 px-3 py-1 rounded-full text-sm font-medium\">\n                        {muscle}\n                      </span>\n                    ))}\n                  </div>\n                </div>\n\n                {/* Step-by-Step Instructions */}\n                <div>\n                  <h3 className=\"text-lg font-semibold text-red-400 mb-3\">How to Perform</h3>\n                  <ol className=\"space-y-3\">\n                    {getExerciseInstructions(selectedExercise.name).steps.map((step, index) => (\n                      <li key={index} className=\"flex items-start space-x-3\">\n                        <span className=\"bg-gradient-to-r from-red-600 to-red-700 text-white rounded-full w-6 h-6 flex items-center justify-center text-sm font-medium flex-shrink-0 mt-0.5\">\n                          {index + 1}\n                        </span>\n                        <p className=\"text-gray-300\">{step}</p>\n                      </li>\n                    ))}\n                  </ol>\n                </div>\n\n                {/* Tips */}\n                <div>\n                  <h3 className=\"text-lg font-semibold text-red-400 mb-3\">Pro Tips</h3>\n                  <ul className=\"space-y-2\">\n                    {getExerciseInstructions(selectedExercise.name).tips.map((tip, index) => (\n                      <li key={index} className=\"flex items-start space-x-2\">\n                        <span className=\"text-red-500 mt-1\">💡</span>\n                        <p className=\"text-gray-300\">{tip}</p>\n                      </li>\n                    ))}\n                  </ul>\n                </div>\n              </div>\n\n              {/* Action Buttons */}\n              <div className=\"flex space-x-3 mt-8\">\n                <Button\n                  onClick={() => handleStartWorkout(selectedExercise.name)}\n                  disabled={createWorkoutMutation.isPending}\n                  className=\"flex-1 bg-gradient-to-r from-red-600 to-red-700 hover:from-red-700 hover:to-red-800 text-white border-0 shadow-lg shadow-red-500/50\"\n                  data-testid=\"start-workout-button\"\n                >\n                  {createWorkoutMutation.isPending ? 'Starting...' : 'Start Workout'}\n                </Button>\n                <Button\n                  variant=\"outline\"\n                  onClick={() => setSelectedExercise(null)}\n                  className=\"px-6 border-red-500/30 text-gray-300 hover:bg-red-600/20 hover:text-red-400 hover:border-red-500/50\"\n                  data-testid=\"close-modal-button\"\n                >\n                  Close\n                </Button>\n              </div>\n            </div>\n          </div>\n        </div>\n      )}\n\n      {/* AI-Powered Workout Form with Difficulty Tracking */}\n      {showWorkoutForm && selectedExercise && (\n        <div className=\"fixed inset-0 bg-black/80 flex items-center justify-center p-4 z-50\">\n          <div className=\"bg-gradient-to-br from-gray-900 to-black border-2 border-red-500/50 rounded-3xl max-w-2xl w-full max-h-[90vh] overflow-y-auto shadow-2xl shadow-red-500/20\">\n            <div className=\"p-8\">\n              {/* Header */}\n              <div className=\"flex justify-between items-center mb-6\">\n                <div>\n                  <h2 className=\"text-2xl font-bold text-white\">Log Your Workout</h2>\n                  <p className=\"text-gray-400 mt-1\">{selectedExercise.name}</p>\n                </div>\n                <button\n                  onClick={() => {\n                    setShowWorkoutForm(false);\n                    setSelectedExercise(null);\n                  }}\n                  className=\"text-gray-400 hover:text-red-400 transition-colors\"\n                  data-testid=\"close-workout-form\"\n                >\n                  <X className=\"w-6 h-6\" />\n                </button>\n              </div>\n\n              {/* Workout Form */}\n              <div className=\"space-y-6\">\n                {/* Exercise Details Section */}\n                <div className=\"bg-gradient-to-r from-red-900/30 to-black/50 border border-red-500/30 rounded-lg p-6\">\n                  <h3 className=\"text-lg font-semibold text-red-400 mb-4 flex items-center gap-2\">\n                    <Dumbbell className=\"w-5 h-5 text-red-500\" />\n                    Exercise Details for {selectedExercise.name}\n                  </h3>\n                  \n                  {/* Exercise Input Grid */}\n                  <div className=\"grid grid-cols-2 gap-4 mb-4\">\n                    {/* Sets Input */}\n                    <div>\n                      <Label className=\"text-sm font-semibold text-gray-300\">Sets</Label>\n                      <Input\n                        type=\"number\"\n                        min=\"1\"\n                        max=\"10\"\n                        value={exerciseSets}\n                        onChange={(e) => setExerciseSets(parseInt(e.target.value) || 1)}\n                        className=\"mt-1 bg-black/50 border-red-500/30 text-white focus:border-red-500 focus:ring-red-500/50\"\n                        data-testid=\"input-sets\"\n                      />\n                    </div>\n\n                    {/* Reps Input */}\n                    <div>\n                      <Label className=\"text-sm font-semibold text-gray-300\">Reps per Set</Label>\n                      <Input\n                        type=\"number\"\n                        min=\"1\"\n                        max=\"100\"\n                        value={exerciseReps}\n                        onChange={(e) => setExerciseReps(parseInt(e.target.value) || 1)}\n                        className=\"mt-1 bg-black/50 border-red-500/30 text-white focus:border-red-500 focus:ring-red-500/50\"\n                        data-testid=\"input-reps\"\n                      />\n                    </div>\n\n                    {/* Weight Input */}\n                    <div>\n                      <Label className=\"text-sm font-semibold text-gray-300\">Weight (lbs)</Label>\n                      <Input\n                        type=\"number\"\n                        min=\"0\"\n                        max=\"1000\"\n                        value={exerciseWeight}\n                        onChange={(e) => setExerciseWeight(parseInt(e.target.value) || 0)}\n                        placeholder=\"0 for bodyweight\"\n                        className=\"mt-1 bg-black/50 border-red-500/30 text-white placeholder:text-gray-500 focus:border-red-500 focus:ring-red-500/50\"\n                        data-testid=\"input-weight\"\n                      />\n                    </div>\n\n                    {/* Exercise Duration Input */}\n                    <div>\n                      <Label className=\"text-sm font-semibold text-gray-300\">Duration (minutes)</Label>\n                      <Input\n                        type=\"number\"\n                        min=\"0\"\n                        max=\"60\"\n                        value={exerciseDuration}\n                        onChange={(e) => setExerciseDuration(parseInt(e.target.value) || 0)}\n                        placeholder=\"0 for rep-based\"\n                        className=\"mt-1 bg-black/50 border-red-500/30 text-white placeholder:text-gray-500 focus:border-red-500 focus:ring-red-500/50\"\n                        data-testid=\"input-exercise-duration\"\n                      />\n                    </div>\n                  </div>\n\n                  {/* Exercise Notes */}\n                  <div>\n                    <Label className=\"text-sm font-semibold text-gray-300\">Exercise Notes (optional)</Label>\n                    <Input\n                      type=\"text\"\n                      value={exerciseNotes}\n                      onChange={(e) => setExerciseNotes(e.target.value)}\n                      placeholder=\"e.g., form notes, modifications, how it felt...\"\n                      className=\"mt-1 bg-black/50 border-red-500/30 text-white placeholder:text-gray-500 focus:border-red-500 focus:ring-red-500/50\"\n                      data-testid=\"input-exercise-notes\"\n                    />\n                  </div>\n                </div>\n\n                {/* Workout Duration */}\n                <div>\n                  <Label className=\"text-base font-semibold text-gray-300\">Workout Duration: {workoutDuration[0]} minutes</Label>\n                  <div className=\"mt-2\">\n                    <Slider\n                      value={workoutDuration}\n                      onValueChange={setWorkoutDuration}\n                      min={5}\n                      max={120}\n                      step={5}\n                      className=\"w-full\"\n                      data-testid=\"duration-slider\"\n                    />\n                  </div>\n                </div>\n\n                {/* Estimated Calories Display */}\n                <div className=\"p-4 bg-gradient-to-r from-red-900/30 to-black/50 rounded-lg border border-red-500/30\">\n                  <div className=\"flex items-center justify-between\">\n                    <div>\n                      <h3 className=\"font-semibold text-gray-300\">Estimated Calories</h3>\n                      <p className=\"text-xs text-gray-400\">Based on your workout</p>\n                    </div>\n                    <div className=\"text-2xl font-bold text-red-500\">\n                      {selectedExercise ? calculateExerciseCalories(selectedExercise, exerciseSets, exerciseReps, exerciseWeight, exerciseDuration, difficultyLevel[0]) : 0} kcal\n                    </div>\n                  </div>\n                </div>\n              </div>\n\n              {/* Action Buttons */}\n              <div className=\"flex space-x-3 mt-8\">\n                <Button\n                  onClick={handleSubmitWorkout}\n                  disabled={createWorkoutMutation.isPending}\n                  className=\"flex-1 bg-gradient-to-r from-red-600 to-orange-600 hover:from-red-700 hover:to-orange-700\"\n                  data-testid=\"submit-workout-button\"\n                >\n                  {createWorkoutMutation.isPending ? 'Logging...' : 'Log Workout'}\n                </Button>\n                <Button\n                  variant=\"outline\"\n                  onClick={() => {\n                    setShowWorkoutForm(false);\n                    setSelectedExercise(null);\n                  }}\n                  className=\"px-6\"\n                  data-testid=\"cancel-workout-button\"\n                >\n                  Cancel\n                </Button>\n              </div>\n            </div>\n          </div>\n        </div>\n      )}\n\n      {/* Progress Photo Prompt Modal */}\n      {showProgressPhotoPrompt && lastCompletedWorkout && (\n        <div className=\"fixed inset-0 bg-black/50 flex items-center justify-center p-4 z-50\">\n          <div className=\"bg-white rounded-2xl max-w-md w-full\" onClick={(e) => e.stopPropagation()}>\n            <div className=\"p-6\">\n              {/* Header */}\n              <div className=\"text-center mb-6\">\n                <div className=\"mx-auto w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mb-4\">\n                  <CheckCircle className=\"w-8 h-8 text-green-600\" />\n                </div>\n                <h2 className=\"text-2xl font-bold text-gray-800 mb-2\">Workout Complete! 🎉</h2>\n                <p className=\"text-gray-600\">\n                  Great job on completing \"{lastCompletedWorkout.name}\"! \n                  Want to capture your progress with a photo?\n                </p>\n              </div>\n\n              {/* Workout Summary */}\n              <div className=\"bg-gray-50 rounded-lg p-4 mb-6\">\n                <div className=\"grid grid-cols-2 gap-4 text-sm\">\n                  <div className=\"text-center\">\n                    <div className=\"font-semibold text-gray-800\">{lastCompletedWorkout.duration} min</div>\n                    <div className=\"text-gray-600\">Duration</div>\n                  </div>\n                  <div className=\"text-center\">\n                    <div className=\"font-semibold text-gray-800\">{lastCompletedWorkout.caloriesBurned} kcal</div>\n                    <div className=\"text-gray-600\">Calories</div>\n                  </div>\n                </div>\n              </div>\n\n              {/* Action Buttons */}\n              <div className=\"space-y-3\">\n                <Button\n                  onClick={() => {\n                    setShowProgressPhotoPrompt(false);\n                    setLocation(\"/progress-photos\");\n                  }}\n                  className=\"w-full bg-red-600 hover:bg-red-700 text-white\"\n                  data-testid=\"button-add-progress-photo\"\n                >\n                  <Camera className=\"mr-2 h-4 w-4\" />\n                  Take Progress Photo\n                </Button>\n                <Button\n                  onClick={() => setShowProgressPhotoPrompt(false)}\n                  variant=\"outline\"\n                  className=\"w-full\"\n                  data-testid=\"button-skip-photo\"\n                >\n                  Skip for Now\n                </Button>\n              </div>\n\n              {/* Tip */}\n              <div className=\"mt-4 p-3 bg-blue-50 rounded-lg\">\n                <p className=\"text-sm text-blue-700\">\n                  💡 <strong>Tip:</strong> Regular progress photos help you see changes that the scale might not show!\n                </p>\n              </div>\n            </div>\n          </div>\n        </div>\n      )}\n\n      </div>\n    </section>\n  );\n}\n","size_bytes":87194},"client/src/components/ui/context-menu.tsx":{"content":"import * as React from \"react\"\nimport * as ContextMenuPrimitive from \"@radix-ui/react-context-menu\"\nimport { Check, ChevronRight, Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ContextMenu = ContextMenuPrimitive.Root\n\nconst ContextMenuTrigger = ContextMenuPrimitive.Trigger\n\nconst ContextMenuGroup = ContextMenuPrimitive.Group\n\nconst ContextMenuPortal = ContextMenuPrimitive.Portal\n\nconst ContextMenuSub = ContextMenuPrimitive.Sub\n\nconst ContextMenuRadioGroup = ContextMenuPrimitive.RadioGroup\n\nconst ContextMenuSubTrigger = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.SubTrigger>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.SubTrigger> & {\n    inset?: boolean\n  }\n>(({ className, inset, children, ...props }, ref) => (\n  <ContextMenuPrimitive.SubTrigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <ChevronRight className=\"ml-auto h-4 w-4\" />\n  </ContextMenuPrimitive.SubTrigger>\n))\nContextMenuSubTrigger.displayName = ContextMenuPrimitive.SubTrigger.displayName\n\nconst ContextMenuSubContent = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.SubContent>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.SubContent>\n>(({ className, ...props }, ref) => (\n  <ContextMenuPrimitive.SubContent\n    ref={ref}\n    className={cn(\n      \"z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-context-menu-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nContextMenuSubContent.displayName = ContextMenuPrimitive.SubContent.displayName\n\nconst ContextMenuContent = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <ContextMenuPrimitive.Portal>\n    <ContextMenuPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"z-50 max-h-[--radix-context-menu-content-available-height] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md animate-in fade-in-80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-context-menu-content-transform-origin]\",\n        className\n      )}\n      {...props}\n    />\n  </ContextMenuPrimitive.Portal>\n))\nContextMenuContent.displayName = ContextMenuPrimitive.Content.displayName\n\nconst ContextMenuItem = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Item> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <ContextMenuPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nContextMenuItem.displayName = ContextMenuPrimitive.Item.displayName\n\nconst ContextMenuCheckboxItem = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.CheckboxItem>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.CheckboxItem>\n>(({ className, children, checked, ...props }, ref) => (\n  <ContextMenuPrimitive.CheckboxItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    checked={checked}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <ContextMenuPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </ContextMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </ContextMenuPrimitive.CheckboxItem>\n))\nContextMenuCheckboxItem.displayName =\n  ContextMenuPrimitive.CheckboxItem.displayName\n\nconst ContextMenuRadioItem = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.RadioItem>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.RadioItem>\n>(({ className, children, ...props }, ref) => (\n  <ContextMenuPrimitive.RadioItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <ContextMenuPrimitive.ItemIndicator>\n        <Circle className=\"h-2 w-2 fill-current\" />\n      </ContextMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </ContextMenuPrimitive.RadioItem>\n))\nContextMenuRadioItem.displayName = ContextMenuPrimitive.RadioItem.displayName\n\nconst ContextMenuLabel = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Label> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <ContextMenuPrimitive.Label\n    ref={ref}\n    className={cn(\n      \"px-2 py-1.5 text-sm font-semibold text-foreground\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nContextMenuLabel.displayName = ContextMenuPrimitive.Label.displayName\n\nconst ContextMenuSeparator = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <ContextMenuPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-border\", className)}\n    {...props}\n  />\n))\nContextMenuSeparator.displayName = ContextMenuPrimitive.Separator.displayName\n\nconst ContextMenuShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\n        \"ml-auto text-xs tracking-widest text-muted-foreground\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\nContextMenuShortcut.displayName = \"ContextMenuShortcut\"\n\nexport {\n  ContextMenu,\n  ContextMenuTrigger,\n  ContextMenuContent,\n  ContextMenuItem,\n  ContextMenuCheckboxItem,\n  ContextMenuRadioItem,\n  ContextMenuLabel,\n  ContextMenuSeparator,\n  ContextMenuShortcut,\n  ContextMenuGroup,\n  ContextMenuPortal,\n  ContextMenuSub,\n  ContextMenuSubContent,\n  ContextMenuSubTrigger,\n  ContextMenuRadioGroup,\n}\n","size_bytes":7428},"client/src/components/ui/form.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as LabelPrimitive from \"@radix-ui/react-label\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport {\n  Controller,\n  FormProvider,\n  useFormContext,\n  type ControllerProps,\n  type FieldPath,\n  type FieldValues,\n} from \"react-hook-form\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Label } from \"@/components/ui/label\"\n\nconst Form = FormProvider\n\ntype FormFieldContextValue<\n  TFieldValues extends FieldValues = FieldValues,\n  TName extends FieldPath<TFieldValues> = FieldPath<TFieldValues>\n> = {\n  name: TName\n}\n\nconst FormFieldContext = React.createContext<FormFieldContextValue>(\n  {} as FormFieldContextValue\n)\n\nconst FormField = <\n  TFieldValues extends FieldValues = FieldValues,\n  TName extends FieldPath<TFieldValues> = FieldPath<TFieldValues>\n>({\n  ...props\n}: ControllerProps<TFieldValues, TName>) => {\n  return (\n    <FormFieldContext.Provider value={{ name: props.name }}>\n      <Controller {...props} />\n    </FormFieldContext.Provider>\n  )\n}\n\nconst useFormField = () => {\n  const fieldContext = React.useContext(FormFieldContext)\n  const itemContext = React.useContext(FormItemContext)\n  const { getFieldState, formState } = useFormContext()\n\n  const fieldState = getFieldState(fieldContext.name, formState)\n\n  if (!fieldContext) {\n    throw new Error(\"useFormField should be used within <FormField>\")\n  }\n\n  const { id } = itemContext\n\n  return {\n    id,\n    name: fieldContext.name,\n    formItemId: `${id}-form-item`,\n    formDescriptionId: `${id}-form-item-description`,\n    formMessageId: `${id}-form-item-message`,\n    ...fieldState,\n  }\n}\n\ntype FormItemContextValue = {\n  id: string\n}\n\nconst FormItemContext = React.createContext<FormItemContextValue>(\n  {} as FormItemContextValue\n)\n\nconst FormItem = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => {\n  const id = React.useId()\n\n  return (\n    <FormItemContext.Provider value={{ id }}>\n      <div ref={ref} className={cn(\"space-y-2\", className)} {...props} />\n    </FormItemContext.Provider>\n  )\n})\nFormItem.displayName = \"FormItem\"\n\nconst FormLabel = React.forwardRef<\n  React.ElementRef<typeof LabelPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof LabelPrimitive.Root>\n>(({ className, ...props }, ref) => {\n  const { error, formItemId } = useFormField()\n\n  return (\n    <Label\n      ref={ref}\n      className={cn(error && \"text-destructive\", className)}\n      htmlFor={formItemId}\n      {...props}\n    />\n  )\n})\nFormLabel.displayName = \"FormLabel\"\n\nconst FormControl = React.forwardRef<\n  React.ElementRef<typeof Slot>,\n  React.ComponentPropsWithoutRef<typeof Slot>\n>(({ ...props }, ref) => {\n  const { error, formItemId, formDescriptionId, formMessageId } = useFormField()\n\n  return (\n    <Slot\n      ref={ref}\n      id={formItemId}\n      aria-describedby={\n        !error\n          ? `${formDescriptionId}`\n          : `${formDescriptionId} ${formMessageId}`\n      }\n      aria-invalid={!!error}\n      {...props}\n    />\n  )\n})\nFormControl.displayName = \"FormControl\"\n\nconst FormDescription = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLParagraphElement>\n>(({ className, ...props }, ref) => {\n  const { formDescriptionId } = useFormField()\n\n  return (\n    <p\n      ref={ref}\n      id={formDescriptionId}\n      className={cn(\"text-sm text-muted-foreground\", className)}\n      {...props}\n    />\n  )\n})\nFormDescription.displayName = \"FormDescription\"\n\nconst FormMessage = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLParagraphElement>\n>(({ className, children, ...props }, ref) => {\n  const { error, formMessageId } = useFormField()\n  const body = error ? String(error?.message ?? \"\") : children\n\n  if (!body) {\n    return null\n  }\n\n  return (\n    <p\n      ref={ref}\n      id={formMessageId}\n      className={cn(\"text-sm font-medium text-destructive\", className)}\n      {...props}\n    >\n      {body}\n    </p>\n  )\n})\nFormMessage.displayName = \"FormMessage\"\n\nexport {\n  useFormField,\n  Form,\n  FormItem,\n  FormLabel,\n  FormControl,\n  FormDescription,\n  FormMessage,\n  FormField,\n}\n","size_bytes":4120},"client/src/pages/progress-photos.tsx":{"content":"import { useState, useRef, useCallback, useMemo } from \"react\";\nimport { useQuery, useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent, CardDescription, CardFooter, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Dialog, DialogContent, DialogDescription, DialogFooter, DialogHeader, DialogTitle, DialogTrigger } from \"@/components/ui/dialog\";\nimport { DropdownMenu, DropdownMenuContent, DropdownMenuItem, DropdownMenuTrigger } from \"@/components/ui/dropdown-menu\";\nimport { Camera, Plus, Calendar, Trash2, Edit3, X, Check, Grid3X3, Eye, ArrowLeft, ArrowRight, RotateCcw, ChevronDown } from \"lucide-react\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport FeatureGate from \"@/components/feature-gate\";\nimport type { ProgressPhotoWithWorkout, Workout } from \"@shared/schema\";\nimport { format } from \"date-fns\";\n\nexport default function ProgressPhotos() {\n  const [isDialogOpen, setIsDialogOpen] = useState(false);\n  const [isCameraActive, setIsCameraActive] = useState(false);\n  const [capturedImage, setCapturedImage] = useState<string | null>(null);\n  const [photoNotes, setPhotoNotes] = useState(\"\");\n  const [selectedWorkoutId, setSelectedWorkoutId] = useState<string | undefined>();\n  const [photoType, setPhotoType] = useState<\"before\" | \"after\">(\"before\");\n  const [editingPhoto, setEditingPhoto] = useState<ProgressPhotoWithWorkout | null>(null);\n  const [viewMode, setViewMode] = useState<\"grid\" | \"comparison\">(\"grid\");\n  const [currentComparisonIndex, setCurrentComparisonIndex] = useState(0);\n  const [isLoadingCamera, setIsLoadingCamera] = useState(false);\n  const [selectedPhotoForView, setSelectedPhotoForView] = useState<ProgressPhotoWithWorkout | null>(null);\n  \n  const videoRef = useRef<HTMLVideoElement>(null);\n  const canvasRef = useRef<HTMLCanvasElement>(null);\n  const fileInputRef = useRef<HTMLInputElement>(null);\n  \n  const { toast } = useToast();\n  const queryClient = useQueryClient();\n\n  // Fetch progress photos\n  const { data: photos = [], isLoading: photosLoading } = useQuery<ProgressPhotoWithWorkout[]>({\n    queryKey: [\"/api/progress-photos\"],\n  });\n\n  // Fetch workouts for selection\n  const { data: workouts = [] } = useQuery<Workout[]>({\n    queryKey: [\"/api/workouts\"],\n  });\n\n  // Organize photos into before/after comparison pairs\n  const comparisonPairs = useMemo(() => {\n    const beforePhotos = photos.filter((p: ProgressPhotoWithWorkout) => p.photoType === 'before');\n    const afterPhotos = photos.filter((p: ProgressPhotoWithWorkout) => p.photoType === 'after');\n    \n    const pairs: Array<{\n      before: ProgressPhotoWithWorkout | null;\n      after: ProgressPhotoWithWorkout | null;\n      timeSpan?: string;\n    }> = [];\n    \n    // Create pairs by matching photos with similar dates or workout links\n    beforePhotos.forEach(beforePhoto => {\n      // Try to find a matching after photo\n      let matchingAfter = null;\n      \n      // First priority: same workout\n      if (beforePhoto.workoutId) {\n        matchingAfter = afterPhotos.find(afterPhoto => \n          afterPhoto.workoutId === beforePhoto.workoutId\n        );\n      }\n      \n      // Second priority: closest date after the before photo\n      if (!matchingAfter) {\n        const beforeDate = new Date(beforePhoto.createdAt);\n        matchingAfter = afterPhotos\n          .filter(afterPhoto => new Date(afterPhoto.createdAt) > beforeDate)\n          .sort((a, b) => new Date(a.createdAt).getTime() - new Date(b.createdAt).getTime())[0];\n      }\n      \n      if (matchingAfter) {\n        const timeDiff = Math.abs(\n          new Date(matchingAfter.createdAt).getTime() - new Date(beforePhoto.createdAt).getTime()\n        );\n        const days = Math.floor(timeDiff / (1000 * 60 * 60 * 24));\n        \n        pairs.push({\n          before: beforePhoto,\n          after: matchingAfter,\n          timeSpan: days > 0 ? `${days} days` : 'Same day'\n        });\n        \n        // Remove the used after photo from the array\n        const afterIndex = afterPhotos.indexOf(matchingAfter);\n        if (afterIndex > -1) {\n          afterPhotos.splice(afterIndex, 1);\n        }\n      } else {\n        // Add unpaired before photo\n        pairs.push({\n          before: beforePhoto,\n          after: null\n        });\n      }\n    });\n    \n    // Add remaining unpaired after photos\n    afterPhotos.forEach(afterPhoto => {\n      pairs.push({\n        before: null,\n        after: afterPhoto\n      });\n    });\n    \n    return pairs.filter(pair => pair.before || pair.after);\n  }, [photos]);\n\n  // Create progress photo mutation\n  const createPhotoMutation = useMutation({\n    mutationFn: async (data: { notes: string; workoutId?: string; photoType: string; imageUrl?: string }) => {\n      await apiRequest(\"POST\", \"/api/progress-photos\", data);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/progress-photos\"] });\n      setIsDialogOpen(false);\n      resetForm();\n      toast({\n        title: \"Success!\",\n        description: \"Progress photo saved successfully.\",\n      });\n    },\n    onError: (error: any) => {\n      toast({\n        title: \"Error\",\n        description: error.message || \"Failed to save progress photo.\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  // Update progress photo mutation\n  const updatePhotoMutation = useMutation({\n    mutationFn: async ({ id, updates }: { id: string; updates: any }) => {\n      await apiRequest(\"PUT\", `/api/progress-photos/${id}`, updates);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/progress-photos\"] });\n      setEditingPhoto(null);\n      toast({\n        title: \"Success!\",\n        description: \"Progress photo updated successfully.\",\n      });\n    },\n    onError: (error: any) => {\n      toast({\n        title: \"Error\",\n        description: error.message || \"Failed to update progress photo.\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  // Delete progress photo mutation\n  const deletePhotoMutation = useMutation({\n    mutationFn: async (id: string) => {\n      await apiRequest(\"DELETE\", `/api/progress-photos/${id}`);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/progress-photos\"] });\n      toast({\n        title: \"Success!\",\n        description: \"Progress photo deleted successfully.\",\n      });\n    },\n    onError: (error: any) => {\n      toast({\n        title: \"Error\",\n        description: error.message || \"Failed to delete progress photo.\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const startCamera = useCallback(async () => {\n    setIsLoadingCamera(true);\n    \n    try {\n      // Check if mediaDevices is available\n      if (!navigator.mediaDevices || !navigator.mediaDevices.getUserMedia) {\n        throw new Error(\"Camera not supported on this device\");\n      }\n\n      const stream = await navigator.mediaDevices.getUserMedia({ \n        video: { facingMode: 'user', width: 640, height: 480 } \n      });\n      \n      if (videoRef.current) {\n        videoRef.current.srcObject = stream;\n        setIsCameraActive(true);\n        toast({\n          title: \"Camera Ready\",\n          description: \"Camera activated successfully!\",\n        });\n      }\n    } catch (error: any) {\n      let errorMessage = \"Unable to access camera.\";\n      \n      if (error.name === \"NotAllowedError\" || error.name === \"PermissionDeniedError\") {\n        errorMessage = \"Camera access denied. Please allow camera permissions in your browser settings.\";\n      } else if (error.name === \"NotFoundError\") {\n        errorMessage = \"No camera found on this device.\";\n      } else if (error.name === \"NotReadableError\") {\n        errorMessage = \"Camera is already in use by another application.\";\n      } else if (error.message) {\n        errorMessage = error.message;\n      }\n      \n      toast({\n        title: \"Camera Error\",\n        description: errorMessage,\n        variant: \"destructive\",\n      });\n    } finally {\n      setIsLoadingCamera(false);\n    }\n  }, [toast]);\n\n  const stopCamera = useCallback(() => {\n    if (videoRef.current?.srcObject) {\n      const tracks = (videoRef.current.srcObject as MediaStream).getTracks();\n      tracks.forEach(track => track.stop());\n      videoRef.current.srcObject = null;\n    }\n    setIsCameraActive(false);\n  }, []);\n\n  const capturePhoto = useCallback(() => {\n    if (videoRef.current && canvasRef.current) {\n      const canvas = canvasRef.current;\n      const video = videoRef.current;\n      \n      canvas.width = video.videoWidth;\n      canvas.height = video.videoHeight;\n      \n      const context = canvas.getContext('2d');\n      if (context) {\n        context.drawImage(video, 0, 0);\n        const imageData = canvas.toDataURL('image/jpeg', 0.8);\n        setCapturedImage(imageData);\n        stopCamera();\n      }\n    }\n  }, [stopCamera]);\n\n  const handleFileUpload = useCallback((event: React.ChangeEvent<HTMLInputElement>) => {\n    const file = event.target.files?.[0];\n    if (file) {\n      const reader = new FileReader();\n      reader.onload = (e) => {\n        setCapturedImage(e.target?.result as string);\n      };\n      reader.readAsDataURL(file);\n    }\n  }, []);\n\n  const resetForm = () => {\n    setCapturedImage(null);\n    setPhotoNotes(\"\");\n    setSelectedWorkoutId(undefined);\n    setPhotoType(\"before\");\n    stopCamera();\n    if (fileInputRef.current) {\n      fileInputRef.current.value = \"\";\n    }\n  };\n\n  const handleSavePhoto = async () => {\n    if (!capturedImage) {\n      toast({\n        title: \"Error\",\n        description: \"Please take a photo or upload an image first.\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    if (!photoNotes.trim()) {\n      toast({\n        title: \"Error\",\n        description: \"Please add notes for your progress photo.\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    try {\n      // For now, we'll save without uploading to object storage\n      // In a real implementation, you'd upload the image first\n      createPhotoMutation.mutate({\n        notes: photoNotes,\n        workoutId: selectedWorkoutId,\n        photoType,\n        imageUrl: capturedImage, // This would be the uploaded URL in production\n      });\n    } catch (error) {\n      console.error(\"Error saving photo:\", error);\n    }\n  };\n\n  const handleEditPhoto = (photo: ProgressPhotoWithWorkout) => {\n    setEditingPhoto(photo);\n  };\n\n  const handleUpdatePhoto = () => {\n    if (!editingPhoto) return;\n    \n    updatePhotoMutation.mutate({\n      id: editingPhoto.id,\n      updates: {\n        notes: editingPhoto.notes,\n        photoType: editingPhoto.photoType,\n      },\n    });\n  };\n\n  const handleDeletePhoto = (id: string) => {\n    if (confirm(\"Are you sure you want to delete this progress photo?\")) {\n      deletePhotoMutation.mutate(id);\n    }\n  };\n\n  if (photosLoading) {\n    return (\n      <div className=\"container mx-auto p-6\">\n        <div className=\"flex items-center justify-center min-h-64\">\n          <div className=\"text-center\">\n            <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-red-600 mx-auto\"></div>\n            <p className=\"mt-4 text-gray-600 dark:text-gray-400\">Loading progress photos...</p>\n          </div>\n        </div>\n      </div>\n    );\n  }\n\n  const renderGridView = () => (\n    <div className=\"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4\">\n      {photos.length === 0 ? (\n        <div className=\"col-span-full text-center py-12\">\n          <Camera className=\"mx-auto h-12 w-12 text-gray-400 mb-4\" />\n          <h3 className=\"text-lg font-medium text-gray-900 dark:text-white mb-2\">No progress photos yet</h3>\n          <p className=\"text-gray-600 dark:text-gray-400 mb-4\">\n            Start tracking your transformation by adding your first progress photo\n          </p>\n          <Button\n            onClick={() => setIsDialogOpen(true)}\n            className=\"bg-red-600 hover:bg-red-700\"\n            data-testid=\"button-add-first-photo\"\n          >\n            <Plus className=\"mr-2 h-4 w-4\" />\n            Add Your First Photo\n          </Button>\n        </div>\n      ) : (\n        photos.map((photo: ProgressPhotoWithWorkout) => (\n          <Card key={photo.id} className=\"overflow-hidden bg-gradient-to-br from-gray-900 to-black border border-red-600/30 shadow-xl shadow-red-500/10 cursor-pointer hover:border-red-500/50 transition-all\" data-testid={`card-photo-${photo.id}`}>\n            {photo.imageUrl && (\n              <div \n                className=\"aspect-square overflow-hidden relative group\"\n                onClick={() => setSelectedPhotoForView(photo)}\n              >\n                <img\n                  src={photo.imageUrl}\n                  alt={photo.notes || 'Progress photo'}\n                  className=\"w-full h-full object-cover transition-transform group-hover:scale-105\"\n                  data-testid={`img-photo-${photo.id}`}\n                />\n                <div className=\"absolute inset-0 bg-black/50 opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center\">\n                  <Eye className=\"w-8 h-8 text-white\" />\n                </div>\n              </div>\n            )}\n            \n            <CardHeader className=\"pb-2\">\n              <div className=\"flex items-start justify-between\">\n                <div className=\"flex-1\">\n                  <Badge\n                    variant={photo.photoType === 'before' ? 'secondary' : 'default'}\n                    className={photo.photoType === 'before' ? 'bg-blue-100 text-blue-800' : 'bg-green-100 text-green-800'}\n                    data-testid={`badge-type-${photo.id}`}\n                  >\n                    {photo.photoType === 'before' ? 'Before' : 'After'}\n                  </Badge>\n                </div>\n                <div className=\"flex gap-1\">\n                  <Button\n                    size=\"sm\"\n                    variant=\"ghost\"\n                    onClick={() => handleEditPhoto(photo)}\n                    data-testid={`button-edit-${photo.id}`}\n                  >\n                    <Edit3 className=\"h-4 w-4\" />\n                  </Button>\n                  <Button\n                    size=\"sm\"\n                    variant=\"ghost\"\n                    onClick={() => handleDeletePhoto(photo.id)}\n                    className=\"text-red-600 hover:text-red-700\"\n                    data-testid={`button-delete-${photo.id}`}\n                  >\n                    <Trash2 className=\"h-4 w-4\" />\n                  </Button>\n                </div>\n              </div>\n            </CardHeader>\n            \n            <CardContent className=\"pt-0\">\n              {editingPhoto?.id === photo.id ? (\n                <div className=\"space-y-3\">\n                  <Textarea\n                    value={editingPhoto.notes || ''}\n                    onChange={(e) => setEditingPhoto({ ...editingPhoto, notes: e.target.value })}\n                    className=\"text-sm\"\n                    data-testid={`input-edit-notes-${photo.id}`}\n                  />\n                  <Select\n                    value={editingPhoto.photoType}\n                    onValueChange={(value: \"before\" | \"after\") => \n                      setEditingPhoto({ ...editingPhoto, photoType: value })\n                    }\n                  >\n                    <SelectTrigger className=\"text-sm\" data-testid={`select-edit-type-${photo.id}`}>\n                      <SelectValue />\n                    </SelectTrigger>\n                    <SelectContent>\n                      <SelectItem value=\"before\">Before</SelectItem>\n                      <SelectItem value=\"after\">After</SelectItem>\n                    </SelectContent>\n                  </Select>\n                  <div className=\"flex gap-2\">\n                    <Button\n                      size=\"sm\"\n                      onClick={handleUpdatePhoto}\n                      disabled={updatePhotoMutation.isPending}\n                      className=\"flex-1 bg-green-600 hover:bg-green-700\"\n                      data-testid={`button-save-edit-${photo.id}`}\n                    >\n                      <Check className=\"mr-1 h-3 w-3\" />\n                      Save\n                    </Button>\n                    <Button\n                      size=\"sm\"\n                      variant=\"outline\"\n                      onClick={() => setEditingPhoto(null)}\n                      className=\"flex-1\"\n                      data-testid={`button-cancel-edit-${photo.id}`}\n                    >\n                      <X className=\"mr-1 h-3 w-3\" />\n                      Cancel\n                    </Button>\n                  </div>\n                </div>\n              ) : (\n                <div>\n                  <p className=\"text-sm text-gray-200 mb-2\" data-testid={`text-notes-${photo.id}`}>\n                    {photo.notes}\n                  </p>\n                  {photo.workout && (\n                    <p className=\"text-xs text-gray-400 mb-1\" data-testid={`text-workout-${photo.id}`}>\n                      Linked to: {photo.workout.name}\n                    </p>\n                  )}\n                  <div className=\"flex items-center text-xs text-gray-400\">\n                    <Calendar className=\"mr-1 h-3 w-3 text-red-500\" />\n                    <span data-testid={`text-date-${photo.id}`}>\n                      {format(new Date(photo.createdAt), 'MMM d, yyyy')}\n                    </span>\n                  </div>\n                </div>\n              )}\n            </CardContent>\n          </Card>\n        ))\n      )}\n    </div>\n  );\n\n  const renderComparisonView = () => (\n    <div className=\"space-y-6\">\n      {comparisonPairs.length === 0 ? (\n        <div className=\"text-center py-12\">\n          <Eye className=\"mx-auto h-12 w-12 text-red-500/60 mb-4\" />\n          <h3 className=\"text-lg font-medium text-white mb-2\">No photos to compare</h3>\n          <p className=\"text-gray-300 mb-4\">\n            Add both \"before\" and \"after\" photos to start comparing your progress\n          </p>\n          <Button\n            onClick={() => setIsDialogOpen(true)}\n            className=\"bg-gradient-to-r from-red-600 to-red-700 hover:from-red-700 hover:to-red-800 text-white shadow-lg shadow-red-500/25\"\n            data-testid=\"button-add-comparison-photo\"\n          >\n            <Plus className=\"mr-2 h-4 w-4\" />\n            Add Photos for Comparison\n          </Button>\n        </div>\n      ) : (\n        <>\n          {/* Comparison Navigation */}\n          <div className=\"flex items-center justify-between\">\n            <div className=\"flex items-center gap-4\">\n              <Button\n                variant=\"outline\"\n                size=\"sm\"\n                onClick={() => setCurrentComparisonIndex(Math.max(0, currentComparisonIndex - 1))}\n                disabled={currentComparisonIndex === 0}\n                className=\"border-red-600/30 text-gray-300 hover:bg-red-600/20 hover:text-white disabled:opacity-50 disabled:hover:bg-transparent\"\n                data-testid=\"button-prev-comparison\"\n              >\n                <ArrowLeft className=\"mr-2 h-4 w-4\" />\n                Previous\n              </Button>\n              <span className=\"text-sm text-gray-300\" data-testid=\"text-comparison-counter\">\n                {currentComparisonIndex + 1} of {comparisonPairs.length}\n              </span>\n              <Button\n                variant=\"outline\"\n                size=\"sm\"\n                onClick={() => setCurrentComparisonIndex(Math.min(comparisonPairs.length - 1, currentComparisonIndex + 1))}\n                disabled={currentComparisonIndex === comparisonPairs.length - 1}\n                className=\"border-red-600/30 text-gray-300 hover:bg-red-600/20 hover:text-white disabled:opacity-50 disabled:hover:bg-transparent\"\n                data-testid=\"button-next-comparison\"\n              >\n                Next\n                <ArrowRight className=\"ml-2 h-4 w-4\" />\n              </Button>\n            </div>\n            <Button\n              variant=\"outline\"\n              size=\"sm\"\n              onClick={() => setCurrentComparisonIndex(0)}\n              className=\"border-red-600/30 text-gray-300 hover:bg-red-600/20 hover:text-white\"\n              data-testid=\"button-reset-comparison\"\n            >\n              <RotateCcw className=\"mr-2 h-4 w-4\" />\n              Start Over\n            </Button>\n          </div>\n\n          {/* Current Comparison Pair */}\n          {comparisonPairs[currentComparisonIndex] && (\n            <Card className=\"p-6 bg-gradient-to-br from-gray-900 to-black border border-red-600/30 shadow-xl shadow-red-500/10\" data-testid={`card-comparison-${currentComparisonIndex}`}>\n              <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-8\">\n                {/* Before Photo */}\n                <div className=\"space-y-4\">\n                  <div className=\"flex items-center justify-center\">\n                    <Badge className=\"bg-blue-100 text-blue-800 text-lg px-4 py-2\" data-testid=\"badge-before-comparison\">\n                      Before\n                    </Badge>\n                  </div>\n                  {comparisonPairs[currentComparisonIndex].before ? (\n                    <div className=\"space-y-3\">\n                      {comparisonPairs[currentComparisonIndex].before?.imageUrl && (\n                        <div className=\"aspect-square overflow-hidden rounded-lg border-2 border-blue-200\">\n                          <img\n                            src={comparisonPairs[currentComparisonIndex].before!.imageUrl}\n                            alt={comparisonPairs[currentComparisonIndex].before!.notes || 'Before photo'}\n                            className=\"w-full h-full object-cover\"\n                            data-testid=\"img-before-comparison\"\n                          />\n                        </div>\n                      )}\n                      <div className=\"text-center space-y-2\">\n                        <p className=\"text-sm text-gray-200\" data-testid=\"text-before-notes\">\n                          {comparisonPairs[currentComparisonIndex].before!.notes}\n                        </p>\n                        <p className=\"text-xs text-gray-400\" data-testid=\"text-before-date\">\n                          {format(new Date(comparisonPairs[currentComparisonIndex].before!.createdAt), 'MMM d, yyyy')}\n                        </p>\n                      </div>\n                    </div>\n                  ) : (\n                    <div className=\"aspect-square border-2 border-dashed border-red-600/30 rounded-lg flex items-center justify-center bg-black/20\">\n                      <div className=\"text-center text-gray-400\">\n                        <Camera className=\"mx-auto h-12 w-12 mb-2 text-red-500/50\" />\n                        <p className=\"text-sm\">No \"before\" photo</p>\n                      </div>\n                    </div>\n                  )}\n                </div>\n\n                {/* After Photo */}\n                <div className=\"space-y-4\">\n                  <div className=\"flex items-center justify-center\">\n                    <Badge className=\"bg-green-100 text-green-800 text-lg px-4 py-2\" data-testid=\"badge-after-comparison\">\n                      After\n                    </Badge>\n                  </div>\n                  {comparisonPairs[currentComparisonIndex].after ? (\n                    <div className=\"space-y-3\">\n                      {comparisonPairs[currentComparisonIndex].after?.imageUrl && (\n                        <div className=\"aspect-square overflow-hidden rounded-lg border-2 border-green-200\">\n                          <img\n                            src={comparisonPairs[currentComparisonIndex].after!.imageUrl}\n                            alt={comparisonPairs[currentComparisonIndex].after!.notes || 'After photo'}\n                            className=\"w-full h-full object-cover\"\n                            data-testid=\"img-after-comparison\"\n                          />\n                        </div>\n                      )}\n                      <div className=\"text-center space-y-2\">\n                        <p className=\"text-sm text-gray-200\" data-testid=\"text-after-notes\">\n                          {comparisonPairs[currentComparisonIndex].after!.notes}\n                        </p>\n                        <p className=\"text-xs text-gray-400\" data-testid=\"text-after-date\">\n                          {format(new Date(comparisonPairs[currentComparisonIndex].after!.createdAt), 'MMM d, yyyy')}\n                        </p>\n                      </div>\n                    </div>\n                  ) : (\n                    <div className=\"aspect-square border-2 border-dashed border-red-600/30 rounded-lg flex items-center justify-center bg-black/20\">\n                      <div className=\"text-center text-gray-400\">\n                        <Camera className=\"mx-auto h-12 w-12 mb-2 text-red-500/50\" />\n                        <p className=\"text-sm\">No \"after\" photo</p>\n                      </div>\n                    </div>\n                  )}\n                </div>\n              </div>\n\n              {/* Comparison Info */}\n              {comparisonPairs[currentComparisonIndex].timeSpan && (\n                <div className=\"mt-6 text-center\">\n                  <Badge variant=\"outline\" className=\"text-sm px-4 py-2\" data-testid=\"badge-timespan\">\n                    Time Difference: {comparisonPairs[currentComparisonIndex].timeSpan}\n                  </Badge>\n                </div>\n              )}\n            </Card>\n          )}\n        </>\n      )}\n    </div>\n  );\n\n  return (\n    <FeatureGate feature=\"progress_photos\">\n      <div className=\"min-h-screen bg-gradient-to-br from-black via-gray-900 to-red-950 relative overflow-hidden\" data-testid=\"progress-photos-page\">\n      {/* Hexagonal animated background elements */}\n      <div className=\"fixed inset-0 pointer-events-none z-0\">\n        <div className=\"absolute top-20 left-10 w-32 h-28 opacity-20 animate-pulse\" style={{animationDuration: '6s'}}>\n          <svg viewBox=\"0 0 120 104\" className=\"w-full h-full\">\n            <polygon points=\"30,2 90,2 120,52 90,102 30,102 0,52\" fill=\"#dc2626\" stroke=\"#dc2626\" strokeWidth=\"2\" opacity=\"0.3\"/>\n          </svg>\n        </div>\n        <div className=\"absolute top-40 right-16 w-24 h-21 opacity-15 animate-bounce\" style={{animationDuration: '8s'}}>\n          <svg viewBox=\"0 0 120 104\" className=\"w-full h-full\">\n            <polygon points=\"30,2 90,2 120,52 90,102 30,102 0,52\" fill=\"none\" stroke=\"#dc2626\" strokeWidth=\"1\" opacity=\"0.4\"/>\n          </svg>\n        </div>\n        <div className=\"absolute top-96 left-1/4 w-28 h-24 opacity-25 animate-ping\" style={{animationDuration: '10s'}}>\n          <svg viewBox=\"0 0 120 104\" className=\"w-full h-full\">\n            <polygon points=\"30,2 90,2 120,52 90,102 30,102 0,52\" fill=\"#000000\" stroke=\"#dc2626\" strokeWidth=\"2\" opacity=\"0.6\"/>\n          </svg>\n        </div>\n        <div className=\"absolute bottom-80 right-1/3 w-20 h-17 opacity-30 animate-bounce\" style={{animationDuration: '7s'}}>\n          <svg viewBox=\"0 0 120 104\" className=\"w-full h-full\">\n            <polygon points=\"30,2 90,2 120,52 90,102 30,102 0,52\" fill=\"#dc2626\" stroke=\"#000000\" strokeWidth=\"1\" opacity=\"0.5\"/>\n          </svg>\n        </div>\n        <div className=\"absolute bottom-40 left-20 w-36 h-31 opacity-20 animate-pulse\" style={{animationDuration: '9s'}}>\n          <svg viewBox=\"0 0 120 104\" className=\"w-full h-full\">\n            <polygon points=\"30,2 90,2 120,52 90,102 30,102 0,52\" fill=\"none\" stroke=\"#dc2626\" strokeWidth=\"2\" opacity=\"0.3\"/>\n          </svg>\n        </div>\n        <div className=\"absolute top-1/3 right-1/4 w-26 h-22 opacity-15 animate-ping\" style={{animationDuration: '12s'}}>\n          <svg viewBox=\"0 0 120 104\" className=\"w-full h-full\">\n            <polygon points=\"30,2 90,2 120,52 90,102 30,102 0,52\" fill=\"#000000\" stroke=\"#dc2626\" strokeWidth=\"1\" opacity=\"0.4\"/>\n          </svg>\n        </div>\n        {/* Floating emojis */}\n        <div className=\"absolute top-10 left-10 text-red-500/20 text-6xl\">📸</div>\n        <div className=\"absolute bottom-10 right-10 text-red-500/20 text-6xl\">🔥</div>\n        <div className=\"absolute top-1/2 left-20 text-red-500/15 text-5xl\">💪</div>\n        <div className=\"absolute bottom-1/4 right-20 text-red-500/15 text-5xl\">⚡</div>\n      </div>\n\n      {/* Animated background gradient overlay */}\n      <div className=\"absolute inset-0 bg-gradient-to-r from-red-500/5 to-transparent animate-pulse\"></div>\n      \n      <div className=\"relative z-10 container mx-auto px-6 py-8\">\n        <div className=\"flex justify-between items-center mb-12\">\n          <div>\n            <h1 className=\"text-4xl font-bold bg-gradient-to-r from-red-500 to-red-300 bg-clip-text text-transparent mb-4 flex items-center\">\n              <Camera className=\"mr-3 text-red-500\" size={40} />\n              Progress Photos\n            </h1>\n            <p className=\"text-gray-300 text-lg\">Track your transformation journey with before and after photos</p>\n          </div>\n        \n          <div className=\"flex items-center gap-4\">\n          {/* View Mode Dropdown */}\n          <DropdownMenu>\n            <DropdownMenuTrigger asChild>\n              <Button\n                variant=\"outline\"\n                className=\"bg-black/60 border-red-600/30 text-gray-300 hover:bg-red-600/20 hover:text-white backdrop-blur-sm\"\n                data-testid=\"button-view-mode\"\n              >\n                {viewMode === \"grid\" ? (\n                  <>\n                    <Grid3X3 className=\"mr-2 h-4 w-4\" />\n                    Grid\n                  </>\n                ) : (\n                  <>\n                    <Eye className=\"mr-2 h-4 w-4\" />\n                    Compare\n                  </>\n                )}\n                <ChevronDown className=\"ml-2 h-4 w-4\" />\n              </Button>\n            </DropdownMenuTrigger>\n            <DropdownMenuContent className=\"bg-black/95 border-red-600/30 backdrop-blur-sm\">\n              <DropdownMenuItem\n                onClick={() => setViewMode(\"grid\")}\n                className={`${\n                  viewMode === \"grid\"\n                    ? \"bg-red-600/20 text-white\"\n                    : \"text-gray-300 hover:bg-red-600/20 hover:text-white\"\n                } cursor-pointer`}\n                data-testid=\"menu-item-grid\"\n              >\n                <Grid3X3 className=\"mr-2 h-4 w-4\" />\n                Grid View\n              </DropdownMenuItem>\n              <DropdownMenuItem\n                onClick={() => setViewMode(\"comparison\")}\n                className={`${\n                  viewMode === \"comparison\"\n                    ? \"bg-red-600/20 text-white\"\n                    : \"text-gray-300 hover:bg-red-600/20 hover:text-white\"\n                } cursor-pointer`}\n                data-testid=\"menu-item-compare\"\n              >\n                <Eye className=\"mr-2 h-4 w-4\" />\n                Compare\n              </DropdownMenuItem>\n            </DropdownMenuContent>\n          </DropdownMenu>\n\n          <Dialog open={isDialogOpen} onOpenChange={setIsDialogOpen}>\n            <DialogTrigger asChild>\n              <Button className=\"bg-red-600 hover:bg-red-700 text-white\" data-testid=\"button-add-photo\">\n                <Plus className=\"mr-2 h-4 w-4\" />\n                Add Photo\n              </Button>\n            </DialogTrigger>\n            <DialogContent className=\"max-w-2xl max-h-[90vh] overflow-y-auto\">\n              <DialogHeader>\n                <DialogTitle>Add Progress Photo</DialogTitle>\n                <DialogDescription>\n                  Capture or upload a photo to track your fitness progress\n                </DialogDescription>\n              </DialogHeader>\n              \n              <div className=\"space-y-6\">\n                {/* Camera/Upload Section */}\n                <div className=\"space-y-4\">\n                  <Label>Photo Capture</Label>\n                  \n                  {!capturedImage && (\n                    <Button\n                      type=\"button\"\n                      onClick={(e) => {\n                        e.preventDefault();\n                        fileInputRef.current?.click();\n                      }}\n                      variant=\"outline\"\n                      className=\"w-full\"\n                      data-testid=\"button-upload-photo\"\n                    >\n                      <Camera className=\"mr-2 h-4 w-4\" />\n                      Take/Upload Photo\n                    </Button>\n                  )}\n                  \n                  <input\n                    ref={fileInputRef}\n                    type=\"file\"\n                    accept=\"image/*\"\n                    capture=\"environment\"\n                    onChange={handleFileUpload}\n                    className=\"hidden\"\n                  />\n                  \n                  {capturedImage && (\n                    <div className=\"space-y-4\">\n                      <div className=\"relative\">\n                        <img\n                          src={capturedImage}\n                          alt=\"Captured progress photo\"\n                          className=\"w-full rounded-lg\"\n                          style={{ maxHeight: '400px', objectFit: 'cover' }}\n                          data-testid=\"img-captured-photo\"\n                        />\n                      </div>\n                      <Button\n                        type=\"button\"\n                        onClick={() => setCapturedImage(null)}\n                        variant=\"outline\"\n                        className=\"w-full\"\n                        data-testid=\"button-retake-photo\"\n                      >\n                        <X className=\"mr-2 h-4 w-4\" />\n                        Retake Photo\n                      </Button>\n                    </div>\n                  )}\n                  \n                  <canvas ref={canvasRef} className=\"hidden\" />\n                </div>\n                \n                {/* Form Fields */}\n                <div className=\"space-y-4\">\n                  <div>\n                    <Label htmlFor=\"photo-notes\">Notes</Label>\n                    <Textarea\n                      id=\"photo-notes\"\n                      placeholder=\"Add notes about your progress, goals, or what this photo represents...\"\n                      value={photoNotes}\n                      onChange={(e) => setPhotoNotes(e.target.value)}\n                      className=\"mt-1\"\n                      data-testid=\"input-photo-notes\"\n                    />\n                  </div>\n                  \n                  <div>\n                    <Label htmlFor=\"photo-type\">Photo Type</Label>\n                    <Select value={photoType} onValueChange={(value: \"before\" | \"after\") => setPhotoType(value)}>\n                      <SelectTrigger className=\"mt-1\" data-testid=\"select-photo-type\">\n                        <SelectValue />\n                      </SelectTrigger>\n                      <SelectContent>\n                        <SelectItem value=\"before\">Before</SelectItem>\n                        <SelectItem value=\"after\">After</SelectItem>\n                      </SelectContent>\n                    </Select>\n                  </div>\n                  \n                  <div>\n                    <Label htmlFor=\"workout-selection\">Link to Workout (Optional)</Label>\n                    <Select value={selectedWorkoutId} onValueChange={setSelectedWorkoutId}>\n                      <SelectTrigger className=\"mt-1\" data-testid=\"select-workout\">\n                        <SelectValue placeholder=\"Choose a workout to link...\" />\n                      </SelectTrigger>\n                      <SelectContent>\n                        {workouts.map((workout: Workout) => (\n                          <SelectItem key={workout.id} value={workout.id}>\n                            {workout.name} - {format(new Date(workout.date), 'MMM d, yyyy')}\n                          </SelectItem>\n                        ))}\n                      </SelectContent>\n                    </Select>\n                  </div>\n                </div>\n              </div>\n              \n              <DialogFooter>\n                <Button\n                  type=\"button\"\n                  onClick={() => setIsDialogOpen(false)}\n                  variant=\"outline\"\n                  data-testid=\"button-cancel-photo\"\n                >\n                  Cancel\n                </Button>\n                <Button\n                  type=\"button\"\n                  onClick={handleSavePhoto}\n                  disabled={createPhotoMutation.isPending}\n                  className=\"bg-red-600 hover:bg-red-700\"\n                  data-testid=\"button-save-photo\"\n                >\n                  {createPhotoMutation.isPending ? \"Saving...\" : \"Save Photo\"}\n                </Button>\n              </DialogFooter>\n            </DialogContent>\n          </Dialog>\n        </div>\n      </div>\n\n        {/* Main Content */}\n        {viewMode === \"grid\" ? renderGridView() : renderComparisonView()}\n      </div>\n\n      {/* Full-size Photo Viewer Dialog */}\n      <Dialog open={!!selectedPhotoForView} onOpenChange={(open) => !open && setSelectedPhotoForView(null)}>\n        <DialogContent className=\"max-w-4xl max-h-[90vh] overflow-y-auto bg-black/95 border-red-600/30\">\n          {selectedPhotoForView && (\n            <>\n              <DialogHeader>\n                <DialogTitle className=\"flex items-center gap-2 text-white\">\n                  <Badge\n                    variant={selectedPhotoForView.photoType === 'before' ? 'secondary' : 'default'}\n                    className={selectedPhotoForView.photoType === 'before' ? 'bg-blue-100 text-blue-800' : 'bg-green-100 text-green-800'}\n                  >\n                    {selectedPhotoForView.photoType === 'before' ? 'Before' : 'After'}\n                  </Badge>\n                  {format(new Date(selectedPhotoForView.createdAt), 'MMMM d, yyyy')}\n                </DialogTitle>\n              </DialogHeader>\n              \n              <div className=\"space-y-4\">\n                {/* Full-size image */}\n                {selectedPhotoForView.imageUrl && (\n                  <div className=\"w-full rounded-lg overflow-hidden border border-red-600/30\">\n                    <img\n                      src={selectedPhotoForView.imageUrl}\n                      alt={selectedPhotoForView.notes || 'Progress photo'}\n                      className=\"w-full h-auto object-contain max-h-[60vh]\"\n                    />\n                  </div>\n                )}\n                \n                {/* Photo details */}\n                <div className=\"space-y-2 text-gray-300\">\n                  <div>\n                    <Label className=\"text-gray-400\">Notes</Label>\n                    <p className=\"text-white mt-1\">{selectedPhotoForView.notes || 'No notes'}</p>\n                  </div>\n                  \n                  {selectedPhotoForView.workout && (\n                    <div>\n                      <Label className=\"text-gray-400\">Linked Workout</Label>\n                      <p className=\"text-white mt-1\">{selectedPhotoForView.workout.name}</p>\n                    </div>\n                  )}\n                </div>\n                \n                {/* Action buttons */}\n                <div className=\"flex gap-2 pt-4\">\n                  <Button\n                    variant=\"outline\"\n                    onClick={() => {\n                      handleEditPhoto(selectedPhotoForView);\n                      setSelectedPhotoForView(null);\n                    }}\n                    className=\"flex-1\"\n                  >\n                    <Edit3 className=\"mr-2 h-4 w-4\" />\n                    Edit\n                  </Button>\n                  <Button\n                    variant=\"outline\"\n                    onClick={() => {\n                      handleDeletePhoto(selectedPhotoForView.id);\n                      setSelectedPhotoForView(null);\n                    }}\n                    className=\"flex-1 text-red-500 hover:text-red-600 hover:bg-red-600/10\"\n                  >\n                    <Trash2 className=\"mr-2 h-4 w-4\" />\n                    Delete\n                  </Button>\n                </div>\n              </div>\n            </>\n          )}\n        </DialogContent>\n      </Dialog>\n    </div>\n    </FeatureGate>\n  );\n}","size_bytes":40711},"client/src/components/ui/avatar.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as AvatarPrimitive from \"@radix-ui/react-avatar\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Avatar = React.forwardRef<\n  React.ElementRef<typeof AvatarPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <AvatarPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full\",\n      className\n    )}\n    {...props}\n  />\n))\nAvatar.displayName = AvatarPrimitive.Root.displayName\n\nconst AvatarImage = React.forwardRef<\n  React.ElementRef<typeof AvatarPrimitive.Image>,\n  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Image>\n>(({ className, ...props }, ref) => (\n  <AvatarPrimitive.Image\n    ref={ref}\n    className={cn(\"aspect-square h-full w-full\", className)}\n    {...props}\n  />\n))\nAvatarImage.displayName = AvatarPrimitive.Image.displayName\n\nconst AvatarFallback = React.forwardRef<\n  React.ElementRef<typeof AvatarPrimitive.Fallback>,\n  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Fallback>\n>(({ className, ...props }, ref) => (\n  <AvatarPrimitive.Fallback\n    ref={ref}\n    className={cn(\n      \"flex h-full w-full items-center justify-center rounded-full bg-muted\",\n      className\n    )}\n    {...props}\n  />\n))\nAvatarFallback.displayName = AvatarPrimitive.Fallback.displayName\n\nexport { Avatar, AvatarImage, AvatarFallback }\n","size_bytes":1419},"server/mealPlanGenerator.ts":{"content":"import OpenAI from \"openai\";\nimport { getMealImageUrl, getIngredientImageUrl } from \"./imageService\";\n\n// the newest OpenAI model is \"gpt-5\" which was released August 7, 2025. do not change this unless explicitly requested by the user\nconst openai = new OpenAI({\n  apiKey: process.env.AI_INTEGRATIONS_OPENAI_API_KEY || process.env.OPENAI_API_KEY,\n  baseURL: process.env.AI_INTEGRATIONS_OPENAI_BASE_URL\n});\n\nexport interface MealPlanGenerationOptions {\n  goal: \"weight_loss\" | \"weight_gain\" | \"maintenance\";\n  dailyCalories: number;\n  dietaryRestrictions?: string[];\n  preferences?: string[];\n  allergies?: string[];\n  mealsPerDay?: number;\n  duration?: number; // days\n}\n\nexport interface GeneratedMealPlan {\n  name: string;\n  description: string;\n  goal: string;\n  dailyCalories: number;\n  dailyProtein: number;\n  dailyCarbs: number;\n  dailyFat: number;\n  duration: number;\n  days: {\n    dayNumber: number;\n    name: string;\n    meals: {\n      mealType: \"breakfast\" | \"lunch\" | \"dinner\" | \"snack\";\n      name: string;\n      description: string;\n      calories: number;\n      protein: number;\n      carbs: number;\n      fat: number;\n      ingredients: string[];\n      instructions: string[];\n      prepTime: number;\n      servings: number;\n      imageUrl?: string;\n      ingredientImages?: Record<string, string>;\n    }[];\n  }[];\n}\n\n\n// Enhanced meal plan generator with user food preferences\nasync function generateMockMealPlan(options: MealPlanGenerationOptions): Promise<GeneratedMealPlan> {\n  const {\n    goal,\n    dailyCalories,\n    dietaryRestrictions = [],\n    preferences = [],\n    allergies = [],\n    duration = 7\n  } = options;\n\n  // Calculate macros based on goal\n  let proteinPercent = 0.25; // 25% protein\n  let carbPercent = 0.45; // 45% carbs\n  let fatPercent = 0.30; // 30% fat\n\n  if (goal === 'weight_loss') {\n    proteinPercent = 0.30;\n    carbPercent = 0.35;\n    fatPercent = 0.35;\n  } else if (goal === 'weight_gain') {\n    proteinPercent = 0.25;\n    carbPercent = 0.50;\n    fatPercent = 0.25;\n  }\n\n  const dailyProtein = Math.round((dailyCalories * proteinPercent) / 4);\n  const dailyCarbs = Math.round((dailyCalories * carbPercent) / 4);\n  const dailyFat = Math.round((dailyCalories * fatPercent) / 9);\n\n  const goalNames = {\n    weight_loss: \"Weight Loss Meal Plan\",\n    weight_gain: \"Weight Gain Meal Plan\", \n    maintenance: \"Balanced Maintenance Plan\"\n  };\n\n  const goalDescriptions = {\n    weight_loss: \"A balanced meal plan designed to support healthy weight loss with high protein and nutrient-dense foods.\",\n    weight_gain: \"A calorie-rich meal plan focused on healthy weight gain with nutritious, energy-dense foods.\",\n    maintenance: \"A well-balanced meal plan to maintain your current weight while supporting overall health and wellness.\"\n  };\n\n  // Create diverse meal database with goal-specific options\n  const weightLossProteins = [\"Chicken breast\", \"White fish\", \"Egg whites\", \"Non-fat Greek yogurt\", \"Tofu\", \"Shrimp\", \"Turkey breast\", \"Cottage cheese\"];\n  const weightGainProteins = [\"Salmon\", \"Whole eggs\", \"Full-fat Greek yogurt\", \"Beef\", \"Pork\", \"Chicken thighs\", \"Cheese\", \"Whole milk\"];\n  const maintenanceProteins = [\"Chicken breast\", \"Salmon\", \"Eggs\", \"Greek yogurt\", \"Tofu\", \"Lentils\", \"Chickpeas\", \"Turkey\"];\n  \n  const weightLossCarbsFoods = [\"Cauliflower rice\", \"Zucchini noodles\", \"Lettuce wraps\", \"Quinoa (small portions)\", \"Berries\", \"Vegetables\"];\n  const weightGainCarbsFoods = [\"Brown rice\", \"Pasta\", \"Oats\", \"Sweet potato\", \"Whole grain bread\", \"Bagels\", \"Granola\", \"Dried fruits\"];\n  const maintenanceCarbsFoods = [\"Brown rice\", \"Quinoa\", \"Oats\", \"Sweet potato\", \"Whole grain bread\", \"Pasta\", \"Barley\"];\n  \n  const vegetables = [\"Broccoli\", \"Spinach\", \"Bell peppers\", \"Carrots\", \"Tomatoes\", \"Cucumber\", \"Kale\", \"Zucchini\", \"Brussels sprouts\", \"Asparagus\", \"Green beans\", \"Mushrooms\"];\n  const fruits = [\"Berries\", \"Apple\", \"Banana\", \"Orange\", \"Avocado\", \"Grapes\", \"Mango\", \"Pineapple\", \"Peach\", \"Kiwi\"];\n  const weightGainFats = [\"Peanut butter\", \"Almond butter\", \"Avocado\", \"Nuts\", \"Seeds\", \"Olive oil\", \"Coconut oil\", \"Full-fat dairy\"];\n  const weightLossFats = [\"Light olive oil spray\", \"Small portions of nuts\", \"Avocado (limited)\", \"Seeds (limited)\"];\n  const maintenanceFats = [\"Olive oil\", \"Avocado\", \"Nuts\", \"Seeds\", \"Nut butters (moderate)\"];\n  \n  // Select appropriate food lists based on goal\n  const proteinFoods = goal === 'weight_loss' ? weightLossProteins : goal === 'weight_gain' ? weightGainProteins : maintenanceProteins;\n  const carbFoods = goal === 'weight_loss' ? weightLossCarbsFoods : goal === 'weight_gain' ? weightGainCarbsFoods : maintenanceCarbsFoods;\n  const fats = goal === 'weight_loss' ? weightLossFats : goal === 'weight_gain' ? weightGainFats : maintenanceFats;\n\n  // Filter foods based on preferences\n  const likedFoods = preferences.map(p => p.toLowerCase());\n  const availableProteins = proteinFoods.filter(food => \n    likedFoods.length === 0 || likedFoods.some(liked => food.toLowerCase().includes(liked) || liked.includes(food.toLowerCase()))\n  );\n  const availableCarbs = carbFoods.filter(food => \n    likedFoods.length === 0 || likedFoods.some(liked => food.toLowerCase().includes(liked) || liked.includes(food.toLowerCase()))\n  );\n  const availableVeggies = vegetables.filter(food => \n    likedFoods.length === 0 || likedFoods.some(liked => food.toLowerCase().includes(liked) || liked.includes(food.toLowerCase()))\n  );\n  const availableFruits = fruits.filter(food => \n    likedFoods.length === 0 || likedFoods.some(liked => food.toLowerCase().includes(liked) || liked.includes(food.toLowerCase()))\n  );\n\n  // Dietary restrictions\n  const isVegetarian = dietaryRestrictions.some(r => r.toLowerCase().includes('vegetarian'));\n  const isVegan = dietaryRestrictions.some(r => r.toLowerCase().includes('vegan'));\n\n  // Filter proteins based on dietary restrictions\n  const finalProteins = isVegan \n    ? availableProteins.filter(p => ![\"Chicken breast\", \"Salmon\", \"Eggs\", \"Greek yogurt\", \"Turkey\", \"Cottage cheese\"].includes(p))\n    : isVegetarian \n    ? availableProteins.filter(p => ![\"Chicken breast\", \"Salmon\", \"Turkey\"].includes(p))\n    : availableProteins;\n\n  // Generate varied meal options for each day\n  const generateMealVariations = (mealType: string, dayIndex: number) => {\n    const baseCalories = {\n      breakfast: Math.round(dailyCalories * 0.25),\n      lunch: Math.round(dailyCalories * 0.30),\n      dinner: Math.round(dailyCalories * 0.35),\n      snack: Math.round(dailyCalories * 0.10)\n    };\n\n    const mealCalories = baseCalories[mealType as keyof typeof baseCalories];\n    const mealProtein = Math.round((mealCalories * proteinPercent) / 4);\n    const mealCarbs = Math.round((mealCalories * carbPercent) / 4);\n    const mealFat = Math.round((mealCalories * fatPercent) / 9);\n\n    // Create unique meals for each day based on available ingredients\n    const proteinIndex = dayIndex % finalProteins.length;\n    const carbIndex = dayIndex % availableCarbs.length;\n    const veggieIndex = dayIndex % availableVeggies.length;\n    const fruitIndex = dayIndex % availableFruits.length;\n\n    const protein = finalProteins[proteinIndex] || \"Tofu\";\n    const carb = availableCarbs[carbIndex] || \"Brown rice\";\n    const veggie = availableVeggies[veggieIndex] || \"Mixed vegetables\";\n    const fruit = availableFruits[fruitIndex] || \"Berries\";\n\n    // Goal-specific meal templates with maximum variety\n    const mealTemplates = goal === 'weight_loss' \n      ? {\n          breakfast: [\n            {\n              name: `${protein} Egg White Scramble`,\n              description: `High-protein, low-calorie breakfast with ${protein.toLowerCase()} and vegetables`,\n              ingredients: [protein, veggie, \"Spinach\", \"Mushrooms\", \"Herbs\"],\n              instructions: [\"Cook protein\", \"Add vegetables\", \"Season lightly\", \"Serve hot\"]\n            },\n            {\n              name: `Greek Yogurt Berry Bowl`,\n              description: `Protein-rich breakfast with fresh berries and minimal added sugar`,\n              ingredients: [\"Non-fat Greek yogurt\", fruit, \"Chia seeds\", \"Cinnamon\"],\n              instructions: [\"Layer yogurt\", \"Top with berries\", \"Add seeds\", \"Enjoy fresh\"]\n            },\n            {\n              name: `Veggie Omelet with ${protein}`,\n              description: `Fluffy egg white omelet loaded with colorful vegetables`,\n              ingredients: [\"Egg whites\", veggie, \"Tomatoes\", \"Onions\", \"Bell peppers\", \"Herbs\"],\n              instructions: [\"Whisk egg whites\", \"Add vegetables\", \"Cook until fluffy\", \"Serve immediately\"]\n            },\n            {\n              name: `Cottage Cheese ${fruit} Parfait`,\n              description: `Light and refreshing breakfast parfait`,\n              ingredients: [\"Low-fat cottage cheese\", fruit, \"Stevia\", \"Vanilla extract\", \"Berries\"],\n              instructions: [\"Layer cottage cheese\", \"Add fruits\", \"Top with berries\", \"Enjoy cold\"]\n            },\n            {\n              name: `Green Smoothie Bowl`,\n              description: `Nutrient-packed smoothie bowl with leafy greens`,\n              ingredients: [\"Spinach\", \"Kale\", fruit, \"Protein powder\", \"Almond milk\", \"Ice\"],\n              instructions: [\"Blend all ingredients\", \"Pour into bowl\", \"Top with seeds\", \"Serve fresh\"]\n            },\n            {\n              name: `Zucchini Egg Muffins`,\n              description: `Portable, low-calorie breakfast muffins`,\n              ingredients: [\"Egg whites\", \"Zucchini\", veggie, \"Garlic\", \"Herbs\"],\n              instructions: [\"Mix ingredients\", \"Pour into muffin tin\", \"Bake until set\", \"Enjoy warm\"]\n            },\n            {\n              name: `${fruit} Chia Pudding`,\n              description: `Overnight chia pudding with fresh fruits`,\n              ingredients: [\"Chia seeds\", \"Unsweetened almond milk\", fruit, \"Vanilla\", \"Stevia\"],\n              instructions: [\"Mix chia and milk\", \"Refrigerate overnight\", \"Top with fruit\", \"Serve cold\"]\n            }\n          ],\n          lunch: [\n            {\n              name: `Grilled ${protein} Salad Bowl`,\n              description: `Large volume salad with lean ${protein.toLowerCase()} and colorful vegetables`,\n              ingredients: [protein, veggie, \"Mixed greens\", \"Tomatoes\", \"Cucumber\", \"Balsamic vinegar\"],\n              instructions: [\"Grill protein\", \"Toss salad\", \"Top with protein\", \"Light dressing\"]\n            },\n            {\n              name: `Vegetable-Packed ${protein} Wrap`,\n              description: `Lettuce wrap loaded with ${protein.toLowerCase()} and vegetables`,\n              ingredients: [protein, veggie, \"Lettuce leaves\", \"Bell peppers\", \"Mustard\"],\n              instructions: [\"Prepare protein\", \"Fill lettuce leaves\", \"Add veggies\", \"Roll and serve\"]\n            }\n          ],\n          dinner: [\n            {\n              name: `Baked ${protein} with Roasted Vegetables`,\n              description: `Simple, lean dinner with ${protein.toLowerCase()} and nutrient-dense vegetables`,\n              ingredients: [protein, veggie, \"Broccoli\", \"Cauliflower\", \"Herbs\", \"Lemon\"],\n              instructions: [\"Bake protein\", \"Roast vegetables\", \"Season with herbs\", \"Serve immediately\"]\n            },\n            {\n              name: `Vegetable Stir-Fry with ${protein}`,\n              description: `Low-calorie stir-fry packed with vegetables and lean ${protein.toLowerCase()}`,\n              ingredients: [protein, veggie, \"Snap peas\", \"Water chestnuts\", \"Soy sauce (low sodium)\"],\n              instructions: [\"Stir-fry vegetables\", \"Add protein\", \"Light sauce\", \"Serve hot\"]\n            }\n          ],\n          snack: [\n            {\n              name: `${fruit} with Cottage Cheese`,\n              description: `High-protein, low-calorie snack`,\n              ingredients: [fruit, \"Low-fat cottage cheese\", \"Cinnamon\"],\n              instructions: [\"Combine ingredients\", \"Enjoy fresh\"]\n            }\n          ]\n        }\n      : goal === 'weight_gain'\n      ? {\n          breakfast: [\n            {\n              name: `Protein Pancakes with ${fruit}`,\n              description: `Calorie-dense breakfast with protein pancakes, ${fruit.toLowerCase()}, and nut butter`,\n              ingredients: [\"Whole eggs\", carb, fruit, \"Peanut butter\", \"Honey\", \"Granola\"],\n              instructions: [\"Make protein pancakes\", \"Top with nut butter\", \"Add fruit and granola\", \"Drizzle honey\"]\n            },\n            {\n              name: `Overnight Oats Power Bowl`,\n              description: `Energy-dense oats with nuts, seeds, and dried fruits`,\n              ingredients: [\"Oats\", \"Whole milk\", fruit, \"Almonds\", \"Chia seeds\", \"Honey\", \"Dried fruits\"],\n              instructions: [\"Mix oats and milk\", \"Add nuts and seeds\", \"Top with fruits\", \"Refrigerate overnight\"]\n            }\n          ],\n          lunch: [\n            {\n              name: `${protein} Rice Bowl with Avocado`,\n              description: `Calorie-rich bowl with ${protein.toLowerCase()}, rice, and healthy fats`,\n              ingredients: [protein, carb, \"Avocado\", \"Cheese\", \"Olive oil\", veggie],\n              instructions: [\"Cook rice\", \"Prepare protein\", \"Add avocado and cheese\", \"Drizzle with oil\"]\n            },\n            {\n              name: `Loaded ${protein} Sandwich`,\n              description: `High-calorie sandwich with ${protein.toLowerCase()}, cheese, and spreads`,\n              ingredients: [protein, \"Whole grain bread\", \"Cheese\", \"Avocado\", \"Mayo\", veggie],\n              instructions: [\"Toast bread\", \"Layer protein and cheese\", \"Add spreads\", \"Pack with veggies\"]\n            }\n          ],\n          dinner: [\n            {\n              name: `${protein} Pasta with Creamy Sauce`,\n              description: `Energy-dense pasta dish with ${protein.toLowerCase()} and rich sauce`,\n              ingredients: [protein, \"Pasta\", \"Heavy cream\", \"Parmesan cheese\", veggie, \"Olive oil\"],\n              instructions: [\"Cook pasta\", \"Prepare protein\", \"Make creamy sauce\", \"Combine and serve\"]\n            },\n            {\n              name: `${protein} and Sweet Potato Bowl`,\n              description: `Hearty bowl with ${protein.toLowerCase()}, roasted sweet potatoes, and tahini`,\n              ingredients: [protein, \"Sweet potato\", \"Chickpeas\", \"Tahini\", \"Olive oil\", veggie],\n              instructions: [\"Roast sweet potato\", \"Cook protein\", \"Drizzle tahini\", \"Serve with veggies\"]\n            }\n          ],\n          snack: [\n            {\n              name: `Trail Mix with ${fruit}`,\n              description: `Calorie-dense snack with nuts, seeds, and dried fruits`,\n              ingredients: [\"Mixed nuts\", \"Dried fruits\", fruit, \"Dark chocolate chips\", \"Granola\"],\n              instructions: [\"Mix all ingredients\", \"Store in container\", \"Enjoy anytime\"]\n            }\n          ]\n        }\n      : {\n          breakfast: [\n            {\n              name: `${protein} and ${fruit} Bowl`,\n              description: `Balanced breakfast with ${protein.toLowerCase()} and fresh ${fruit.toLowerCase()}`,\n              ingredients: [protein, fruit, carb, \"Almond milk\", \"Honey\"],\n              instructions: [\"Prepare base ingredients\", \"Add toppings\", \"Serve fresh\"]\n            },\n            {\n              name: `${fruit} ${carb} Parfait`,\n              description: `Layered breakfast with ${fruit.toLowerCase()} and ${carb.toLowerCase()}`,\n              ingredients: [fruit, carb, protein, \"Nuts\", \"Greek yogurt\"],\n              instructions: [\"Layer ingredients\", \"Add nuts on top\", \"Enjoy immediately\"]\n            }\n          ],\n          lunch: [\n            {\n              name: `${protein} and ${veggie} ${carb} Bowl`,\n              description: `Balanced lunch bowl with ${protein.toLowerCase()}, ${veggie.toLowerCase()}, and ${carb.toLowerCase()}`,\n              ingredients: [protein, veggie, carb, \"Olive oil\", \"Lemon\", \"Herbs\"],\n              instructions: [\"Cook protein and grain\", \"Prepare vegetables\", \"Combine with dressing\"]\n            },\n            {\n              name: `Mediterranean ${protein} Salad`,\n              description: `Fresh Mediterranean salad featuring ${protein.toLowerCase()}`,\n              ingredients: [protein, veggie, \"Mixed greens\", \"Cucumber\", \"Olive oil\", \"Lemon\"],\n              instructions: [\"Prepare protein\", \"Mix salad ingredients\", \"Dress and serve\"]\n            }\n          ],\n          dinner: [\n            {\n              name: `Herb-Crusted ${protein} with ${carb}`,\n              description: `Flavorful dinner featuring ${protein.toLowerCase()} with ${carb.toLowerCase()}`,\n              ingredients: [protein, carb, veggie, \"Herbs\", \"Garlic\", \"Olive oil\"],\n              instructions: [\"Season and cook protein\", \"Prepare grain\", \"Steam vegetables\", \"Combine and serve\"]\n            },\n            {\n              name: `${veggie} and ${protein} Stir-Fry`,\n              description: `Quick and healthy stir-fry with ${veggie.toLowerCase()} and ${protein.toLowerCase()}`,\n              ingredients: [protein, veggie, carb, \"Soy sauce\", \"Ginger\", \"Garlic\"],\n              instructions: [\"Heat pan\", \"Stir-fry ingredients\", \"Season to taste\", \"Serve hot\"]\n            }\n          ],\n          snack: [\n            {\n              name: `${fruit} with Protein`,\n              description: `Simple and nutritious snack`,\n              ingredients: [fruit, protein === \"Greek yogurt\" ? \"Greek yogurt\" : \"Nuts\", \"Honey\"],\n              instructions: [\"Combine ingredients\", \"Enjoy fresh\"]\n            }\n          ]\n        };\n\n    const templates = mealTemplates[mealType as keyof typeof mealTemplates];\n    const template = templates[dayIndex % templates.length];\n\n      // Note: Image URLs will be added later in batch\n    return {\n      mealType: mealType as \"breakfast\" | \"lunch\" | \"dinner\" | \"snack\",\n      name: template.name,\n      description: template.description,\n      calories: mealCalories,\n      protein: mealProtein,\n      carbs: mealCarbs,\n      fat: mealFat,\n      ingredients: template.ingredients,\n      instructions: template.instructions,\n      prepTime: mealType === \"breakfast\" ? 10 : mealType === \"snack\" ? 5 : mealType === \"lunch\" ? 20 : 30,\n      servings: 1,\n      imageUrl: '',\n      ingredientImages: {}\n    };\n  };\n\n  // Generate days with varied meals\n  const days = [];\n  for (let i = 1; i <= duration; i++) {\n    days.push({\n      dayNumber: i,\n      name: `Day ${i}`,\n      meals: [\n        generateMealVariations(\"breakfast\", i - 1),\n        generateMealVariations(\"lunch\", i - 1),\n        generateMealVariations(\"dinner\", i - 1),\n        generateMealVariations(\"snack\", i - 1)\n      ]\n    });\n  }\n\n  // Fetch images for all meals\n  for (const day of days) {\n    for (const meal of day.meals) {\n      // Fetch meal image\n      meal.imageUrl = await getMealImageUrl(meal.mealType, meal.name);\n      \n      // Fetch ingredient images\n      const ingredientImages: Record<string, string> = {};\n      for (const ingredient of meal.ingredients) {\n        ingredientImages[ingredient] = await getIngredientImageUrl(ingredient);\n      }\n      meal.ingredientImages = ingredientImages;\n    }\n  }\n\n  return {\n    name: goalNames[goal],\n    description: goalDescriptions[goal],\n    goal,\n    dailyCalories,\n    dailyProtein,\n    dailyCarbs,\n    dailyFat,\n    duration,\n    days\n  };\n}\n\n// New interface for personalized meal plans with food preferences\ninterface PersonalizedMealPlanParams {\n  goal: string; \n  dailyCalories: number;\n  duration: number;\n  likedFoods: string[];\n  dislikedFoods: string[];\n  userId: string;\n  dietaryRestrictions?: string[];\n  allergies?: string[];\n  preferences?: string[];\n}\n\nexport async function generatePersonalizedMealPlan(params: PersonalizedMealPlanParams | MealPlanGenerationOptions): Promise<GeneratedMealPlan> {\n  // Handle both old and new interface\n  if ('likedFoods' in params) {\n    return generatePersonalizedMealPlanWithFoodPreferences(params as PersonalizedMealPlanParams);\n  }\n  \n  const options = params as MealPlanGenerationOptions;\n  if (!process.env.OPENAI_API_KEY) {\n    console.log(\"OPENAI_API_KEY not configured, using mock meal plan\");\n    return generateMockMealPlan(options);\n  }\n\n  const {\n    goal,\n    dailyCalories,\n    dietaryRestrictions = [],\n    preferences = [],\n    allergies = [],\n    mealsPerDay = 4,\n    duration = 7\n  } = options;\n\n  try {\n    const response = await openai.chat.completions.create({\n      model: \"gpt-5\", // the newest OpenAI model is \"gpt-5\" which was released August 7, 2025. do not change this unless explicitly requested by the user\n      messages: [\n        {\n          role: \"system\",\n          content: `You are a certified nutritionist and meal planning expert. Create personalized meal plans based on user goals and preferences.\n\nKey requirements:\n1. Create balanced meals that meet the daily caloric and macro targets\n2. Ensure meals are practical, affordable, and easy to prepare\n3. Include variety across the week to prevent boredom\n4. Consider dietary restrictions, allergies, and preferences\n5. Provide detailed nutritional breakdowns for each meal\n6. Include clear, step-by-step cooking instructions\n7. Estimate realistic preparation times\n\nRespond with JSON in this exact format:\n{\n  \"name\": \"Descriptive meal plan name based on goal\",\n  \"description\": \"Brief description of the meal plan and its benefits\",\n  \"goal\": \"${goal}\",\n  \"dailyCalories\": ${dailyCalories},\n  \"dailyProtein\": number (grams - target 20-30% of calories),\n  \"dailyCarbs\": number (grams - adjust based on goal),\n  \"dailyFat\": number (grams - 20-35% of calories),\n  \"duration\": ${duration},\n  \"days\": [\n    {\n      \"dayNumber\": 1,\n      \"name\": \"Day 1\",\n      \"meals\": [\n        {\n          \"mealType\": \"breakfast/lunch/dinner/snack\",\n          \"name\": \"Meal name\",\n          \"description\": \"Brief description\",\n          \"calories\": number,\n          \"protein\": number (grams),\n          \"carbs\": number (grams),\n          \"fat\": number (grams),\n          \"ingredients\": [\"ingredient 1\", \"ingredient 2\"],\n          \"instructions\": [\"step 1\", \"step 2\"],\n          \"prepTime\": number (minutes),\n          \"servings\": 1\n        }\n      ]\n    }\n  ]\n}`\n        },\n        {\n          role: \"user\",\n          content: `Create a ${duration}-day meal plan with the following specifications:\n\nGoal: ${goal}\nDaily Calories: ${dailyCalories}\nMeals per day: ${mealsPerDay}\n${dietaryRestrictions.length > 0 ? `Dietary Restrictions: ${dietaryRestrictions.join(', ')}` : ''}\n${allergies.length > 0 ? `Allergies: ${allergies.join(', ')}` : ''}\n${preferences.length > 0 ? `Preferences: ${preferences.join(', ')}` : ''}\n\nGOAL-SPECIFIC GUIDELINES:\n${goal === 'weight_loss' ? `WEIGHT LOSS:\n- Focus on high-volume, low-calorie foods (vegetables, lean proteins)\n- Emphasize foods that promote satiety (high protein, high fiber)\n- Include plenty of leafy greens and non-starchy vegetables\n- Use lean cooking methods (grilling, baking, steaming)\n- Smaller portion sizes with nutrient-dense foods\n- Examples: Grilled chicken salads, vegetable stir-fries, egg white omelets` : ''}\n${goal === 'weight_gain' ? `WEIGHT GAIN:\n- Focus on calorie-dense, nutrient-rich foods\n- Include healthy fats (nuts, avocado, olive oil, nut butters)\n- Emphasize complex carbs and starches (rice, pasta, potatoes, oats)\n- Larger portion sizes with added healthy calories\n- Include smoothies, shakes, and energy-dense snacks\n- Examples: Peanut butter toast, pasta dishes, rice bowls, protein pancakes` : ''}\n${goal === 'maintenance' ? `MAINTENANCE:\n- Balance between all food groups\n- Moderate portions with variety\n- Include a mix of lean proteins, whole grains, healthy fats\n- Focus on sustainable, enjoyable meals` : ''}\n\nIMPORTANT CONSTRAINTS:\n- MUST create distinctly different meals based on the goal (weight loss vs weight gain meals should be VERY different)\n- Include MAXIMUM variety - no repeated meals across the ${duration} days\n- Every day should feature different meals and different ingredients\n- Focus on whole, minimally processed foods\n\nPlease ensure each day's meals total approximately ${dailyCalories} calories and provide a good balance of macronutrients. Make the meals practical for someone with basic cooking skills.`\n        }\n      ],\n      response_format: { type: \"json_object\" },\n      max_completion_tokens: 4000,\n    });\n\n    const result = JSON.parse(response.choices[0].message.content || \"{}\");\n    \n    // Validate the structure\n    if (!result.name || !result.days || !Array.isArray(result.days)) {\n      throw new Error(\"Invalid meal plan structure generated\");\n    }\n\n    // Ensure we have the right number of days\n    if (result.days.length !== duration) {\n      throw new Error(`Expected ${duration} days, got ${result.days.length}`);\n    }\n\n    // Validate each day has meals and add image URLs\n    for (const day of result.days) {\n      if (!day.meals || !Array.isArray(day.meals) || day.meals.length === 0) {\n        throw new Error(`Day ${day.dayNumber} has no meals`);\n      }\n      \n      // Add image URLs to each meal\n      for (const meal of day.meals) {\n        meal.imageUrl = await getMealImageUrl(meal.mealType, meal.name);\n        \n        // Add ingredient images\n        if (meal.ingredients && Array.isArray(meal.ingredients)) {\n          meal.ingredientImages = {};\n          for (const ingredient of meal.ingredients) {\n            meal.ingredientImages[ingredient] = await getIngredientImageUrl(ingredient);\n          }\n        }\n      }\n    }\n\n    return result as GeneratedMealPlan;\n  } catch (error) {\n    console.error(\"Error generating meal plan:\", error);\n    \n    // Fallback to mock data if OpenAI API fails\n    console.log(\"OpenAI API failed, falling back to mock meal plan\");\n    return generateMockMealPlan(options);\n  }\n}\n\nexport async function generateWeeklyMealPlan(\n  userId: string,\n  userPreferences: {\n    goal: \"weight_loss\" | \"weight_gain\" | \"maintenance\";\n    dailyCalories: number;\n    dietaryRestrictions?: string[];\n    preferences?: string[];\n    allergies?: string[];\n  }\n): Promise<GeneratedMealPlan> {\n  const options: MealPlanGenerationOptions = {\n    ...userPreferences,\n    duration: 7,\n    mealsPerDay: 4\n  };\n\n  return generatePersonalizedMealPlan(options);\n}\n\nasync function generatePersonalizedMealPlanWithFoodPreferences(params: PersonalizedMealPlanParams): Promise<GeneratedMealPlan> {\n  const { \n    goal, \n    dailyCalories, \n    duration, \n    likedFoods, \n    dislikedFoods, \n    userId,\n    dietaryRestrictions = [],\n    allergies = [],\n    preferences = []\n  } = params;\n\n  console.log(`Generating personalized meal plan for user ${userId}:`, {\n    goal,\n    dailyCalories,\n    duration,\n    likedFoodsCount: likedFoods.length,\n    dislikedFoodsCount: dislikedFoods.length,\n    dietaryRestrictions,\n    allergies,\n    preferences\n  });\n\n  if (!process.env.OPENAI_API_KEY) {\n    console.log(\"OPENAI_API_KEY not configured, using mock meal plan\");\n    return generateMockMealPlan({\n      goal: goal as any,\n      dailyCalories,\n      duration,\n      preferences: likedFoods,\n      dietaryRestrictions: dislikedFoods.map(food => `Avoid ${food}`)\n    });\n  }\n\n  // Calculate macronutrient targets based on goal\n  const proteinPercentage = goal === \"weight_gain\" ? 0.25 : goal === \"weight_loss\" ? 0.30 : 0.25;\n  const fatPercentage = goal === \"weight_gain\" ? 0.30 : 0.25;\n  const carbPercentage = 1 - proteinPercentage - fatPercentage;\n\n  const dailyProtein = Math.round((dailyCalories * proteinPercentage) / 4); // 4 cal per gram\n  const dailyFat = Math.round((dailyCalories * fatPercentage) / 9); // 9 cal per gram  \n  const dailyCarbs = Math.round((dailyCalories * carbPercentage) / 4); // 4 cal per gram\n\n  const goalDescription = goal === \"weight_loss\" ? \n    \"weight loss with moderate calorie deficit\" : \n    goal === \"weight_gain\" ? \n    \"healthy weight gain with calorie surplus\" : \n    \"weight maintenance and overall health\";\n\n  // Goal-specific meal guidance\n  const goalGuidance = goal === \"weight_loss\" \n    ? `WEIGHT LOSS SPECIFIC GUIDELINES:\n- Focus on high-volume, low-calorie foods (vegetables, lean proteins)\n- Emphasize foods that promote satiety (high protein, high fiber)\n- Include plenty of leafy greens and non-starchy vegetables\n- Use lean cooking methods (grilling, baking, steaming)\n- Smaller portion sizes with nutrient-dense foods\n- Examples: Grilled chicken salads, vegetable stir-fries, egg white omelets, Greek yogurt bowls`\n    : goal === \"weight_gain\"\n    ? `WEIGHT GAIN SPECIFIC GUIDELINES:\n- Focus on calorie-dense, nutrient-rich foods\n- Include healthy fats (nuts, avocado, olive oil, nut butters)\n- Emphasize complex carbs and starches (rice, pasta, potatoes, oats)\n- Larger portion sizes with added healthy calories\n- Include smoothies, shakes, and energy-dense snacks\n- Examples: Peanut butter toast, pasta dishes, rice bowls, protein pancakes, trail mix, smoothie bowls`\n    : `MAINTENANCE SPECIFIC GUIDELINES:\n- Balance between all food groups\n- Moderate portions with variety\n- Include a mix of lean proteins, whole grains, healthy fats\n- Focus on sustainable, enjoyable meals\n- Examples: Balanced grain bowls, mixed protein sources, variety of vegetables`;\n\n  const prompt = `Create a ${duration}-day personalized meal plan for ${goalDescription}.\n\nREQUIREMENTS:\n- Daily calories: ${dailyCalories}\n- Daily protein: ${dailyProtein}g\n- Daily carbs: ${dailyCarbs}g  \n- Daily fat: ${dailyFat}g\n- 4 meals per day: breakfast, lunch, dinner, snack\n\n${goalGuidance}\n\nFOOD PREFERENCES:\nPreferred foods (use these heavily): ${likedFoods.length > 0 ? likedFoods.join(\", \") : \"No specific preferences\"}\nFoods to avoid: ${dislikedFoods.length > 0 ? dislikedFoods.join(\", \") : \"None\"}\n${dietaryRestrictions.length > 0 ? `Dietary restrictions: ${dietaryRestrictions.join(\", \")}` : \"\"}\n${allergies.length > 0 ? `Allergies (MUST avoid): ${allergies.join(\", \")}` : \"\"}\n${preferences.length > 0 ? `General preferences: ${preferences.join(\", \")}` : \"\"}\n\nIMPORTANT CONSTRAINTS:\n- MUST create distinctly different meals based on the goal (weight loss vs weight gain meals should be VERY different)\n- Focus on whole, minimally processed foods\n- Include MAXIMUM variety - no repeated meals across the ${duration} days\n- Ensure adequate micronutrient coverage\n- Make meals practical and realistic\n- Each meal should have clear portions and instructions\n- Every day should feature different meals and different ingredients\n\nRespond with JSON in this exact format:\n{\n  \"name\": \"string\",\n  \"description\": \"string\", \n  \"goal\": \"${goal}\",\n  \"dailyCalories\": ${dailyCalories},\n  \"dailyProtein\": ${dailyProtein},\n  \"dailyCarbs\": ${dailyCarbs},\n  \"dailyFat\": ${dailyFat},\n  \"duration\": ${duration},\n  \"days\": [\n    {\n      \"dayNumber\": 1,\n      \"name\": \"Day 1\",\n      \"meals\": [\n        {\n          \"mealType\": \"breakfast\",\n          \"name\": \"string\",\n          \"description\": \"string\",\n          \"calories\": number,\n          \"protein\": number,\n          \"carbs\": number, \n          \"fat\": number,\n          \"ingredients\": [\"string\"],\n          \"instructions\": [\"string\"],\n          \"prepTime\": number,\n          \"servings\": 1\n        }\n      ]\n    }\n  ]\n}`;\n\n  try {\n    const response = await openai.chat.completions.create({\n      model: \"gpt-5\", // the newest OpenAI model is \"gpt-5\" which was released August 7, 2025. do not change this unless explicitly requested by the user\n      messages: [\n        {\n          role: \"system\",\n          content: \"You are a professional nutritionist and meal planning expert. Create detailed, nutritionally balanced meal plans based on user preferences and goals. Always respond with valid JSON only.\"\n        },\n        {\n          role: \"user\",\n          content: prompt\n        }\n      ],\n      response_format: { type: \"json_object\" },\n      temperature: 0.7,\n      max_completion_tokens: 4000\n    });\n\n    const content = response.choices[0].message.content;\n    if (!content) {\n      throw new Error(\"No content received from AI\");\n    }\n    \n    const generatedPlan = JSON.parse(content);\n    \n    // Validate the response structure\n    if (!generatedPlan.name || !generatedPlan.days || !Array.isArray(generatedPlan.days)) {\n      throw new Error(\"Invalid meal plan structure received from AI\");\n    }\n\n    // Ensure each day has the required meal types and add image URLs\n    for (let dayIndex = 0; dayIndex < generatedPlan.days.length; dayIndex++) {\n      const day = generatedPlan.days[dayIndex];\n      \n      if (!day.meals || !Array.isArray(day.meals)) {\n        throw new Error(`Day ${dayIndex + 1} is missing meals array`);\n      }\n      \n      const mealTypes = day.meals.map((meal: any) => meal.mealType);\n      const requiredTypes = [\"breakfast\", \"lunch\", \"dinner\", \"snack\"];\n      \n      requiredTypes.forEach(type => {\n        if (!mealTypes.includes(type)) {\n          console.warn(`Day ${dayIndex + 1} is missing ${type} meal`);\n        }\n      });\n      \n      // Add image URLs to each meal\n      for (const meal of day.meals) {\n        meal.imageUrl = await getMealImageUrl(meal.mealType, meal.name);\n        \n        // Add ingredient images\n        if (meal.ingredients && Array.isArray(meal.ingredients)) {\n          meal.ingredientImages = {};\n          for (const ingredient of meal.ingredients) {\n            meal.ingredientImages[ingredient] = await getIngredientImageUrl(ingredient);\n          }\n        }\n      }\n    }\n\n    console.log(`Successfully generated ${duration}-day meal plan: \"${generatedPlan.name}\"`);\n    return generatedPlan as GeneratedMealPlan;\n\n  } catch (error: any) {\n    console.error(\"Error generating personalized meal plan:\", error);\n    \n    if (error.message?.includes(\"API key\")) {\n      throw new Error(\"OpenAI API key is not configured. Please set OPENAI_API_KEY environment variable.\");\n    }\n    \n    if (error.message?.includes(\"JSON\")) {\n      throw new Error(\"Failed to parse AI response. Please try again.\");\n    }\n    \n    throw new Error(`Failed to generate meal plan: ${error.message}`);\n  }\n}","size_bytes":33959},"server/auto-difficulty-adjuster.ts":{"content":"import { storage } from \"./storage\";\nimport { aiDifficultyService } from \"./ai-difficulty-service\";\nimport type { User, Exercise } from \"../shared/schema\";\n\nexport interface AutoAdjustmentResult {\n  userId: string;\n  exerciseId: string;\n  currentDifficulty: number;\n  suggestedDifficulty: number;\n  adjustmentReason: string;\n  confidence: number;\n  shouldNotify: boolean;\n}\n\nexport class AutoDifficultyAdjuster {\n  /**\n   * Analyzes all users and their workout patterns to suggest difficulty adjustments\n   */\n  async processAllUsers(): Promise<AutoAdjustmentResult[]> {\n    const users = await storage.getUsers();\n    const adjustmentResults: AutoAdjustmentResult[] = [];\n\n    for (const user of users) {\n      const userAdjustments = await this.processUserAdjustments(user.id);\n      adjustmentResults.push(...userAdjustments);\n    }\n\n    return adjustmentResults;\n  }\n\n  /**\n   * Processes difficulty adjustments for a specific user\n   */\n  async processUserAdjustments(userId: string): Promise<AutoAdjustmentResult[]> {\n    try {\n      // Get user's recent workouts to identify exercises they've been doing\n      const recentWorkouts = await storage.getWorkouts(userId);\n      \n      if (recentWorkouts.length === 0) {\n        return [];\n      }\n\n      // Get unique exercises from recent workouts\n      const uniqueExerciseIds = new Set<string>();\n      \n      // Get workout exercises for each recent workout to find unique exercises\n      for (const workout of recentWorkouts.slice(0, 10)) { // Last 10 workouts\n        const workoutExercises = await storage.getWorkoutExercises(workout.id);\n        workoutExercises.forEach(we => uniqueExerciseIds.add(we.exerciseId));\n      }\n\n      const adjustmentResults: AutoAdjustmentResult[] = [];\n\n      // Analyze each exercise for potential difficulty adjustments\n      for (const exerciseId of uniqueExerciseIds) {\n        const analysis = await aiDifficultyService.analyzePerformanceAndSuggestDifficulty(\n          userId,\n          exerciseId\n        );\n\n        if (analysis && this.shouldSuggestAdjustment(analysis)) {\n          const exercise = await storage.getExercise(exerciseId);\n          \n          adjustmentResults.push({\n            userId,\n            exerciseId,\n            currentDifficulty: analysis.currentDifficulty,\n            suggestedDifficulty: analysis.suggestedDifficulty,\n            adjustmentReason: this.generateAdjustmentReason(analysis),\n            confidence: analysis.confidenceScore,\n            shouldNotify: analysis.confidenceScore >= 70, // Only notify for high-confidence suggestions\n          });\n        }\n      }\n\n      return adjustmentResults;\n    } catch (error) {\n      console.error(`Error processing user adjustments for ${userId}:`, error);\n      return [];\n    }\n  }\n\n  /**\n   * Determines if an adjustment should be suggested based on AI analysis\n   */\n  private shouldSuggestAdjustment(analysis: any): boolean {\n    // Don't suggest if confidence is too low\n    if (analysis.confidenceScore < 50) return false;\n\n    // Don't suggest if the change is minimal\n    const difficultyChange = Math.abs(analysis.suggestedDifficulty - analysis.currentDifficulty);\n    if (difficultyChange < 0.5) return false;\n\n    // Don't suggest extreme changes\n    if (difficultyChange > 2) return false;\n\n    // Additional logic based on performance trends\n    if (analysis.performanceTrend === \"declining\" && analysis.suggestedDifficulty > analysis.currentDifficulty) {\n      // Don't increase difficulty if performance is declining unless confidence is very high\n      return analysis.confidenceScore >= 80;\n    }\n\n    return true;\n  }\n\n  /**\n   * Generates a human-readable reason for the difficulty adjustment\n   */\n  private generateAdjustmentReason(analysis: any): string {\n    const { performanceTrend, currentDifficulty, suggestedDifficulty, reasoningFactors } = analysis;\n    const isIncrease = suggestedDifficulty > currentDifficulty;\n    \n    if (performanceTrend === \"improving\") {\n      if (isIncrease) {\n        return `Your performance has been consistently improving! Time to challenge yourself with a higher difficulty.`;\n      } else {\n        return `You're improving steadily. Consider maintaining current difficulty for better consistency.`;\n      }\n    } else if (performanceTrend === \"declining\") {\n      if (!isIncrease) {\n        return `Recent workouts show some struggle. Let's dial back the difficulty to rebuild confidence and form.`;\n      } else {\n        return `Despite some challenges, your overall trend shows readiness for progression.`;\n      }\n    } else {\n      // Stable performance\n      if (isIncrease) {\n        return `Your performance is stable and consistent. Ready to take on a new challenge!`;\n      } else {\n        return `Let's optimize your current level before progressing to maintain quality workouts.`;\n      }\n    }\n  }\n\n  /**\n   * Applies automatic difficulty adjustments for a user (with their consent)\n   */\n  async applyAutomaticAdjustments(userId: string, exerciseIds: string[]): Promise<boolean[]> {\n    const results: boolean[] = [];\n\n    for (const exerciseId of exerciseIds) {\n      try {\n        // Get pending adjustments for this user and exercise\n        const pendingAdjustments = await aiDifficultyService.getPendingAdjustments(userId);\n        const relevantAdjustment = pendingAdjustments.find(adj => adj.exerciseId === exerciseId);\n\n        if (relevantAdjustment) {\n          const applied = await aiDifficultyService.applyDifficultyAdjustment(relevantAdjustment.id);\n          results.push(applied);\n        } else {\n          results.push(false);\n        }\n      } catch (error) {\n        console.error(`Error applying adjustment for exercise ${exerciseId}:`, error);\n        results.push(false);\n      }\n    }\n\n    return results;\n  }\n\n  /**\n   * Gets intelligent workout recommendations based on user's performance patterns\n   */\n  async getIntelligentRecommendations(userId: string): Promise<{\n    exercises: Array<{\n      exerciseId: string;\n      exerciseName: string;\n      recommendedDifficulty: number;\n      reason: string;\n      confidence: number;\n    }>;\n    overallRecommendation: string;\n  }> {\n    try {\n      const adjustments = await this.processUserAdjustments(userId);\n      const exercises = [];\n\n      for (const adjustment of adjustments) {\n        const exercise = await storage.getExercise(adjustment.exerciseId);\n        if (exercise) {\n          exercises.push({\n            exerciseId: adjustment.exerciseId,\n            exerciseName: exercise.name,\n            recommendedDifficulty: adjustment.suggestedDifficulty,\n            reason: adjustment.adjustmentReason,\n            confidence: adjustment.confidence,\n          });\n        }\n      }\n\n      // Generate overall recommendation\n      let overallRecommendation = \"Keep up the great work! \";\n      \n      const increasingCount = adjustments.filter(a => a.suggestedDifficulty > a.currentDifficulty).length;\n      const decreasingCount = adjustments.filter(a => a.suggestedDifficulty < a.currentDifficulty).length;\n      \n      if (increasingCount > decreasingCount) {\n        overallRecommendation += \"You're ready to challenge yourself with higher difficulty levels across multiple exercises.\";\n      } else if (decreasingCount > increasingCount) {\n        overallRecommendation += \"Focus on form and consistency. Consider reducing difficulty to build a strong foundation.\";\n      } else {\n        overallRecommendation += \"Your training is well-balanced. Make selective adjustments based on individual exercise performance.\";\n      }\n\n      return {\n        exercises: exercises.slice(0, 5), // Limit to top 5 recommendations\n        overallRecommendation,\n      };\n    } catch (error) {\n      console.error(`Error generating recommendations for user ${userId}:`, error);\n      return {\n        exercises: [],\n        overallRecommendation: \"Unable to generate recommendations at this time. Please try again later.\",\n      };\n    }\n  }\n\n  /**\n   * Runs the daily auto-adjustment process for all users\n   */\n  async runDailyAdjustmentProcess(): Promise<{\n    processed: number;\n    adjustmentsSuggested: number;\n    highConfidenceAdjustments: number;\n  }> {\n    console.log(\"Starting daily auto-adjustment process...\");\n    \n    const allAdjustments = await this.processAllUsers();\n    const highConfidenceAdjustments = allAdjustments.filter(adj => adj.shouldNotify);\n    \n    console.log(`Processed ${allAdjustments.length} potential adjustments`);\n    console.log(`${highConfidenceAdjustments.length} high-confidence adjustments ready for notification`);\n\n    return {\n      processed: allAdjustments.length,\n      adjustmentsSuggested: allAdjustments.length,\n      highConfidenceAdjustments: highConfidenceAdjustments.length,\n    };\n  }\n}\n\nexport const autoDifficultyAdjuster = new AutoDifficultyAdjuster();","size_bytes":8859},"client/src/components/premium-badge.tsx":{"content":"import { Crown, Sparkles } from \"lucide-react\";\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Link } from \"wouter\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport type { User } from \"@shared/schema\";\n\nexport default function PremiumBadge() {\n  const { data: user } = useQuery<User>({\n    queryKey: [\"/api/auth/user\"],\n  });\n\n  const isPremium = user?.subscriptionStatus === \"active\";\n\n  if (isPremium) {\n    return (\n      <div className=\"inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors bg-gradient-to-r from-yellow-400 to-orange-500 text-white border-none hover:from-yellow-500 hover:to-orange-600\" data-testid=\"premium-badge\">\n        <Crown className=\"w-3 h-3 mr-1\" />\n        Premium\n      </div>\n    );\n  }\n\n  return (\n    <Button\n      asChild\n      className=\"bg-gradient-to-r from-purple-600 to-blue-600 hover:from-purple-700 hover:to-blue-700 text-white border-none shadow-sm px-2 py-1 h-auto text-xs\"\n      data-testid=\"upgrade-button\"\n    >\n      <Link href=\"/subscription\">\n        <Sparkles className=\"w-3 h-3 mr-1\" />\n        Upgrade\n      </Link>\n    </Button>\n  );\n}","size_bytes":1202},"vite.config.ts":{"content":"import { defineConfig } from \"vite\";\nimport react from \"@vitejs/plugin-react\";\nimport path from \"path\";\nimport runtimeErrorOverlay from \"@replit/vite-plugin-runtime-error-modal\";\n\nexport default defineConfig({\n  plugins: [\n    react(),\n    runtimeErrorOverlay(),\n    ...(process.env.NODE_ENV !== \"production\" &&\n    process.env.REPL_ID !== undefined\n      ? [\n          await import(\"@replit/vite-plugin-cartographer\").then((m) =>\n            m.cartographer(),\n          ),\n        ]\n      : []),\n  ],\n  resolve: {\n    alias: {\n      \"@\": path.resolve(import.meta.dirname, \"client\", \"src\"),\n      \"@shared\": path.resolve(import.meta.dirname, \"shared\"),\n      \"@assets\": path.resolve(import.meta.dirname, \"attached_assets\"),\n    },\n  },\n  root: path.resolve(import.meta.dirname, \"client\"),\n  build: {\n    outDir: path.resolve(import.meta.dirname, \"dist/public\"),\n    emptyOutDir: true,\n  },\n  server: {\n    fs: {\n      strict: true,\n      deny: [\"**/.*\"],\n    },\n  },\n});\n","size_bytes":971},"client/src/pages/meal-tracker.tsx":{"content":"import { useState, useRef } from \"react\";\nimport { useMutation, useQuery, useQueryClient } from \"@tanstack/react-query\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport { Label } from \"@/components/ui/label\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Table, TableBody, TableCell, TableHead, TableHeader, TableRow } from \"@/components/ui/table\";\nimport { Input } from \"@/components/ui/input\";\nimport { Loader2, Apple, Calendar, TrendingUp, ScanLine, Trash2 } from \"lucide-react\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport FeatureGate from \"@/components/feature-gate\";\nimport type { MealEntry, InsertMealEntry } from \"@shared/schema\";\nimport BarcodeScanner from \"@/components/barcode-scanner\";\nimport { PageMedicalDisclaimer, AIGeneratedDisclaimer } from \"@/components/medical-disclaimer\";\nimport { HealthSources } from \"@/components/health-sources\";\n\ninterface NutritionalAnalysis {\n  mealName: string;\n  description: string;\n  totalCalories: number;\n  protein: number;\n  carbs: number;\n  fat: number;\n  fiber: number;\n  sugar: number;\n  sodium: number;\n  confidence: number;\n}\n\ninterface BarcodeFormData {\n  mealType: string;\n  customDescription: string;\n}\n\nexport default function MealTrackerPage() {\n  const [barcodeForm, setBarcodeForm] = useState<BarcodeFormData>({\n    mealType: \"\",\n    customDescription: \"\"\n  });\n  const [selectedDate, setSelectedDate] = useState(new Date().toISOString().split('T')[0]);\n  const [analysisResult, setAnalysisResult] = useState<NutritionalAnalysis | null>(null);\n  const [isScannerOpen, setIsScannerOpen] = useState(false);\n  const [editingMealName, setEditingMealName] = useState<string>(\"\");\n  \n  const lastBarcodeRef = useRef<string | null>(null);\n  const barcodeTimeoutRef = useRef<NodeJS.Timeout | null>(null);\n  const { toast } = useToast();\n  const queryClient = useQueryClient();\n\n  // Get meal entries for selected date\n  const { data: mealEntries = [], isLoading: entriesLoading } = useQuery<MealEntry[]>({\n    queryKey: [\"/api/meal-entries\", selectedDate],\n    queryFn: async () => {\n      const response = await apiRequest(\"GET\", `/api/meal-entries?date=${selectedDate}`);\n      return response.json();\n    }\n  });\n\n  // Get weekly meal entries (last 7 days)\n  const getWeekDates = () => {\n    const dates = [];\n    for (let i = 6; i >= 0; i--) {\n      const date = new Date();\n      date.setDate(date.getDate() - i);\n      dates.push(date.toISOString().split('T')[0]);\n    }\n    return dates;\n  };\n\n  const weekDates = getWeekDates();\n  const { data: weeklyEntries = [] } = useQuery<MealEntry[]>({\n    queryKey: [\"/api/meal-entries\", \"weekly\", weekDates[0]],\n    queryFn: async () => {\n      const allEntries: MealEntry[] = [];\n      for (const date of weekDates) {\n        const response = await apiRequest(\"GET\", `/api/meal-entries?date=${date}`);\n        const entries = await response.json();\n        allEntries.push(...entries);\n      }\n      return allEntries;\n    }\n  });\n\n\n  // Barcode lookup mutation\n  const barcodeLookupMutation = useMutation({\n    mutationFn: async (barcode: string) => {\n      const response = await apiRequest(\"POST\", \"/api/meal-entries/barcode-lookup\", { barcode });\n      return response.json();\n    },\n    onSuccess: (data) => {\n      if (data.success && data.product) {\n        const nutritionData: NutritionalAnalysis = {\n          mealName: data.product.name,\n          description: `${data.product.brand} - ${data.product.servingSize}`,\n          totalCalories: data.product.calories,\n          protein: data.product.protein,\n          carbs: data.product.carbs,\n          fat: data.product.fat,\n          fiber: data.product.fiber,\n          sugar: data.product.sugar,\n          sodium: data.product.sodium,\n          confidence: 0.95 // High confidence for barcode lookup\n        };\n        setAnalysisResult(nutritionData);\n        setEditingMealName(nutritionData.mealName);\n        toast({\n          title: \"Barcode Found! 📊\",\n          description: `${data.product.name} - ${data.product.calories} calories`,\n        });\n      } else {\n        toast({\n          title: \"Barcode Not Found\",\n          description: \"This barcode is not in our database. Try manual entry instead.\",\n          variant: \"destructive\",\n        });\n      }\n    },\n    onError: (error: any) => {\n      if (error?.status === 401) {\n        toast({\n          title: \"Authentication Required\",\n          description: \"Please log in to use the barcode scanner.\",\n          variant: \"destructive\",\n        });\n      } else {\n        toast({\n          title: \"Scanner Error\",\n          description: \"Could not lookup barcode. Please try again.\",\n          variant: \"destructive\",\n        });\n      }\n    }\n  });\n\n  // Save meal entry mutation\n  const saveMutation = useMutation({\n    mutationFn: async (mealData: InsertMealEntry) => {\n      const response = await apiRequest(\"POST\", \"/api/meal-entries\", mealData);\n      return response.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/meal-entries\"] });\n      setAnalysisResult(null);\n      setBarcodeForm({ mealType: \"\", customDescription: \"\" });\n      toast({\n        title: \"Meal Saved! ✅\",\n        description: \"Your meal has been added to your diary.\",\n      });\n    }\n  });\n\n  // Delete meal entry mutation\n  const deleteMutation = useMutation({\n    mutationFn: async (mealId: string) => {\n      const response = await apiRequest(\"DELETE\", `/api/meal-entries/${mealId}`);\n      return response.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/meal-entries\"] });\n      toast({\n        title: \"Meal Deleted! 🗑️\",\n        description: \"The meal entry has been removed from your diary.\",\n      });\n    },\n    onError: () => {\n      toast({\n        title: \"Error\",\n        description: \"Failed to delete meal entry. Please try again.\",\n        variant: \"destructive\",\n      });\n    }\n  });\n\n\n  const handleBarcodeScanned = (barcode: string) => {\n    setIsScannerOpen(false);\n    \n    // Prevent spam by checking for duplicate barcodes within a short time window\n    if (lastBarcodeRef.current === barcode) {\n      return;\n    }\n    \n    // Clear any pending timeout and set a new one\n    if (barcodeTimeoutRef.current) {\n      clearTimeout(barcodeTimeoutRef.current);\n    }\n    \n    lastBarcodeRef.current = barcode;\n    \n    // Reset after 3 seconds to allow scanning the same barcode again later\n    barcodeTimeoutRef.current = setTimeout(() => {\n      lastBarcodeRef.current = null;\n    }, 3000);\n    \n    barcodeLookupMutation.mutate(barcode);\n  };\n\n  const handleSaveMeal = () => {\n    if (!analysisResult) return;\n\n    const mealData: InsertMealEntry = {\n      userId: \"current-user\", // Will be set by backend auth\n      mealType: barcodeForm.mealType,\n      mealName: editingMealName || analysisResult.mealName,\n      description: analysisResult.description || barcodeForm.customDescription,\n      imageUrl: null,\n      totalCalories: analysisResult.totalCalories,\n      protein: analysisResult.protein.toString(),\n      carbs: analysisResult.carbs.toString(),\n      fat: analysisResult.fat.toString(),\n      fiber: analysisResult.fiber.toString(),\n      sugar: analysisResult.sugar.toString(),\n      sodium: analysisResult.sodium.toString(),\n      confidence: analysisResult.confidence.toString(),\n      analysisRaw: JSON.stringify(analysisResult),\n      loggedAt: new Date()\n    };\n\n    saveMutation.mutate(mealData);\n  };\n\n  const getTotalNutrition = () => {\n    return mealEntries.reduce((totals, entry) => ({\n      calories: totals.calories + entry.totalCalories,\n      protein: totals.protein + parseFloat(entry.protein),\n      carbs: totals.carbs + parseFloat(entry.carbs),\n      fat: totals.fat + parseFloat(entry.fat)\n    }), { calories: 0, protein: 0, carbs: 0, fat: 0 });\n  };\n\n  const getMealsByType = (type: string) => {\n    return mealEntries.filter(meal => meal.mealType === type);\n  };\n\n  return (\n    <FeatureGate feature=\"meal_tracker\">\n      <div className=\"min-h-screen bg-gradient-to-br from-black via-gray-900 to-red-950\">\n      <div className=\"container mx-auto px-4 py-8 space-y-8\">\n        <div className=\"text-center space-y-4\">\n          <h1 className=\"text-4xl font-bold text-white flex items-center justify-center gap-3\">\n            <div className=\"p-2 bg-gradient-to-r from-red-600 to-red-800 rounded-lg shadow-lg\">\n              <ScanLine className=\"w-8 h-8 text-white\" />\n            </div>\n            Professional Barcode Scanner\n          </h1>\n          <p className=\"text-gray-300 max-w-2xl mx-auto text-lg\">\n            Advanced barcode scanning technology for precise nutritional tracking and professional meal management.\n          </p>\n        </div>\n\n        <PageMedicalDisclaimer type=\"nutrition\" />\n        <AIGeneratedDisclaimer />\n\n        <Tabs defaultValue=\"scan\" className=\"w-full\">\n          <TabsList className=\"grid w-full grid-cols-3 bg-black/50 border border-red-800/30\">\n            <TabsTrigger value=\"scan\" className=\"data-[state=active]:bg-red-600 data-[state=active]:text-white text-gray-300 hover:text-white transition-colors\">\n              <ScanLine className=\"w-4 h-4 mr-2\" />\n              Scan Barcode\n            </TabsTrigger>\n            <TabsTrigger value=\"history\" className=\"data-[state=active]:bg-red-600 data-[state=active]:text-white text-gray-300 hover:text-white transition-colors\">\n              <Calendar className=\"w-4 h-4 mr-2\" />\n              Daily View\n            </TabsTrigger>\n            <TabsTrigger value=\"weekly\" className=\"data-[state=active]:bg-red-600 data-[state=active]:text-white text-gray-300 hover:text-white transition-colors\">\n              <TrendingUp className=\"w-4 h-4 mr-2\" />\n              Weekly View\n            </TabsTrigger>\n          </TabsList>\n\n          <TabsContent value=\"scan\" className=\"space-y-6\">\n            <Card className=\"bg-black/80 border-red-800/30 shadow-2xl\">\n              <CardHeader className=\"border-b border-red-800/20\">\n                <CardTitle className=\"flex items-center gap-2 text-white\">\n                  <div className=\"p-1 bg-red-600 rounded\">\n                    <ScanLine className=\"w-5 h-5 text-white\" />\n                  </div>\n                  Professional Barcode Scanner\n                </CardTitle>\n                <CardDescription className=\"text-gray-300\">\n                  Advanced scanning technology for instant, accurate nutritional analysis\n                </CardDescription>\n              </CardHeader>\n              <CardContent className=\"space-y-6 p-6\">\n                {/* Meal Type Selection */}\n                <div className=\"space-y-3\">\n                  <Label htmlFor=\"meal-type\" className=\"text-white font-semibold\">Meal Category</Label>\n                  <Select \n                    value={barcodeForm.mealType} \n                    onValueChange={(value) => setBarcodeForm(prev => ({ ...prev, mealType: value }))}\n                  >\n                    <SelectTrigger data-testid=\"select-meal-type\" className=\"bg-gray-900 border-red-800/30 text-white hover:border-red-600 focus:border-red-500\">\n                      <SelectValue placeholder=\"Select meal category\" className=\"text-gray-400\" />\n                    </SelectTrigger>\n                    <SelectContent className=\"bg-gray-900 border-red-800/30\">\n                      <SelectItem value=\"breakfast\" className=\"text-white hover:bg-red-900/50\">🌅 Breakfast</SelectItem>\n                      <SelectItem value=\"lunch\" className=\"text-white hover:bg-red-900/50\">☀️ Lunch</SelectItem>\n                      <SelectItem value=\"dinner\" className=\"text-white hover:bg-red-900/50\">🌙 Dinner</SelectItem>\n                      <SelectItem value=\"snack\" className=\"text-white hover:bg-red-900/50\">🍎 Snack</SelectItem>\n                    </SelectContent>\n                  </Select>\n                </div>\n\n                {/* Barcode Scanner */}\n                <div className=\"border-2 border-dashed rounded-xl p-8 text-center border-red-600/40 bg-gradient-to-br from-red-950/20 to-black/20\">\n                  <div className=\"space-y-6\">\n                    <div className=\"relative\">\n                      <div className=\"mx-auto h-16 w-16 bg-gradient-to-r from-red-600 to-red-800 rounded-full flex items-center justify-center shadow-lg\">\n                        <ScanLine className=\"h-8 w-8 text-white animate-pulse\" />\n                      </div>\n                      <div className=\"absolute -top-2 -right-2 w-6 h-6 bg-red-500 rounded-full animate-ping opacity-75\"></div>\n                    </div>\n                    <div>\n                      <p className=\"text-xl font-bold text-white mb-2\">Professional Barcode Scanner</p>\n                      <p className=\"text-gray-300\">Advanced camera technology for instant product identification</p>\n                    </div>\n                    <Button \n                      onClick={() => setIsScannerOpen(true)}\n                      data-testid=\"button-scan-barcode\"\n                      className=\"bg-gradient-to-r from-red-600 to-red-700 hover:from-red-700 hover:to-red-800 text-white font-semibold px-8 py-3 rounded-lg shadow-lg transform hover:scale-105 transition-all duration-200 flex items-center gap-3\"\n                      disabled={!barcodeForm.mealType}\n                    >\n                      <ScanLine className=\"w-5 h-5\" />\n                      {barcodeForm.mealType ? \"Launch Scanner\" : \"Select meal category first\"}\n                    </Button>\n                  </div>\n                </div>\n\n                {/* Custom Description */}\n                <div className=\"space-y-3\">\n                  <Label htmlFor=\"description\" className=\"text-white font-semibold\">Additional Notes (Optional)</Label>\n                  <Input\n                    id=\"description\"\n                    placeholder=\"Add preparation details, portion adjustments, or special notes...\"\n                    value={barcodeForm.customDescription}\n                    onChange={(e) => setBarcodeForm(prev => ({ ...prev, customDescription: e.target.value }))}\n                    data-testid=\"input-meal-description\"\n                    className=\"bg-gray-900 border-red-800/30 text-white placeholder:text-gray-500 hover:border-red-600 focus:border-red-500\"\n                  />\n                </div>\n            </CardContent>\n          </Card>\n\n            {/* Analysis Results */}\n            {analysisResult && (\n              <Card data-testid=\"card-analysis-results\" className=\"bg-black/90 border-red-600/50 shadow-2xl\">\n                <CardHeader className=\"border-b border-red-800/30\">\n                  <CardTitle className=\"flex items-center justify-between text-white\">\n                    <span className=\"flex items-center gap-2\">\n                      <div className=\"p-1 bg-green-600 rounded\">\n                        <TrendingUp className=\"w-4 h-4 text-white\" />\n                      </div>\n                      Nutritional Analysis\n                    </span>\n                    <Badge className=\"bg-red-600 text-white hover:bg-red-700\">\n                      {Math.round(analysisResult.confidence * 100)}% confidence\n                    </Badge>\n                  </CardTitle>\n                  <CardDescription className=\"text-gray-300\">{analysisResult.description}</CardDescription>\n                </CardHeader>\n                <CardContent className=\"space-y-6 p-6\">\n                  {/* Food Name Edit Section */}\n                  <div className=\"space-y-3\">\n                    <Label htmlFor=\"meal-name-edit\" className=\"text-white font-semibold\">Product Name</Label>\n                    <Input\n                      id=\"meal-name-edit\"\n                      value={editingMealName}\n                      onChange={(e) => setEditingMealName(e.target.value)}\n                      placeholder=\"Enter product name\"\n                      data-testid=\"input-meal-name-edit\"\n                      className=\"font-medium bg-gray-900 border-red-800/30 text-white hover:border-red-600 focus:border-red-500\"\n                    />\n                    <p className=\"text-sm text-gray-400\">\n                      Customize the product name before saving to your diary\n                    </p>\n                  </div>\n\n                  <div className=\"grid gap-6 md:grid-cols-2\">\n                    <div className=\"bg-gray-900/50 rounded-lg p-4 border border-red-800/20\">\n                      <h3 className=\"font-semibold mb-4 text-white flex items-center gap-2\">\n                        <div className=\"w-2 h-2 bg-red-500 rounded-full\"></div>\n                        Macronutrients\n                      </h3>\n                      <Table>\n                        <TableHeader>\n                          <TableRow className=\"border-red-800/20\">\n                            <TableHead className=\"text-gray-300\">Nutrient</TableHead>\n                            <TableHead className=\"text-gray-300\">Amount</TableHead>\n                          </TableRow>\n                        </TableHeader>\n                        <TableBody>\n                          <TableRow className=\"border-red-800/10\">\n                            <TableCell className=\"text-gray-300\">Calories</TableCell>\n                            <TableCell className=\"font-medium text-red-400\">{analysisResult.totalCalories} kcal</TableCell>\n                          </TableRow>\n                          <TableRow className=\"border-red-800/10\">\n                            <TableCell className=\"text-gray-300\">Protein</TableCell>\n                            <TableCell className=\"text-white\">{analysisResult.protein}g</TableCell>\n                          </TableRow>\n                          <TableRow className=\"border-red-800/10\">\n                            <TableCell className=\"text-gray-300\">Carbohydrates</TableCell>\n                            <TableCell className=\"text-white\">{analysisResult.carbs}g</TableCell>\n                          </TableRow>\n                          <TableRow className=\"border-red-800/10\">\n                            <TableCell className=\"text-gray-300\">Fat</TableCell>\n                            <TableCell className=\"text-white\">{analysisResult.fat}g</TableCell>\n                          </TableRow>\n                        </TableBody>\n                      </Table>\n                    </div>\n\n                    <div className=\"bg-gray-900/50 rounded-lg p-4 border border-red-800/20\">\n                      <h3 className=\"font-semibold mb-4 text-white flex items-center gap-2\">\n                        <div className=\"w-2 h-2 bg-red-500 rounded-full\"></div>\n                        Additional Details\n                      </h3>\n                      <Table>\n                        <TableBody>\n                          <TableRow className=\"border-red-800/10\">\n                            <TableCell className=\"text-gray-300\">Fiber</TableCell>\n                            <TableCell className=\"text-white\">{analysisResult.fiber}g</TableCell>\n                          </TableRow>\n                          <TableRow className=\"border-red-800/10\">\n                            <TableCell className=\"text-gray-300\">Sugar</TableCell>\n                            <TableCell className=\"text-white\">{analysisResult.sugar}g</TableCell>\n                          </TableRow>\n                          <TableRow className=\"border-red-800/10\">\n                            <TableCell className=\"text-gray-300\">Sodium</TableCell>\n                            <TableCell className=\"text-white\">{analysisResult.sodium}mg</TableCell>\n                          </TableRow>\n                        </TableBody>\n                      </Table>\n                    </div>\n                  </div>\n\n                  <Button\n                    onClick={handleSaveMeal}\n                    disabled={saveMutation.isPending}\n                    className=\"w-full bg-gradient-to-r from-red-600 to-red-700 hover:from-red-700 hover:to-red-800 text-white font-semibold py-3 rounded-lg shadow-lg transform hover:scale-105 transition-all duration-200\"\n                    data-testid=\"button-save-meal\"\n                  >\n                    {saveMutation.isPending ? (\n                      <>\n                        <Loader2 className=\"mr-2 h-4 w-4 animate-spin\" />\n                        Saving to Diary...\n                      </>\n                    ) : (\n                      <>\n                        <Apple className=\"mr-2 h-4 w-4\" />\n                        Save to Diary\n                      </>\n                    )}\n                  </Button>\n              </CardContent>\n            </Card>\n          )}\n        </TabsContent>\n\n          <TabsContent value=\"history\" className=\"space-y-6\">\n            <div className=\"flex items-center gap-4 p-4 bg-black/60 rounded-lg border border-red-800/30\">\n              <div className=\"flex items-center gap-3\">\n                <div className=\"p-1 bg-red-600 rounded\">\n                  <Calendar className=\"w-5 h-5 text-white\" />\n                </div>\n                <Label htmlFor=\"date-select\" className=\"text-white font-semibold\">Select Date:</Label>\n              </div>\n              <Input\n                id=\"date-select\"\n                type=\"date\"\n                value={selectedDate}\n                onChange={(e) => setSelectedDate(e.target.value)}\n                className=\"w-auto bg-gray-900 border-red-800/30 text-white hover:border-red-600 focus:border-red-500\"\n                data-testid=\"input-date-select\"\n              />\n            </div>\n\n            {/* Daily Summary */}\n            {mealEntries.length > 0 && (\n              <Card data-testid=\"card-daily-summary\" className=\"bg-black/90 border-red-600/50 shadow-2xl\">\n                <CardHeader className=\"border-b border-red-800/30\">\n                  <CardTitle className=\"flex items-center gap-2 text-white\">\n                    <div className=\"p-1 bg-red-600 rounded\">\n                      <TrendingUp className=\"w-5 h-5 text-white\" />\n                    </div>\n                    Daily Nutrition Summary\n                  </CardTitle>\n                </CardHeader>\n                <CardContent className=\"p-6\">\n                  <div className=\"grid gap-6 md:grid-cols-4\">\n                    {(() => {\n                      const totals = getTotalNutrition();\n                      return (\n                        <>\n                          <div className=\"text-center bg-gray-900/50 p-4 rounded-lg border border-red-800/20\">\n                            <p className=\"text-3xl font-bold text-red-400 mb-1\">{totals.calories}</p>\n                            <p className=\"text-sm text-gray-300 font-medium\">Calories</p>\n                          </div>\n                          <div className=\"text-center bg-gray-900/50 p-4 rounded-lg border border-red-800/20\">\n                            <p className=\"text-3xl font-bold text-blue-400 mb-1\">{Math.round(totals.protein)}g</p>\n                            <p className=\"text-sm text-gray-300 font-medium\">Protein</p>\n                          </div>\n                          <div className=\"text-center bg-gray-900/50 p-4 rounded-lg border border-red-800/20\">\n                            <p className=\"text-3xl font-bold text-green-400 mb-1\">{Math.round(totals.carbs)}g</p>\n                            <p className=\"text-sm text-gray-300 font-medium\">Carbs</p>\n                          </div>\n                          <div className=\"text-center bg-gray-900/50 p-4 rounded-lg border border-red-800/20\">\n                            <p className=\"text-3xl font-bold text-orange-400 mb-1\">{Math.round(totals.fat)}g</p>\n                            <p className=\"text-sm text-gray-300 font-medium\">Fat</p>\n                          </div>\n                        </>\n                      );\n                    })()}\n                  </div>\n                </CardContent>\n              </Card>\n            )}\n\n            {/* Meal History by Type */}\n            <div className=\"grid gap-6\">\n              {['breakfast', 'lunch', 'dinner', 'snack'].map((mealType) => {\n                const meals = getMealsByType(mealType);\n                return (\n                  <Card key={mealType} data-testid={`card-${mealType}-meals`} className=\"bg-black/80 border-red-800/30 shadow-xl\">\n                    <CardHeader className=\"border-b border-red-800/20\">\n                      <CardTitle className=\"capitalize text-white flex items-center gap-2\">\n                        <span className=\"text-xl\">\n                          {mealType === 'breakfast' && '🌅'} \n                          {mealType === 'lunch' && '☀️'} \n                          {mealType === 'dinner' && '🌙'} \n                          {mealType === 'snack' && '🍎'}\n                        </span>\n                        <span className=\"font-semibold\">{mealType}</span>\n                      </CardTitle>\n                    </CardHeader>\n                    <CardContent className=\"p-6\">\n                      {meals.length > 0 ? (\n                        <div className=\"space-y-4\">\n                          {meals.map((meal) => (\n                            <div key={meal.id} className=\"flex justify-between items-start p-4 bg-gray-900/50 border border-red-800/20 rounded-lg hover:border-red-600/40 transition-colors\">\n                              <div className=\"flex-1\">\n                                <h4 className=\"font-medium text-white\">{meal.mealName}</h4>\n                                {meal.description && (\n                                  <p className=\"text-sm text-gray-400 mt-1\">{meal.description}</p>\n                                )}\n                              </div>\n                              <div className=\"text-right flex items-start gap-3\">\n                                <div>\n                                  <p className=\"font-semibold text-red-400\">{meal.totalCalories} cal</p>\n                                  <p className=\"text-xs text-gray-400\">\n                                    P: {meal.protein}g | C: {meal.carbs}g | F: {meal.fat}g\n                                  </p>\n                                </div>\n                                <Button\n                                  variant=\"ghost\"\n                                  size=\"icon\"\n                                  onClick={() => deleteMutation.mutate(meal.id)}\n                                  disabled={deleteMutation.isPending}\n                                  className=\"text-red-400 hover:text-red-300 hover:bg-red-900/20\"\n                                  data-testid={`button-delete-meal-${meal.id}`}\n                                >\n                                  <Trash2 className=\"h-4 w-4\" />\n                                </Button>\n                              </div>\n                            </div>\n                          ))}\n                        </div>\n                      ) : (\n                        <div className=\"text-center py-8\">\n                          <div className=\"w-12 h-12 bg-gray-800 rounded-full flex items-center justify-center mx-auto mb-3\">\n                            <span className=\"text-2xl opacity-50\">\n                              {mealType === 'breakfast' && '🌅'} \n                              {mealType === 'lunch' && '☀️'} \n                              {mealType === 'dinner' && '🌙'} \n                              {mealType === 'snack' && '🍎'}\n                            </span>\n                          </div>\n                          <p className=\"text-gray-400 text-center\">No {mealType} logged yet</p>\n                        </div>\n                      )}\n                    </CardContent>\n                  </Card>\n                );\n              })}\n            </div>\n        </TabsContent>\n\n          <TabsContent value=\"weekly\" className=\"space-y-6\">\n            {/* Weekly Summary */}\n            {weeklyEntries.length > 0 && (\n              <Card data-testid=\"card-weekly-summary\" className=\"bg-black/90 border-red-600/50 shadow-2xl\">\n                <CardHeader className=\"border-b border-red-800/30\">\n                  <CardTitle className=\"flex items-center gap-2 text-white\">\n                    <div className=\"p-1 bg-red-600 rounded\">\n                      <TrendingUp className=\"w-5 h-5 text-white\" />\n                    </div>\n                    Weekly Nutrition Summary (Last 7 Days)\n                  </CardTitle>\n                </CardHeader>\n                <CardContent className=\"p-6\">\n                  <div className=\"grid gap-6 md:grid-cols-4\">\n                    {(() => {\n                      const weeklyTotals = weeklyEntries.reduce((totals, entry) => ({\n                        calories: totals.calories + entry.totalCalories,\n                        protein: totals.protein + parseFloat(entry.protein),\n                        carbs: totals.carbs + parseFloat(entry.carbs),\n                        fat: totals.fat + parseFloat(entry.fat)\n                      }), { calories: 0, protein: 0, carbs: 0, fat: 0 });\n                      \n                      const avgCalories = Math.round(weeklyTotals.calories / 7);\n                      \n                      return (\n                        <>\n                          <div className=\"text-center bg-gray-900/50 p-4 rounded-lg border border-red-800/20\">\n                            <p className=\"text-3xl font-bold text-red-400 mb-1\">{weeklyTotals.calories}</p>\n                            <p className=\"text-sm text-gray-300 font-medium\">Total Calories</p>\n                            <p className=\"text-xs text-gray-500 mt-1\">~{avgCalories}/day avg</p>\n                          </div>\n                          <div className=\"text-center bg-gray-900/50 p-4 rounded-lg border border-red-800/20\">\n                            <p className=\"text-3xl font-bold text-blue-400 mb-1\">{Math.round(weeklyTotals.protein)}g</p>\n                            <p className=\"text-sm text-gray-300 font-medium\">Total Protein</p>\n                            <p className=\"text-xs text-gray-500 mt-1\">~{Math.round(weeklyTotals.protein / 7)}g/day avg</p>\n                          </div>\n                          <div className=\"text-center bg-gray-900/50 p-4 rounded-lg border border-red-800/20\">\n                            <p className=\"text-3xl font-bold text-green-400 mb-1\">{Math.round(weeklyTotals.carbs)}g</p>\n                            <p className=\"text-sm text-gray-300 font-medium\">Total Carbs</p>\n                            <p className=\"text-xs text-gray-500 mt-1\">~{Math.round(weeklyTotals.carbs / 7)}g/day avg</p>\n                          </div>\n                          <div className=\"text-center bg-gray-900/50 p-4 rounded-lg border border-red-800/20\">\n                            <p className=\"text-3xl font-bold text-orange-400 mb-1\">{Math.round(weeklyTotals.fat)}g</p>\n                            <p className=\"text-sm text-gray-300 font-medium\">Total Fat</p>\n                            <p className=\"text-xs text-gray-500 mt-1\">~{Math.round(weeklyTotals.fat / 7)}g/day avg</p>\n                          </div>\n                        </>\n                      );\n                    })()}\n                  </div>\n                </CardContent>\n              </Card>\n            )}\n\n            {/* All Weekly Entries */}\n            <Card className=\"bg-black/80 border-red-800/30 shadow-xl\">\n              <CardHeader className=\"border-b border-red-800/20\">\n                <CardTitle className=\"text-white flex items-center gap-2\">\n                  <Calendar className=\"w-5 h-5\" />\n                  <span className=\"font-semibold\">All Scanned Items This Week</span>\n                  <Badge variant=\"outline\" className=\"ml-auto\">{weeklyEntries.length} items</Badge>\n                </CardTitle>\n              </CardHeader>\n              <CardContent className=\"p-6\">\n                {weeklyEntries.length > 0 ? (\n                  <div className=\"space-y-4\">\n                    {weekDates.map((date) => {\n                      const dayEntries = weeklyEntries.filter(entry => \n                        new Date(entry.loggedAt).toISOString().split('T')[0] === date\n                      );\n                      \n                      if (dayEntries.length === 0) return null;\n                      \n                      const dayTotal = dayEntries.reduce((sum, entry) => sum + entry.totalCalories, 0);\n                      const dayOfWeek = new Date(date).toLocaleDateString('en-US', { weekday: 'short' });\n                      const formattedDate = new Date(date).toLocaleDateString('en-US', { month: 'short', day: 'numeric' });\n                      \n                      return (\n                        <div key={date} className=\"border border-red-800/20 rounded-lg p-4 bg-gray-900/30\">\n                          <div className=\"flex justify-between items-center mb-3\">\n                            <h4 className=\"font-semibold text-white\">\n                              {dayOfWeek}, {formattedDate}\n                            </h4>\n                            <Badge className=\"bg-red-600 text-white\">{dayTotal} cal</Badge>\n                          </div>\n                          <div className=\"space-y-2\">\n                            {dayEntries.map((entry) => (\n                              <div key={entry.id} className=\"flex justify-between items-start p-3 bg-black/40 border border-red-800/10 rounded-lg\">\n                                <div className=\"flex-1\">\n                                  <h5 className=\"font-medium text-white text-sm\">{entry.mealName}</h5>\n                                  <p className=\"text-xs text-gray-400 capitalize\">{entry.mealType}</p>\n                                </div>\n                                <div className=\"text-right flex items-start gap-3\">\n                                  <div>\n                                    <p className=\"font-semibold text-red-400 text-sm\">{entry.totalCalories} cal</p>\n                                    <p className=\"text-xs text-gray-400\">\n                                      P: {entry.protein}g | C: {entry.carbs}g | F: {entry.fat}g\n                                    </p>\n                                  </div>\n                                  <Button\n                                    variant=\"ghost\"\n                                    size=\"icon\"\n                                    onClick={() => deleteMutation.mutate(entry.id)}\n                                    disabled={deleteMutation.isPending}\n                                    className=\"text-red-400 hover:text-red-300 hover:bg-red-900/20 h-8 w-8\"\n                                    data-testid={`button-delete-weekly-meal-${entry.id}`}\n                                  >\n                                    <Trash2 className=\"h-3 w-3\" />\n                                  </Button>\n                                </div>\n                              </div>\n                            ))}\n                          </div>\n                        </div>\n                      );\n                    }).filter(Boolean)}\n                  </div>\n                ) : (\n                  <div className=\"text-center py-12\">\n                    <div className=\"w-16 h-16 bg-gray-800 rounded-full flex items-center justify-center mx-auto mb-4\">\n                      <ScanLine className=\"w-8 h-8 text-gray-600\" />\n                    </div>\n                    <h3 className=\"text-lg font-semibold text-white mb-2\">No Items Scanned This Week</h3>\n                    <p className=\"text-gray-400\">Start scanning barcodes to track your nutrition throughout the week</p>\n                  </div>\n                )}\n              </CardContent>\n            </Card>\n        </TabsContent>\n        </Tabs>\n        \n        <HealthSources />\n        \n        {/* Barcode Scanner Modal */}\n        <BarcodeScanner\n          isOpen={isScannerOpen}\n          onScan={handleBarcodeScanned}\n          onClose={() => setIsScannerOpen(false)}\n        />\n      </div>\n    </div>\n    </FeatureGate>\n  );\n}","size_bytes":36454},"client/src/components/ui/resizable.tsx":{"content":"\"use client\"\n\nimport { GripVertical } from \"lucide-react\"\nimport * as ResizablePrimitive from \"react-resizable-panels\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ResizablePanelGroup = ({\n  className,\n  ...props\n}: React.ComponentProps<typeof ResizablePrimitive.PanelGroup>) => (\n  <ResizablePrimitive.PanelGroup\n    className={cn(\n      \"flex h-full w-full data-[panel-group-direction=vertical]:flex-col\",\n      className\n    )}\n    {...props}\n  />\n)\n\nconst ResizablePanel = ResizablePrimitive.Panel\n\nconst ResizableHandle = ({\n  withHandle,\n  className,\n  ...props\n}: React.ComponentProps<typeof ResizablePrimitive.PanelResizeHandle> & {\n  withHandle?: boolean\n}) => (\n  <ResizablePrimitive.PanelResizeHandle\n    className={cn(\n      \"relative flex w-px items-center justify-center bg-border after:absolute after:inset-y-0 after:left-1/2 after:w-1 after:-translate-x-1/2 focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring focus-visible:ring-offset-1 data-[panel-group-direction=vertical]:h-px data-[panel-group-direction=vertical]:w-full data-[panel-group-direction=vertical]:after:left-0 data-[panel-group-direction=vertical]:after:h-1 data-[panel-group-direction=vertical]:after:w-full data-[panel-group-direction=vertical]:after:-translate-y-1/2 data-[panel-group-direction=vertical]:after:translate-x-0 [&[data-panel-group-direction=vertical]>div]:rotate-90\",\n      className\n    )}\n    {...props}\n  >\n    {withHandle && (\n      <div className=\"z-10 flex h-4 w-3 items-center justify-center rounded-sm border bg-border\">\n        <GripVertical className=\"h-2.5 w-2.5\" />\n      </div>\n    )}\n  </ResizablePrimitive.PanelResizeHandle>\n)\n\nexport { ResizablePanelGroup, ResizablePanel, ResizableHandle }\n","size_bytes":1723},"client/src/components/ui/popover.tsx":{"content":"import * as React from \"react\"\nimport * as PopoverPrimitive from \"@radix-ui/react-popover\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Popover = PopoverPrimitive.Root\n\nconst PopoverTrigger = PopoverPrimitive.Trigger\n\nconst PopoverContent = React.forwardRef<\n  React.ElementRef<typeof PopoverPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof PopoverPrimitive.Content>\n>(({ className, align = \"center\", sideOffset = 4, ...props }, ref) => (\n  <PopoverPrimitive.Portal>\n    <PopoverPrimitive.Content\n      ref={ref}\n      align={align}\n      sideOffset={sideOffset}\n      className={cn(\n        \"z-50 w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-popover-content-transform-origin]\",\n        className\n      )}\n      {...props}\n    />\n  </PopoverPrimitive.Portal>\n))\nPopoverContent.displayName = PopoverPrimitive.Content.displayName\n\nexport { Popover, PopoverTrigger, PopoverContent }\n","size_bytes":1280},"client/src/components/ui/alert.tsx":{"content":"import * as React from \"react\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst alertVariants = cva(\n  \"relative w-full rounded-lg border p-4 [&>svg~*]:pl-7 [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground\",\n  {\n    variants: {\n      variant: {\n        default: \"bg-background text-foreground\",\n        destructive:\n          \"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  }\n)\n\nconst Alert = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement> & VariantProps<typeof alertVariants>\n>(({ className, variant, ...props }, ref) => (\n  <div\n    ref={ref}\n    role=\"alert\"\n    className={cn(alertVariants({ variant }), className)}\n    {...props}\n  />\n))\nAlert.displayName = \"Alert\"\n\nconst AlertTitle = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLHeadingElement>\n>(({ className, ...props }, ref) => (\n  <h5\n    ref={ref}\n    className={cn(\"mb-1 font-medium leading-none tracking-tight\", className)}\n    {...props}\n  />\n))\nAlertTitle.displayName = \"AlertTitle\"\n\nconst AlertDescription = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLParagraphElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"text-sm [&_p]:leading-relaxed\", className)}\n    {...props}\n  />\n))\nAlertDescription.displayName = \"AlertDescription\"\n\nexport { Alert, AlertTitle, AlertDescription }\n","size_bytes":1584},"client/src/components/ui/menubar.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as MenubarPrimitive from \"@radix-ui/react-menubar\"\nimport { Check, ChevronRight, Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nfunction MenubarMenu({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Menu>) {\n  return <MenubarPrimitive.Menu {...props} />\n}\n\nfunction MenubarGroup({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Group>) {\n  return <MenubarPrimitive.Group {...props} />\n}\n\nfunction MenubarPortal({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Portal>) {\n  return <MenubarPrimitive.Portal {...props} />\n}\n\nfunction MenubarRadioGroup({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.RadioGroup>) {\n  return <MenubarPrimitive.RadioGroup {...props} />\n}\n\nfunction MenubarSub({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Sub>) {\n  return <MenubarPrimitive.Sub data-slot=\"menubar-sub\" {...props} />\n}\n\nconst Menubar = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"flex h-10 items-center space-x-1 rounded-md border bg-background p-1\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubar.displayName = MenubarPrimitive.Root.displayName\n\nconst MenubarTrigger = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Trigger>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.Trigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center rounded-sm px-3 py-1.5 text-sm font-medium outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarTrigger.displayName = MenubarPrimitive.Trigger.displayName\n\nconst MenubarSubTrigger = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.SubTrigger>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.SubTrigger> & {\n    inset?: boolean\n  }\n>(({ className, inset, children, ...props }, ref) => (\n  <MenubarPrimitive.SubTrigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <ChevronRight className=\"ml-auto h-4 w-4\" />\n  </MenubarPrimitive.SubTrigger>\n))\nMenubarSubTrigger.displayName = MenubarPrimitive.SubTrigger.displayName\n\nconst MenubarSubContent = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.SubContent>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.SubContent>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.SubContent\n    ref={ref}\n    className={cn(\n      \"z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-menubar-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarSubContent.displayName = MenubarPrimitive.SubContent.displayName\n\nconst MenubarContent = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Content>\n>(\n  (\n    { className, align = \"start\", alignOffset = -4, sideOffset = 8, ...props },\n    ref\n  ) => (\n    <MenubarPrimitive.Portal>\n      <MenubarPrimitive.Content\n        ref={ref}\n        align={align}\n        alignOffset={alignOffset}\n        sideOffset={sideOffset}\n        className={cn(\n          \"z-50 min-w-[12rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-menubar-content-transform-origin]\",\n          className\n        )}\n        {...props}\n      />\n    </MenubarPrimitive.Portal>\n  )\n)\nMenubarContent.displayName = MenubarPrimitive.Content.displayName\n\nconst MenubarItem = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Item> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <MenubarPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarItem.displayName = MenubarPrimitive.Item.displayName\n\nconst MenubarCheckboxItem = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.CheckboxItem>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.CheckboxItem>\n>(({ className, children, checked, ...props }, ref) => (\n  <MenubarPrimitive.CheckboxItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    checked={checked}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <MenubarPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </MenubarPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </MenubarPrimitive.CheckboxItem>\n))\nMenubarCheckboxItem.displayName = MenubarPrimitive.CheckboxItem.displayName\n\nconst MenubarRadioItem = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.RadioItem>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.RadioItem>\n>(({ className, children, ...props }, ref) => (\n  <MenubarPrimitive.RadioItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <MenubarPrimitive.ItemIndicator>\n        <Circle className=\"h-2 w-2 fill-current\" />\n      </MenubarPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </MenubarPrimitive.RadioItem>\n))\nMenubarRadioItem.displayName = MenubarPrimitive.RadioItem.displayName\n\nconst MenubarLabel = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Label> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <MenubarPrimitive.Label\n    ref={ref}\n    className={cn(\n      \"px-2 py-1.5 text-sm font-semibold\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarLabel.displayName = MenubarPrimitive.Label.displayName\n\nconst MenubarSeparator = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-muted\", className)}\n    {...props}\n  />\n))\nMenubarSeparator.displayName = MenubarPrimitive.Separator.displayName\n\nconst MenubarShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\n        \"ml-auto text-xs tracking-widest text-muted-foreground\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\nMenubarShortcut.displayname = \"MenubarShortcut\"\n\nexport {\n  Menubar,\n  MenubarMenu,\n  MenubarTrigger,\n  MenubarContent,\n  MenubarItem,\n  MenubarSeparator,\n  MenubarLabel,\n  MenubarCheckboxItem,\n  MenubarRadioGroup,\n  MenubarRadioItem,\n  MenubarPortal,\n  MenubarSubContent,\n  MenubarSubTrigger,\n  MenubarGroup,\n  MenubarSub,\n  MenubarShortcut,\n}\n","size_bytes":8605},"client/src/components/ui/scroll-area.tsx":{"content":"import * as React from \"react\"\nimport * as ScrollAreaPrimitive from \"@radix-ui/react-scroll-area\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ScrollArea = React.forwardRef<\n  React.ElementRef<typeof ScrollAreaPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof ScrollAreaPrimitive.Root>\n>(({ className, children, ...props }, ref) => (\n  <ScrollAreaPrimitive.Root\n    ref={ref}\n    className={cn(\"relative overflow-hidden\", className)}\n    {...props}\n  >\n    <ScrollAreaPrimitive.Viewport className=\"h-full w-full rounded-[inherit]\">\n      {children}\n    </ScrollAreaPrimitive.Viewport>\n    <ScrollBar />\n    <ScrollAreaPrimitive.Corner />\n  </ScrollAreaPrimitive.Root>\n))\nScrollArea.displayName = ScrollAreaPrimitive.Root.displayName\n\nconst ScrollBar = React.forwardRef<\n  React.ElementRef<typeof ScrollAreaPrimitive.ScrollAreaScrollbar>,\n  React.ComponentPropsWithoutRef<typeof ScrollAreaPrimitive.ScrollAreaScrollbar>\n>(({ className, orientation = \"vertical\", ...props }, ref) => (\n  <ScrollAreaPrimitive.ScrollAreaScrollbar\n    ref={ref}\n    orientation={orientation}\n    className={cn(\n      \"flex touch-none select-none transition-colors\",\n      orientation === \"vertical\" &&\n        \"h-full w-2.5 border-l border-l-transparent p-[1px]\",\n      orientation === \"horizontal\" &&\n        \"h-2.5 flex-col border-t border-t-transparent p-[1px]\",\n      className\n    )}\n    {...props}\n  >\n    <ScrollAreaPrimitive.ScrollAreaThumb className=\"relative flex-1 rounded-full bg-border\" />\n  </ScrollAreaPrimitive.ScrollAreaScrollbar>\n))\nScrollBar.displayName = ScrollAreaPrimitive.ScrollAreaScrollbar.displayName\n\nexport { ScrollArea, ScrollBar }\n","size_bytes":1642},"server/services/subscription.ts":{"content":"import { Request, Response, NextFunction } from 'express';\nimport { PREMIUM_FEATURES, PremiumFeature, hasFeatureAccess, isTrialExpired, insertSubscriptionAuditSchema } from '../../shared/schema.js';\nimport { IStorage, storage } from '../storage.js';\n\nexport class SubscriptionService {\n  constructor(private storage: IStorage) {}\n\n  // Check if user's trial has expired and update status if needed\n  async checkAndUpdateTrialStatus(userId: string) {\n    const user = await this.storage.getUser(userId);\n    if (!user) return null;\n\n    // If user is on free trial and trial has expired\n    if (user.subscriptionStatus === 'free_trial' && isTrialExpired({ \n      subscriptionStatus: user.subscriptionStatus || 'free_trial', \n      trialEndDate: user.trialEndDate \n    })) {\n      // Update user status to expired\n      await this.storage.updateUser(userId, { subscriptionStatus: 'expired' });\n      \n      // Log the status change in audit table\n      await this.storage.createSubscriptionAudit({\n        userId,\n        fromStatus: 'free_trial',\n        toStatus: 'expired',\n        reason: 'trial_expired',\n        metadata: { expiredAt: new Date() }\n      });\n\n      // Return updated user\n      return await this.storage.getUser(userId);\n    }\n\n    return user;\n  }\n\n  // Check if user has access to specific feature\n  async checkFeatureAccess(userId: string, feature: PremiumFeature): Promise<boolean> {\n    const user = await this.checkAndUpdateTrialStatus(userId);\n    if (!user) return false;\n    \n    return hasFeatureAccess({ \n      subscriptionStatus: user.subscriptionStatus || 'expired', \n      trialEndDate: user.trialEndDate \n    }, feature);\n  }\n\n  // Get user's subscription status with trial info\n  async getSubscriptionStatus(userId: string) {\n    const user = await this.checkAndUpdateTrialStatus(userId);\n    if (!user) return null;\n\n    const isExpired = isTrialExpired({ \n      subscriptionStatus: user.subscriptionStatus || 'expired', \n      trialEndDate: user.trialEndDate \n    });\n    const trialDaysRemaining = user.trialEndDate \n      ? Math.max(0, Math.ceil((new Date(user.trialEndDate).getTime() - new Date().getTime()) / (1000 * 60 * 60 * 24)))\n      : 0;\n\n    return {\n      subscriptionStatus: user.subscriptionStatus,\n      trialStartDate: user.trialStartDate,\n      trialEndDate: user.trialEndDate,\n      trialExpired: isExpired,\n      trialDaysRemaining,\n      subscriptionExpiresAt: user.subscriptionExpiresAt,\n      hasActiveSubscription: user.subscriptionStatus === 'active'\n    };\n  }\n\n  // Upgrade user to premium\n  async upgradeToPremium(userId: string, stripeSubscriptionId?: string) {\n    const user = await this.storage.getUser(userId);\n    if (!user) throw new Error('User not found');\n\n    const updates: any = {\n      subscriptionStatus: 'active',\n      subscriptionStartDate: new Date(),\n      subscriptionExpiresAt: null // Ongoing subscription\n    };\n\n    if (stripeSubscriptionId) {\n      updates.stripeSubscriptionId = stripeSubscriptionId;\n    }\n\n    await this.storage.updateUser(userId, updates);\n\n    // Log the upgrade in audit table\n    await this.storage.createSubscriptionAudit({\n      userId,\n      fromStatus: user.subscriptionStatus || 'expired',\n      toStatus: 'active',\n      reason: 'upgraded_to_premium',\n      metadata: { \n        upgradedAt: new Date(),\n        stripeSubscriptionId \n      }\n    });\n\n    return await this.storage.getUser(userId);\n  }\n}\n\n// Middleware to require premium feature access\nexport const requireFeatureAccess = (feature: PremiumFeature) => {\n  return async (req: Request, res: Response, next: NextFunction) => {\n    try {\n      // Get user ID from authenticated user (set by authenticateToken middleware)\n      const userId = (req as any).user?.id || (req as any).session?.userId || (req as any).userId;\n      if (!userId) {\n        return res.status(401).json({ \n          message: 'Authentication required',\n          feature,\n          accessDenied: true\n        });\n      }\n\n      const subscriptionService = new SubscriptionService(storage as IStorage);\n      \n      const hasAccess = await subscriptionService.checkFeatureAccess(userId, feature);\n      \n      if (!hasAccess) {\n        const status = await subscriptionService.getSubscriptionStatus(userId);\n        return res.status(402).json({ \n          message: `Premium feature access required: ${feature}`,\n          feature,\n          accessDenied: true,\n          subscriptionStatus: status,\n          upgradeRequired: true\n        });\n      }\n\n      next();\n    } catch (error) {\n      console.error('Feature access check failed:', error);\n      res.status(500).json({ \n        message: 'Feature access check failed',\n        feature,\n        error: true\n      });\n    }\n  };\n};\n\n// Helper to check feature access in routes without blocking\nexport const checkFeatureAccessNonBlocking = async (req: Request, feature: PremiumFeature): Promise<{\n  hasAccess: boolean;\n  subscriptionStatus?: any;\n}> => {\n  try {\n    const userId = (req as any).user?.id || (req as any).session?.userId || (req as any).userId;\n    if (!userId) {\n      return { hasAccess: false };\n    }\n\n    const subscriptionService = new SubscriptionService(storage);\n    \n    const hasAccess = await subscriptionService.checkFeatureAccess(userId, feature);\n    const subscriptionStatus = await subscriptionService.getSubscriptionStatus(userId);\n    \n    return { \n      hasAccess, \n      subscriptionStatus \n    };\n  } catch (error) {\n    console.error('Feature access check failed:', error);\n    return { hasAccess: false };\n  }\n};","size_bytes":5561},"client/src/App.tsx":{"content":"import { useState } from \"react\";\nimport { Switch, Route } from \"wouter\";\nimport { queryClient } from \"./lib/queryClient\";\nimport { QueryClientProvider } from \"@tanstack/react-query\";\nimport { Toaster } from \"@/components/ui/toaster\";\nimport { TooltipProvider } from \"@/components/ui/tooltip\";\nimport { ThemeProvider } from \"@/hooks/useTheme\";\nimport Dashboard from \"@/pages/dashboard\";\nimport Home from \"@/pages/home\";\nimport UserSubscription from \"@/pages/user-subscription\";\nimport MileTracker from \"@/pages/mile-tracker\";\nimport Community from \"@/pages/community\";\nimport MealPlans from \"@/pages/meal-plans\";\nimport WorkoutPlanner from \"@/pages/workout-planner\";\nimport MealTracker from \"@/pages/meal-tracker\";\nimport Landing from \"@/pages/landing\";\nimport Settings from \"@/pages/settings\";\nimport Workouts from \"@/pages/workouts\";\nimport NewsPage from \"@/pages/news\";\nimport Progress from \"@/pages/progress\";\nimport ProgressPhotos from \"@/pages/progress-photos\";\nimport Calendar from \"@/pages/calendar\";\nimport NotFound from \"@/pages/not-found\";\nimport Navbar from \"@/components/navbar\";\nimport BottomNav from \"@/components/bottom-nav\";\nimport Onboarding from \"@/pages/onboarding\";\nimport OnboardingPlan from \"@/pages/onboarding-plan\";\nimport TrialSuccess from \"@/pages/trial-success\";\nimport ProfileCompletionGuard from \"@/components/profile-completion-guard\";\nimport AuthSelection from \"@/pages/auth-selection\";\nimport Tutorial from \"@/pages/tutorial\";\nimport TermsOfService from \"@/pages/terms-of-service\";\nimport PrivacyPolicy from \"@/pages/privacy-policy\";\nimport { useNewAuth } from \"@/hooks/useNewAuth\";\nimport NotificationManager from \"@/components/notification-manager\";\nimport SplashScreen from \"@/components/splash-screen\";\n\nfunction Router() {\n  const { isAuthenticated, isLoading } = useNewAuth();\n\n  if (isLoading) {\n    return (\n      <div className=\"h-screen flex items-center justify-center bg-gray-50 dark:bg-black\">\n        <div className=\"animate-spin w-8 h-8 border-4 border-primary border-t-transparent rounded-full\" aria-label=\"Loading\"/>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"min-h-screen bg-gray-50 dark:bg-black\">\n      {isAuthenticated && (\n        <>\n          <Navbar />\n          <NotificationManager />\n        </>\n      )}\n      \n      <main className=\"pb-safe\">\n        <Switch>\n        {/* Legal pages - accessible to all users */}\n        <Route path=\"/terms-of-service\" component={TermsOfService} />\n        <Route path=\"/privacy-policy\" component={PrivacyPolicy} />\n        \n        {/* Tutorial page - always available but checks auth internally */}\n        <Route path=\"/tutorial\" component={Tutorial} />\n        \n        {!isAuthenticated ? (\n          <>\n            <Route path=\"/\" component={Landing} />\n            <Route path=\"/auth-selection\" component={AuthSelection} />\n            <Route path=\"/onboarding\" component={Onboarding} />\n            <Route path=\"/onboarding/plan\" component={OnboardingPlan} />\n            <Route path=\"/trial-success\" component={TrialSuccess} />\n          </>\n        ) : (\n          <ProfileCompletionGuard>\n            <Route path=\"/\" component={Home} />\n            <Route path=\"/home\" component={Home} />\n            <Route path=\"/dashboard\" component={Dashboard} />\n            <Route path=\"/subscription\" component={UserSubscription} />\n            <Route path=\"/user/subscription\" component={UserSubscription} />\n            <Route path=\"/mile-tracker\" component={MileTracker} />\n            <Route path=\"/community\" component={Community} />\n            <Route path=\"/meal-plans\" component={MealPlans} />\n            <Route path=\"/workout-planner\" component={WorkoutPlanner} />\n            <Route path=\"/meal-tracker\" component={MealTracker} />\n            <Route path=\"/settings\" component={Settings} />\n            <Route path=\"/workouts\" component={Workouts} />\n            <Route path=\"/progress\" component={Progress} />\n            <Route path=\"/progress-photos\" component={ProgressPhotos} />\n            <Route path=\"/calendar\" component={Calendar} />\n            <Route path=\"/news\" component={NewsPage} />\n          </ProfileCompletionGuard>\n        )}\n        <Route component={NotFound} />\n      </Switch>\n      </main>\n      \n      {isAuthenticated && <BottomNav />}\n    </div>\n  );\n}\n\nfunction App() {\n  const [showSplash, setShowSplash] = useState(true);\n\n  const handleSplashComplete = () => {\n    setShowSplash(false);\n  };\n\n  return (\n    <QueryClientProvider client={queryClient}>\n      <ThemeProvider>\n        <TooltipProvider>\n          <Toaster />\n          {showSplash ? (\n            <SplashScreen onComplete={handleSplashComplete} />\n          ) : (\n            <Router />\n          )}\n        </TooltipProvider>\n      </ThemeProvider>\n    </QueryClientProvider>\n  );\n}\n\nexport default App;\n","size_bytes":4822},"client/src/components/ui/slider.tsx":{"content":"import * as React from \"react\"\nimport * as SliderPrimitive from \"@radix-ui/react-slider\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Slider = React.forwardRef<\n  React.ElementRef<typeof SliderPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof SliderPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <SliderPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative flex w-full touch-none select-none items-center\",\n      className\n    )}\n    {...props}\n  >\n    <SliderPrimitive.Track className=\"relative h-2 w-full grow overflow-hidden rounded-full bg-secondary\">\n      <SliderPrimitive.Range className=\"absolute h-full bg-primary\" />\n    </SliderPrimitive.Track>\n    <SliderPrimitive.Thumb className=\"block h-5 w-5 rounded-full border-2 border-primary bg-background ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50\" />\n  </SliderPrimitive.Root>\n))\nSlider.displayName = SliderPrimitive.Root.displayName\n\nexport { Slider }\n","size_bytes":1077},"client/src/components/ui/table.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Table = React.forwardRef<\n  HTMLTableElement,\n  React.HTMLAttributes<HTMLTableElement>\n>(({ className, ...props }, ref) => (\n  <div className=\"relative w-full overflow-auto\">\n    <table\n      ref={ref}\n      className={cn(\"w-full caption-bottom text-sm\", className)}\n      {...props}\n    />\n  </div>\n))\nTable.displayName = \"Table\"\n\nconst TableHeader = React.forwardRef<\n  HTMLTableSectionElement,\n  React.HTMLAttributes<HTMLTableSectionElement>\n>(({ className, ...props }, ref) => (\n  <thead ref={ref} className={cn(\"[&_tr]:border-b\", className)} {...props} />\n))\nTableHeader.displayName = \"TableHeader\"\n\nconst TableBody = React.forwardRef<\n  HTMLTableSectionElement,\n  React.HTMLAttributes<HTMLTableSectionElement>\n>(({ className, ...props }, ref) => (\n  <tbody\n    ref={ref}\n    className={cn(\"[&_tr:last-child]:border-0\", className)}\n    {...props}\n  />\n))\nTableBody.displayName = \"TableBody\"\n\nconst TableFooter = React.forwardRef<\n  HTMLTableSectionElement,\n  React.HTMLAttributes<HTMLTableSectionElement>\n>(({ className, ...props }, ref) => (\n  <tfoot\n    ref={ref}\n    className={cn(\n      \"border-t bg-muted/50 font-medium [&>tr]:last:border-b-0\",\n      className\n    )}\n    {...props}\n  />\n))\nTableFooter.displayName = \"TableFooter\"\n\nconst TableRow = React.forwardRef<\n  HTMLTableRowElement,\n  React.HTMLAttributes<HTMLTableRowElement>\n>(({ className, ...props }, ref) => (\n  <tr\n    ref={ref}\n    className={cn(\n      \"border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted\",\n      className\n    )}\n    {...props}\n  />\n))\nTableRow.displayName = \"TableRow\"\n\nconst TableHead = React.forwardRef<\n  HTMLTableCellElement,\n  React.ThHTMLAttributes<HTMLTableCellElement>\n>(({ className, ...props }, ref) => (\n  <th\n    ref={ref}\n    className={cn(\n      \"h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0\",\n      className\n    )}\n    {...props}\n  />\n))\nTableHead.displayName = \"TableHead\"\n\nconst TableCell = React.forwardRef<\n  HTMLTableCellElement,\n  React.TdHTMLAttributes<HTMLTableCellElement>\n>(({ className, ...props }, ref) => (\n  <td\n    ref={ref}\n    className={cn(\"p-4 align-middle [&:has([role=checkbox])]:pr-0\", className)}\n    {...props}\n  />\n))\nTableCell.displayName = \"TableCell\"\n\nconst TableCaption = React.forwardRef<\n  HTMLTableCaptionElement,\n  React.HTMLAttributes<HTMLTableCaptionElement>\n>(({ className, ...props }, ref) => (\n  <caption\n    ref={ref}\n    className={cn(\"mt-4 text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nTableCaption.displayName = \"TableCaption\"\n\nexport {\n  Table,\n  TableHeader,\n  TableBody,\n  TableFooter,\n  TableHead,\n  TableRow,\n  TableCell,\n  TableCaption,\n}\n","size_bytes":2765},"client/src/components/recent-workouts.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport { Dumbbell, Activity, Leaf, ChevronUp, ChevronDown } from \"lucide-react\";\nimport { format, isToday, isYesterday, formatDistanceToNow } from \"date-fns\";\nimport type { Workout } from \"@shared/schema\";\n\nexport default function RecentWorkouts() {\n  const [showAll, setShowAll] = useState(false);\n  const { data: workouts, isLoading } = useQuery<Workout[]>({\n    queryKey: [\"/api/workouts\"],\n  });\n\n  const getWorkoutIcon = (category: string) => {\n    switch (category) {\n      case \"strength\":\n        return Dumbbell;\n      case \"cardio\":\n        return Activity;\n      case \"yoga\":\n        return Leaf;\n      default:\n        return Activity;\n    }\n  };\n\n  const getWorkoutColor = (category: string) => {\n    switch (category) {\n      case \"strength\":\n        return \"primary\";\n      case \"cardio\":\n        return \"secondary\";\n      case \"yoga\":\n        return \"pink-500\";\n      default:\n        return \"primary\";\n    }\n  };\n\n  const formatWorkoutDate = (date: Date) => {\n    if (isToday(date)) return \"Today\";\n    if (isYesterday(date)) return \"Yesterday\";\n    return formatDistanceToNow(date, { addSuffix: true });\n  };\n\n  if (isLoading) {\n    return (\n      <section className=\"relative bg-gradient-to-br from-black via-red-900/30 to-black rounded-3xl shadow-2xl border border-red-600/50 p-8 overflow-hidden hexagon-bg hexagon-pattern\">\n        {/* Animated red and black background elements */}\n        <div className=\"absolute inset-0\">\n          {/* Floating red hexagons */}\n          <div className=\"absolute top-0 left-0 w-32 h-28 opacity-30 animate-pulse\" style={{animationDuration: '4s'}}>\n            <svg viewBox=\"0 0 120 104\" className=\"w-full h-full\">\n              <polygon points=\"30,2 90,2 120,52 90,102 30,102 0,52\" fill=\"#dc2626\" stroke=\"#dc2626\" strokeWidth=\"2\" opacity=\"0.6\"/>\n            </svg>\n          </div>\n          <div className=\"absolute top-1/4 right-0 w-24 h-21 opacity-20 animate-bounce\" style={{animationDuration: '6s'}}>\n            <svg viewBox=\"0 0 120 104\" className=\"w-full h-full\">\n              <polygon points=\"30,2 90,2 120,52 90,102 30,102 0,52\" fill=\"none\" stroke=\"#dc2626\" strokeWidth=\"2\" opacity=\"0.8\"/>\n            </svg>\n          </div>\n          <div className=\"absolute bottom-0 left-1/3 w-28 h-24 opacity-25 animate-ping\" style={{animationDuration: '8s', animationDelay: '1s'}}>\n            <svg viewBox=\"0 0 120 104\" className=\"w-full h-full\">\n              <polygon points=\"30,2 90,2 120,52 90,102 30,102 0,52\" fill=\"#000000\" stroke=\"#dc2626\" strokeWidth=\"1\" opacity=\"0.7\"/>\n            </svg>\n          </div>\n          <div className=\"absolute bottom-1/4 right-1/4 w-20 h-17 opacity-15 animate-pulse\" style={{animationDuration: '5s', animationDelay: '2s'}}>\n            <svg viewBox=\"0 0 120 104\" className=\"w-full h-full\">\n              <polygon points=\"30,2 90,2 120,52 90,102 30,102 0,52\" fill=\"#dc2626\" stroke=\"#000000\" strokeWidth=\"1\" opacity=\"0.5\"/>\n            </svg>\n          </div>\n          <div className=\"absolute top-1/2 left-10 w-22 h-19 opacity-20 animate-bounce\" style={{animationDuration: '7s', animationDelay: '0.5s'}}>\n            <svg viewBox=\"0 0 120 104\" className=\"w-full h-full\">\n              <polygon points=\"30,2 90,2 120,52 90,102 30,102 0,52\" fill=\"none\" stroke=\"#dc2626\" strokeWidth=\"2\" opacity=\"0.4\"/>\n            </svg>\n          </div>\n          \n          {/* Animated red gradient orbs */}\n          <div className=\"absolute top-1/3 right-1/3 w-40 h-40 bg-gradient-to-br from-red-600/20 to-black/40 rounded-full blur-3xl opacity-30 animate-pulse\" style={{animationDuration: '6s'}}></div>\n          <div className=\"absolute bottom-1/3 left-1/4 w-32 h-32 bg-gradient-to-br from-black/60 to-red-600/20 rounded-full blur-2xl opacity-20 animate-ping\" style={{animationDuration: '10s'}}></div>\n          \n          {/* Dynamic radial gradient overlay */}\n          <div className=\"absolute inset-0 bg-gradient-radial from-transparent via-red-900/10 to-black/60 animate-pulse\" style={{animationDuration: '8s'}}></div>\n        </div>\n        {/* Content wrapper */}\n        <div className=\"relative z-10\">\n        <div className=\"flex items-center justify-between mb-6\">\n          <h3 className=\"text-2xl font-bold text-white drop-shadow-lg\">Recent Workouts</h3>\n        </div>\n        <div className=\"space-y-4\">\n          {[...Array(3)].map((_, i) => (\n            <div key={i} className=\"animate-pulse\">\n              <div className=\"flex items-center space-x-4 p-4 bg-gray-50 rounded-xl\">\n                <div className=\"bg-gray-200 rounded-lg p-3 w-12 h-12\"></div>\n                <div className=\"flex-1\">\n                  <div className=\"h-4 bg-gray-200 rounded w-3/4 mb-2\"></div>\n                  <div className=\"h-3 bg-gray-200 rounded w-1/2\"></div>\n                </div>\n                <div className=\"text-right\">\n                  <div className=\"h-4 bg-gray-200 rounded w-16 mb-1\"></div>\n                  <div className=\"h-3 bg-gray-200 rounded w-12\"></div>\n                </div>\n              </div>\n            </div>\n          ))}\n        </div>\n        </div>\n      </section>\n    );\n  }\n\n  if (!workouts || workouts.length === 0) {\n    return (\n      <section className=\"relative bg-gradient-to-br from-black via-red-900/30 to-black rounded-3xl shadow-2xl border border-red-600/50 p-8 overflow-hidden hexagon-bg hexagon-pattern\">\n        {/* Animated red and black background elements */}\n        <div className=\"absolute inset-0\">\n          {/* Floating red hexagons */}\n          <div className=\"absolute top-0 left-0 w-32 h-28 opacity-30 animate-pulse\" style={{animationDuration: '4s'}}>\n            <svg viewBox=\"0 0 120 104\" className=\"w-full h-full\">\n              <polygon points=\"30,2 90,2 120,52 90,102 30,102 0,52\" fill=\"#dc2626\" stroke=\"#dc2626\" strokeWidth=\"2\" opacity=\"0.6\"/>\n            </svg>\n          </div>\n          <div className=\"absolute top-1/4 right-0 w-24 h-21 opacity-20 animate-bounce\" style={{animationDuration: '6s'}}>\n            <svg viewBox=\"0 0 120 104\" className=\"w-full h-full\">\n              <polygon points=\"30,2 90,2 120,52 90,102 30,102 0,52\" fill=\"none\" stroke=\"#dc2626\" strokeWidth=\"2\" opacity=\"0.8\"/>\n            </svg>\n          </div>\n          <div className=\"absolute bottom-0 left-1/3 w-28 h-24 opacity-25 animate-ping\" style={{animationDuration: '8s', animationDelay: '1s'}}>\n            <svg viewBox=\"0 0 120 104\" className=\"w-full h-full\">\n              <polygon points=\"30,2 90,2 120,52 90,102 30,102 0,52\" fill=\"#000000\" stroke=\"#dc2626\" strokeWidth=\"1\" opacity=\"0.7\"/>\n            </svg>\n          </div>\n          <div className=\"absolute bottom-1/4 right-1/4 w-20 h-17 opacity-15 animate-pulse\" style={{animationDuration: '5s', animationDelay: '2s'}}>\n            <svg viewBox=\"0 0 120 104\" className=\"w-full h-full\">\n              <polygon points=\"30,2 90,2 120,52 90,102 30,102 0,52\" fill=\"#dc2626\" stroke=\"#000000\" strokeWidth=\"1\" opacity=\"0.5\"/>\n            </svg>\n          </div>\n          <div className=\"absolute top-1/2 left-10 w-22 h-19 opacity-20 animate-bounce\" style={{animationDuration: '7s', animationDelay: '0.5s'}}>\n            <svg viewBox=\"0 0 120 104\" className=\"w-full h-full\">\n              <polygon points=\"30,2 90,2 120,52 90,102 30,102 0,52\" fill=\"none\" stroke=\"#dc2626\" strokeWidth=\"2\" opacity=\"0.4\"/>\n            </svg>\n          </div>\n          \n          {/* Animated red gradient orbs */}\n          <div className=\"absolute top-1/3 right-1/3 w-40 h-40 bg-gradient-to-br from-red-600/20 to-black/40 rounded-full blur-3xl opacity-30 animate-pulse\" style={{animationDuration: '6s'}}></div>\n          <div className=\"absolute bottom-1/3 left-1/4 w-32 h-32 bg-gradient-to-br from-black/60 to-red-600/20 rounded-full blur-2xl opacity-20 animate-ping\" style={{animationDuration: '10s'}}></div>\n          \n          {/* Dynamic radial gradient overlay */}\n          <div className=\"absolute inset-0 bg-gradient-radial from-transparent via-red-900/10 to-black/60 animate-pulse\" style={{animationDuration: '8s'}}></div>\n        </div>\n        {/* Content wrapper */}\n        <div className=\"relative z-10\">\n        <div className=\"flex items-center justify-between mb-6\">\n          <h3 className=\"text-2xl font-bold text-white drop-shadow-lg\">Recent Workouts</h3>\n        </div>\n        <div className=\"text-center py-8\">\n          <Dumbbell className=\"mx-auto text-gray-400 mb-4\" size={48} />\n          <p className=\"text-gray-300\">No workouts yet. Start your first workout!</p>\n        </div>\n        </div>\n      </section>\n    );\n  }\n\n  return (\n    <section className=\"relative bg-gradient-to-br from-indigo-900 via-purple-900 to-blue-900 rounded-3xl shadow-2xl border border-indigo-700/50 p-8 overflow-hidden\">\n      {/* Animated background elements */}\n      <div className=\"absolute inset-0\">\n        <div className=\"absolute top-0 left-0 w-40 h-40 bg-gradient-to-br from-cyan-400 to-blue-500 rounded-full blur-3xl opacity-20 animate-pulse\"></div>\n        <div className=\"absolute bottom-0 right-0 w-32 h-32 bg-gradient-to-br from-purple-400 to-pink-500 rounded-full blur-2xl opacity-15 animate-bounce\" style={{animationDuration: '3s'}}></div>\n        <div className=\"absolute top-1/2 left-1/3 w-28 h-28 bg-gradient-to-br from-emerald-400 to-cyan-500 rounded-full blur-3xl opacity-10 animate-ping\" style={{animationDuration: '4s'}}></div>\n      </div>\n      {/* Content wrapper */}\n      <div className=\"relative z-10\">\n      <div className=\"flex items-center justify-between mb-6\">\n        <h3 className=\"text-2xl font-bold text-white drop-shadow-lg\">Recent Workouts</h3>\n        <button \n          onClick={() => setShowAll(!showAll)}\n          className=\"text-cyan-300 hover:text-cyan-200 text-sm font-medium transition-colors flex items-center gap-1\"\n          data-testid=\"view-all-workouts-button\"\n        >\n          {showAll ? 'Show Less' : 'View All'}\n          {showAll ? <ChevronUp size={16} /> : <ChevronDown size={16} />}\n        </button>\n      </div>\n\n      <div className=\"space-y-4\">\n        {(showAll ? workouts : workouts.slice(0, 3)).map((workout) => {\n          const IconComponent = getWorkoutIcon(workout.category);\n          const colorClass = getWorkoutColor(workout.category);\n\n          return (\n            <div\n              key={workout.id}\n              className=\"flex items-center space-x-4 p-4 bg-white/10 backdrop-blur-sm rounded-xl hover:bg-white/15 transition-colors border border-white/20\"\n            >\n              <div className={`bg-${colorClass} bg-opacity-10 rounded-lg p-3`}>\n                <IconComponent className={`text-${colorClass} text-lg`} />\n              </div>\n              <div className=\"flex-1\">\n                <h4 className=\"font-medium text-white\">{workout.name}</h4>\n                <p className=\"text-sm text-gray-300\">\n                  {workout.duration} min • {workout.caloriesBurned} calories\n                </p>\n              </div>\n              <div className=\"text-right\">\n                <p className=\"text-sm font-medium text-white\">\n                  {formatWorkoutDate(new Date(workout.date))}\n                </p>\n                <p className=\"text-xs text-gray-300\">\n                  {format(new Date(workout.date), \"h:mm a\")}\n                </p>\n              </div>\n            </div>\n          );\n        })}\n      </div>\n      \n      {workouts.length > 3 && (\n        <div className=\"mt-4 text-center\">\n          <p className=\"text-sm text-gray-300\">\n            {showAll ? `Showing all ${workouts.length} workouts` : `Showing 3 of ${workouts.length} workouts`}\n          </p>\n        </div>\n      )}\n      </div>\n    </section>\n  );\n}\n","size_bytes":11708},"client/src/pages/onboarding.tsx":{"content":"import { useState } from \"react\";\nimport { useLocation } from \"wouter\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Progress } from \"@/components/ui/progress\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Activity, ArrowRight, ArrowLeft } from \"lucide-react\";\n\ninterface OnboardingAnswers {\n  fitnessGoal: string;\n  experience: string;\n  consistency: string;\n  location: string;\n  age: string;\n  heightFeet: string;\n  heightInches: string;\n  weight: string;\n  weightUnit: string;\n  goalWeight: string;\n  workoutFrequency: string;\n  workoutDuration: string;\n}\n\nconst questions = [\n  {\n    id: 'fitnessGoal',\n    question: 'What is your fitness goal?',\n    type: 'choice',\n    options: [\n      'Lose weight and burn fat',\n      'Build muscle and gain strength', \n      'Improve endurance and cardio',\n      'General health and wellness',\n      'Athletic performance enhancement'\n    ]\n  },\n  {\n    id: 'experience',\n    question: 'How much strength training experience do you have?',\n    type: 'choice',\n    options: [\n      'Complete beginner - never lifted weights',\n      'Some experience - less than 6 months',\n      'Moderate experience - 6 months to 2 years',\n      'Experienced - 2+ years of consistent training',\n      'Advanced - 5+ years with extensive knowledge'\n    ]\n  },\n  {\n    id: 'age',\n    question: 'What is your age?',\n    type: 'input',\n    inputType: 'number',\n    placeholder: 'Enter your age (e.g., 25)',\n    min: 13,\n    max: 100\n  },\n  {\n    id: 'height',\n    question: 'What is your height?',\n    type: 'height',\n    description: 'This helps us calculate your personalized calorie needs'\n  },\n  {\n    id: 'weight',\n    question: 'What is your current weight?',\n    type: 'weight',\n    description: 'Used for accurate calorie and workout recommendations'\n  },\n  {\n    id: 'goalWeight',\n    question: 'What is your goal weight?',\n    type: 'input',\n    inputType: 'number',\n    placeholder: 'Enter your target weight',\n    min: 50,\n    max: 500\n  },\n  {\n    id: 'workoutFrequency',\n    question: 'How often would you like to workout per week?',\n    type: 'choice',\n    options: [\n      '2-3 times per week - I\\'m just starting',\n      '3-4 times per week - I want steady progress',\n      '4-5 times per week - I\\'m committed to fitness',\n      '5-6 times per week - Fitness is a priority',\n      '6-7 times per week - I love daily activity'\n    ]\n  },\n  {\n    id: 'workoutDuration',\n    question: 'How long would you like each workout to be?',\n    type: 'choice',\n    options: [\n      '15-30 minutes - Quick and efficient',\n      '30-45 minutes - Moderate workout time',\n      '45-60 minutes - Standard gym session',\n      '60-75 minutes - Extended training',\n      '75+ minutes - Marathon sessions'\n    ]\n  },\n  {\n    id: 'consistency',\n    question: 'How consistent are you with working out currently?',\n    type: 'choice',\n    options: [\n      'Just getting started - no routine yet',\n      '1-2 times per week when I can',\n      '3-4 times per week regularly',\n      '5-6 times per week consistently',\n      'Daily workouts are part of my lifestyle'\n    ]\n  },\n  {\n    id: 'location',\n    question: 'Where do you normally workout?',\n    type: 'choice',\n    options: [\n      'At home with no equipment',\n      'At home with basic equipment',\n      'Local gym or fitness center',\n      'Outdoor spaces (parks, trails, etc.)',\n      'Multiple locations depending on the day'\n    ]\n  }\n];\n\nexport default function Onboarding() {\n  const [, setLocation] = useLocation();\n  const [currentStep, setCurrentStep] = useState(0);\n  const [answers, setAnswers] = useState<OnboardingAnswers>({\n    fitnessGoal: '',\n    experience: '',\n    consistency: '',\n    location: '',\n    age: '',\n    heightFeet: '',\n    heightInches: '',\n    weight: '',\n    weightUnit: 'lbs',\n    goalWeight: '',\n    workoutFrequency: '',\n    workoutDuration: ''\n  });\n\n  const currentQuestion = questions[currentStep];\n  const progress = ((currentStep + 1) / questions.length) * 100;\n\n  const handleAnswerSelect = (answer: string) => {\n    setAnswers(prev => ({\n      ...prev,\n      [currentQuestion.id]: answer\n    }));\n  };\n\n  const handleInputChange = (field: string, value: string) => {\n    setAnswers(prev => ({\n      ...prev,\n      [field]: value\n    }));\n  };\n\n  const handleNext = () => {\n    if (currentStep < questions.length - 1) {\n      setCurrentStep(prev => prev + 1);\n    } else {\n      // Pass answers to plan generation page\n      const queryParams = new URLSearchParams();\n      Object.entries(answers).forEach(([key, value]) => {\n        queryParams.append(key, value);\n      });\n      setLocation(`/onboarding/plan?${queryParams.toString()}`);\n    }\n  };\n\n  const handlePrevious = () => {\n    if (currentStep > 0) {\n      setCurrentStep(prev => prev - 1);\n    }\n  };\n\n  const isCurrentAnswered = () => {\n    const questionId = currentQuestion.id as keyof OnboardingAnswers;\n    \n    if (currentQuestion.type === 'choice' || currentQuestion.type === 'input') {\n      return answers[questionId] !== '';\n    }\n    \n    if (currentQuestion.type === 'height') {\n      return answers.heightFeet !== '' && answers.heightInches !== '';\n    }\n    \n    if (currentQuestion.type === 'weight') {\n      return answers.weight !== '' && answers.weightUnit !== '';\n    }\n    \n    return false;\n  };\n\n  return (\n    <div className=\"relative min-h-screen bg-gradient-to-br from-primary/5 via-white to-secondary/5 dark:from-gray-900 dark:via-gray-800 dark:to-gray-900 overflow-hidden\">\n      {/* Animated background elements */}\n      <div className=\"fixed inset-0 pointer-events-none z-0\">\n        <div className=\"absolute top-20 left-10 w-72 h-72 bg-gradient-to-br from-purple-400 to-blue-500 rounded-full blur-3xl opacity-20 animate-pulse\"></div>\n        <div className=\"absolute top-40 right-16 w-56 h-56 bg-gradient-to-br from-cyan-400 to-emerald-500 rounded-full blur-2xl opacity-25 animate-bounce\" style={{animationDuration: '4s'}}></div>\n        <div className=\"absolute bottom-20 left-1/4 w-64 h-64 bg-gradient-to-br from-pink-400 to-purple-500 rounded-full blur-3xl opacity-15 animate-ping\" style={{animationDuration: '6s'}}></div>\n      </div>\n\n      {/* Header */}\n      <header className=\"relative z-10 px-4 lg:px-6 h-14 flex items-center border-b bg-white/80 dark:bg-gray-800/80 backdrop-blur\">\n        <div className=\"flex items-center space-x-2\">\n          <Activity className=\"text-primary\" size={32} />\n          <h1 className=\"text-xl font-bold text-gray-900 dark:text-white\">FlexFlow</h1>\n        </div>\n      </header>\n\n      {/* Main Content */}\n      <div className=\"relative z-10 container mx-auto px-4 py-16 max-w-2xl\">\n        <div className=\"text-center mb-8\">\n          <h1 className=\"text-3xl md:text-4xl font-bold text-gray-900 dark:text-white mb-4\">\n            Let's Create Your Personal Plan\n          </h1>\n          <p className=\"text-lg text-gray-600 dark:text-gray-300\">\n            Answer a few quick questions to get a customized fitness plan\n          </p>\n        </div>\n\n        {/* Progress Bar */}\n        <div className=\"mb-8\">\n          <div className=\"flex justify-between text-sm text-gray-600 dark:text-gray-400 mb-2\">\n            <span>Question {currentStep + 1} of {questions.length}</span>\n            <span>{Math.round(progress)}% Complete</span>\n          </div>\n          <Progress value={progress} className=\"h-2\" />\n        </div>\n\n        {/* Question Card */}\n        <Card className=\"mb-8 bg-white/80 dark:bg-gray-800/80 backdrop-blur border-0 shadow-xl\">\n          <CardHeader>\n            <CardTitle className=\"text-2xl text-center\">\n              {currentQuestion.question}\n            </CardTitle>\n            <CardDescription className=\"text-center\">\n              {currentQuestion.type === 'choice' ? 'Select the option that best describes you' : \n               currentQuestion.description || 'Please provide your information below'}\n            </CardDescription>\n          </CardHeader>\n          <CardContent className=\"space-y-3\">\n            {currentQuestion.type === 'choice' && currentQuestion.options?.map((option, index) => (\n              <Button\n                key={index}\n                variant={answers[currentQuestion.id as keyof OnboardingAnswers] === option ? \"default\" : \"outline\"}\n                className=\"w-full h-auto p-4 text-left justify-start hover:scale-105 transition-all\"\n                onClick={() => handleAnswerSelect(option)}\n                data-testid={`option-${index}`}\n              >\n                <div className=\"flex items-center space-x-3\">\n                  <div className={`w-4 h-4 rounded-full border-2 flex-shrink-0 ${\n                    answers[currentQuestion.id as keyof OnboardingAnswers] === option \n                      ? 'bg-primary border-primary' \n                      : 'border-gray-300'\n                  }`}>\n                    {answers[currentQuestion.id as keyof OnboardingAnswers] === option && (\n                      <div className=\"w-2 h-2 bg-white rounded-full mx-auto mt-0.5\"></div>\n                    )}\n                  </div>\n                  <span className=\"text-wrap\">{option}</span>\n                </div>\n              </Button>\n            ))}\n\n            {currentQuestion.type === 'input' && (\n              <div className=\"space-y-4\">\n                <Label htmlFor={currentQuestion.id} className=\"text-lg font-medium\">\n                  {currentQuestion.placeholder}\n                </Label>\n                <Input\n                  id={currentQuestion.id}\n                  type={currentQuestion.inputType}\n                  placeholder={currentQuestion.placeholder}\n                  value={answers[currentQuestion.id as keyof OnboardingAnswers]}\n                  onChange={(e) => handleInputChange(currentQuestion.id, e.target.value)}\n                  min={currentQuestion.min}\n                  max={currentQuestion.max}\n                  className=\"text-lg p-4 h-14\"\n                  data-testid={`input-${currentQuestion.id}`}\n                />\n              </div>\n            )}\n\n            {currentQuestion.type === 'height' && (\n              <div className=\"space-y-4\">\n                <Label className=\"text-lg font-medium\">Height</Label>\n                <div className=\"grid grid-cols-2 gap-4\">\n                  <div className=\"space-y-2\">\n                    <Label htmlFor=\"heightFeet\">Feet</Label>\n                    <Input\n                      id=\"heightFeet\"\n                      type=\"number\"\n                      placeholder=\"5\"\n                      value={answers.heightFeet}\n                      onChange={(e) => handleInputChange('heightFeet', e.target.value)}\n                      min=\"3\"\n                      max=\"8\"\n                      className=\"text-lg p-4 h-14\"\n                      data-testid=\"input-height-feet\"\n                    />\n                  </div>\n                  <div className=\"space-y-2\">\n                    <Label htmlFor=\"heightInches\">Inches</Label>\n                    <Input\n                      id=\"heightInches\"\n                      type=\"number\"\n                      placeholder=\"10\"\n                      value={answers.heightInches}\n                      onChange={(e) => handleInputChange('heightInches', e.target.value)}\n                      min=\"0\"\n                      max=\"11\"\n                      className=\"text-lg p-4 h-14\"\n                      data-testid=\"input-height-inches\"\n                    />\n                  </div>\n                </div>\n              </div>\n            )}\n\n            {currentQuestion.type === 'weight' && (\n              <div className=\"space-y-4\">\n                <Label className=\"text-lg font-medium\">Current Weight</Label>\n                <div className=\"flex gap-4\">\n                  <div className=\"flex-1\">\n                    <Input\n                      type=\"number\"\n                      placeholder=\"Enter weight\"\n                      value={answers.weight}\n                      onChange={(e) => handleInputChange('weight', e.target.value)}\n                      min=\"50\"\n                      max=\"500\"\n                      className=\"text-lg p-4 h-14\"\n                      data-testid=\"input-weight\"\n                    />\n                  </div>\n                  <div className=\"w-24\">\n                    <Select value={answers.weightUnit} onValueChange={(value) => handleInputChange('weightUnit', value)}>\n                      <SelectTrigger className=\"h-14 text-lg\" data-testid=\"select-weight-unit\">\n                        <SelectValue />\n                      </SelectTrigger>\n                      <SelectContent>\n                        <SelectItem value=\"lbs\">lbs</SelectItem>\n                        <SelectItem value=\"kg\">kg</SelectItem>\n                      </SelectContent>\n                    </Select>\n                  </div>\n                </div>\n              </div>\n            )}\n          </CardContent>\n        </Card>\n\n        {/* Navigation */}\n        <div className=\"flex justify-between\">\n          <Button\n            variant=\"outline\"\n            onClick={handlePrevious}\n            disabled={currentStep === 0}\n            className=\"flex items-center space-x-2\"\n            data-testid=\"previous-button\"\n          >\n            <ArrowLeft size={16} />\n            <span>Previous</span>\n          </Button>\n          \n          <Button\n            onClick={handleNext}\n            disabled={!isCurrentAnswered()}\n            className=\"flex items-center space-x-2\"\n            data-testid=\"next-button\"\n          >\n            <span>{currentStep === questions.length - 1 ? 'Create My Plan' : 'Next'}</span>\n            <ArrowRight size={16} />\n          </Button>\n        </div>\n      </div>\n    </div>\n  );\n}","size_bytes":14010},"client/src/components/ui/toast.tsx":{"content":"import * as React from \"react\"\nimport * as ToastPrimitives from \"@radix-ui/react-toast\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\nimport { X } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ToastProvider = ToastPrimitives.Provider\n\nconst ToastViewport = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Viewport>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Viewport>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Viewport\n    ref={ref}\n    className={cn(\n      \"fixed top-0 z-[100] flex max-h-screen w-full flex-col-reverse p-4 sm:bottom-0 sm:right-0 sm:top-auto sm:flex-col md:max-w-[420px]\",\n      className\n    )}\n    {...props}\n  />\n))\nToastViewport.displayName = ToastPrimitives.Viewport.displayName\n\nconst toastVariants = cva(\n  \"group pointer-events-auto relative flex w-full items-center justify-between space-x-4 overflow-hidden rounded-md border p-6 pr-8 shadow-lg transition-all data-[swipe=cancel]:translate-x-0 data-[swipe=end]:translate-x-[var(--radix-toast-swipe-end-x)] data-[swipe=move]:translate-x-[var(--radix-toast-swipe-move-x)] data-[swipe=move]:transition-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[swipe=end]:animate-out data-[state=closed]:fade-out-80 data-[state=closed]:slide-out-to-right-full data-[state=open]:slide-in-from-top-full data-[state=open]:sm:slide-in-from-bottom-full\",\n  {\n    variants: {\n      variant: {\n        default: \"border bg-background text-foreground\",\n        destructive:\n          \"destructive group border-destructive bg-destructive text-destructive-foreground\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  }\n)\n\nconst Toast = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Root>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Root> &\n    VariantProps<typeof toastVariants>\n>(({ className, variant, ...props }, ref) => {\n  return (\n    <ToastPrimitives.Root\n      ref={ref}\n      className={cn(toastVariants({ variant }), className)}\n      {...props}\n    />\n  )\n})\nToast.displayName = ToastPrimitives.Root.displayName\n\nconst ToastAction = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Action>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Action>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Action\n    ref={ref}\n    className={cn(\n      \"inline-flex h-8 shrink-0 items-center justify-center rounded-md border bg-transparent px-3 text-sm font-medium ring-offset-background transition-colors hover:bg-secondary focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 group-[.destructive]:border-muted/40 group-[.destructive]:hover:border-destructive/30 group-[.destructive]:hover:bg-destructive group-[.destructive]:hover:text-destructive-foreground group-[.destructive]:focus:ring-destructive\",\n      className\n    )}\n    {...props}\n  />\n))\nToastAction.displayName = ToastPrimitives.Action.displayName\n\nconst ToastClose = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Close>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Close>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Close\n    ref={ref}\n    className={cn(\n      \"absolute right-2 top-2 rounded-md p-1 text-foreground/50 opacity-0 transition-opacity hover:text-foreground focus:opacity-100 focus:outline-none focus:ring-2 group-hover:opacity-100 group-[.destructive]:text-red-300 group-[.destructive]:hover:text-red-50 group-[.destructive]:focus:ring-red-400 group-[.destructive]:focus:ring-offset-red-600\",\n      className\n    )}\n    toast-close=\"\"\n    {...props}\n  >\n    <X className=\"h-4 w-4\" />\n  </ToastPrimitives.Close>\n))\nToastClose.displayName = ToastPrimitives.Close.displayName\n\nconst ToastTitle = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Title>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Title>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Title\n    ref={ref}\n    className={cn(\"text-sm font-semibold\", className)}\n    {...props}\n  />\n))\nToastTitle.displayName = ToastPrimitives.Title.displayName\n\nconst ToastDescription = React.forwardRef<\n  React.ElementRef<typeof ToastPrimitives.Description>,\n  React.ComponentPropsWithoutRef<typeof ToastPrimitives.Description>\n>(({ className, ...props }, ref) => (\n  <ToastPrimitives.Description\n    ref={ref}\n    className={cn(\"text-sm opacity-90\", className)}\n    {...props}\n  />\n))\nToastDescription.displayName = ToastPrimitives.Description.displayName\n\ntype ToastProps = React.ComponentPropsWithoutRef<typeof Toast>\n\ntype ToastActionElement = React.ReactElement<typeof ToastAction>\n\nexport {\n  type ToastProps,\n  type ToastActionElement,\n  ToastProvider,\n  ToastViewport,\n  Toast,\n  ToastTitle,\n  ToastDescription,\n  ToastClose,\n  ToastAction,\n}\n","size_bytes":4845},"client/src/components/progress-charts.tsx":{"content":"import { useQuery } from \"@tanstack/react-query\";\nimport { useEffect, useRef } from \"react\";\nimport type { Workout } from \"@shared/schema\";\n\ninterface WeightProgressData {\n  exerciseNames: string[];\n  maxWeights: number[];\n  progressOverTime: { exerciseName: string; dates: string[]; weights: number[] }[];\n}\n\ndeclare global {\n  interface Window {\n    Chart: any;\n  }\n}\n\nexport default function ProgressCharts() {\n  const { data: workouts } = useQuery<Workout[]>({\n    queryKey: [\"/api/workouts\"],\n  });\n  \n  const { data: weightProgress } = useQuery<WeightProgressData>({\n    queryKey: [\"/api/progress/weight\"],\n  });\n\n  const frequencyChartRef = useRef<HTMLCanvasElement>(null);\n  const weightChartRef = useRef<HTMLCanvasElement>(null);\n  const frequencyChartInstance = useRef<any>(null);\n  const weightChartInstance = useRef<any>(null);\n\n  useEffect(() => {\n    // Load Chart.js if not already loaded\n    if (!window.Chart) {\n      const script = document.createElement('script');\n      script.src = 'https://cdn.jsdelivr.net/npm/chart.js';\n      script.onload = () => {\n        initializeCharts();\n      };\n      document.head.appendChild(script);\n    } else {\n      initializeCharts();\n    }\n  }, [workouts, weightProgress]);\n\n  const initializeCharts = () => {\n    if (!workouts || !window.Chart) return;\n\n    // Workout Frequency Chart\n    if (frequencyChartRef.current) {\n      const ctx = frequencyChartRef.current.getContext('2d');\n      if (ctx) {\n        // Destroy existing chart if it exists\n        if (frequencyChartInstance.current) {\n          frequencyChartInstance.current.destroy();\n        }\n        \n        // Process workout data for the last 7 days\n        const last7Days = Array.from({ length: 7 }, (_, i) => {\n          const date = new Date();\n          date.setDate(date.getDate() - (6 - i));\n          return date;\n        });\n\n        const dailyWorkouts = last7Days.map(date => {\n          return workouts.filter(workout => {\n            const workoutDate = new Date(workout.date);\n            return workoutDate.toDateString() === date.toDateString();\n          }).length;\n        });\n\n        // Generate dynamic day labels based on actual dates\n        const dayLabels = last7Days.map(date => {\n          const days = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];\n          return days[date.getDay()];\n        });\n\n        frequencyChartInstance.current = new window.Chart(ctx, {\n          type: 'line',\n          data: {\n            labels: dayLabels,\n            datasets: [{\n              label: 'Workouts',\n              data: dailyWorkouts,\n              borderColor: '#1E40AF',\n              backgroundColor: 'rgba(30, 64, 175, 0.1)',\n              tension: 0.4,\n              fill: true\n            }]\n          },\n          options: {\n            responsive: true,\n            maintainAspectRatio: false,\n            plugins: {\n              legend: {\n                display: false\n              }\n            },\n            scales: {\n              y: {\n                beginAtZero: true,\n                ticks: {\n                  stepSize: 1\n                }\n              }\n            }\n          }\n        });\n      }\n    }\n\n    // Weight Progress Chart (using real workout data)\n    if (weightChartRef.current && weightProgress) {\n      const ctx = weightChartRef.current.getContext('2d');\n      if (ctx) {\n        // Destroy existing chart if it exists\n        if (weightChartInstance.current) {\n          weightChartInstance.current.destroy();\n        }\n        \n        if (weightProgress.exerciseNames.length > 0) {\n          // Create color palette for exercises\n          const colors = [\n            'rgba(30, 64, 175, 0.8)',\n            'rgba(5, 150, 105, 0.8)',\n            'rgba(249, 115, 22, 0.8)',\n            'rgba(168, 85, 247, 0.8)',\n            'rgba(239, 68, 68, 0.8)',\n            'rgba(245, 158, 11, 0.8)',\n            'rgba(59, 130, 246, 0.8)',\n            'rgba(16, 185, 129, 0.8)'\n          ];\n          \n          weightChartInstance.current = new window.Chart(ctx, {\n            type: 'bar',\n            data: {\n              labels: weightProgress.exerciseNames,\n              datasets: [{\n                label: 'Max Weight (lbs)',\n                data: weightProgress.maxWeights,\n                backgroundColor: weightProgress.exerciseNames.map((_, i) => colors[i % colors.length]),\n                borderRadius: 6\n              }]\n            },\n            options: {\n              responsive: true,\n              maintainAspectRatio: false,\n              plugins: {\n                legend: {\n                  display: false\n                },\n                tooltip: {\n                  callbacks: {\n                    label: function(context: any) {\n                      return `Max Weight: ${context.parsed.y} lbs`;\n                    }\n                  }\n                }\n              },\n              scales: {\n                y: {\n                  beginAtZero: true,\n                  title: {\n                    display: true,\n                    text: 'Weight (lbs)'\n                  }\n                },\n                x: {\n                  ticks: {\n                    maxRotation: 45,\n                    font: {\n                      size: 10\n                    }\n                  }\n                }\n              }\n            }\n          });\n        }\n      }\n    }\n  };\n\n  return (\n    <section className=\"bg-white rounded-2xl shadow-sm border border-gray-100 p-6\">\n      <div className=\"flex items-center justify-between mb-6\">\n        <h3 className=\"text-xl font-bold text-gray-800\">Progress Overview</h3>\n        <select className=\"text-sm border border-gray-200 rounded-lg px-3 py-2 focus:ring-2 focus:ring-primary focus:border-transparent outline-none\">\n          <option>Last 7 days</option>\n          <option>Last 30 days</option>\n          <option>Last 3 months</option>\n        </select>\n      </div>\n\n      <div className=\"grid md:grid-cols-2 gap-6\">\n        <div>\n          <h4 className=\"font-medium text-gray-800 mb-3\">Workout Frequency</h4>\n          <div className=\"h-48 bg-gray-50 rounded-xl flex items-center justify-center\">\n            <canvas ref={frequencyChartRef} className=\"max-w-full max-h-full\"></canvas>\n          </div>\n        </div>\n        <div>\n          <h4 className=\"font-medium text-gray-800 mb-3\">Weight Progress</h4>\n          <div className=\"h-48 bg-gray-50 rounded-xl flex items-center justify-center\">\n            {!weightProgress ? (\n              <div className=\"text-gray-500 text-sm text-center\">\n                <div className=\"animate-pulse mb-2\">Loading...</div>\n              </div>\n            ) : weightProgress.exerciseNames.length === 0 ? (\n              <div className=\"text-gray-500 text-sm text-center\">\n                <div className=\"mb-2\">📊 No weight data yet</div>\n                <div className=\"text-xs\">Log workouts with weights to see your progress</div>\n              </div>\n            ) : (\n              <canvas ref={weightChartRef} className=\"max-w-full max-h-full\" data-testid=\"weight-progress-chart\"></canvas>\n            )}\n          </div>\n        </div>\n      </div>\n    </section>\n  );\n}\n","size_bytes":7185},"server/objectStorage.ts":{"content":"import { Storage, File } from \"@google-cloud/storage\";\nimport { Response } from \"express\";\nimport { randomUUID } from \"crypto\";\nimport {\n  ObjectAclPolicy,\n  ObjectPermission,\n  canAccessObject,\n  getObjectAclPolicy,\n  setObjectAclPolicy,\n} from \"./objectAcl\";\n\nconst REPLIT_SIDECAR_ENDPOINT = \"http://127.0.0.1:1106\";\n\nexport const objectStorageClient = new Storage({\n  credentials: {\n    audience: \"replit\",\n    subject_token_type: \"access_token\",\n    token_url: `${REPLIT_SIDECAR_ENDPOINT}/token`,\n    type: \"external_account\",\n    credential_source: {\n      url: `${REPLIT_SIDECAR_ENDPOINT}/credential`,\n      format: {\n        type: \"json\",\n        subject_token_field_name: \"access_token\",\n      },\n    },\n    universe_domain: \"googleapis.com\",\n  },\n  projectId: \"\",\n});\n\nexport class ObjectNotFoundError extends Error {\n  constructor() {\n    super(\"Object not found\");\n    this.name = \"ObjectNotFoundError\";\n    Object.setPrototypeOf(this, ObjectNotFoundError.prototype);\n  }\n}\n\nexport class ObjectStorageService {\n  constructor() {}\n\n  // Gets the public object search paths.\n  getPublicObjectSearchPaths(): Array<string> {\n    const pathsStr = process.env.PUBLIC_OBJECT_SEARCH_PATHS || \"\";\n    const paths = Array.from(\n      new Set(\n        pathsStr\n          .split(\",\")\n          .map((path) => path.trim())\n          .filter((path) => path.length > 0)\n      )\n    );\n    if (paths.length === 0) {\n      throw new Error(\n        \"PUBLIC_OBJECT_SEARCH_PATHS not set. Create a bucket in 'Object Storage' \" +\n          \"tool and set PUBLIC_OBJECT_SEARCH_PATHS env var (comma-separated paths).\"\n      );\n    }\n    return paths;\n  }\n\n  // Gets the private object directory.\n  getPrivateObjectDir(): string {\n    const dir = process.env.PRIVATE_OBJECT_DIR || \"\";\n    if (!dir) {\n      throw new Error(\n        \"PRIVATE_OBJECT_DIR not set. Create a bucket in 'Object Storage' \" +\n          \"tool and set PRIVATE_OBJECT_DIR env var.\"\n      );\n    }\n    return dir;\n  }\n\n  // Search for a public object from the search paths.\n  async searchPublicObject(filePath: string): Promise<File | null> {\n    for (const searchPath of this.getPublicObjectSearchPaths()) {\n      const fullPath = `${searchPath}/${filePath}`;\n\n      // Full path format: /<bucket_name>/<object_name>\n      const { bucketName, objectName } = parseObjectPath(fullPath);\n      const bucket = objectStorageClient.bucket(bucketName);\n      const file = bucket.file(objectName);\n\n      // Check if file exists\n      const [exists] = await file.exists();\n      if (exists) {\n        return file;\n      }\n    }\n\n    return null;\n  }\n\n  // Downloads an object to the response.\n  async downloadObject(file: File, res: Response, cacheTtlSec: number = 3600) {\n    try {\n      // Get file metadata\n      const [metadata] = await file.getMetadata();\n      // Get the ACL policy for the object.\n      const aclPolicy = await getObjectAclPolicy(file);\n      const isPublic = aclPolicy?.visibility === \"public\";\n      // Set appropriate headers\n      res.set({\n        \"Content-Type\": metadata.contentType || \"application/octet-stream\",\n        \"Content-Length\": metadata.size,\n        \"Cache-Control\": `${\n          isPublic ? \"public\" : \"private\"\n        }, max-age=${cacheTtlSec}`,\n      });\n\n      // Stream the file to the response\n      const stream = file.createReadStream();\n\n      stream.on(\"error\", (err) => {\n        console.error(\"Stream error:\", err);\n        if (!res.headersSent) {\n          res.status(500).json({ error: \"Error streaming file\" });\n        }\n      });\n\n      stream.pipe(res);\n    } catch (error) {\n      console.error(\"Error downloading file:\", error);\n      if (!res.headersSent) {\n        res.status(500).json({ error: \"Error downloading file\" });\n      }\n    }\n  }\n\n  // Gets the upload URL for an object entity.\n  async getObjectEntityUploadURL(): Promise<string> {\n    const privateObjectDir = this.getPrivateObjectDir();\n    if (!privateObjectDir) {\n      throw new Error(\n        \"PRIVATE_OBJECT_DIR not set. Create a bucket in 'Object Storage' \" +\n          \"tool and set PRIVATE_OBJECT_DIR env var.\"\n      );\n    }\n\n    const objectId = randomUUID();\n    const fullPath = `${privateObjectDir}/uploads/${objectId}`;\n\n    const { bucketName, objectName } = parseObjectPath(fullPath);\n\n    // Sign URL for PUT method with TTL\n    return signObjectURL({\n      bucketName,\n      objectName,\n      method: \"PUT\",\n      ttlSec: 900,\n    });\n  }\n\n  // Gets the object entity file from the object path.\n  async getObjectEntityFile(objectPath: string): Promise<File> {\n    if (!objectPath.startsWith(\"/objects/\")) {\n      throw new ObjectNotFoundError();\n    }\n\n    const parts = objectPath.slice(1).split(\"/\");\n    if (parts.length < 2) {\n      throw new ObjectNotFoundError();\n    }\n\n    const entityId = parts.slice(1).join(\"/\");\n    let entityDir = this.getPrivateObjectDir();\n    if (!entityDir.endsWith(\"/\")) {\n      entityDir = `${entityDir}/`;\n    }\n    const objectEntityPath = `${entityDir}${entityId}`;\n    const { bucketName, objectName } = parseObjectPath(objectEntityPath);\n    const bucket = objectStorageClient.bucket(bucketName);\n    const objectFile = bucket.file(objectName);\n    const [exists] = await objectFile.exists();\n    if (!exists) {\n      throw new ObjectNotFoundError();\n    }\n    return objectFile;\n  }\n\n  normalizeObjectEntityPath(\n    rawPath: string,\n  ): string {\n    if (!rawPath.startsWith(\"https://storage.googleapis.com/\")) {\n      return rawPath;\n    }\n  \n    // Extract the path from the URL by removing query parameters and domain\n    const url = new URL(rawPath);\n    const rawObjectPath = url.pathname;\n  \n    let objectEntityDir = this.getPrivateObjectDir();\n    if (!objectEntityDir.endsWith(\"/\")) {\n      objectEntityDir = `${objectEntityDir}/`;\n    }\n  \n    if (!rawObjectPath.startsWith(objectEntityDir)) {\n      return rawObjectPath;\n    }\n  \n    // Extract the entity ID from the path\n    const entityId = rawObjectPath.slice(objectEntityDir.length);\n    return `/objects/${entityId}`;\n  }\n\n  // Tries to set the ACL policy for the object entity and return the normalized path.\n  async trySetObjectEntityAclPolicy(\n    rawPath: string,\n    aclPolicy: ObjectAclPolicy\n  ): Promise<string> {\n    const normalizedPath = this.normalizeObjectEntityPath(rawPath);\n    if (!normalizedPath.startsWith(\"/\")) {\n      return normalizedPath;\n    }\n\n    const objectFile = await this.getObjectEntityFile(normalizedPath);\n    await setObjectAclPolicy(objectFile, aclPolicy);\n    return normalizedPath;\n  }\n\n  // Checks if the user can access the object entity.\n  async canAccessObjectEntity({\n    userId,\n    objectFile,\n    requestedPermission,\n  }: {\n    userId?: string;\n    objectFile: File;\n    requestedPermission?: ObjectPermission;\n  }): Promise<boolean> {\n    return canAccessObject({\n      userId,\n      objectFile,\n      requestedPermission: requestedPermission ?? ObjectPermission.READ,\n    });\n  }\n}\n\nfunction parseObjectPath(path: string): {\n  bucketName: string;\n  objectName: string;\n} {\n  if (!path.startsWith(\"/\")) {\n    path = `/${path}`;\n  }\n  const pathParts = path.split(\"/\");\n  if (pathParts.length < 3) {\n    throw new Error(\"Invalid path: must contain at least a bucket name\");\n  }\n\n  const bucketName = pathParts[1];\n  const objectName = pathParts.slice(2).join(\"/\");\n\n  return {\n    bucketName,\n    objectName,\n  };\n}\n\nasync function signObjectURL({\n  bucketName,\n  objectName,\n  method,\n  ttlSec,\n}: {\n  bucketName: string;\n  objectName: string;\n  method: \"GET\" | \"PUT\" | \"DELETE\" | \"HEAD\";\n  ttlSec: number;\n}): Promise<string> {\n  const request = {\n    bucket_name: bucketName,\n    object_name: objectName,\n    method,\n    expires_at: new Date(Date.now() + ttlSec * 1000).toISOString(),\n  };\n  const response = await fetch(\n    `${REPLIT_SIDECAR_ENDPOINT}/object-storage/signed-object-url`,\n    {\n      method: \"POST\",\n      headers: {\n        \"Content-Type\": \"application/json\",\n      },\n      body: JSON.stringify(request),\n    }\n  );\n  if (!response.ok) {\n    throw new Error(\n      `Failed to sign object URL, errorcode: ${response.status}, ` +\n        `make sure you're running on Replit`\n    );\n  }\n\n  const { signed_url: signedURL } = await response.json();\n  return signedURL;\n}","size_bytes":8242},"client/src/components/calendar-view.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery, useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport { ChevronLeft, ChevronRight, Edit3, Check, X, Plus } from \"lucide-react\";\nimport { format, startOfMonth, endOfMonth, eachDayOfInterval, getDay, isSameDay, addMonths, subMonths } from \"date-fns\";\nimport { Button } from \"@/components/ui/button\";\nimport { Dialog, DialogContent, DialogHeader, DialogTitle } from \"@/components/ui/dialog\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport type { Workout, CalendarNote } from \"@shared/schema\";\n\nexport default function CalendarView() {\n  const [currentMonth, setCurrentMonth] = useState(new Date());\n  const [selectedDate, setSelectedDate] = useState<Date | null>(null);\n  const [editingNote, setEditingNote] = useState<CalendarNote | null>(null);\n  const [isDialogOpen, setIsDialogOpen] = useState(false);\n  const [noteText, setNoteText] = useState(\"\");\n  const queryClient = useQueryClient();\n\n  const { data: workouts } = useQuery<Workout[]>({\n    queryKey: [\"/api/workouts/range\", format(startOfMonth(currentMonth), 'yyyy-MM-dd'), format(endOfMonth(currentMonth), 'yyyy-MM-dd')],\n  });\n\n  const { data: calendarNotes } = useQuery<CalendarNote[]>({\n    queryKey: [\"/api/calendar-notes\"],\n  });\n\n  const monthStart = startOfMonth(currentMonth);\n  const monthEnd = endOfMonth(currentMonth);\n  const monthDays = eachDayOfInterval({ start: monthStart, end: monthEnd });\n\n  // Calculate calendar grid with proper week alignment\n  const firstDayOfMonth = getDay(monthStart);\n  const calendarDays = Array.from({ length: 42 }, (_, i) => {\n    const dayIndex = i - firstDayOfMonth;\n    if (dayIndex < 0) return null;\n    if (dayIndex >= monthDays.length) return null;\n    return monthDays[dayIndex];\n  });\n\n  const getWorkoutsForDay = (date: Date) => {\n    if (!workouts) return [];\n    return workouts.filter(workout => \n      isSameDay(new Date(workout.date), date)\n    );\n  };\n\n  const getWorkoutIndicators = (dayWorkouts: Workout[]) => {\n    const categories = Array.from(new Set(dayWorkouts.map(w => w.category)));\n    const colorMap = {\n      strength: \"bg-primary\",\n      cardio: \"bg-secondary\", \n      yoga: \"bg-accent\",\n      swimming: \"bg-blue-500\"\n    };\n    \n    return categories.map(category => colorMap[category as keyof typeof colorMap] || \"bg-gray-500\");\n  };\n\n  const navigateMonth = (direction: 'prev' | 'next') => {\n    setCurrentMonth(prev => \n      direction === 'prev' ? subMonths(prev, 1) : addMonths(prev, 1)\n    );\n  };\n\n  const getNotesForDay = (date: Date) => {\n    if (!calendarNotes) return [];\n    return calendarNotes.filter(note => \n      isSameDay(new Date(note.date), date)\n    );\n  };\n\n  const createNoteMutation = useMutation({\n    mutationFn: async (data: { date: string; note: string }) => {\n      return apiRequest(\"POST\", \"/api/calendar-notes\", data);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/calendar-notes\"] });\n      setIsDialogOpen(false);\n      setNoteText(\"\");\n      setSelectedDate(null);\n    },\n  });\n\n  const updateNoteMutation = useMutation({\n    mutationFn: async ({ id, note }: { id: string; note: string }) => {\n      return apiRequest(\"PUT\", `/api/calendar-notes/${id}`, { note });\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/calendar-notes\"] });\n      setEditingNote(null);\n      setIsDialogOpen(false);\n      setNoteText(\"\");\n    },\n  });\n\n  const deleteNoteMutation = useMutation({\n    mutationFn: async (id: string) => {\n      return apiRequest(\"DELETE\", `/api/calendar-notes/${id}`);\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/calendar-notes\"] });\n    },\n  });\n\n  const handleDayClick = (date: Date) => {\n    setSelectedDate(date);\n    const dayNotes = getNotesForDay(date);\n    if (dayNotes.length > 0) {\n      setEditingNote(dayNotes[0]);\n      setNoteText(dayNotes[0].note);\n    } else {\n      setEditingNote(null);\n      setNoteText(\"\");\n    }\n    setIsDialogOpen(true);\n  };\n\n  const handleSaveNote = () => {\n    if (!selectedDate || !noteText.trim()) return;\n\n    if (editingNote) {\n      updateNoteMutation.mutate({ id: editingNote.id, note: noteText });\n    } else {\n      createNoteMutation.mutate({\n        date: format(selectedDate, 'yyyy-MM-dd'),\n        note: noteText\n      });\n    }\n  };\n\n  const handleDeleteNote = () => {\n    if (editingNote) {\n      deleteNoteMutation.mutate(editingNote.id);\n      setIsDialogOpen(false);\n      setEditingNote(null);\n      setNoteText(\"\");\n    }\n  };\n\n  return (\n    <section className=\"relative bg-gradient-to-br from-black via-red-900/30 to-black rounded-3xl shadow-2xl border border-red-600/50 p-8 overflow-hidden hexagon-bg hexagon-pattern\">\n      {/* Animated red and black background elements */}\n      <div className=\"absolute inset-0\">\n        {/* Floating red hexagons */}\n        <div className=\"absolute top-0 left-0 w-32 h-28 opacity-30 animate-pulse\" style={{animationDuration: '4s'}}>\n          <svg viewBox=\"0 0 120 104\" className=\"w-full h-full\">\n            <polygon points=\"30,2 90,2 120,52 90,102 30,102 0,52\" fill=\"#dc2626\" stroke=\"#dc2626\" strokeWidth=\"2\" opacity=\"0.6\"/>\n          </svg>\n        </div>\n        <div className=\"absolute top-1/4 right-0 w-24 h-21 opacity-20 animate-bounce\" style={{animationDuration: '6s'}}>\n          <svg viewBox=\"0 0 120 104\" className=\"w-full h-full\">\n            <polygon points=\"30,2 90,2 120,52 90,102 30,102 0,52\" fill=\"none\" stroke=\"#dc2626\" strokeWidth=\"2\" opacity=\"0.8\"/>\n          </svg>\n        </div>\n        <div className=\"absolute bottom-0 left-1/3 w-28 h-24 opacity-25 animate-ping\" style={{animationDuration: '8s', animationDelay: '1s'}}>\n          <svg viewBox=\"0 0 120 104\" className=\"w-full h-full\">\n            <polygon points=\"30,2 90,2 120,52 90,102 30,102 0,52\" fill=\"#000000\" stroke=\"#dc2626\" strokeWidth=\"1\" opacity=\"0.7\"/>\n          </svg>\n        </div>\n        <div className=\"absolute bottom-1/4 right-1/4 w-20 h-17 opacity-15 animate-pulse\" style={{animationDuration: '5s', animationDelay: '2s'}}>\n          <svg viewBox=\"0 0 120 104\" className=\"w-full h-full\">\n            <polygon points=\"30,2 90,2 120,52 90,102 30,102 0,52\" fill=\"#dc2626\" stroke=\"#000000\" strokeWidth=\"1\" opacity=\"0.5\"/>\n          </svg>\n        </div>\n        <div className=\"absolute top-1/2 left-10 w-22 h-19 opacity-20 animate-bounce\" style={{animationDuration: '7s', animationDelay: '0.5s'}}>\n          <svg viewBox=\"0 0 120 104\" className=\"w-full h-full\">\n            <polygon points=\"30,2 90,2 120,52 90,102 30,102 0,52\" fill=\"none\" stroke=\"#dc2626\" strokeWidth=\"2\" opacity=\"0.4\"/>\n          </svg>\n        </div>\n        \n        {/* Animated red gradient orbs */}\n        <div className=\"absolute top-1/3 right-1/3 w-40 h-40 bg-gradient-to-br from-red-600/20 to-black/40 rounded-full blur-3xl opacity-30 animate-pulse\" style={{animationDuration: '6s'}}></div>\n        <div className=\"absolute bottom-1/3 left-1/4 w-32 h-32 bg-gradient-to-br from-black/60 to-red-600/20 rounded-full blur-2xl opacity-20 animate-ping\" style={{animationDuration: '10s'}}></div>\n        \n        {/* Dynamic radial gradient overlay */}\n        <div className=\"absolute inset-0 bg-gradient-radial from-transparent via-red-900/10 to-black/60 animate-pulse\" style={{animationDuration: '8s'}}></div>\n      </div>\n      {/* Content wrapper */}\n      <div className=\"relative z-10\">\n      <div className=\"flex items-center justify-between mb-6\">\n        <h3 className=\"text-2xl font-bold text-white drop-shadow-lg\">Workout Calendar</h3>\n        <div className=\"flex items-center space-x-2\">\n          <button \n            onClick={() => navigateMonth('prev')}\n            className=\"text-gray-300 hover:text-cyan-300 transition-colors\"\n          >\n            <ChevronLeft />\n          </button>\n          <span className=\"font-medium text-white drop-shadow-lg\">\n            {format(currentMonth, 'MMMM yyyy')}\n          </span>\n          <button \n            onClick={() => navigateMonth('next')}\n            className=\"text-gray-300 hover:text-cyan-300 transition-colors\"\n          >\n            <ChevronRight />\n          </button>\n        </div>\n      </div>\n\n      {/* Calendar Grid */}\n      <div className=\"grid grid-cols-7 gap-1 mb-2\">\n        {['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'].map(day => (\n          <div key={day} className=\"text-center text-xs font-medium text-muted py-2\">\n            {day}\n          </div>\n        ))}\n      </div>\n\n      <div className=\"grid grid-cols-7 gap-1\">\n        {calendarDays.map((day, index) => {\n          if (!day) {\n            return <div key={index} className=\"aspect-square\"></div>;\n          }\n\n          const dayWorkouts = getWorkoutsForDay(day);\n          const indicators = getWorkoutIndicators(dayWorkouts);\n          const dayNotes = getNotesForDay(day);\n          const isToday = isSameDay(day, new Date());\n          const hasNote = dayNotes.length > 0;\n\n          return (\n            <div\n              key={day.toISOString()}\n              onClick={() => handleDayClick(day)}\n              className={`aspect-square flex flex-col items-center justify-center text-sm border border-gray-100 rounded-lg hover:bg-gray-50 transition-colors cursor-pointer relative ${\n                isToday ? 'border-primary bg-primary bg-opacity-10' : ''\n              }`}\n              data-testid={`calendar-day-${format(day, 'yyyy-MM-dd')}`}\n            >\n              <span className={`${isToday ? 'text-red-400 font-bold' : dayWorkouts.length > 0 ? 'text-white font-medium' : 'text-white'}`}>\n                {format(day, 'd')}\n              </span>\n              \n              {/* Workout indicators */}\n              {indicators.length > 0 && (\n                <div className=\"absolute bottom-1 left-1 flex space-x-1\">\n                  {indicators.slice(0, 3).map((colorClass, i) => (\n                    <div key={i} className={`w-1 h-1 ${colorClass} rounded-full`}></div>\n                  ))}\n                </div>\n              )}\n              \n              {/* Note indicator */}\n              {hasNote && (\n                <div className=\"absolute top-1 right-1\">\n                  <div className=\"w-2 h-2 bg-yellow-500 rounded-full\" title=\"Has note\"></div>\n                </div>\n              )}\n            </div>\n          );\n        })}\n      </div>\n\n      <div className=\"mt-4 flex items-center justify-center space-x-4 text-xs\">\n        <div className=\"flex items-center space-x-2\">\n          <div className=\"w-2 h-2 bg-primary rounded-full\"></div>\n          <span className=\"text-muted\">Strength</span>\n        </div>\n        <div className=\"flex items-center space-x-2\">\n          <div className=\"w-2 h-2 bg-secondary rounded-full\"></div>\n          <span className=\"text-muted\">Cardio</span>\n        </div>\n        <div className=\"flex items-center space-x-2\">\n          <div className=\"w-2 h-2 bg-accent rounded-full\"></div>\n          <span className=\"text-muted\">Yoga</span>\n        </div>\n        <div className=\"flex items-center space-x-2\">\n          <div className=\"w-2 h-2 bg-yellow-500 rounded-full\"></div>\n          <span className=\"text-muted\">Notes</span>\n        </div>\n      </div>\n\n      {/* Note Dialog */}\n      <Dialog open={isDialogOpen} onOpenChange={setIsDialogOpen}>\n        <DialogContent className=\"sm:max-w-md\">\n          <DialogHeader>\n            <DialogTitle className=\"flex items-center gap-2\">\n              <Edit3 className=\"w-5 h-5\" />\n              {selectedDate ? `Note for ${format(selectedDate, 'MMMM d, yyyy')}` : 'Calendar Note'}\n            </DialogTitle>\n          </DialogHeader>\n          <div className=\"space-y-4\">\n            <Textarea\n              placeholder=\"Add a note for this day...\"\n              value={noteText}\n              onChange={(e) => setNoteText(e.target.value)}\n              className=\"min-h-[100px]\"\n              data-testid=\"note-textarea\"\n            />\n            <div className=\"flex justify-between\">\n              <div>\n                {editingNote && (\n                  <Button\n                    variant=\"destructive\"\n                    size=\"sm\"\n                    onClick={handleDeleteNote}\n                    data-testid=\"delete-note-button\"\n                  >\n                    <X className=\"w-4 h-4 mr-1\" />\n                    Delete\n                  </Button>\n                )}\n              </div>\n              <div className=\"flex gap-2\">\n                <Button\n                  variant=\"outline\"\n                  size=\"sm\"\n                  onClick={() => setIsDialogOpen(false)}\n                  data-testid=\"cancel-note-button\"\n                >\n                  Cancel\n                </Button>\n                <Button\n                  size=\"sm\"\n                  onClick={handleSaveNote}\n                  disabled={!noteText.trim() || createNoteMutation.isPending || updateNoteMutation.isPending}\n                  data-testid=\"save-note-button\"\n                >\n                  <Check className=\"w-4 h-4 mr-1\" />\n                  {editingNote ? 'Update' : 'Save'}\n                </Button>\n              </div>\n            </div>\n          </div>\n        </DialogContent>\n      </Dialog>\n      </div>\n    </section>\n  );\n}\n","size_bytes":13315},"client/src/hooks/use-mobile.tsx":{"content":"import * as React from \"react\"\n\nconst MOBILE_BREAKPOINT = 768\n\nexport function useIsMobile() {\n  const [isMobile, setIsMobile] = React.useState<boolean | undefined>(undefined)\n\n  React.useEffect(() => {\n    const mql = window.matchMedia(`(max-width: ${MOBILE_BREAKPOINT - 1}px)`)\n    const onChange = () => {\n      setIsMobile(window.innerWidth < MOBILE_BREAKPOINT)\n    }\n    mql.addEventListener(\"change\", onChange)\n    setIsMobile(window.innerWidth < MOBILE_BREAKPOINT)\n    return () => mql.removeEventListener(\"change\", onChange)\n  }, [])\n\n  return !!isMobile\n}\n","size_bytes":565},"client/src/components/ui/card.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Card = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\n      \"rounded-lg border bg-card text-card-foreground shadow-sm\",\n      className\n    )}\n    {...props}\n  />\n))\nCard.displayName = \"Card\"\n\nconst CardHeader = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"flex flex-col space-y-1.5 p-6\", className)}\n    {...props}\n  />\n))\nCardHeader.displayName = \"CardHeader\"\n\nconst CardTitle = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\n      \"text-2xl font-semibold leading-none tracking-tight\",\n      className\n    )}\n    {...props}\n  />\n))\nCardTitle.displayName = \"CardTitle\"\n\nconst CardDescription = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nCardDescription.displayName = \"CardDescription\"\n\nconst CardContent = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div ref={ref} className={cn(\"p-6 pt-0\", className)} {...props} />\n))\nCardContent.displayName = \"CardContent\"\n\nconst CardFooter = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"flex items-center p-6 pt-0\", className)}\n    {...props}\n  />\n))\nCardFooter.displayName = \"CardFooter\"\n\nexport { Card, CardHeader, CardFooter, CardTitle, CardDescription, CardContent }\n","size_bytes":1858},"server/storage.ts":{"content":"import { \n  type User, \n  type InsertUser,\n  type UpsertUser,\n  type SignUpData,\n  type SignInData,\n  type Exercise,\n  type InsertExercise,\n  type Workout,\n  type InsertWorkout,\n  type WorkoutExercise,\n  type InsertWorkoutExercise,\n  type Goal,\n  type InsertGoal,\n  type Trainer,\n  type InsertTrainer,\n  type TrainerService,\n  type InsertTrainerService,\n  type Booking,\n  type InsertBooking,\n  type TrainerReview,\n  type InsertTrainerReview,\n  type WorkoutWithExercises,\n  type TrainerWithServices,\n  type BookingWithDetails,\n  type TrainerReviewWithUser,\n  type UserStats,\n  type FoodEntry,\n  type InsertFoodEntry,\n  type LeaderboardEntry,\n  type MileTrackerSession,\n  type MileTrackerSplit,\n  type MileTrackerSessionWithSplits,\n  type InsertMileTrackerSession,\n  type InsertMileTrackerSplit,\n  type CommunityPost,\n  type CommunityPostWithUser,\n  type InsertCommunityPost,\n  type MealPlan,\n  type MealPlanWithDetails,\n  type InsertMealPlan,\n  type MealPlanDay,\n  type InsertMealPlanDay,\n  type MealPlanMeal,\n  type InsertMealPlanMeal,\n  type UserMealPlan,\n  type UserMealPlanWithDetails,\n  type FoodItem,\n  type InsertFoodItem,\n  type FoodItemWithPreference,\n  type UserFoodPreference,\n  type InsertUserFoodPreference,\n  type InsertUserMealPlan,\n  type Payment,\n  type InsertPayment,\n  type CalendarNote,\n  type InsertCalendarNote,\n  type UserMealPreferences,\n  type InsertUserMealPreferences,\n  type AiDifficultyAdjustment,\n  type InsertAiDifficultyAdjustment,\n  type UserActivityLog,\n  type InsertUserActivityLog,\n  type WorkoutPreferences,\n  type InsertWorkoutPreferences,\n  type WorkoutPlan,\n  type InsertWorkoutPlan,\n  type PlannedWorkout,\n  type InsertPlannedWorkout,\n  type MealEntry,\n  type InsertMealEntry,\n  type ProgressPhoto,\n  type InsertProgressPhoto,\n  type ProgressPhotoWithWorkout,\n  type SubscriptionAudit,\n  type InsertSubscriptionAudit,\n  type NotificationPreferences,\n  type InsertNotificationPreferences,\n  type Badge,\n  type InsertBadge,\n  type UserBadge,\n  type InsertUserBadge,\n  type UserBadgeWithDetails,\n  type News,\n  type InsertNews\n} from \"@shared/schema\";\nimport { randomUUID } from \"crypto\";\nimport * as bcrypt from \"bcrypt\";\nimport { db } from \"./db\";\nimport { users, communityPosts, workouts, progressPhotos, subscriptionAudit, notificationPreferences, badges, userBadges, news } from \"@shared/schema\";\nimport { eq, or, desc, sql, and } from \"drizzle-orm\";\n\nexport interface IStorage {\n  // Users (IMPORTANT) these user operations are mandatory for Replit Auth.\n  getUser(id: string): Promise<User | undefined>;\n  upsertUser(user: UpsertUser): Promise<User>;\n  getUsers(): Promise<User[]>;\n  getUserByUsername(username: string): Promise<User | undefined>;\n  createUser(user: InsertUser): Promise<User>;\n  updateUserStreak(id: string, streak: number): Promise<User | undefined>;\n  updateUser(id: string, updates: Partial<User>): Promise<User | undefined>;\n  updateUserActivity(id: string, activityDate: Date): Promise<User | undefined>;\n\n  // Authentication methods\n  createUserWithPassword(userData: SignUpData): Promise<User>;\n  getUserByEmail(email: string): Promise<User | undefined>;\n  getUserByUsernameOrEmail(identifier: string): Promise<User | undefined>;\n  verifyUserEmail(userId: string): Promise<User | undefined>;\n  getUsersByAppleTransactionId(transactionId: string): Promise<User[]>;\n\n  // Activity logging methods\n  createUserActivity(activityData: InsertUserActivityLog): Promise<UserActivityLog>;\n  getUserActivities(userId: string, limit?: number): Promise<UserActivityLog[]>;\n\n  // Meal Tracking methods\n  getMealEntries(userId: string, date?: string): Promise<MealEntry[]>;\n  createMealEntry(entry: InsertMealEntry): Promise<MealEntry>;\n  getMealEntry(id: string): Promise<MealEntry | undefined>;\n  deleteMealEntry(id: string): Promise<boolean>;\n  \n  \n  // Exercises\n  getExercises(): Promise<Exercise[]>;\n  getExercisesByCategory(category: string): Promise<Exercise[]>;\n  searchExercises(query: string): Promise<Exercise[]>;\n  getExercise(id: string): Promise<Exercise | undefined>;\n  createExercise(exercise: InsertExercise): Promise<Exercise>;\n  \n  // Workouts\n  getWorkouts(userId: string): Promise<Workout[]>;\n  getWorkout(id: string): Promise<WorkoutWithExercises | undefined>;\n  createWorkout(workout: InsertWorkout): Promise<Workout>;\n  getWorkoutsByDateRange(userId: string, startDate: Date, endDate: Date): Promise<Workout[]>;\n  \n  // Workout Exercises\n  createWorkoutExercise(workoutExercise: InsertWorkoutExercise): Promise<WorkoutExercise>;\n  getWorkoutExercises(workoutId: string): Promise<(WorkoutExercise & { exercise: Exercise })[]>;\n  \n  // Goals\n  getGoals(userId: string): Promise<Goal[]>;\n  createGoal(goal: InsertGoal): Promise<Goal>;\n  updateGoal(id: string, updates: Partial<Goal>): Promise<Goal | undefined>;\n  deleteGoal(id: string): Promise<boolean>;\n  \n  // Stats\n  getUserStats(userId: string): Promise<UserStats>;\n  getAdvancedProgressMetrics(userId: string): Promise<{\n    currentStreak: number;\n    longestStreak: number;\n    totalWorkoutDays: number;\n    consistencyPercentage30Days: number;\n    consistencyPercentage7Days: number;\n    workoutFrequency: { date: string; count: number }[];\n    streakHistory: { start: string; end: string; length: number }[];\n  }>;\n  getWeightProgressData(userId: string): Promise<{\n    exerciseNames: string[];\n    maxWeights: number[];\n    progressOverTime: { exerciseName: string; dates: string[]; weights: number[] }[];\n  }>;\n  \n  // Leaderboard\n  getLeaderboard(): Promise<LeaderboardEntry[]>;\n  \n  // Trainers\n  getTrainers(filters?: { specialties?: string[], location?: string, maxRate?: number }): Promise<TrainerWithServices[]>;\n  getTrainer(id: string): Promise<TrainerWithServices | undefined>;\n  getTrainerByUserId(userId: string): Promise<Trainer | undefined>;\n  createTrainer(trainer: InsertTrainer): Promise<Trainer>;\n  updateTrainer(id: string, updates: Partial<Trainer>): Promise<Trainer | undefined>;\n  \n  // Trainer Services\n  getTrainerServices(trainerId: string): Promise<TrainerService[]>;\n  createTrainerService(service: InsertTrainerService): Promise<TrainerService>;\n  updateTrainerService(id: string, updates: Partial<TrainerService>): Promise<TrainerService | undefined>;\n  \n  // Bookings\n  getBookings(userId: string): Promise<BookingWithDetails[]>;\n  getTrainerBookings(trainerId: string): Promise<BookingWithDetails[]>;\n  getBooking(id: string): Promise<BookingWithDetails | undefined>;\n  createBooking(booking: InsertBooking): Promise<Booking>;\n  updateBooking(id: string, updates: Partial<Booking>): Promise<Booking | undefined>;\n  \n  // Reviews\n  getTrainerReviews(trainerId: string): Promise<TrainerReviewWithUser[]>;\n  createTrainerReview(review: InsertTrainerReview): Promise<TrainerReview>;\n  updateTrainerRating(trainerId: string): Promise<void>;\n\n  // Food entries\n  getFoodEntries(userId: string, date?: Date): Promise<FoodEntry[]>;\n  createFoodEntry(foodEntry: InsertFoodEntry): Promise<FoodEntry>;\n  updateFoodEntry(id: string, updates: Partial<FoodEntry>): Promise<FoodEntry | undefined>;\n  deleteFoodEntry(id: string): Promise<boolean>;\n\n  // Mile Tracker\n  getMileTrackerSessions(userId: string): Promise<MileTrackerSessionWithSplits[]>;\n  getMileTrackerSession(id: string): Promise<MileTrackerSessionWithSplits | undefined>;\n  getActiveMileTrackerSession(userId: string): Promise<MileTrackerSessionWithSplits | undefined>;\n  createMileTrackerSession(session: InsertMileTrackerSession): Promise<MileTrackerSession>;\n  updateMileTrackerSession(id: string, updates: Partial<MileTrackerSession>): Promise<MileTrackerSession | undefined>;\n  createMileTrackerSplit(split: InsertMileTrackerSplit): Promise<MileTrackerSplit>;\n  getMileTrackerSplits(sessionId: string): Promise<MileTrackerSplit[]>;\n  \n  // Community Posts\n  getCommunityPosts(limit?: number): Promise<CommunityPostWithUser[]>;\n  createCommunityPost(post: InsertCommunityPost): Promise<CommunityPost>;\n  likeCommunityPost(postId: string): Promise<CommunityPost | undefined>;\n  dislikeCommunityPost(postId: string): Promise<CommunityPost | undefined>;\n  deleteCommunityPost(postId: string, userId: string): Promise<boolean>;\n\n  // Progress Photos\n  getProgressPhotos(userId: string, limit?: number): Promise<ProgressPhotoWithWorkout[]>;\n  createProgressPhoto(photo: InsertProgressPhoto): Promise<ProgressPhoto>;\n  getProgressPhoto(id: string): Promise<ProgressPhoto | undefined>;\n  updateProgressPhoto(id: string, updates: Partial<ProgressPhoto>): Promise<ProgressPhoto | undefined>;\n  deleteProgressPhoto(id: string, userId: string): Promise<boolean>;\n  getProgressPhotosByDateRange(userId: string, startDate: Date, endDate: Date): Promise<ProgressPhotoWithWorkout[]>;\n\n  // Subscription Audit\n  createSubscriptionAudit(audit: InsertSubscriptionAudit): Promise<SubscriptionAudit>;\n\n  // Notification Preferences\n  getNotificationPreferences(userId: string): Promise<NotificationPreferences | undefined>;\n  createNotificationPreferences(preferences: InsertNotificationPreferences): Promise<NotificationPreferences>;\n  updateNotificationPreferences(userId: string, updates: Partial<NotificationPreferences>): Promise<NotificationPreferences | undefined>;\n  checkWorkoutReminderNeeded(userId: string): Promise<boolean>;\n\n  // Badges\n  getAllBadges(): Promise<Badge[]>;\n  getBadge(id: string): Promise<Badge | undefined>;\n  createBadgeIfNotExists(badge: InsertBadge): Promise<Badge>;\n  getUserBadges(userId: string): Promise<UserBadgeWithDetails[]>;\n  awardBadge(userId: string, badgeId: string): Promise<UserBadge>;\n\n  // Meal Plans\n  getMealPlans(goal?: string): Promise<MealPlanWithDetails[]>;\n  getMealPlan(id: string): Promise<MealPlanWithDetails | undefined>;\n  createMealPlan(mealPlan: InsertMealPlan): Promise<MealPlan>;\n  getUserMealPlan(userId: string): Promise<UserMealPlanWithDetails | undefined>;\n  assignMealPlan(userMealPlan: InsertUserMealPlan): Promise<UserMealPlan>;\n\n  // Commission tracking\n  getTotalCommissions(): Promise<{ totalCommissions: number; totalBookings: number }>;\n  markBookingAsPaid(bookingId: string, totalPrice: number): Promise<Booking | undefined>;\n\n  // Calendar Notes\n  getCalendarNotes(userId: string, date?: Date): Promise<CalendarNote[]>;\n  getCalendarNote(id: string): Promise<CalendarNote | undefined>;\n  createCalendarNote(note: InsertCalendarNote): Promise<CalendarNote>;\n  updateCalendarNote(id: string, updates: Partial<CalendarNote>): Promise<CalendarNote | undefined>;\n  deleteCalendarNote(id: string): Promise<boolean>;\n\n  // User Meal Preferences for AI generation\n  getUserMealPreferences(userId: string): Promise<UserMealPreferences | undefined>;\n  createUserMealPreferences(preferences: InsertUserMealPreferences): Promise<UserMealPreferences>;\n  updateUserMealPreferences(userId: string, updates: Partial<UserMealPreferences>): Promise<UserMealPreferences | undefined>;\n  getUsersForWeeklyMealPlanGeneration(): Promise<{ userId: string; preferences: UserMealPreferences }[]>;\n\n  // AI Meal Plan Generation\n  createAIMealPlan(mealPlan: InsertMealPlan, days: { dayNumber: number; name: string; meals: any[] }[]): Promise<MealPlan>;\n\n  // Food Items and Preferences\n  getFoodItems(category?: string): Promise<FoodItem[]>;\n  createFoodItem(foodItem: InsertFoodItem): Promise<FoodItem>;\n  getFoodItemsWithUserPreferences(userId: string, category?: string): Promise<FoodItemWithPreference[]>;\n  getUserFoodPreferences(userId: string): Promise<UserFoodPreference[]>;\n  setUserFoodPreference(preference: InsertUserFoodPreference): Promise<UserFoodPreference>;\n  updateUserFoodPreference(userId: string, foodItemId: string, preference: string): Promise<UserFoodPreference | undefined>;\n  deleteUserFoodPreference(userId: string, foodItemId: string): Promise<boolean>;\n\n  // AI Difficulty Adjustments\n  getRecentWorkoutsForExercise(userId: string, exerciseId: string, limit: number): Promise<(Workout & { exercises: WorkoutExercise[] })[]>;\n  createAiDifficultyAdjustment(adjustment: InsertAiDifficultyAdjustment): Promise<AiDifficultyAdjustment>;\n  getPendingAiAdjustments(userId: string): Promise<AiDifficultyAdjustment[]>;\n  applyAiDifficultyAdjustment(adjustmentId: string): Promise<boolean>;\n\n  // Payment methods\n  createPayment(insertPayment: InsertPayment): Promise<Payment>;\n  updatePayment(id: string, updates: Partial<Payment>): Promise<Payment | undefined>;\n  updateStripeCustomerId(userId: string, stripeCustomerId: string): Promise<User | undefined>;\n  updateUserStripeInfo(userId: string, stripeCustomerId: string, stripeSubscriptionId: string): Promise<User | undefined>;\n\n  // Trainer subscription methods\n  getTrainerSubscriptionStatus(userId: string): Promise<{\n    subscriptionStatus: string;\n    lastPaymentDate?: Date;\n    subscriptionExpiresAt?: Date;\n    isActive: boolean;\n  } | null>;\n  activateTrainerSubscription(userId: string): Promise<Trainer | undefined>;\n  cancelTrainerSubscription(userId: string): Promise<Trainer | undefined>;\n  getTotalSubscriptionRevenue(): Promise<{ totalRevenue: number; activeTrainers: number }>;\n\n  // Workout Planner methods\n  getWorkoutPreferences(userId: string): Promise<WorkoutPreferences | undefined>;\n  saveWorkoutPreferences(preferences: InsertWorkoutPreferences): Promise<WorkoutPreferences>;\n  getWorkoutPlan(userId: string): Promise<(WorkoutPlan & { plannedWorkouts: PlannedWorkout[] }) | undefined>;\n  createWorkoutPlan(plan: InsertWorkoutPlan): Promise<WorkoutPlan>;\n  createPlannedWorkouts(plannedWorkouts: InsertPlannedWorkout[]): Promise<PlannedWorkout[]>;\n\n  // Leaderboard seeding\n  seedLeaderboardData(): Promise<void>;\n  \n  // News and announcements\n  getNews(limit?: number): Promise<News[]>;\n  getNewsItem(id: string): Promise<News | undefined>;\n  createNews(news: InsertNews): Promise<News>;\n}\n\nexport class MemStorage implements IStorage {\n  private users: Map<string, User> = new Map();\n  private exercises: Map<string, Exercise> = new Map();\n  private workouts: Map<string, Workout> = new Map();\n  private workoutExercises: Map<string, WorkoutExercise> = new Map();\n  private goals: Map<string, Goal> = new Map();\n  private payments: Map<string, Payment> = new Map();\n  private trainers: Map<string, Trainer> = new Map();\n  private trainerServices: Map<string, TrainerService> = new Map();\n  private bookings: Map<string, Booking> = new Map();\n  private trainerReviews: Map<string, TrainerReview> = new Map();\n  private foodEntries: Map<string, FoodEntry> = new Map();\n  private mileTrackerSessions: Map<string, MileTrackerSession> = new Map();\n  private mileTrackerSplits: Map<string, MileTrackerSplit> = new Map();\n  private communityPosts: Map<string, CommunityPost> = new Map();\n  private progressPhotos: Map<string, ProgressPhoto> = new Map();\n  private subscriptionAudits: Map<string, SubscriptionAudit> = new Map();\n  private mealPlans: Map<string, MealPlan> = new Map();\n  private mealPlanDays: Map<string, MealPlanDay> = new Map();\n  private mealPlanMeals: Map<string, MealPlanMeal> = new Map();\n  private userMealPlans: Map<string, UserMealPlan> = new Map();\n  private calendarNotes: Map<string, CalendarNote> = new Map();\n  private userMealPreferences: Map<string, UserMealPreferences> = new Map();\n  private foodItems: Map<string, FoodItem> = new Map();\n  private userFoodPreferences: Map<string, UserFoodPreference> = new Map();\n  private aiDifficultyAdjustments: Map<string, AiDifficultyAdjustment> = new Map();\n  private mealEntries: Map<string, MealEntry> = new Map();\n  private workoutPreferences: Map<string, WorkoutPreferences> = new Map();\n  private workoutPlans: Map<string, WorkoutPlan> = new Map();\n  private plannedWorkouts: Map<string, PlannedWorkout> = new Map();\n  private badges: Map<string, Badge> = new Map();\n  private userBadges: Map<string, UserBadge> = new Map();\n  private userActivityLogs: Map<string, UserActivityLog> = new Map();\n  private notificationPrefs: Map<string, NotificationPreferences> = new Map();\n  private newsItems: Map<string, News> = new Map();\n\n  constructor() {\n    this.seedExercises();\n    this.seedTrainers();\n    this.seedMealPlans();\n    this.seedFoodItems();\n    this.seedCommunityPosts();\n    this.seedRealisticLeaderboardData();\n    this.seedNews();\n  }\n\n  private seedExercises() {\n    const defaultExercises: InsertExercise[] = [\n      {\n        name: \"Push-ups\",\n        category: \"strength\",\n        description: \"Upper body bodyweight exercise\",\n        muscleGroups: [\"chest\", \"triceps\", \"shoulders\"],\n        equipment: \"bodyweight\"\n      },\n      {\n        name: \"Squats\",\n        category: \"strength\", \n        description: \"Lower body compound movement\",\n        muscleGroups: [\"quadriceps\", \"glutes\", \"hamstrings\"],\n        equipment: \"bodyweight\"\n      },\n      {\n        name: \"Running\",\n        category: \"cardio\",\n        description: \"Cardiovascular endurance exercise\",\n        muscleGroups: [\"legs\", \"cardiovascular\"],\n        equipment: \"none\"\n      },\n      {\n        name: \"Yoga Flow\",\n        category: \"yoga\",\n        description: \"Flexibility and mindfulness practice\",\n        muscleGroups: [\"full body\"],\n        equipment: \"yoga mat\"\n      },\n      {\n        name: \"Deadlifts\",\n        category: \"strength\",\n        description: \"Full body compound lift\",\n        muscleGroups: [\"hamstrings\", \"glutes\", \"back\", \"core\"],\n        equipment: \"barbell\"\n      },\n      {\n        name: \"Cycling\",\n        category: \"cardio\",\n        description: \"Low impact cardio exercise\",\n        muscleGroups: [\"legs\", \"cardiovascular\"],\n        equipment: \"bicycle\"\n      },\n      {\n        name: \"Hip Thrusts\",\n        category: \"strength\",\n        description: \"Glute and hamstring exercise using a bench for support\",\n        muscleGroups: [\"glutes\", \"hamstrings\", \"core\"],\n        equipment: \"bench\"\n      },\n      {\n        name: \"Bench Press\",\n        category: \"strength\",\n        description: \"Upper body compound exercise targeting chest, shoulders, and triceps\",\n        muscleGroups: [\"chest\", \"triceps\", \"shoulders\"],\n        equipment: \"barbell\"\n      }\n    ];\n\n    defaultExercises.forEach(exercise => {\n      const id = randomUUID();\n      this.exercises.set(id, {\n        ...exercise,\n        id,\n        description: exercise.description || null,\n        muscleGroups: exercise.muscleGroups || null,\n        equipment: exercise.equipment || null,\n        createdAt: new Date()\n      });\n    });\n  }\n\n  private seedTrainers() {\n    const defaultTrainers: (InsertTrainer & { id: string; services: Omit<InsertTrainerService, 'trainerId'>[] })[] = [\n      {\n        id: randomUUID(),\n        userId: randomUUID(),\n        bio: \"Certified personal trainer with 8 years of experience specializing in strength training and weight loss.\",\n        specialties: [\"strength\", \"weight-loss\", \"bodybuilding\"],\n        certifications: [\"NASM-CPT\", \"Precision Nutrition Level 1\"],\n        experience: 8,\n        hourlyRate: 8000, // $80/hour\n        location: \"Downtown Gym, City Center\",\n        isActive: true,\n        services: [\n          {\n            name: \"Personal Training Session\",\n            description: \"One-on-one strength training and fitness coaching\",\n            duration: 60,\n            price: 8000,\n            isActive: true\n          },\n          {\n            name: \"Group Training Session\",\n            description: \"Small group fitness training (2-4 people)\",\n            duration: 45,\n            price: 5000,\n            isActive: true\n          }\n        ]\n      },\n      {\n        id: randomUUID(),\n        userId: randomUUID(),\n        bio: \"Yoga instructor and wellness coach focused on flexibility, mindfulness, and stress relief.\",\n        specialties: [\"yoga\", \"flexibility\", \"mindfulness\"],\n        certifications: [\"RYT-500\", \"Mindfulness-Based Stress Reduction\"],\n        experience: 5,\n        hourlyRate: 6000, // $60/hour\n        location: \"Zen Yoga Studio\",\n        isActive: true,\n        services: [\n          {\n            name: \"Yoga Session\",\n            description: \"Personalized yoga practice focusing on flexibility and mindfulness\",\n            duration: 75,\n            price: 7500,\n            isActive: true\n          },\n          {\n            name: \"Meditation Coaching\",\n            description: \"Guided meditation and mindfulness techniques\",\n            duration: 30,\n            price: 3500,\n            isActive: true\n          }\n        ]\n      }\n    ];\n\n    defaultTrainers.forEach(trainerData => {\n      const { services, ...trainerInfo } = trainerData;\n      \n      // Create user first\n      const now = new Date();\n      const trialEnd = new Date(now.getTime() + (7 * 24 * 60 * 60 * 1000)); // 7 days from now\n      const isYogaTrainer = trainerInfo.specialties[0] === \"yoga\";\n      const user: User = {\n        id: trainerInfo.userId,\n        email: isYogaTrainer ? \"maya.singh.yoga@hotmail.com\" : \"marcus.williams.athlete@gmail.com\",\n        username: null,\n        passwordHash: null,\n        firstName: isYogaTrainer ? \"Maya\" : \"Marcus\",\n        lastName: isYogaTrainer ? \"Singh\" : \"Williams\",\n        profileImageUrl: null,\n        authProvider: \"local\",\n        isEmailVerified: false,\n        streak: 0,\n        lastWorkoutDate: null,\n        lastActivityDate: null,\n        subscriptionStatus: \"free_trial\",\n        subscriptionStartDate: now,\n        lastPaymentDate: null,\n        subscriptionExpiresAt: null,\n        trialStartDate: now,\n        trialEndDate: trialEnd,\n        stripeCustomerId: null,\n        stripeSubscriptionId: null,\n        personalPlanData: null,\n        createdAt: now,\n        updatedAt: now,\n      };\n      this.users.set(user.id, user);\n\n      // Create trainer\n      const trainer: Trainer = {\n        ...trainerInfo,\n        certifications: trainerInfo.certifications || null,\n        location: trainerInfo.location || null,\n        isActive: trainerInfo.isActive !== undefined ? trainerInfo.isActive : true,\n        rating: 450, // 4.5 stars * 100\n        totalReviews: 12,\n        createdAt: new Date()\n      };\n      this.trainers.set(trainer.id, trainer);\n\n      // Create services\n      services.forEach(serviceData => {\n        const serviceId = randomUUID();\n        const service: TrainerService = {\n          ...serviceData,\n          id: serviceId,\n          trainerId: trainer.id,\n          isActive: serviceData.isActive !== undefined ? serviceData.isActive : true,\n          createdAt: new Date()\n        };\n        this.trainerServices.set(serviceId, service);\n      });\n    });\n  }\n\n  // Users (IMPORTANT) these user operations are mandatory for Replit Auth.\n  async getUser(id: string): Promise<User | undefined> {\n    const user = this.users.get(id);\n    if (!user) return undefined;\n    \n    // Migrate users without trial dates (for existing users)\n    if (!user.trialStartDate || !user.trialEndDate) {\n      const now = new Date();\n      const trialEnd = new Date(now.getTime() + (7 * 24 * 60 * 60 * 1000)); // 7 days from now\n      const updatedUser = {\n        ...user,\n        trialStartDate: user.trialStartDate || user.createdAt || now,\n        trialEndDate: user.trialEndDate || trialEnd,\n        lastWorkoutDate: user.lastWorkoutDate || null,\n        lastActivityDate: user.lastActivityDate || null,\n      };\n      this.users.set(id, updatedUser);\n      return updatedUser;\n    }\n    \n    return user;\n  }\n\n  async upsertUser(userData: UpsertUser): Promise<User> {\n    const existingUser = this.users.get(userData.id!);\n    if (existingUser) {\n      const updatedUser = {\n        ...existingUser,\n        ...userData,\n        updatedAt: new Date(),\n      };\n      this.users.set(userData.id!, updatedUser);\n      return updatedUser;\n    } else {\n      const now = new Date();\n      const freeTrialExpiry = new Date(now.getTime() + (7 * 24 * 60 * 60 * 1000)); // 7 days from now\n      \n      const user: User = {\n        id: userData.id!,\n        email: userData.email || null,\n        username: null,\n        passwordHash: null,\n        firstName: userData.firstName || null,\n        lastName: userData.lastName || null,\n        profileImageUrl: userData.profileImageUrl || null,\n        authProvider: \"replit\",\n        isEmailVerified: false,\n        streak: userData.streak || 0,\n        lastWorkoutDate: userData.lastWorkoutDate || null,\n        lastActivityDate: null,\n        subscriptionStatus: userData.subscriptionStatus || \"free_trial\",\n        subscriptionStartDate: userData.subscriptionStartDate || now,\n        lastPaymentDate: userData.lastPaymentDate || null,\n        subscriptionExpiresAt: userData.subscriptionExpiresAt || null,\n        trialStartDate: now,\n        trialEndDate: freeTrialExpiry,\n        stripeCustomerId: null,\n        stripeSubscriptionId: null,\n        personalPlanData: null,\n        createdAt: userData.createdAt || now,\n        updatedAt: now,\n      };\n      this.users.set(user.id, user);\n      return user;\n    }\n  }\n\n  async getUsers(): Promise<User[]> {\n    return Array.from(this.users.values());\n  }\n\n  async getUserByUsername(username: string): Promise<User | undefined> {\n    // Since we don't have username anymore, search by email\n    return Array.from(this.users.values()).find(user => user.email === username);\n  }\n\n  async createUser(insertUser: InsertUser): Promise<User> {\n    const id = randomUUID();\n    const now = new Date();\n    const freeTrialExpiry = new Date(now.getTime() + (7 * 24 * 60 * 60 * 1000)); // 7 days from now\n    \n    const user: User = {\n      ...insertUser,\n      id,\n      streak: insertUser.streak || 0,\n      lastWorkoutDate: insertUser.lastWorkoutDate || null,\n      subscriptionStatus: insertUser.subscriptionStatus || \"free_trial\",\n      trialStartDate: insertUser.trialStartDate || now,\n      trialEndDate: insertUser.trialEndDate || freeTrialExpiry,\n      subscriptionStartDate: insertUser.subscriptionStartDate || now,\n      lastPaymentDate: insertUser.lastPaymentDate || null,\n      subscriptionExpiresAt: insertUser.subscriptionExpiresAt || freeTrialExpiry,\n      createdAt: now,\n      updatedAt: now,\n    };\n    this.users.set(id, user);\n    return user;\n  }\n\n  async updateUserStreak(id: string, streak: number): Promise<User | undefined> {\n    const user = this.users.get(id);\n    if (user) {\n      const updatedUser = { ...user, streak };\n      this.users.set(id, updatedUser);\n      return updatedUser;\n    }\n    return undefined;\n  }\n\n  async updateUserStreakAndDate(id: string, streak: number, lastWorkoutDate: Date): Promise<User | undefined> {\n    const user = this.users.get(id);\n    if (user) {\n      const updatedUser = { ...user, streak, lastWorkoutDate, lastActivityDate: lastWorkoutDate };\n      this.users.set(id, updatedUser);\n      return updatedUser;\n    }\n    return undefined;\n  }\n\n  // Update user activity date for any activity (workout, meal, etc.)\n  async updateUserActivity(id: string, activityDate: Date): Promise<User | undefined> {\n    const user = this.users.get(id);\n    if (user) {\n      const now = new Date();\n      // Security: Prevent future-dating activities to manipulate streaks\n      const effectiveDate = activityDate > now ? now : activityDate;\n      \n      // Security: Prevent backdating to rebuild streaks - only accept non-decreasing dates\n      if (user.lastActivityDate && effectiveDate < new Date(user.lastActivityDate)) {\n        // Backdated activity - don't update streak, just track the activity\n        return user;\n      }\n      \n      // Recalculate streak based on all activities\n      const newStreak = await this.calculateUserStreak(id);\n      const updatedUser = { ...user, lastActivityDate: effectiveDate, streak: newStreak };\n      this.users.set(id, updatedUser);\n      return updatedUser;\n    }\n    return undefined;\n  }\n\n  async calculateUserStreak(userId: string): Promise<number> {\n    const userWorkouts = await this.getWorkouts(userId);\n    const user = this.users.get(userId);\n    \n    if (userWorkouts.length === 0) return 0;\n\n    // Check if more than 24 hours have passed since last activity\n    if (user?.lastActivityDate) {\n      const now = new Date();\n      const lastActivity = new Date(user.lastActivityDate);\n      const hoursSinceLastActivity = (now.getTime() - lastActivity.getTime()) / (1000 * 60 * 60);\n      \n      // If more than 24 hours have passed since last activity, reset streak\n      if (hoursSinceLastActivity > 24) {\n        return 0;\n      }\n    }\n\n    // Sort workouts by date (newest first)\n    const sortedWorkouts = userWorkouts.sort((a, b) => b.date.getTime() - a.date.getTime());\n    \n    // Get unique workout dates (only the date part, not time)\n    const uniqueDates = [...new Set(sortedWorkouts.map(w => {\n      const date = new Date(w.date);\n      return `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, '0')}-${String(date.getDate()).padStart(2, '0')}`;\n    }))].sort().reverse(); // Sort dates in descending order\n\n    if (uniqueDates.length === 0) return 0;\n\n    let streak = 0;\n    const today = new Date();\n    const todayStr = `${today.getFullYear()}-${String(today.getMonth() + 1).padStart(2, '0')}-${String(today.getDate()).padStart(2, '0')}`;\n    \n    // Check if user worked out today or yesterday (to account for different time zones)\n    const yesterday = new Date(today);\n    yesterday.setDate(yesterday.getDate() - 1);\n    const yesterdayStr = `${yesterday.getFullYear()}-${String(yesterday.getMonth() + 1).padStart(2, '0')}-${String(yesterday.getDate()).padStart(2, '0')}`;\n    \n    let startDate = todayStr;\n    if (uniqueDates[0] === todayStr) {\n      // User worked out today, start counting from today\n      startDate = todayStr;\n    } else if (uniqueDates[0] === yesterdayStr) {\n      // User's last workout was yesterday, start counting from yesterday  \n      startDate = yesterdayStr;\n    } else {\n      // User hasn't worked out today or yesterday, streak is 0\n      return 0;\n    }\n\n    // Count consecutive days starting from the most recent workout date\n    let expectedDate = new Date(startDate);\n    \n    for (const workoutDate of uniqueDates) {\n      const expectedDateStr = `${expectedDate.getFullYear()}-${String(expectedDate.getMonth() + 1).padStart(2, '0')}-${String(expectedDate.getDate()).padStart(2, '0')}`;\n      \n      if (workoutDate === expectedDateStr) {\n        streak++;\n        expectedDate.setDate(expectedDate.getDate() - 1); // Move to previous day\n      } else {\n        break; // Streak broken\n      }\n    }\n\n    return streak;\n  }\n\n  // Reset streaks for users who haven't logged ANY activity in 24+ hours\n  async resetInactiveUserStreaks(): Promise<void> {\n    const now = new Date();\n    const users = Array.from(this.users.values());\n    \n    for (const user of users) {\n      if (user.lastActivityDate && user.streak > 0) {\n        const lastActivity = new Date(user.lastActivityDate);\n        const hoursSinceLastActivity = (now.getTime() - lastActivity.getTime()) / (1000 * 60 * 60);\n        \n        // If more than 24 hours have passed since last activity, reset streak\n        if (hoursSinceLastActivity > 24) {\n          await this.updateUserStreak(user.id, 0);\n        }\n      }\n    }\n  }\n\n  async getAdvancedProgressMetrics(userId: string): Promise<{\n    currentStreak: number;\n    longestStreak: number;\n    totalWorkoutDays: number;\n    consistencyPercentage30Days: number;\n    consistencyPercentage7Days: number;\n    workoutFrequency: { date: string; count: number }[];\n    streakHistory: { start: string; end: string; length: number }[];\n  }> {\n    const userWorkouts = await this.getWorkouts(userId);\n    const currentStreak = await this.calculateUserStreak(userId);\n    \n    if (userWorkouts.length === 0) {\n      return {\n        currentStreak: 0,\n        longestStreak: 0,\n        totalWorkoutDays: 0,\n        consistencyPercentage30Days: 0,\n        consistencyPercentage7Days: 0,\n        workoutFrequency: [],\n        streakHistory: []\n      };\n    }\n\n    // Get unique workout dates\n    const uniqueDates = [...new Set(userWorkouts.map(w => {\n      const date = new Date(w.date);\n      return `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, '0')}-${String(date.getDate()).padStart(2, '0')}`;\n    }))].sort();\n\n    const totalWorkoutDays = uniqueDates.length;\n\n    // Calculate longest streak and all streaks\n    let longestStreak = 0;\n    let streakHistory: { start: string; end: string; length: number }[] = [];\n    \n    if (uniqueDates.length > 0) {\n      let currentStreakStart = uniqueDates[0];\n      let currentStreakLength = 1;\n      \n      for (let i = 1; i < uniqueDates.length; i++) {\n        const currentDate = new Date(uniqueDates[i]);\n        const prevDate = new Date(uniqueDates[i - 1]);\n        const dayDiff = Math.floor((currentDate.getTime() - prevDate.getTime()) / (1000 * 60 * 60 * 24));\n        \n        if (dayDiff === 1) {\n          // Consecutive day\n          currentStreakLength++;\n        } else {\n          // Streak broken, record the streak\n          if (currentStreakLength >= 1) {\n            streakHistory.push({\n              start: currentStreakStart,\n              end: uniqueDates[i - 1],\n              length: currentStreakLength\n            });\n            longestStreak = Math.max(longestStreak, currentStreakLength);\n          }\n          // Start new streak\n          currentStreakStart = uniqueDates[i];\n          currentStreakLength = 1;\n        }\n      }\n      \n      // Record the final streak\n      if (currentStreakLength >= 1) {\n        streakHistory.push({\n          start: currentStreakStart,\n          end: uniqueDates[uniqueDates.length - 1],\n          length: currentStreakLength\n        });\n        longestStreak = Math.max(longestStreak, currentStreakLength);\n      }\n    }\n\n    // Calculate consistency percentages\n    const today = new Date();\n    const thirtyDaysAgo = new Date(today);\n    thirtyDaysAgo.setDate(thirtyDaysAgo.getDate() - 30);\n    \n    const sevenDaysAgo = new Date(today);\n    sevenDaysAgo.setDate(sevenDaysAgo.getDate() - 7);\n\n    const workoutDaysLast30 = uniqueDates.filter(dateStr => {\n      const date = new Date(dateStr);\n      return date >= thirtyDaysAgo && date <= today;\n    }).length;\n    \n    const workoutDaysLast7 = uniqueDates.filter(dateStr => {\n      const date = new Date(dateStr);\n      return date >= sevenDaysAgo && date <= today;\n    }).length;\n\n    const consistencyPercentage30Days = Math.round((workoutDaysLast30 / 30) * 100);\n    const consistencyPercentage7Days = Math.round((workoutDaysLast7 / 7) * 100);\n\n    // Calculate workout frequency for last 30 days\n    const workoutFrequency: { date: string; count: number }[] = [];\n    for (let i = 29; i >= 0; i--) {\n      const date = new Date(today);\n      date.setDate(date.getDate() - i);\n      const dateStr = `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, '0')}-${String(date.getDate()).padStart(2, '0')}`;\n      \n      const workoutCount = userWorkouts.filter(w => {\n        const workoutDate = new Date(w.date);\n        const workoutDateStr = `${workoutDate.getFullYear()}-${String(workoutDate.getMonth() + 1).padStart(2, '0')}-${String(workoutDate.getDate()).padStart(2, '0')}`;\n        return workoutDateStr === dateStr;\n      }).length;\n      \n      workoutFrequency.push({ date: dateStr, count: workoutCount });\n    }\n\n    return {\n      currentStreak,\n      longestStreak,\n      totalWorkoutDays,\n      consistencyPercentage30Days,\n      consistencyPercentage7Days,\n      workoutFrequency,\n      streakHistory\n    };\n  }\n\n  async getWeightProgressData(userId: string): Promise<{\n    exerciseNames: string[];\n    maxWeights: number[];\n    progressOverTime: { exerciseName: string; dates: string[]; weights: number[] }[];\n  }> {\n    const userWorkouts = await this.getWorkouts(userId);\n    \n    if (userWorkouts.length === 0) {\n      return {\n        exerciseNames: [],\n        maxWeights: [],\n        progressOverTime: []\n      };\n    }\n\n    // Get all workout exercises for this user\n    const allWorkoutExercises: (WorkoutExercise & { exercise: Exercise; workoutDate: Date })[] = [];\n    \n    for (const workout of userWorkouts) {\n      const workoutExercises = await this.getWorkoutExercises(workout.id);\n      for (const we of workoutExercises) {\n        if (we.weight && we.weight > 0) { // Only include exercises with weight data\n          allWorkoutExercises.push({\n            ...we,\n            workoutDate: workout.date\n          });\n        }\n      }\n    }\n\n    if (allWorkoutExercises.length === 0) {\n      return {\n        exerciseNames: [],\n        maxWeights: [],\n        progressOverTime: []\n      };\n    }\n\n    // Group by exercise and find max weights\n    const exerciseWeightMap = new Map<string, { maxWeight: number; records: { date: Date; weight: number }[] }>();\n    \n    for (const we of allWorkoutExercises) {\n      const exerciseName = we.exercise.name;\n      const weight = we.weight!;\n      const date = we.workoutDate;\n      \n      if (!exerciseWeightMap.has(exerciseName)) {\n        exerciseWeightMap.set(exerciseName, {\n          maxWeight: weight,\n          records: [{ date, weight }]\n        });\n      } else {\n        const current = exerciseWeightMap.get(exerciseName)!;\n        current.maxWeight = Math.max(current.maxWeight, weight);\n        current.records.push({ date, weight });\n      }\n    }\n\n    // Sort exercises by max weight (descending) and take top 8 for chart readability\n    const sortedExercises = Array.from(exerciseWeightMap.entries())\n      .sort(([, a], [, b]) => b.maxWeight - a.maxWeight)\n      .slice(0, 8);\n\n    const exerciseNames = sortedExercises.map(([name]) => name);\n    const maxWeights = sortedExercises.map(([, data]) => data.maxWeight);\n\n    // Create progress over time data for trending\n    const progressOverTime = sortedExercises.map(([exerciseName, data]) => {\n      // Sort records by date and get progression\n      const sortedRecords = data.records.sort((a, b) => a.date.getTime() - b.date.getTime());\n      \n      // Group by week to reduce noise and show clear progression\n      const weeklyMaxes = new Map<string, number>();\n      \n      for (const record of sortedRecords) {\n        // Get the start of the week for this date\n        const weekStart = new Date(record.date);\n        weekStart.setDate(weekStart.getDate() - weekStart.getDay());\n        const weekKey = weekStart.toISOString().split('T')[0];\n        \n        const currentMax = weeklyMaxes.get(weekKey) || 0;\n        weeklyMaxes.set(weekKey, Math.max(currentMax, record.weight));\n      }\n      \n      // Convert to arrays for chart\n      const sortedWeeks = Array.from(weeklyMaxes.entries()).sort((a, b) => a[0].localeCompare(b[0]));\n      const dates = sortedWeeks.map(([date]) => date);\n      const weights = sortedWeeks.map(([, weight]) => weight);\n      \n      return {\n        exerciseName,\n        dates,\n        weights\n      };\n    });\n\n    return {\n      exerciseNames,\n      maxWeights,\n      progressOverTime\n    };\n  }\n\n  async updateUser(id: string, updates: Partial<User>): Promise<User | undefined> {\n    const user = this.users.get(id);\n    if (user) {\n      const updatedUser = { ...user, ...updates };\n      this.users.set(id, updatedUser);\n      return updatedUser;\n    }\n    return undefined;\n  }\n\n  // Activity logging methods\n  private userActivities = new Map<string, UserActivityLog[]>();\n\n  async createUserActivity(activityData: InsertUserActivityLog): Promise<UserActivityLog> {\n    const activity: UserActivityLog = {\n      id: randomUUID(),\n      ...activityData,\n      createdAt: new Date(),\n    };\n\n    if (!this.userActivities.has(activityData.userId)) {\n      this.userActivities.set(activityData.userId, []);\n    }\n    \n    const userActivityList = this.userActivities.get(activityData.userId)!;\n    userActivityList.unshift(activity); // Add to front for chronological order\n    \n    // Keep only the most recent 1000 activities per user to prevent memory issues\n    if (userActivityList.length > 1000) {\n      userActivityList.splice(1000);\n    }\n\n    return activity;\n  }\n\n  async getUserActivities(userId: string, limit: number = 100): Promise<UserActivityLog[]> {\n    const userActivityList = this.userActivities.get(userId) || [];\n    return userActivityList.slice(0, limit);\n  }\n\n  // Badge methods\n  async getAllBadges(): Promise<Badge[]> {\n    return Array.from(this.badges.values());\n  }\n\n  async getBadge(id: string): Promise<Badge | undefined> {\n    return this.badges.get(id);\n  }\n\n  async createBadgeIfNotExists(badge: InsertBadge): Promise<Badge> {\n    // Check if badge with same name already exists\n    const existingBadge = Array.from(this.badges.values()).find(\n      b => b.name === badge.name\n    );\n    \n    if (existingBadge) {\n      return existingBadge;\n    }\n\n    const id = randomUUID();\n    const newBadge: Badge = {\n      id,\n      ...badge,\n      createdAt: new Date(),\n    };\n    \n    this.badges.set(id, newBadge);\n    return newBadge;\n  }\n\n  async getUserBadges(userId: string): Promise<UserBadgeWithDetails[]> {\n    const userBadgesList = Array.from(this.userBadges.values()).filter(\n      ub => ub.userId === userId\n    );\n    \n    const userBadgesWithDetails: UserBadgeWithDetails[] = [];\n    \n    for (const userBadge of userBadgesList) {\n      const badge = this.badges.get(userBadge.badgeId);\n      if (badge) {\n        userBadgesWithDetails.push({\n          ...userBadge,\n          badge,\n        });\n      }\n    }\n    \n    // Sort by earned date (newest first)\n    return userBadgesWithDetails.sort((a, b) => \n      b.earnedAt.getTime() - a.earnedAt.getTime()\n    );\n  }\n\n  async awardBadge(userId: string, badgeId: string): Promise<UserBadge> {\n    // Check if user already has this badge\n    const existingUserBadge = Array.from(this.userBadges.values()).find(\n      ub => ub.userId === userId && ub.badgeId === badgeId\n    );\n    \n    if (existingUserBadge) {\n      return existingUserBadge;\n    }\n\n    const id = randomUUID();\n    const userBadge: UserBadge = {\n      id,\n      userId,\n      badgeId,\n      earnedAt: new Date(),\n    };\n    \n    this.userBadges.set(id, userBadge);\n    return userBadge;\n  }\n\n  // Authentication methods\n  async createUserWithPassword(userData: SignUpData): Promise<User> {\n    try {\n      \n      // Check if username or email already exists\n      const existingUser = await this.getUserByUsernameOrEmail(userData.username) || \n                          await this.getUserByUsernameOrEmail(userData.email);\n      \n      if (existingUser) {\n        console.log(\"User already exists:\", existingUser.username || existingUser.email);\n        throw new Error(\"Username or email already exists\");\n      }\n\n      const id = randomUUID();\n      const now = new Date();\n      const freeTrialExpiry = new Date(now.getTime() + (7 * 24 * 60 * 60 * 1000)); // 7 days from now\n      \n      \n      // Hash the password\n      const saltRounds = 12;\n      const passwordHash = await bcrypt.hash(userData.password, saltRounds);\n\n      const user: User = {\n        id,\n        email: userData.email,\n        username: userData.username,\n        passwordHash,\n        firstName: userData.firstName,\n        lastName: userData.lastName,\n        profileImageUrl: null,\n        authProvider: \"local\",\n        isEmailVerified: false,\n        streak: 0,\n        lastWorkoutDate: null,\n        lastActivityDate: null,\n        subscriptionStatus: \"free_trial\",\n        subscriptionStartDate: now,\n        lastPaymentDate: null,\n        subscriptionExpiresAt: null,\n        trialStartDate: now,\n        trialEndDate: freeTrialExpiry,\n        stripeCustomerId: null,\n        stripeSubscriptionId: null,\n        personalPlanData: userData.personalPlanData ? JSON.stringify(userData.personalPlanData) : null,\n        createdAt: now,\n        updatedAt: now,\n      };\n\n      this.users.set(id, user);\n      return user;\n    } catch (error) {\n      throw error;\n    }\n  }\n\n  async getUserByEmail(email: string): Promise<User | undefined> {\n    return Array.from(this.users.values()).find(user => user.email === email);\n  }\n\n  async getUserByUsernameOrEmail(identifier: string): Promise<User | undefined> {\n    return Array.from(this.users.values()).find(user => \n      user.username === identifier || user.email === identifier\n    );\n  }\n\n\n  async verifyUserEmail(userId: string): Promise<User | undefined> {\n    const user = this.users.get(userId);\n    if (user) {\n      const updatedUser = { ...user, isEmailVerified: true, updatedAt: new Date() };\n      this.users.set(userId, updatedUser);\n      return updatedUser;\n    }\n    return undefined;\n  }\n\n  // Exercises\n  async getExercises(): Promise<Exercise[]> {\n    return Array.from(this.exercises.values());\n  }\n\n  async getExercisesByCategory(category: string): Promise<Exercise[]> {\n    return Array.from(this.exercises.values()).filter(ex => ex.category === category);\n  }\n\n  async searchExercises(query: string): Promise<Exercise[]> {\n    const lowerQuery = query.toLowerCase();\n    return Array.from(this.exercises.values()).filter(ex => \n      ex.name.toLowerCase().includes(lowerQuery) ||\n      ex.category.toLowerCase().includes(lowerQuery) ||\n      ex.description?.toLowerCase().includes(lowerQuery)\n    );\n  }\n\n  async getExercise(id: string): Promise<Exercise | undefined> {\n    return this.exercises.get(id);\n  }\n\n  async createExercise(insertExercise: InsertExercise): Promise<Exercise> {\n    const id = randomUUID();\n    const exercise: Exercise = {\n      ...insertExercise,\n      id,\n      description: insertExercise.description || null,\n      muscleGroups: insertExercise.muscleGroups || null,\n      equipment: insertExercise.equipment || null,\n      createdAt: new Date()\n    };\n    this.exercises.set(id, exercise);\n    return exercise;\n  }\n\n  // Workouts\n  async getWorkouts(userId: string): Promise<Workout[]> {\n    return Array.from(this.workouts.values())\n      .filter(workout => workout.userId === userId)\n      .sort((a, b) => b.date.getTime() - a.date.getTime());\n  }\n\n  async getWorkout(id: string): Promise<WorkoutWithExercises | undefined> {\n    const workout = this.workouts.get(id);\n    if (!workout) return undefined;\n\n    const exercises = await this.getWorkoutExercises(id);\n    return {\n      ...workout,\n      exercises\n    };\n  }\n\n  async createWorkout(insertWorkout: InsertWorkout): Promise<Workout> {\n    const id = randomUUID();\n    const workout: Workout = {\n      ...insertWorkout,\n      id,\n      notes: insertWorkout.notes || null,\n      createdAt: new Date()\n    };\n    this.workouts.set(id, workout);\n    \n    // Update user's last workout date and recalculate streak\n    const newStreak = await this.calculateUserStreak(insertWorkout.userId);\n    await this.updateUserStreakAndDate(insertWorkout.userId, newStreak, workout.date);\n    \n    return workout;\n  }\n\n  async getWorkoutsByDateRange(userId: string, startDate: Date, endDate: Date): Promise<Workout[]> {\n    return Array.from(this.workouts.values()).filter(workout =>\n      workout.userId === userId &&\n      workout.date >= startDate &&\n      workout.date <= endDate\n    );\n  }\n\n  // Workout Exercises\n  async createWorkoutExercise(insertWorkoutExercise: InsertWorkoutExercise): Promise<WorkoutExercise> {\n    const id = randomUUID();\n    const workoutExercise: WorkoutExercise = {\n      ...insertWorkoutExercise,\n      id,\n      sets: insertWorkoutExercise.sets || null,\n      reps: insertWorkoutExercise.reps || null,\n      weight: insertWorkoutExercise.weight || null,\n      distance: insertWorkoutExercise.distance || null,\n      duration: insertWorkoutExercise.duration || null,\n      notes: insertWorkoutExercise.notes || null\n    };\n    this.workoutExercises.set(id, workoutExercise);\n    return workoutExercise;\n  }\n\n  async getWorkoutExercises(workoutId: string): Promise<(WorkoutExercise & { exercise: Exercise })[]> {\n    const workoutExercises = Array.from(this.workoutExercises.values())\n      .filter(we => we.workoutId === workoutId);\n    \n    return workoutExercises.map(we => {\n      const exercise = this.exercises.get(we.exerciseId);\n      return {\n        ...we,\n        exercise: exercise!\n      };\n    });\n  }\n\n  // Goals\n  async getGoals(userId: string): Promise<Goal[]> {\n    return Array.from(this.goals.values()).filter(goal => goal.userId === userId);\n  }\n\n  async createGoal(insertGoal: InsertGoal): Promise<Goal> {\n    const id = randomUUID();\n    const goal: Goal = {\n      ...insertGoal,\n      id,\n      current: insertGoal.current || 0,\n      period: insertGoal.period || \"weekly\",\n      isActive: insertGoal.isActive !== undefined ? insertGoal.isActive : true,\n      createdAt: new Date()\n    };\n    this.goals.set(id, goal);\n    return goal;\n  }\n\n  async updateGoal(id: string, updates: Partial<Goal>): Promise<Goal | undefined> {\n    const goal = this.goals.get(id);\n    if (goal) {\n      const updatedGoal = { ...goal, ...updates };\n      this.goals.set(id, updatedGoal);\n      return updatedGoal;\n    }\n    return undefined;\n  }\n\n  async deleteGoal(id: string): Promise<boolean> {\n    return this.goals.delete(id);\n  }\n\n  // Payment management\n  async createPayment(insertPayment: InsertPayment): Promise<Payment> {\n    const id = randomUUID();\n    const payment: Payment = {\n      ...insertPayment,\n      id,\n      createdAt: new Date(),\n      updatedAt: new Date()\n    };\n    this.payments.set(id, payment);\n    return payment;\n  }\n\n  async getPayment(id: string): Promise<Payment | undefined> {\n    return this.payments.get(id);\n  }\n\n  async getPaymentByStripeId(stripePaymentIntentId: string): Promise<Payment | undefined> {\n    return Array.from(this.payments.values()).find(p => p.stripePaymentIntentId === stripePaymentIntentId);\n  }\n\n  async updatePayment(id: string, updates: Partial<Payment>): Promise<Payment | undefined> {\n    const payment = this.payments.get(id);\n    if (payment) {\n      const updatedPayment = { ...payment, ...updates, updatedAt: new Date() };\n      this.payments.set(id, updatedPayment);\n      return updatedPayment;\n    }\n    return undefined;\n  }\n\n  async getUserPayments(userId: string): Promise<Payment[]> {\n    return Array.from(this.payments.values()).filter(p => p.userId === userId);\n  }\n\n  async updateStripeCustomerId(userId: string, stripeCustomerId: string): Promise<User | undefined> {\n    const user = this.users.get(userId);\n    if (user) {\n      const updatedUser = { ...user, stripeCustomerId };\n      this.users.set(userId, updatedUser);\n      return updatedUser;\n    }\n    return undefined;\n  }\n\n  async updateUserStripeInfo(userId: string, stripeCustomerId: string, stripeSubscriptionId: string): Promise<User | undefined> {\n    const user = this.users.get(userId);\n    if (user) {\n      const updatedUser = { ...user, stripeCustomerId, stripeSubscriptionId };\n      this.users.set(userId, updatedUser);\n      return updatedUser;\n    }\n    return undefined;\n  }\n\n  // Stats\n  async getUserStats(userId: string): Promise<UserStats> {\n    const userWorkouts = await this.getWorkouts(userId);\n    \n    const totalWorkouts = userWorkouts.length;\n    const totalHours = Math.round(userWorkouts.reduce((sum, w) => sum + w.duration, 0) / 60);\n    const caloriesBurned = userWorkouts.reduce((sum, w) => sum + w.caloriesBurned, 0);\n    \n    // Count personal records (simplified - could be more sophisticated)\n    const personalRecords = userWorkouts.filter(w => w.notes?.includes('PR')).length;\n\n    return {\n      totalWorkouts,\n      totalHours,\n      caloriesBurned,\n      personalRecords\n    };\n  }\n\n  // Trainers\n  async getTrainers(filters?: { specialties?: string[], location?: string, maxRate?: number }): Promise<TrainerWithServices[]> {\n    let trainers = Array.from(this.trainers.values()).filter(t => t.isActive);\n    \n    if (filters?.specialties?.length) {\n      trainers = trainers.filter(t => \n        filters.specialties!.some(specialty => t.specialties.includes(specialty))\n      );\n    }\n    \n    if (filters?.location) {\n      trainers = trainers.filter(t => \n        t.location?.toLowerCase().includes(filters.location!.toLowerCase())\n      );\n    }\n    \n    if (filters?.maxRate) {\n      trainers = trainers.filter(t => t.hourlyRate <= filters.maxRate!);\n    }\n\n    return Promise.all(trainers.map(async trainer => {\n      const services = await this.getTrainerServices(trainer.id);\n      const user = await this.getUser(trainer.userId);\n      return {\n        ...trainer,\n        services,\n        user: { \n          email: user!.email || \"\", \n          firstName: user!.firstName || \"\", \n          lastName: user!.lastName || \"\"\n        }\n      };\n    }));\n  }\n\n  async getTrainer(id: string): Promise<TrainerWithServices | undefined> {\n    const trainer = this.trainers.get(id);\n    if (!trainer) return undefined;\n\n    const services = await this.getTrainerServices(id);\n    const user = await this.getUser(trainer.userId);\n    return {\n      ...trainer,\n      services,\n      user: { \n        email: user!.email || \"\", \n        firstName: user!.firstName || \"\", \n        lastName: user!.lastName || \"\"\n      }\n    };\n  }\n\n  async getTrainerByUserId(userId: string): Promise<Trainer | undefined> {\n    return Array.from(this.trainers.values()).find(t => t.userId === userId);\n  }\n\n  async createTrainer(insertTrainer: InsertTrainer): Promise<Trainer> {\n    const id = randomUUID();\n    const trainer: Trainer = {\n      ...insertTrainer,\n      id,\n      certifications: insertTrainer.certifications || null,\n      location: insertTrainer.location || null,\n      isActive: insertTrainer.isActive !== undefined ? insertTrainer.isActive : true,\n      rating: null,\n      totalReviews: null,\n      subscriptionStatus: \"inactive\",\n      lastPaymentDate: null,\n      subscriptionExpiresAt: null,\n      createdAt: new Date()\n    };\n    this.trainers.set(id, trainer);\n    return trainer;\n  }\n\n  async updateTrainer(id: string, updates: Partial<Trainer>): Promise<Trainer | undefined> {\n    const trainer = this.trainers.get(id);\n    if (trainer) {\n      const updatedTrainer = { ...trainer, ...updates };\n      this.trainers.set(id, updatedTrainer);\n      return updatedTrainer;\n    }\n    return undefined;\n  }\n\n  // Trainer Services\n  async getTrainerServices(trainerId: string): Promise<TrainerService[]> {\n    return Array.from(this.trainerServices.values())\n      .filter(s => s.trainerId === trainerId && s.isActive);\n  }\n\n  async createTrainerService(insertService: InsertTrainerService): Promise<TrainerService> {\n    const id = randomUUID();\n    const service: TrainerService = {\n      ...insertService,\n      id,\n      isActive: insertService.isActive !== undefined ? insertService.isActive : true,\n      createdAt: new Date()\n    };\n    this.trainerServices.set(id, service);\n    return service;\n  }\n\n  async updateTrainerService(id: string, updates: Partial<TrainerService>): Promise<TrainerService | undefined> {\n    const service = this.trainerServices.get(id);\n    if (service) {\n      const updatedService = { ...service, ...updates };\n      this.trainerServices.set(id, updatedService);\n      return updatedService;\n    }\n    return undefined;\n  }\n\n  // Bookings\n  async getBookings(userId: string): Promise<BookingWithDetails[]> {\n    const bookings = Array.from(this.bookings.values())\n      .filter(b => b.userId === userId)\n      .sort((a, b) => b.scheduledAt.getTime() - a.scheduledAt.getTime());\n\n    return Promise.all(bookings.map(async booking => {\n      const trainer = this.trainers.get(booking.trainerId)!;\n      const service = this.trainerServices.get(booking.serviceId)!;\n      const user = this.users.get(booking.userId)!;\n      \n      return {\n        ...booking,\n        trainer: {\n          id: trainer.id,\n          userId: trainer.userId,\n          bio: trainer.bio,\n          rating: trainer.rating,\n          totalReviews: trainer.totalReviews\n        },\n        service,\n        user: { \n          email: user.email || \"\", \n          firstName: user.firstName || \"\", \n          lastName: user.lastName || \"\"\n        }\n      };\n    }));\n  }\n\n  async getTrainerBookings(trainerId: string): Promise<BookingWithDetails[]> {\n    const bookings = Array.from(this.bookings.values())\n      .filter(b => b.trainerId === trainerId)\n      .sort((a, b) => b.scheduledAt.getTime() - a.scheduledAt.getTime());\n\n    return Promise.all(bookings.map(async booking => {\n      const trainer = this.trainers.get(booking.trainerId)!;\n      const service = this.trainerServices.get(booking.serviceId)!;\n      const user = this.users.get(booking.userId)!;\n      \n      return {\n        ...booking,\n        trainer: {\n          id: trainer.id,\n          userId: trainer.userId,\n          bio: trainer.bio,\n          rating: trainer.rating,\n          totalReviews: trainer.totalReviews\n        },\n        service,\n        user: { \n          email: user.email || \"\", \n          firstName: user.firstName || \"\", \n          lastName: user.lastName || \"\"\n        }\n      };\n    }));\n  }\n\n  async getBooking(id: string): Promise<BookingWithDetails | undefined> {\n    const booking = this.bookings.get(id);\n    if (!booking) return undefined;\n\n    const trainer = this.trainers.get(booking.trainerId)!;\n    const service = this.trainerServices.get(booking.serviceId)!;\n    const user = this.users.get(booking.userId)!;\n    \n    return {\n      ...booking,\n      trainer: {\n        id: trainer.id,\n        userId: trainer.userId,\n        bio: trainer.bio,\n        rating: trainer.rating,\n        totalReviews: trainer.totalReviews\n      },\n      service,\n      user: { \n        email: user.email || \"\", \n        firstName: user.firstName || \"\", \n        lastName: user.lastName || \"\"\n      }\n    };\n  }\n\n  async createBooking(insertBooking: InsertBooking): Promise<Booking> {\n    const id = randomUUID();\n    const booking: Booking = {\n      ...insertBooking,\n      id,\n      status: insertBooking.status || \"pending\",\n      stripePaymentIntentId: insertBooking.stripePaymentIntentId || null,\n      notes: insertBooking.notes || null,\n      createdAt: new Date()\n    };\n    this.bookings.set(id, booking);\n    return booking;\n  }\n\n  async updateBooking(id: string, updates: Partial<Booking>): Promise<Booking | undefined> {\n    const booking = this.bookings.get(id);\n    if (booking) {\n      const updatedBooking = { ...booking, ...updates };\n      this.bookings.set(id, updatedBooking);\n      return updatedBooking;\n    }\n    return undefined;\n  }\n\n  // Reviews\n  async getTrainerReviews(trainerId: string): Promise<TrainerReviewWithUser[]> {\n    const reviews = Array.from(this.trainerReviews.values())\n      .filter(r => r.trainerId === trainerId)\n      .sort((a, b) => b.createdAt.getTime() - a.createdAt.getTime());\n\n    return reviews.map(review => {\n      const user = this.users.get(review.userId)!;\n      return {\n        ...review,\n        user: { \n          email: user.email || \"\", \n          firstName: user.firstName || \"\", \n          lastName: user.lastName || \"\"\n        }\n      };\n    });\n  }\n\n  async createTrainerReview(insertReview: InsertTrainerReview): Promise<TrainerReview> {\n    const id = randomUUID();\n    const review: TrainerReview = {\n      ...insertReview,\n      id,\n      comment: insertReview.comment || null,\n      createdAt: new Date()\n    };\n    this.trainerReviews.set(id, review);\n    \n    // Update trainer rating\n    await this.updateTrainerRating(insertReview.trainerId);\n    \n    return review;\n  }\n\n  async updateTrainerRating(trainerId: string): Promise<void> {\n    const reviews = Array.from(this.trainerReviews.values()).filter(r => r.trainerId === trainerId);\n    const trainer = this.trainers.get(trainerId);\n    \n    if (trainer && reviews.length > 0) {\n      const avgRating = reviews.reduce((sum, r) => sum + r.rating, 0) / reviews.length;\n      const updatedTrainer = {\n        ...trainer,\n        rating: Math.round(avgRating * 100), // Store as integer (rating * 100)\n        totalReviews: reviews.length\n      };\n      this.trainers.set(trainerId, updatedTrainer);\n    }\n  }\n\n  // Food entries\n  async getFoodEntries(userId: string, date?: Date): Promise<FoodEntry[]> {\n    const entries = Array.from(this.foodEntries.values())\n      .filter(entry => {\n        if (entry.userId !== userId) return false;\n        \n        if (date) {\n          const entryDate = entry.loggedAt ? new Date(entry.loggedAt) : new Date();\n          const targetDate = new Date(date);\n          return (\n            entryDate.getFullYear() === targetDate.getFullYear() &&\n            entryDate.getMonth() === targetDate.getMonth() &&\n            entryDate.getDate() === targetDate.getDate()\n          );\n        }\n        \n        return true;\n      })\n      .sort((a, b) => (b.loggedAt ? new Date(b.loggedAt) : new Date()).getTime() - (a.loggedAt ? new Date(a.loggedAt) : new Date()).getTime());\n\n    return entries;\n  }\n\n  async createFoodEntry(insertEntry: InsertFoodEntry): Promise<FoodEntry> {\n    const id = randomUUID();\n    const entry: FoodEntry = {\n      id,\n      userId: insertEntry.userId,\n      name: insertEntry.name,\n      description: insertEntry.description || null,\n      calories: insertEntry.calories,\n      protein: insertEntry.protein || null,\n      carbs: insertEntry.carbs || null,\n      fat: insertEntry.fat || null,\n      fiber: insertEntry.fiber || null,\n      sugar: insertEntry.sugar || null,\n      sodium: insertEntry.sodium || null,\n      servingSize: insertEntry.servingSize || null,\n      imageUrl: insertEntry.imageUrl || null,\n      confidence: insertEntry.confidence || null,\n      loggedAt: insertEntry.loggedAt || new Date(),\n      createdAt: new Date()\n    };\n    this.foodEntries.set(id, entry);\n    return entry;\n  }\n\n  async updateFoodEntry(id: string, updates: Partial<FoodEntry>): Promise<FoodEntry | undefined> {\n    const entry = this.foodEntries.get(id);\n    if (entry) {\n      const updatedEntry = { ...entry, ...updates };\n      this.foodEntries.set(id, updatedEntry);\n      return updatedEntry;\n    }\n    return undefined;\n  }\n\n  async deleteFoodEntry(id: string): Promise<boolean> {\n    return this.foodEntries.delete(id);\n  }\n\n  // News and announcements\n  async getNews(limit: number = 50): Promise<News[]> {\n    return Array.from(this.newsItems.values())\n      .filter(item => item.isPublished)\n      .sort((a, b) => new Date(b.publishedAt).getTime() - new Date(a.publishedAt).getTime())\n      .slice(0, limit);\n  }\n\n  async getNewsItem(id: string): Promise<News | undefined> {\n    return this.newsItems.get(id);\n  }\n\n  async createNews(insertNews: InsertNews): Promise<News> {\n    const id = randomUUID();\n    const newsItem: News = {\n      id,\n      title: insertNews.title,\n      content: insertNews.content,\n      category: insertNews.category,\n      imageUrl: insertNews.imageUrl || null,\n      isPublished: insertNews.isPublished ?? true,\n      publishedAt: new Date(),\n      createdAt: new Date()\n    };\n    this.newsItems.set(id, newsItem);\n    return newsItem;\n  }\n\n  private seedNews() {\n    const newsData: InsertNews[] = [\n      {\n        title: \"Welcome to FlexFlow!\",\n        content: \"We're excited to have you here. FlexFlow is your all-in-one fitness companion, featuring workout tracking, AI-powered meal planning, progress photos, and much more. Start your fitness journey today!\",\n        category: \"announcement\",\n        isPublished: true\n      },\n      {\n        title: \"New Feature: AI Workout Planner\",\n        content: \"Create personalized 4-week workout plans tailored to your goals, equipment, and fitness level. Our AI generates specific exercises with sets, reps, rest periods, and form cues. Access it from the More menu!\",\n        category: \"feature\",\n        isPublished: true\n      },\n      {\n        title: \"Enhanced Meal Planning\",\n        content: \"Our AI meal planner now generates goal-specific meals with maximum variety. Whether you're aiming for weight loss, muscle gain, or maintenance, you'll get unique meals tailored to your preferences with no repetition across your plan.\",\n        category: \"feature\",\n        isPublished: true\n      },\n      {\n        title: \"Community Features Live\",\n        content: \"Share your fitness journey with the community! Post updates, progress photos, and connect with other fitness enthusiasts. All posts are moderated using AI to ensure a positive environment.\",\n        category: \"feature\",\n        isPublished: true\n      },\n      {\n        title: \"iOS App Coming Soon\",\n        content: \"We're working on a native iOS app that will sync seamlessly with your web account. Premium subscriptions purchased in the app will automatically sync across all your devices!\",\n        category: \"announcement\",\n        isPublished: true\n      }\n    ];\n\n    newsData.forEach(news => {\n      const id = randomUUID();\n      const newsItem: News = {\n        id,\n        title: news.title,\n        content: news.content,\n        category: news.category,\n        imageUrl: null,\n        isPublished: true,\n        publishedAt: new Date(Date.now() - Math.random() * 7 * 24 * 60 * 60 * 1000), // Random date within last week\n        createdAt: new Date()\n      };\n      this.newsItems.set(id, newsItem);\n    });\n  }\n\n  async seedLeaderboardData(): Promise<void> {\n    console.log(\"=== MEMSTORAGE SEEDING FUNCTION CALLED ===\");\n    console.log(\"🚀 Starting competitive leaderboard seeding...\");\n    \n    // Get current week date range (Monday to Sunday)\n    const now = new Date();\n    const currentDay = now.getDay();\n    const mondayOffset = currentDay === 0 ? -6 : 1 - currentDay;\n    const weekStart = new Date(now);\n    weekStart.setDate(now.getDate() + mondayOffset);\n    weekStart.setHours(0, 0, 0, 0);\n    \n    console.log(`📅 Week calculation: Today=${now.toDateString()}, Day=${currentDay}, WeekStart=${weekStart.toDateString()}`);\n\n    // Clear ALL existing workout exercises to reset leaderboard\n    console.log(`🧹 Clearing ${this.workoutExercises.size} existing workout exercises for clean leaderboard`);\n    this.workoutExercises.clear();\n    \n    // Add diverse competitive users to dominate the leaderboard  \n    const competitiveUsers = [\n      { email: \"derek.chen.powerlifter@outlook.com\", firstName: \"Derek\", lastName: \"Chen\", totalReps: 1500 },\n      { email: \"zoe.endurance.runner@yahoo.com\", firstName: \"Zoe\", lastName: \"Patel\", totalReps: 1400 },\n      { email: \"riley.hiit.specialist@hotmail.com\", firstName: \"Riley\", lastName: \"Johnson\", totalReps: 1300 },\n      { email: \"ava.calisthenics.expert@gmail.com\", firstName: \"Ava\", lastName: \"Rodriguez\", totalReps: 1200 },\n      { email: \"noah.strength.athlete@outlook.com\", firstName: \"Noah\", lastName: \"Kim\", totalReps: 1100 },\n      { email: \"sophia.cardio.dancer@yahoo.com\", firstName: \"Sophia\", lastName: \"Brown\", totalReps: 1000 },\n      { email: \"ethan.combat.fighter@gmail.com\", firstName: \"Ethan\", lastName: \"Davis\", totalReps: 900 },\n      { email: \"chloe.crossfit.pro@outlook.com\", firstName: \"Chloe\", lastName: \"Garcia\", totalReps: 800 },\n      { email: \"luke.functional.trainer@gmail.com\", firstName: \"Luke\", lastName: \"Taylor\", totalReps: 700 },\n      { email: \"isabella.yoga.master@hotmail.com\", firstName: \"Isabella\", lastName: \"Wilson\", totalReps: 600 }\n    ];\n\n    console.log(`👥 Adding ${competitiveUsers.length} competitive users to leaderboard`);\n\n    // Add each competitive user with workout data that creates their rep totals\n    for (const userData of competitiveUsers) {\n      const userId = randomUUID();\n      \n      // Create user\n      const user: any = {\n        id: userId,\n        email: userData.email,\n        firstName: userData.firstName,\n        lastName: userData.lastName,\n        createdAt: new Date(),\n        updatedAt: new Date(),\n        streak: Math.floor(Math.random() * 30) + 10, // 10-40 day streaks\n        subscriptionStatus: 'active', // All competitive users are active subscribers\n        trialStartDate: new Date(Date.now() - Math.random() * 30 * 24 * 60 * 60 * 1000)\n      };\n      this.users.set(userId, user);\n      console.log(`✅ Created user: ${userData.firstName} ${userData.lastName} (${userId}) - Target reps: ${userData.totalReps}`);\n\n      // Create multiple high-rep workouts for this user to achieve their total\n      const workoutsNeeded = Math.ceil(userData.totalReps / 300); // Split reps across multiple workouts\n      for (let i = 0; i < workoutsNeeded; i++) {\n        const workoutDate = new Date(weekStart);\n        workoutDate.setDate(weekStart.getDate() + i); // Spread across week\n        workoutDate.setHours(Math.floor(Math.random() * 6) + 6); // 6-12 PM\n\n        const workoutId = randomUUID();\n        const workout: any = {\n          id: workoutId,\n          userId: userId,\n          date: workoutDate.toISOString(),\n          name: `${userData.firstName}'s Training Session ${i + 1}`,\n          category: \"High Intensity\",\n          duration: 60 + Math.floor(Math.random() * 30), // 60-90 minutes\n          caloriesBurned: 400 + Math.floor(Math.random() * 200), // 400-600 calories\n          notes: \"Competitive training session\",\n          completedAt: workoutDate.toISOString(),\n          perceivedExertion: 8 + Math.floor(Math.random() * 2) // 8-9 RPE (high intensity)\n        };\n        this.workouts.set(workoutId, workout);\n\n        // Calculate reps for this specific workout (distribute total across workouts)\n        const repsForThisWorkout = i === workoutsNeeded - 1 \n          ? userData.totalReps - (i * Math.floor(userData.totalReps / workoutsNeeded)) // Remainder for last workout\n          : Math.floor(userData.totalReps / workoutsNeeded);\n\n        // Add workout exercise with calculated reps\n        const exerciseId = randomUUID();\n        const workoutExercise: any = {\n          id: exerciseId,\n          workoutId: workoutId,\n          exerciseId: `exercise-${userData.firstName.toLowerCase()}`,\n          sets: Math.ceil(repsForThisWorkout / 100), // Calculate sets\n          reps: repsForThisWorkout,\n          restTime: 90,\n          notes: `Competitive ${userData.firstName} training`\n        };\n        this.workoutExercises.set(exerciseId, workoutExercise);\n        console.log(`  💪 Created exercise: ${repsForThisWorkout} reps on ${workoutDate.toDateString()}`);\n      }\n    }\n\n    console.log(\"Competitive leaderboard seeding completed successfully\");\n  }\n\n  private getWorkoutsForProfile(profile: string) {\n    const workoutTemplates: Record<string, any[]> = {\n      endurance: [\n        {\n          name: \"Long Distance Run\",\n          category: \"Cardio\",\n          duration: 45,\n          calories: 400,\n          notes: \"Steady pace endurance training\",\n          exercises: [\n            { exerciseId: \"running\", sets: 1, reps: 350 }\n          ]\n        },\n        {\n          name: \"Interval Running\",\n          category: \"Cardio\",\n          duration: 35,\n          calories: 350,\n          notes: \"Speed intervals\",\n          exercises: [\n            { exerciseId: \"running\", sets: 8, reps: 280 }\n          ]\n        }\n      ],\n      strength: [\n        {\n          name: \"Upper Body Strength\",\n          category: \"Strength\",\n          duration: 50,\n          calories: 300,\n          notes: \"Heavy compound movements\",\n          exercises: [\n            { exerciseId: \"bench-press\", sets: 4, reps: 48, weight: 185 },\n            { exerciseId: \"pull-ups\", sets: 4, reps: 32 },\n            { exerciseId: \"shoulder-press\", sets: 3, reps: 36, weight: 135 }\n          ]\n        },\n        {\n          name: \"Lower Body Power\",\n          category: \"Strength\",\n          duration: 55,\n          calories: 350,\n          notes: \"Leg day focused training\",\n          exercises: [\n            { exerciseId: \"squats\", sets: 4, reps: 60, weight: 225 },\n            { exerciseId: \"deadlifts\", sets: 4, reps: 32, weight: 275 },\n            { exerciseId: \"lunges\", sets: 3, reps: 45 }\n          ]\n        }\n      ],\n      crossfit: [\n        {\n          name: \"WOD: Cindy\",\n          category: \"CrossFit\",\n          duration: 40,\n          calories: 450,\n          notes: \"20 min AMRAP\",\n          exercises: [\n            { exerciseId: \"pull-ups\", sets: 15, reps: 75 },\n            { exerciseId: \"push-ups\", sets: 15, reps: 150 },\n            { exerciseId: \"squats\", sets: 15, reps: 300 }\n          ]\n        },\n        {\n          name: \"WOD: Fran\",\n          category: \"CrossFit\", \n          duration: 25,\n          calories: 380,\n          notes: \"21-15-9 for time\",\n          exercises: [\n            { exerciseId: \"thrusters\", sets: 3, reps: 135, weight: 95 },\n            { exerciseId: \"pull-ups\", sets: 3, reps: 135 }\n          ]\n        }\n      ],\n      hiit: [\n        {\n          name: \"HIIT Circuit\",\n          category: \"HIIT\",\n          duration: 30,\n          calories: 400,\n          notes: \"High intensity intervals\",\n          exercises: [\n            { exerciseId: \"burpees\", sets: 6, reps: 72 },\n            { exerciseId: \"mountain-climbers\", sets: 6, reps: 180 },\n            { exerciseId: \"jump-squats\", sets: 6, reps: 90 }\n          ]\n        }\n      ],\n      athlete: [\n        {\n          name: \"Performance Training\",\n          category: \"Performance\",\n          duration: 60,\n          calories: 500,\n          notes: \"Competition preparation\",\n          exercises: [\n            { exerciseId: \"squats\", sets: 5, reps: 75, weight: 315 },\n            { exerciseId: \"bench-press\", sets: 5, reps: 60, weight: 225 },\n            { exerciseId: \"pull-ups\", sets: 5, reps: 75 },\n            { exerciseId: \"rows\", sets: 4, reps: 80, weight: 185 }\n          ]\n        }\n      ],\n      powerlifting: [\n        {\n          name: \"Heavy Singles\",\n          category: \"Powerlifting\",\n          duration: 75,\n          calories: 300,\n          notes: \"Max effort training\",\n          exercises: [\n            { exerciseId: \"deadlifts\", sets: 6, reps: 18, weight: 405 },\n            { exerciseId: \"squats\", sets: 5, reps: 20, weight: 365 },\n            { exerciseId: \"bench-press\", sets: 5, reps: 20, weight: 275 }\n          ]\n        }\n      ],\n      bodyweight: [\n        {\n          name: \"Calisthenics Flow\",\n          category: \"Bodyweight\",\n          duration: 35,\n          calories: 280,\n          notes: \"Movement quality focus\",\n          exercises: [\n            { exerciseId: \"push-ups\", sets: 5, reps: 125 },\n            { exerciseId: \"pull-ups\", sets: 5, reps: 65 },\n            { exerciseId: \"squats\", sets: 4, reps: 120 },\n            { exerciseId: \"dips\", sets: 4, reps: 80 }\n          ]\n        }\n      ],\n      cardio: [\n        {\n          name: \"Dance Cardio\",\n          category: \"Cardio\", \n          duration: 40,\n          calories: 350,\n          notes: \"High energy dance workout\",\n          exercises: [\n            { exerciseId: \"jumping-jacks\", sets: 8, reps: 320 },\n            { exerciseId: \"high-knees\", sets: 6, reps: 240 },\n            { exerciseId: \"butt-kickers\", sets: 6, reps: 180 }\n          ]\n        }\n      ],\n      flexibility: [\n        {\n          name: \"Yoga Flow\",\n          category: \"Flexibility\",\n          duration: 50,\n          calories: 200,\n          notes: \"Mind-body connection\",\n          exercises: [\n            { exerciseId: \"sun-salutations\", sets: 10, reps: 100 },\n            { exerciseId: \"warrior-poses\", sets: 8, reps: 80 },\n            { exerciseId: \"planks\", sets: 5, reps: 50 }\n          ]\n        }\n      ],\n      combat: [\n        {\n          name: \"Boxing Training\", \n          category: \"Combat\",\n          duration: 45,\n          calories: 450,\n          notes: \"Heavy bag work\",\n          exercises: [\n            { exerciseId: \"punching-bag\", sets: 12, reps: 360 },\n            { exerciseId: \"jump-rope\", sets: 6, reps: 600 },\n            { exerciseId: \"shadowboxing\", sets: 4, reps: 200 }\n          ]\n        }\n      ]\n    };\n\n    return workoutTemplates[profile] || workoutTemplates.strength;\n  }\n\n  async getLeaderboard(): Promise<LeaderboardEntry[]> {\n    // Get the current week's date range (Monday to Sunday)\n    const now = new Date();\n    const currentDay = now.getDay(); // 0 = Sunday, 1 = Monday, ..., 6 = Saturday\n    const mondayOffset = currentDay === 0 ? -6 : 1 - currentDay; // If Sunday, go back 6 days, else go to Monday\n    \n    const weekStart = new Date(now);\n    weekStart.setDate(now.getDate() + mondayOffset);\n    weekStart.setHours(0, 0, 0, 0); // Start of Monday\n    \n    const weekEnd = new Date(weekStart);\n    weekEnd.setDate(weekStart.getDate() + 6); // End of Sunday\n    weekEnd.setHours(23, 59, 59, 999);\n\n    // Calculate total reps for each user FROM THIS WEEK ONLY\n    const userReps = new Map<string, number>();\n    \n    // Iterate through all workout exercises to sum up reps per user (only from this week)\n    for (const workoutExercise of Array.from(this.workoutExercises.values())) {\n      const workout = this.workouts.get(workoutExercise.workoutId);\n      if (workout && workoutExercise.reps) {\n        // Only count workouts from the current week\n        const workoutDate = new Date(workout.date);\n        if (workoutDate >= weekStart && workoutDate <= weekEnd) {\n          const currentReps = userReps.get(workout.userId) || 0;\n          userReps.set(workout.userId, currentReps + workoutExercise.reps);\n        }\n      }\n    }\n\n    // Convert to leaderboard entries with user details\n    const leaderboardEntries: LeaderboardEntry[] = [];\n    \n    for (const [userId, totalReps] of Array.from(userReps.entries())) {\n      const user = this.users.get(userId);\n      if (user) {\n        leaderboardEntries.push({\n          userId: user.id,\n          firstName: user.firstName || user.email?.split('@')[0] || 'User',\n          lastName: user.lastName || '',\n          email: user.email || '',\n          totalReps,\n          rank: 0 // Will be set after sorting\n        });\n      }\n    }\n\n    // Sort by total reps (descending) and assign ranks\n    leaderboardEntries.sort((a, b) => b.totalReps - a.totalReps);\n    leaderboardEntries.forEach((entry, index) => {\n      entry.rank = index + 1;\n    });\n\n    return leaderboardEntries;\n  }\n\n  // Mile Tracker Sessions\n  async getMileTrackerSessions(userId: string): Promise<MileTrackerSessionWithSplits[]> {\n    const sessions = Array.from(this.mileTrackerSessions.values())\n      .filter(session => session.userId === userId)\n      .sort((a, b) => new Date(b.createdAt).getTime() - new Date(a.createdAt).getTime());\n\n    const sessionsWithSplits: MileTrackerSessionWithSplits[] = [];\n    for (const session of sessions) {\n      const splits = await this.getMileTrackerSplits(session.id);\n      sessionsWithSplits.push({ ...session, splits });\n    }\n\n    return sessionsWithSplits;\n  }\n\n  async getMileTrackerSession(id: string): Promise<MileTrackerSessionWithSplits | undefined> {\n    const session = this.mileTrackerSessions.get(id);\n    if (!session) return undefined;\n\n    const splits = await this.getMileTrackerSplits(session.id);\n    return { ...session, splits };\n  }\n\n  async getActiveMileTrackerSession(userId: string): Promise<MileTrackerSessionWithSplits | undefined> {\n    const activeSession = Array.from(this.mileTrackerSessions.values())\n      .find(session => session.userId === userId && session.status === \"active\");\n    \n    if (!activeSession) return undefined;\n\n    const splits = await this.getMileTrackerSplits(activeSession.id);\n    return { ...activeSession, splits };\n  }\n\n  async createMileTrackerSession(session: InsertMileTrackerSession): Promise<MileTrackerSession> {\n    const newSession: MileTrackerSession = {\n      id: randomUUID(),\n      ...session,\n      createdAt: new Date(),\n      startedAt: session.startedAt || new Date(),\n    };\n    \n    this.mileTrackerSessions.set(newSession.id, newSession);\n    return newSession;\n  }\n\n  async updateMileTrackerSession(id: string, updates: Partial<MileTrackerSession>): Promise<MileTrackerSession | undefined> {\n    const session = this.mileTrackerSessions.get(id);\n    if (!session) return undefined;\n\n    const updatedSession = { ...session, ...updates };\n    this.mileTrackerSessions.set(id, updatedSession);\n    return updatedSession;\n  }\n\n  async createMileTrackerSplit(split: InsertMileTrackerSplit): Promise<MileTrackerSplit> {\n    const newSplit: MileTrackerSplit = {\n      id: randomUUID(),\n      ...split,\n      completedAt: split.completedAt || new Date(),\n    };\n    \n    this.mileTrackerSplits.set(newSplit.id, newSplit);\n    return newSplit;\n  }\n\n  async getMileTrackerSplits(sessionId: string): Promise<MileTrackerSplit[]> {\n    return Array.from(this.mileTrackerSplits.values())\n      .filter(split => split.sessionId === sessionId)\n      .sort((a, b) => a.mileNumber - b.mileNumber);\n  }\n\n  // Community Posts\n  async getCommunityPosts(limit: number = 50): Promise<CommunityPostWithUser[]> {\n    const posts = Array.from(this.communityPosts.values())\n      .sort((a, b) => new Date(b.createdAt).getTime() - new Date(a.createdAt).getTime())\n      .slice(0, limit);\n\n    console.log(`Memory storage: Found ${posts.length} community posts`);\n    console.log(`Memory storage: Total users: ${this.users.size}`);\n\n    const postsWithUsers: CommunityPostWithUser[] = [];\n    for (const post of posts) {\n      const user = this.users.get(post.userId);\n      console.log(`Looking for user ${post.userId}: ${user ? 'found' : 'not found'}`);\n      if (user) {\n        const postWithUser: CommunityPostWithUser = {\n          ...post,\n          user: {\n            id: user.id,\n            firstName: user.firstName || \"\",\n            lastName: user.lastName || \"\",\n            email: user.email || \"\",\n            streak: user.streak,\n            profileImageUrl: user.profileImageUrl || null,\n          }\n        };\n\n        // Add workout info if it's a workout progress post\n        if (post.workoutId) {\n          const workout = this.workouts.get(post.workoutId);\n          if (workout) {\n            postWithUser.workout = {\n              id: workout.id,\n              name: workout.name,\n              category: workout.category,\n              duration: workout.duration,\n              caloriesBurned: workout.caloriesBurned,\n            };\n          }\n        }\n\n        postsWithUsers.push(postWithUser);\n      }\n    }\n\n    return postsWithUsers;\n  }\n\n  async createCommunityPost(post: InsertCommunityPost): Promise<CommunityPost> {\n    const newPost: CommunityPost = {\n      id: randomUUID(),\n      ...post,\n      likes: 0,\n      dislikes: 0,\n      createdAt: new Date(),\n    };\n    \n    this.communityPosts.set(newPost.id, newPost);\n    return newPost;\n  }\n\n  async likeCommunityPost(postId: string): Promise<CommunityPost | undefined> {\n    const post = this.communityPosts.get(postId);\n    if (!post) return undefined;\n\n    const updatedPost = { ...post, likes: post.likes + 1 };\n    this.communityPosts.set(postId, updatedPost);\n    return updatedPost;\n  }\n\n  async dislikeCommunityPost(postId: string): Promise<CommunityPost | undefined> {\n    const post = this.communityPosts.get(postId);\n    if (!post) return undefined;\n\n    const updatedPost = { ...post, dislikes: post.dislikes + 1 };\n    this.communityPosts.set(postId, updatedPost);\n    return updatedPost;\n  }\n\n  async deleteCommunityPost(postId: string, userId: string): Promise<boolean> {\n    const post = this.communityPosts.get(postId);\n    if (!post || post.userId !== userId) return false;\n\n    this.communityPosts.delete(postId);\n    return true;\n  }\n\n  // Progress Photos\n  async getProgressPhotos(userId: string, limit: number = 50): Promise<ProgressPhotoWithWorkout[]> {\n    const photos = Array.from(this.progressPhotos.values())\n      .filter(photo => photo.userId === userId)\n      .sort((a, b) => new Date(b.createdAt).getTime() - new Date(a.createdAt).getTime())\n      .slice(0, limit);\n\n    const photosWithWorkouts: ProgressPhotoWithWorkout[] = [];\n    for (const photo of photos) {\n      const workout = photo.workoutId ? this.workouts.get(photo.workoutId) : undefined;\n      photosWithWorkouts.push({\n        ...photo,\n        workout: workout ? {\n          id: workout.id,\n          name: workout.name,\n          category: workout.category,\n          date: workout.date,\n        } : undefined,\n      });\n    }\n\n    return photosWithWorkouts;\n  }\n\n  async createProgressPhoto(photo: InsertProgressPhoto): Promise<ProgressPhoto> {\n    const newPhoto: ProgressPhoto = {\n      id: randomUUID(),\n      ...photo,\n      createdAt: new Date(),\n    };\n    \n    this.progressPhotos.set(newPhoto.id, newPhoto);\n    return newPhoto;\n  }\n\n  async getProgressPhoto(id: string): Promise<ProgressPhoto | undefined> {\n    return this.progressPhotos.get(id);\n  }\n\n  async updateProgressPhoto(id: string, updates: Partial<ProgressPhoto>): Promise<ProgressPhoto | undefined> {\n    const photo = this.progressPhotos.get(id);\n    if (!photo) return undefined;\n\n    const updatedPhoto = { ...photo, ...updates };\n    this.progressPhotos.set(id, updatedPhoto);\n    return updatedPhoto;\n  }\n\n  async deleteProgressPhoto(id: string, userId: string): Promise<boolean> {\n    const photo = this.progressPhotos.get(id);\n    if (!photo || photo.userId !== userId) return false;\n\n    this.progressPhotos.delete(id);\n    return true;\n  }\n\n  async getProgressPhotosByDateRange(userId: string, startDate: Date, endDate: Date): Promise<ProgressPhotoWithWorkout[]> {\n    const photos = Array.from(this.progressPhotos.values())\n      .filter(photo => \n        photo.userId === userId &&\n        new Date(photo.createdAt) >= startDate &&\n        new Date(photo.createdAt) <= endDate\n      )\n      .sort((a, b) => new Date(a.createdAt).getTime() - new Date(b.createdAt).getTime());\n\n    const photosWithWorkouts: ProgressPhotoWithWorkout[] = [];\n    for (const photo of photos) {\n      const workout = photo.workoutId ? this.workouts.get(photo.workoutId) : undefined;\n      photosWithWorkouts.push({\n        ...photo,\n        workout: workout ? {\n          id: workout.id,\n          name: workout.name,\n          category: workout.category,\n          date: workout.date,\n        } : undefined,\n      });\n    }\n\n    return photosWithWorkouts;\n  }\n\n  // Subscription Audit\n  async createSubscriptionAudit(audit: InsertSubscriptionAudit): Promise<SubscriptionAudit> {\n    const newAudit: SubscriptionAudit = {\n      id: randomUUID(),\n      ...audit,\n      timestamp: new Date(),\n    };\n    \n    this.subscriptionAudits.set(newAudit.id, newAudit);\n    return newAudit;\n  }\n\n  // Meal Plans\n  async getMealPlans(goal?: string): Promise<MealPlanWithDetails[]> {\n    const plans = Array.from(this.mealPlans.values())\n      .filter(plan => plan.isActive && (!goal || plan.goal === goal));\n    \n    const plansWithDetails: MealPlanWithDetails[] = [];\n    for (const plan of plans) {\n      const days = Array.from(this.mealPlanDays.values())\n        .filter(day => day.mealPlanId === plan.id)\n        .sort((a, b) => a.dayNumber - b.dayNumber);\n      \n      const daysWithMeals = [];\n      for (const day of days) {\n        const meals = Array.from(this.mealPlanMeals.values())\n          .filter(meal => meal.mealPlanDayId === day.id);\n        daysWithMeals.push({ ...day, meals });\n      }\n      \n      plansWithDetails.push({ ...plan, days: daysWithMeals });\n    }\n    \n    return plansWithDetails;\n  }\n\n  async getMealPlan(id: string): Promise<MealPlanWithDetails | undefined> {\n    const plan = this.mealPlans.get(id);\n    if (!plan) return undefined;\n    \n    const days = Array.from(this.mealPlanDays.values())\n      .filter(day => day.mealPlanId === plan.id)\n      .sort((a, b) => a.dayNumber - b.dayNumber);\n    \n    const daysWithMeals = [];\n    for (const day of days) {\n      const meals = Array.from(this.mealPlanMeals.values())\n        .filter(meal => meal.mealPlanDayId === day.id);\n      daysWithMeals.push({ ...day, meals });\n    }\n    \n    return { ...plan, days: daysWithMeals };\n  }\n\n  async createMealPlan(mealPlan: InsertMealPlan): Promise<MealPlan> {\n    const newPlan: MealPlan = {\n      id: randomUUID(),\n      ...mealPlan,\n      createdAt: new Date(),\n    };\n    \n    this.mealPlans.set(newPlan.id, newPlan);\n    return newPlan;\n  }\n\n  async getUserMealPlan(userId: string): Promise<UserMealPlanWithDetails | undefined> {\n    const userPlan = Array.from(this.userMealPlans.values())\n      .find(up => up.userId === userId && up.isActive);\n    \n    if (!userPlan) return undefined;\n    \n    const mealPlan = await this.getMealPlan(userPlan.mealPlanId);\n    if (!mealPlan) return undefined;\n    \n    return { ...userPlan, mealPlan };\n  }\n\n  async assignMealPlan(userMealPlan: InsertUserMealPlan): Promise<UserMealPlan> {\n    // Deactivate any existing active meal plan for this user\n    for (const [id, plan] of this.userMealPlans.entries()) {\n      if (plan.userId === userMealPlan.userId && plan.isActive) {\n        this.userMealPlans.set(id, { ...plan, isActive: false });\n      }\n    }\n    \n    const newUserPlan: UserMealPlan = {\n      id: randomUUID(),\n      ...userMealPlan,\n      createdAt: new Date(),\n    };\n    \n    this.userMealPlans.set(newUserPlan.id, newUserPlan);\n    \n    // Update user activity to maintain streak\n    await this.updateUserActivity(userMealPlan.userId, newUserPlan.createdAt);\n    \n    return newUserPlan;\n  }\n\n  private seedMealPlans() {\n    // Weight Loss Meal Plan\n    const weightLossPlan = this.createMealPlanSync({\n      name: \"7-Day Weight Loss Plan\",\n      description: \"A balanced meal plan designed to create a caloric deficit while maintaining proper nutrition.\",\n      goal: \"weight_loss\",\n      dailyCalories: 1500,\n      dailyProtein: 120,\n      dailyCarbs: 150,\n      dailyFat: 50,\n      duration: 7,\n      isActive: true,\n    });\n\n    // Weight Gain Meal Plan  \n    const weightGainPlan = this.createMealPlanSync({\n      name: \"7-Day Weight Gain Plan\",\n      description: \"A nutrient-dense meal plan to support healthy weight gain and muscle building.\",\n      goal: \"weight_gain\",\n      dailyCalories: 2800,\n      dailyProtein: 150,\n      dailyCarbs: 350,\n      dailyFat: 100,\n      duration: 7,\n      isActive: true,\n    });\n\n    // Moderate Weight Loss Plan\n    const moderateWeightLossPlan = this.createMealPlanSync({\n      name: \"14-Day Moderate Weight Loss Plan\",\n      description: \"A gentle approach to weight loss with sustainable eating habits and 1800 calories per day.\",\n      goal: \"weight_loss\",\n      dailyCalories: 1800,\n      dailyProtein: 135,\n      dailyCarbs: 180,\n      dailyFat: 70,\n      duration: 14,\n      isActive: true,\n    });\n\n    // Maintenance Plan\n    const maintenancePlan = this.createMealPlanSync({\n      name: \"7-Day Balanced Maintenance Plan\",\n      description: \"Perfect for maintaining current weight while eating nutritious, satisfying meals.\",\n      goal: \"maintenance\",\n      dailyCalories: 2200,\n      dailyProtein: 110,\n      dailyCarbs: 275,\n      dailyFat: 85,\n      duration: 7,\n      isActive: true,\n    });\n\n    // High Protein Muscle Building Plan\n    const muscleBuildingPlan = this.createMealPlanSync({\n      name: \"7-Day Muscle Building Plan\",\n      description: \"High-protein meal plan designed for muscle growth and strength training support.\",\n      goal: \"weight_gain\",\n      dailyCalories: 3200,\n      dailyProtein: 180,\n      dailyCarbs: 400,\n      dailyFat: 115,\n      duration: 7,\n      isActive: true,\n    });\n\n    // Quick Weight Loss Plan\n    const quickWeightLossPlan = this.createMealPlanSync({\n      name: \"5-Day Quick Start Plan\",\n      description: \"A short-term plan to kickstart your weight loss journey with clean eating.\",\n      goal: \"weight_loss\",\n      dailyCalories: 1400,\n      dailyProtein: 105,\n      dailyCarbs: 140,\n      dailyFat: 45,\n      duration: 5,\n      isActive: true,\n    });\n\n    // Flexible Maintenance Plan\n    const flexibleMaintenancePlan = this.createMealPlanSync({\n      name: \"21-Day Flexible Living Plan\",\n      description: \"A longer-term maintenance plan with variety to fit your lifestyle.\",\n      goal: \"maintenance\",\n      dailyCalories: 2400,\n      dailyProtein: 120,\n      dailyCarbs: 300,\n      dailyFat: 95,\n      duration: 21,\n      isActive: true,\n    });\n\n    // Add days and meals for all plans\n    this.seedWeightLossMealPlan(weightLossPlan.id);\n    this.seedWeightGainMealPlan(weightGainPlan.id);\n    this.seedGeneralMealPlan(moderateWeightLossPlan.id, \"weight_loss\", moderateWeightLossPlan.dailyCalories, 14);\n    this.seedGeneralMealPlan(maintenancePlan.id, \"maintenance\", maintenancePlan.dailyCalories, 7);\n    this.seedGeneralMealPlan(muscleBuildingPlan.id, \"weight_gain\", muscleBuildingPlan.dailyCalories, 10);\n    this.seedGeneralMealPlan(quickWeightLossPlan.id, \"weight_loss\", quickWeightLossPlan.dailyCalories, 5);\n    this.seedGeneralMealPlan(flexibleMaintenancePlan.id, \"maintenance\", flexibleMaintenancePlan.dailyCalories, 21);\n  }\n\n  private createMealPlanSync(mealPlan: InsertMealPlan): MealPlan {\n    const newPlan: MealPlan = {\n      id: randomUUID(),\n      ...mealPlan,\n      createdAt: new Date(),\n    };\n    \n    this.mealPlans.set(newPlan.id, newPlan);\n    return newPlan;\n  }\n\n  private seedWeightLossMealPlan(planId: string) {\n    for (let day = 1; day <= 7; day++) {\n      const dayId = randomUUID();\n      const mealPlanDay: MealPlanDay = {\n        id: dayId,\n        mealPlanId: planId,\n        dayNumber: day,\n        name: `Day ${day}`,\n      };\n      this.mealPlanDays.set(dayId, mealPlanDay);\n\n      // Sample meals for weight loss\n      const meals = [\n        {\n          mealType: \"breakfast\",\n          name: \"Greek Yogurt Bowl\",\n          description: \"Low-fat Greek yogurt with berries and almonds\",\n          calories: 300,\n          protein: 20,\n          carbs: 30,\n          fat: 8,\n          ingredients: [\"Greek yogurt (1 cup)\", \"Mixed berries (1/2 cup)\", \"Sliced almonds (1 tbsp)\", \"Honey (1 tsp)\"],\n          instructions: [\"Mix yogurt with honey\", \"Top with berries and almonds\"],\n          prepTime: 5,\n          servings: 1,\n        },\n        {\n          mealType: \"lunch\",\n          name: \"Grilled Chicken Salad\",\n          description: \"Mixed greens with grilled chicken and light dressing\",\n          calories: 400,\n          protein: 35,\n          carbs: 15,\n          fat: 20,\n          ingredients: [\"Grilled chicken breast (4oz)\", \"Mixed greens (2 cups)\", \"Cherry tomatoes (1/2 cup)\", \"Cucumber (1/2 cup)\", \"Olive oil dressing (2 tbsp)\"],\n          instructions: [\"Grill chicken breast\", \"Mix greens and vegetables\", \"Top with chicken and dressing\"],\n          prepTime: 15,\n          servings: 1,\n        },\n        {\n          mealType: \"dinner\",\n          name: \"Baked Salmon with Vegetables\",\n          description: \"Herb-crusted salmon with roasted vegetables\",\n          calories: 450,\n          protein: 40,\n          carbs: 25,\n          fat: 18,\n          ingredients: [\"Salmon fillet (5oz)\", \"Broccoli (1 cup)\", \"Sweet potato (1/2 medium)\", \"Olive oil (1 tbsp)\", \"Herbs and spices\"],\n          instructions: [\"Season salmon with herbs\", \"Roast vegetables at 400°F\", \"Bake salmon for 15 minutes\"],\n          prepTime: 25,\n          servings: 1,\n        },\n        {\n          mealType: \"snack\",\n          name: \"Apple with Almond Butter\",\n          description: \"Fresh apple slices with natural almond butter\",\n          calories: 200,\n          protein: 6,\n          carbs: 25,\n          fat: 8,\n          ingredients: [\"Apple (1 medium)\", \"Almond butter (1 tbsp)\"],\n          instructions: [\"Slice apple\", \"Serve with almond butter for dipping\"],\n          prepTime: 2,\n          servings: 1,\n        },\n      ];\n\n      meals.forEach(meal => {\n        const mealId = randomUUID();\n        const mealPlanMeal: MealPlanMeal = {\n          id: mealId,\n          mealPlanDayId: dayId,\n          ...meal,\n          imageUrl: null,\n          ingredientImages: null,\n        };\n        this.mealPlanMeals.set(mealId, mealPlanMeal);\n      });\n    }\n  }\n\n  private seedWeightGainMealPlan(planId: string) {\n    for (let day = 1; day <= 7; day++) {\n      const dayId = randomUUID();\n      const mealPlanDay: MealPlanDay = {\n        id: dayId,\n        mealPlanId: planId,\n        dayNumber: day,\n        name: `Day ${day}`,\n      };\n      this.mealPlanDays.set(dayId, mealPlanDay);\n\n      // Sample meals for weight gain\n      const meals = [\n        {\n          mealType: \"breakfast\",\n          name: \"Protein Pancakes\",\n          description: \"High-protein pancakes with peanut butter and banana\",\n          calories: 550,\n          protein: 30,\n          carbs: 45,\n          fat: 20,\n          ingredients: [\"Oat flour (1/2 cup)\", \"Protein powder (1 scoop)\", \"Banana (1 large)\", \"Eggs (2 whole)\", \"Peanut butter (2 tbsp)\", \"Milk (1/4 cup)\"],\n          instructions: [\"Mix dry ingredients\", \"Blend wet ingredients\", \"Cook pancakes on medium heat\", \"Top with peanut butter\"],\n          prepTime: 15,\n          servings: 1,\n        },\n        {\n          mealType: \"lunch\",\n          name: \"Quinoa Power Bowl\",\n          description: \"Quinoa with grilled chicken, avocado, and nuts\",\n          calories: 650,\n          protein: 35,\n          carbs: 50,\n          fat: 28,\n          ingredients: [\"Quinoa (1 cup cooked)\", \"Grilled chicken (4oz)\", \"Avocado (1/2 medium)\", \"Mixed nuts (1/4 cup)\", \"Olive oil (1 tbsp)\", \"Vegetables (1 cup)\"],\n          instructions: [\"Cook quinoa according to package\", \"Grill chicken breast\", \"Assemble bowl with all ingredients\"],\n          prepTime: 20,\n          servings: 1,\n        },\n        {\n          mealType: \"dinner\",\n          name: \"Steak with Sweet Potato\",\n          description: \"Lean beef with roasted sweet potato and vegetables\",\n          calories: 700,\n          protein: 45,\n          carbs: 40,\n          fat: 30,\n          ingredients: [\"Lean beef steak (6oz)\", \"Sweet potato (1 large)\", \"Green beans (1 cup)\", \"Butter (1 tbsp)\", \"Olive oil (1 tbsp)\"],\n          instructions: [\"Season and grill steak\", \"Roast sweet potato at 425°F\", \"Sauté green beans\", \"Serve together\"],\n          prepTime: 30,\n          servings: 1,\n        },\n        {\n          mealType: \"snack\",\n          name: \"Protein Smoothie\",\n          description: \"High-calorie smoothie with protein powder and fruits\",\n          calories: 400,\n          protein: 25,\n          carbs: 35,\n          fat: 15,\n          ingredients: [\"Protein powder (1 scoop)\", \"Banana (1 large)\", \"Peanut butter (2 tbsp)\", \"Oats (1/4 cup)\", \"Milk (1 cup)\", \"Honey (1 tbsp)\"],\n          instructions: [\"Add all ingredients to blender\", \"Blend until smooth\", \"Serve immediately\"],\n          prepTime: 5,\n          servings: 1,\n        },\n      ];\n\n      meals.forEach(meal => {\n        const mealId = randomUUID();\n        const mealPlanMeal: MealPlanMeal = {\n          id: mealId,\n          mealPlanDayId: dayId,\n          ...meal,\n          imageUrl: null,\n          ingredientImages: null,\n        };\n        this.mealPlanMeals.set(mealId, mealPlanMeal);\n      });\n    }\n  }\n\n  // Commission tracking methods\n  async getTotalCommissions(): Promise<{ totalCommissions: number; totalBookings: number }> {\n    const paidBookings = Array.from(this.bookings.values())\n      .filter(booking => booking.status === \"paid\" && booking.platformCommission);\n    \n    const totalCommissions = paidBookings.reduce((total, booking) => \n      total + (booking.platformCommission || 0), 0);\n    \n    return {\n      totalCommissions,\n      totalBookings: paidBookings.length\n    };\n  }\n\n  async markBookingAsPaid(bookingId: string, totalPrice: number): Promise<Booking | undefined> {\n    const booking = this.bookings.get(bookingId);\n    if (!booking) return undefined;\n\n    // Calculate 15% commission for platform\n    const platformCommission = Math.round(totalPrice * 0.15);\n    const trainerEarnings = totalPrice - platformCommission;\n\n    const updatedBooking: Booking = {\n      ...booking,\n      status: \"paid\",\n      totalPrice,\n      platformCommission,\n      trainerEarnings,\n    };\n\n    this.bookings.set(bookingId, updatedBooking);\n    return updatedBooking;\n  }\n\n  // Trainer subscription methods\n  async getTrainerSubscriptionStatus(userId: string): Promise<{\n    subscriptionStatus: string;\n    lastPaymentDate?: Date;\n    subscriptionExpiresAt?: Date;\n    isActive: boolean;\n  } | null> {\n    const trainer = Array.from(this.trainers.values())\n      .find(t => t.userId === userId);\n    \n    if (!trainer) return null;\n\n    const now = new Date();\n    const isExpired = trainer.subscriptionExpiresAt && now > trainer.subscriptionExpiresAt;\n\n    return {\n      subscriptionStatus: trainer.subscriptionStatus || \"inactive\",\n      lastPaymentDate: trainer.lastPaymentDate,\n      subscriptionExpiresAt: trainer.subscriptionExpiresAt,\n      isActive: trainer.subscriptionStatus === \"active\" && !isExpired\n    };\n  }\n\n  async activateTrainerSubscription(userId: string): Promise<Trainer | undefined> {\n    const trainer = Array.from(this.trainers.values())\n      .find(t => t.userId === userId);\n    \n    if (!trainer) return undefined;\n\n    const now = new Date();\n    const subscriptionExpiresAt = new Date(now);\n    subscriptionExpiresAt.setMonth(subscriptionExpiresAt.getMonth() + 1); // Add 1 month\n\n    const updatedTrainer: Trainer = {\n      ...trainer,\n      subscriptionStatus: \"active\",\n      lastPaymentDate: now,\n      subscriptionExpiresAt,\n    };\n\n    this.trainers.set(trainer.id, updatedTrainer);\n    return updatedTrainer;\n  }\n\n  async cancelTrainerSubscription(userId: string): Promise<Trainer | undefined> {\n    const trainer = Array.from(this.trainers.values())\n      .find(t => t.userId === userId);\n    \n    if (!trainer) return undefined;\n\n    const updatedTrainer: Trainer = {\n      ...trainer,\n      subscriptionStatus: \"inactive\",\n    };\n\n    this.trainers.set(trainer.id, updatedTrainer);\n    return updatedTrainer;\n  }\n\n  async getTotalSubscriptionRevenue(): Promise<{ totalRevenue: number; activeTrainers: number }> {\n    const activeTrainers = Array.from(this.trainers.values())\n      .filter(trainer => trainer.subscriptionStatus === \"active\");\n    \n    // Each active trainer pays $25/month, calculate estimated monthly revenue\n    const totalRevenue = activeTrainers.length * 25; // $25 per trainer per month\n\n    return {\n      totalRevenue: totalRevenue * 100, // Convert to cents for consistency\n      activeTrainers: activeTrainers.length\n    };\n  }\n\n  // Calendar Notes\n  async getCalendarNotes(userId: string, date?: Date): Promise<CalendarNote[]> {\n    const notes = Array.from(this.calendarNotes.values()).filter(note => {\n      if (note.userId !== userId) return false;\n      if (date) {\n        const noteDate = new Date(note.date);\n        const targetDate = new Date(date);\n        return noteDate.toDateString() === targetDate.toDateString();\n      }\n      return true;\n    });\n    return notes.sort((a, b) => new Date(a.date).getTime() - new Date(b.date).getTime());\n  }\n\n  async getCalendarNote(id: string): Promise<CalendarNote | undefined> {\n    return this.calendarNotes.get(id);\n  }\n\n  async createCalendarNote(noteData: InsertCalendarNote): Promise<CalendarNote> {\n    const id = randomUUID();\n    const now = new Date();\n    const note: CalendarNote = {\n      ...noteData,\n      id,\n      createdAt: now,\n      updatedAt: now,\n    };\n    this.calendarNotes.set(id, note);\n    return note;\n  }\n\n  async updateCalendarNote(id: string, updates: Partial<CalendarNote>): Promise<CalendarNote | undefined> {\n    const note = this.calendarNotes.get(id);\n    if (!note) return undefined;\n\n    const updatedNote: CalendarNote = {\n      ...note,\n      ...updates,\n      id, // Ensure ID doesn't change\n      updatedAt: new Date(),\n    };\n    this.calendarNotes.set(id, updatedNote);\n    return updatedNote;\n  }\n\n  async deleteCalendarNote(id: string): Promise<boolean> {\n    return this.calendarNotes.delete(id);\n  }\n\n  // User Meal Preferences for AI generation\n  async getUserMealPreferences(userId: string): Promise<UserMealPreferences | undefined> {\n    return Array.from(this.userMealPreferences.values())\n      .find(prefs => prefs.userId === userId);\n  }\n\n  async createUserMealPreferences(preferences: InsertUserMealPreferences): Promise<UserMealPreferences> {\n    const id = randomUUID();\n    const now = new Date();\n    const userPreferences: UserMealPreferences = {\n      ...preferences,\n      id,\n      createdAt: now,\n      updatedAt: now,\n    };\n    this.userMealPreferences.set(id, userPreferences);\n    return userPreferences;\n  }\n\n  async updateUserMealPreferences(userId: string, updates: Partial<UserMealPreferences>): Promise<UserMealPreferences | undefined> {\n    const existing = Array.from(this.userMealPreferences.values())\n      .find(prefs => prefs.userId === userId);\n    \n    if (!existing) return undefined;\n\n    const updatedPreferences: UserMealPreferences = {\n      ...existing,\n      ...updates,\n      id: existing.id, // Ensure ID doesn't change\n      updatedAt: new Date(),\n    };\n    this.userMealPreferences.set(existing.id, updatedPreferences);\n    return updatedPreferences;\n  }\n\n  async getUsersForWeeklyMealPlanGeneration(): Promise<{ userId: string; preferences: UserMealPreferences }[]> {\n    const oneWeekAgo = new Date();\n    oneWeekAgo.setDate(oneWeekAgo.getDate() - 7);\n\n    return Array.from(this.userMealPreferences.values())\n      .filter(prefs => \n        prefs.autoGenerate && \n        (!prefs.lastGeneratedAt || new Date(prefs.lastGeneratedAt) <= oneWeekAgo)\n      )\n      .map(prefs => ({ userId: prefs.userId, preferences: prefs }));\n  }\n\n  // AI Meal Plan Generation\n  async createAIMealPlan(mealPlan: InsertMealPlan, days: { dayNumber: number; name: string; meals: any[] }[]): Promise<MealPlan> {\n    // Create the meal plan\n    const planId = randomUUID();\n    const newPlan: MealPlan = {\n      id: planId,\n      ...mealPlan,\n      createdAt: new Date(),\n    };\n    this.mealPlans.set(planId, newPlan);\n\n    // Create the days and meals\n    for (const dayData of days) {\n      const dayId = randomUUID();\n      const day: MealPlanDay = {\n        id: dayId,\n        mealPlanId: planId,\n        dayNumber: dayData.dayNumber,\n        name: dayData.name,\n      };\n      this.mealPlanDays.set(dayId, day);\n\n      // Create meals for this day\n      for (const mealData of dayData.meals) {\n        const mealId = randomUUID();\n        const meal: MealPlanMeal = {\n          id: mealId,\n          mealPlanDayId: dayId,\n          mealType: mealData.mealType,\n          name: mealData.name,\n          description: mealData.description,\n          calories: mealData.calories,\n          protein: mealData.protein,\n          carbs: mealData.carbs,\n          fat: mealData.fat,\n          ingredients: mealData.ingredients,\n          instructions: mealData.instructions || [],\n          prepTime: mealData.prepTime,\n          servings: mealData.servings,\n          imageUrl: mealData.imageUrl || null,\n          ingredientImages: mealData.ingredientImages || null,\n        };\n        this.mealPlanMeals.set(mealId, meal);\n      }\n    }\n\n    return newPlan;\n  }\n\n  // Food Items and Preferences Implementation\n  async getFoodItems(category?: string): Promise<FoodItem[]> {\n    const items = Array.from(this.foodItems.values());\n    if (category) {\n      return items.filter(item => item.category === category);\n    }\n    return items.sort((a, b) => (b.isCommon ? 1 : 0) - (a.isCommon ? 1 : 0));\n  }\n\n  async createFoodItem(foodItem: InsertFoodItem): Promise<FoodItem> {\n    const newItem: FoodItem = {\n      id: randomUUID(),\n      ...foodItem,\n      createdAt: new Date(),\n    };\n    this.foodItems.set(newItem.id, newItem);\n    return newItem;\n  }\n\n  async getFoodItemsWithUserPreferences(userId: string, category?: string): Promise<FoodItemWithPreference[]> {\n    const items = await this.getFoodItems(category);\n    const userPrefs = await this.getUserFoodPreferences(userId);\n    \n    return items.map(item => {\n      const userPreference = userPrefs.find(pref => pref.foodItemId === item.id);\n      return { ...item, userPreference };\n    });\n  }\n\n  async getUserFoodPreferences(userId: string): Promise<UserFoodPreference[]> {\n    return Array.from(this.userFoodPreferences.values())\n      .filter(pref => pref.userId === userId);\n  }\n\n  async setUserFoodPreference(preference: InsertUserFoodPreference): Promise<UserFoodPreference> {\n    // Check if preference already exists\n    const existing = Array.from(this.userFoodPreferences.values())\n      .find(pref => pref.userId === preference.userId && pref.foodItemId === preference.foodItemId);\n\n    if (existing) {\n      // Update existing preference\n      const updated: UserFoodPreference = {\n        ...existing,\n        preference: preference.preference,\n        updatedAt: new Date(),\n      };\n      this.userFoodPreferences.set(existing.id, updated);\n      return updated;\n    }\n\n    // Create new preference\n    const newPreference: UserFoodPreference = {\n      id: randomUUID(),\n      ...preference,\n      createdAt: new Date(),\n      updatedAt: new Date(),\n    };\n    this.userFoodPreferences.set(newPreference.id, newPreference);\n    return newPreference;\n  }\n\n  async updateUserFoodPreference(userId: string, foodItemId: string, preference: string): Promise<UserFoodPreference | undefined> {\n    const existing = Array.from(this.userFoodPreferences.values())\n      .find(pref => pref.userId === userId && pref.foodItemId === foodItemId);\n\n    if (!existing) return undefined;\n\n    const updated: UserFoodPreference = {\n      ...existing,\n      preference,\n      updatedAt: new Date(),\n    };\n    this.userFoodPreferences.set(existing.id, updated);\n    return updated;\n  }\n\n  async deleteUserFoodPreference(userId: string, foodItemId: string): Promise<boolean> {\n    const existing = Array.from(this.userFoodPreferences.values())\n      .find(pref => pref.userId === userId && pref.foodItemId === foodItemId);\n\n    if (!existing) return false;\n\n    this.userFoodPreferences.delete(existing.id);\n    return true;\n  }\n\n  private seedFoodItems() {\n    const foodItems: InsertFoodItem[] = [\n      // Proteins\n      { name: \"Chicken Breast\", category: \"proteins\", caloriesPer100g: 165, proteinPer100g: 31, carbsPer100g: 0, fatPer100g: 4, fiberPer100g: 0, commonServingSize: \"1 piece (100g)\", isCommon: true },\n      { name: \"Salmon\", category: \"proteins\", caloriesPer100g: 208, proteinPer100g: 20, carbsPer100g: 0, fatPer100g: 13, fiberPer100g: 0, commonServingSize: \"1 fillet (150g)\", isCommon: true },\n      { name: \"Ground Turkey\", category: \"proteins\", caloriesPer100g: 149, proteinPer100g: 20, carbsPer100g: 0, fatPer100g: 7, fiberPer100g: 0, commonServingSize: \"100g\", isCommon: true },\n      { name: \"Eggs\", category: \"proteins\", caloriesPer100g: 155, proteinPer100g: 13, carbsPer100g: 1, fatPer100g: 11, fiberPer100g: 0, commonServingSize: \"2 large eggs (100g)\", isCommon: true },\n      { name: \"Greek Yogurt\", category: \"dairy\", caloriesPer100g: 59, proteinPer100g: 10, carbsPer100g: 4, fatPer100g: 0, fiberPer100g: 0, commonServingSize: \"1 cup (245g)\", isCommon: true },\n      { name: \"Tofu\", category: \"proteins\", caloriesPer100g: 76, proteinPer100g: 8, carbsPer100g: 2, fatPer100g: 5, fiberPer100g: 1, commonServingSize: \"100g\", isCommon: true },\n      { name: \"Lean Beef\", category: \"proteins\", caloriesPer100g: 250, proteinPer100g: 26, carbsPer100g: 0, fatPer100g: 15, fiberPer100g: 0, commonServingSize: \"3 oz (85g)\", isCommon: true },\n      { name: \"Cod Fish\", category: \"proteins\", caloriesPer100g: 82, proteinPer100g: 18, carbsPer100g: 0, fatPer100g: 1, fiberPer100g: 0, commonServingSize: \"1 fillet (150g)\", isCommon: true },\n      { name: \"Shrimp\", category: \"proteins\", caloriesPer100g: 99, proteinPer100g: 18, carbsPer100g: 0, fatPer100g: 1, fiberPer100g: 0, commonServingSize: \"3 oz (85g)\", isCommon: true },\n      { name: \"Protein Powder\", category: \"proteins\", caloriesPer100g: 411, proteinPer100g: 82, carbsPer100g: 6, fatPer100g: 8, fiberPer100g: 0, commonServingSize: \"1 scoop (30g)\", isCommon: true },\n      { name: \"Chicken Thighs\", category: \"proteins\", caloriesPer100g: 209, proteinPer100g: 26, carbsPer100g: 0, fatPer100g: 11, fiberPer100g: 0, commonServingSize: \"1 thigh (85g)\", isCommon: true },\n      { name: \"Turkey Breast\", category: \"proteins\", caloriesPer100g: 135, proteinPer100g: 30, carbsPer100g: 0, fatPer100g: 1, fiberPer100g: 0, commonServingSize: \"3 oz (85g)\", isCommon: true },\n      { name: \"Pork Tenderloin\", category: \"proteins\", caloriesPer100g: 143, proteinPer100g: 26, carbsPer100g: 0, fatPer100g: 4, fiberPer100g: 0, commonServingSize: \"3 oz (85g)\", isCommon: true },\n      { name: \"Egg Whites\", category: \"proteins\", caloriesPer100g: 52, proteinPer100g: 11, carbsPer100g: 1, fatPer100g: 0, fiberPer100g: 0, commonServingSize: \"3 egg whites (100g)\", isCommon: true },\n      { name: \"Seitan\", category: \"proteins\", caloriesPer100g: 370, proteinPer100g: 75, carbsPer100g: 14, fatPer100g: 2, fiberPer100g: 6, commonServingSize: \"3 oz (85g)\", isCommon: true },\n      { name: \"Tempeh\", category: \"proteins\", caloriesPer100g: 190, proteinPer100g: 19, carbsPer100g: 9, fatPer100g: 11, fiberPer100g: 9, commonServingSize: \"3 oz (85g)\", isCommon: true },\n\n      // Carbohydrates\n      { name: \"Brown Rice\", category: \"grains\", caloriesPer100g: 111, proteinPer100g: 3, carbsPer100g: 23, fatPer100g: 1, fiberPer100g: 2, commonServingSize: \"1 cup cooked (195g)\", isCommon: true },\n      { name: \"Quinoa\", category: \"grains\", caloriesPer100g: 120, proteinPer100g: 4, carbsPer100g: 22, fatPer100g: 2, fiberPer100g: 3, commonServingSize: \"1 cup cooked (185g)\", isCommon: true },\n      { name: \"Sweet Potato\", category: \"vegetables\", caloriesPer100g: 86, proteinPer100g: 2, carbsPer100g: 20, fatPer100g: 0, fiberPer100g: 3, commonServingSize: \"1 medium (128g)\", isCommon: true },\n      { name: \"Oats\", category: \"grains\", caloriesPer100g: 389, proteinPer100g: 17, carbsPer100g: 66, fatPer100g: 7, fiberPer100g: 11, commonServingSize: \"1/2 cup dry (40g)\", isCommon: true },\n      { name: \"Whole Wheat Bread\", category: \"grains\", caloriesPer100g: 247, proteinPer100g: 13, carbsPer100g: 41, fatPer100g: 4, fiberPer100g: 7, commonServingSize: \"2 slices (56g)\", isCommon: true },\n\n      // Vegetables\n      { name: \"Broccoli\", category: \"vegetables\", caloriesPer100g: 34, proteinPer100g: 3, carbsPer100g: 7, fatPer100g: 0, fiberPer100g: 3, commonServingSize: \"1 cup chopped (91g)\", isCommon: true },\n      { name: \"Spinach\", category: \"vegetables\", caloriesPer100g: 23, proteinPer100g: 3, carbsPer100g: 4, fatPer100g: 0, fiberPer100g: 2, commonServingSize: \"1 cup raw (30g)\", isCommon: true },\n      { name: \"Bell Peppers\", category: \"vegetables\", caloriesPer100g: 31, proteinPer100g: 1, carbsPer100g: 7, fatPer100g: 0, fiberPer100g: 3, commonServingSize: \"1 medium (119g)\", isCommon: true },\n      { name: \"Carrots\", category: \"vegetables\", caloriesPer100g: 41, proteinPer100g: 1, carbsPer100g: 10, fatPer100g: 0, fiberPer100g: 3, commonServingSize: \"1 medium (61g)\", isCommon: true },\n      { name: \"Tomatoes\", category: \"vegetables\", caloriesPer100g: 18, proteinPer100g: 1, carbsPer100g: 4, fatPer100g: 0, fiberPer100g: 1, commonServingSize: \"1 medium (123g)\", isCommon: true },\n\n      // Fruits\n      { name: \"Banana\", category: \"fruits\", caloriesPer100g: 89, proteinPer100g: 1, carbsPer100g: 23, fatPer100g: 0, fiberPer100g: 3, commonServingSize: \"1 medium (118g)\", isCommon: true },\n      { name: \"Apple\", category: \"fruits\", caloriesPer100g: 52, proteinPer100g: 0, carbsPer100g: 14, fatPer100g: 0, fiberPer100g: 2, commonServingSize: \"1 medium (182g)\", isCommon: true },\n      { name: \"Berries (Mixed)\", category: \"fruits\", caloriesPer100g: 57, proteinPer100g: 1, carbsPer100g: 14, fatPer100g: 0, fiberPer100g: 6, commonServingSize: \"1 cup (148g)\", isCommon: true },\n      { name: \"Orange\", category: \"fruits\", caloriesPer100g: 47, proteinPer100g: 1, carbsPer100g: 12, fatPer100g: 0, fiberPer100g: 2, commonServingSize: \"1 medium (154g)\", isCommon: true },\n\n      // Healthy Fats\n      { name: \"Avocado\", category: \"fats\", caloriesPer100g: 160, proteinPer100g: 2, carbsPer100g: 9, fatPer100g: 15, fiberPer100g: 7, commonServingSize: \"1 medium (150g)\", isCommon: true },\n      { name: \"Almonds\", category: \"nuts\", caloriesPer100g: 579, proteinPer100g: 21, carbsPer100g: 22, fatPer100g: 50, fiberPer100g: 12, commonServingSize: \"1 oz (28g)\", isCommon: true },\n      { name: \"Olive Oil\", category: \"fats\", caloriesPer100g: 884, proteinPer100g: 0, carbsPer100g: 0, fatPer100g: 100, fiberPer100g: 0, commonServingSize: \"1 tbsp (14g)\", isCommon: true },\n      { name: \"Walnuts\", category: \"nuts\", caloriesPer100g: 654, proteinPer100g: 15, carbsPer100g: 14, fatPer100g: 65, fiberPer100g: 7, commonServingSize: \"1 oz (28g)\", isCommon: true },\n\n      // Dairy\n      { name: \"Milk (2%)\", category: \"dairy\", caloriesPer100g: 50, proteinPer100g: 3, carbsPer100g: 5, fatPer100g: 2, fiberPer100g: 0, commonServingSize: \"1 cup (244g)\", isCommon: true },\n      { name: \"Cheese (Cheddar)\", category: \"dairy\", caloriesPer100g: 403, proteinPer100g: 25, carbsPer100g: 1, fatPer100g: 33, fiberPer100g: 0, commonServingSize: \"1 oz (28g)\", isCommon: true },\n\n      // Additional options\n      { name: \"Black Beans\", category: \"legumes\", caloriesPer100g: 132, proteinPer100g: 9, carbsPer100g: 23, fatPer100g: 1, fiberPer100g: 9, commonServingSize: \"1/2 cup (86g)\", isCommon: true },\n      { name: \"Lentils\", category: \"legumes\", caloriesPer100g: 116, proteinPer100g: 9, carbsPer100g: 20, fatPer100g: 0, fiberPer100g: 8, commonServingSize: \"1/2 cup (99g)\", isCommon: true },\n      { name: \"Tuna\", category: \"proteins\", caloriesPer100g: 144, proteinPer100g: 30, carbsPer100g: 0, fatPer100g: 1, fiberPer100g: 0, commonServingSize: \"1 can (142g)\", isCommon: true },\n      { name: \"Cottage Cheese\", category: \"dairy\", caloriesPer100g: 98, proteinPer100g: 11, carbsPer100g: 4, fatPer100g: 4, fiberPer100g: 0, commonServingSize: \"1/2 cup (113g)\", isCommon: true },\n    ];\n\n    foodItems.forEach((item, index) => {\n      const id = `food-${index + 1}`;\n      const foodItem: FoodItem = {\n        id,\n        ...item,\n        createdAt: new Date(),\n      };\n      this.foodItems.set(id, foodItem);\n    });\n  }\n\n  private seedCommunityPosts() {\n    // Create some sample users first for the community posts\n    const sampleUsers: { id: string; firstName: string; lastName: string; email: string; streak: number }[] = [\n      {\n        id: randomUUID(),\n        firstName: \"Jessica\",\n        lastName: \"Martinez\",\n        email: \"jessica.m.fit@gmail.com\",\n        streak: 12\n      },\n      {\n        id: randomUUID(),\n        firstName: \"Maria\",\n        lastName: \"Garcia\",\n        email: \"maria@example.com\",\n        streak: 12\n      },\n      {\n        id: randomUUID(),\n        firstName: \"Jordan\",\n        lastName: \"Lee\",\n        email: \"jordan@example.com\",\n        streak: 3\n      }\n    ];\n\n    // Store sample users in memory storage\n    sampleUsers.forEach(user => {\n      const fullUser = {\n        ...user,\n        createdAt: new Date(),\n        updatedAt: new Date(),\n        currentWeightKg: 70,\n        currentHeightCm: 170,\n        fitnessLevel: \"intermediate\" as const,\n        goalType: \"weight_loss\" as const,\n      };\n      this.users.set(user.id, fullUser);\n    });\n\n    // Create sample community posts\n    const samplePosts = [\n      {\n        userId: sampleUsers[0].id,\n        content: \"Just finished an amazing 45-minute strength training session! 💪 Feeling stronger every day. The consistency is really paying off!\",\n        postType: \"workout_progress\" as const\n      },\n      {\n        userId: sampleUsers[1].id, \n        content: \"Hit my goal of running 5K under 25 minutes today! 🏃‍♀️ Started from barely being able to run 1K just 3 months ago. Never give up on your dreams!\",\n        postType: \"goal_achievement\" as const\n      },\n      {\n        userId: sampleUsers[2].id,\n        content: \"Who else is struggling with motivation today? 😅 Some days are harder than others, but we've got this! What keeps you going when things get tough?\",\n        postType: \"message\" as const\n      },\n      {\n        userId: sampleUsers[0].id,\n        content: \"Meal prep Sunday is done! 🥗 Prepared healthy lunches for the entire week. Small steps lead to big changes!\",\n        postType: \"message\" as const\n      },\n      {\n        userId: sampleUsers[1].id,\n        content: \"New personal record on deadlifts today! 🎉 Added 10 more pounds to my max. Progress feels amazing when you work for it consistently.\",\n        postType: \"workout_progress\" as const\n      }\n    ];\n\n    samplePosts.forEach((postData, index) => {\n      const post = {\n        id: randomUUID(),\n        ...postData,\n        likes: Math.floor(Math.random() * 15) + 1, // Random likes between 1-15\n        createdAt: new Date(Date.now() - (index * 24 * 60 * 60 * 1000)), // Spread posts over several days\n        updatedAt: new Date(),\n        workoutId: undefined,\n        imageUrl: undefined\n      };\n      this.communityPosts.set(post.id, post);\n    });\n  }\n\n  private seedLeaderboardData() {\n    // Get the sample users created in seedCommunityPosts\n    const userIds = Array.from(this.users.keys()).slice(0, 5); // Get first 5 users\n    \n    if (userIds.length === 0) return; // No users to create workouts for\n    \n    // Get some exercises for the workouts\n    const exerciseIds = Array.from(this.exercises.keys()).slice(0, 5);\n    \n    // Create sample workouts for different users with varying rep counts\n    const workoutData = [\n      // User 1 - Gold position (highest reps)\n      {\n        userId: userIds[0],\n        workoutName: \"Strength Training Session\",\n        exercises: [\n          { exerciseId: exerciseIds[0], reps: 25 }, // Push-ups\n          { exerciseId: exerciseIds[1], reps: 30 }, // Squats  \n          { exerciseId: exerciseIds[2], reps: 20 }, // Lunges\n        ]\n      },\n      // User 2 - Silver position (medium reps)\n      {\n        userId: userIds[1],\n        workoutName: \"Upper Body Workout\",\n        exercises: [\n          { exerciseId: exerciseIds[0], reps: 20 }, // Push-ups\n          { exerciseId: exerciseIds[3], reps: 15 }, // Pull-ups\n          { exerciseId: exerciseIds[4], reps: 18 }, // Planks (as reps)\n        ]\n      },\n      // User 3 - Bronze position (lower reps)\n      {\n        userId: userIds[2],\n        workoutName: \"Full Body Circuit\",\n        exercises: [\n          { exerciseId: exerciseIds[1], reps: 15 }, // Squats\n          { exerciseId: exerciseIds[2], reps: 12 }, // Lunges\n          { exerciseId: exerciseIds[0], reps: 10 }, // Push-ups\n        ]\n      }\n    ];\n\n    // Create the workouts and workout exercises\n    workoutData.forEach((data, index) => {\n      const workoutId = randomUUID();\n      const workout = {\n        id: workoutId,\n        userId: data.userId,\n        name: data.workoutName,\n        category: \"strength\",\n        duration: 45,\n        caloriesBurned: 300 + (index * 50),\n        notes: \"Sample workout for leaderboard demo\",\n        date: new Date(Date.now() - (index * 24 * 60 * 60 * 1000)), // Different days\n        createdAt: new Date()\n      };\n      this.workouts.set(workoutId, workout);\n\n      // Add workout exercises with reps\n      data.exercises.forEach(exercise => {\n        const workoutExerciseId = randomUUID();\n        const workoutExercise = {\n          id: workoutExerciseId,\n          workoutId: workoutId,\n          exerciseId: exercise.exerciseId,\n          sets: 3,\n          reps: exercise.reps,\n          weight: null,\n          distance: null,\n          duration: null,\n          notes: null\n        };\n        this.workoutExercises.set(workoutExerciseId, workoutExercise);\n      });\n    });\n  }\n\n  private seedRealisticLeaderboardData() {\n    // No synthetic users - leaderboard will only show real users with real workouts\n    console.log(\"✅ Leaderboard configured to use real user data only\");\n  }\n\n  private seedGeneralMealPlan(planId: string, goal: string, dailyCalories: number, duration: number) {\n    // Create days for the meal plan with variety\n    for (let day = 1; day <= duration; day++) {\n      const dayId = randomUUID();\n      const mealPlanDay: MealPlanDay = {\n        id: dayId,\n        mealPlanId: planId,\n        dayNumber: day,\n        name: `Day ${day}`,\n      };\n      this.mealPlanDays.set(dayId, mealPlanDay);\n\n      // Create varied meals for each day\n      const breakfastVariations = [\n        {\n          name: `Protein-Rich Breakfast Bowl`,\n          description: `Balanced morning meal with ${Math.round(dailyCalories * 0.25)} calories`,\n          calories: Math.round(dailyCalories * 0.25),\n          ingredients: goal === \"weight_gain\" ? \n            [\"Oats\", \"Greek yogurt\", \"Banana\", \"Nuts\", \"Honey\", \"Berries\"] :\n            [\"Egg whites\", \"Vegetables\", \"Avocado\", \"Whole grain toast\"],\n        },\n        {\n          name: `Morning Energy Bowl`,\n          description: `Energizing breakfast with varied ingredients`,\n          calories: Math.round(dailyCalories * 0.25),\n          ingredients: goal === \"weight_gain\" ? \n            [\"Quinoa\", \"Almond milk\", \"Mixed fruits\", \"Chia seeds\", \"Maple syrup\"] :\n            [\"Greek yogurt\", \"Berries\", \"Almonds\", \"Cinnamon\"],\n        }\n      ];\n\n      const lunchVariations = [\n        {\n          name: `Power Lunch Bowl`,\n          description: `Satisfying midday meal with ${Math.round(dailyCalories * 0.30)} calories`,\n          calories: Math.round(dailyCalories * 0.30),\n          ingredients: goal === \"weight_gain\" ? \n            [\"Brown rice\", \"Chicken\", \"Vegetables\", \"Avocado\", \"Olive oil\"] :\n            [\"Quinoa\", \"Grilled chicken\", \"Mixed greens\", \"Light dressing\"],\n        },\n        {\n          name: `Mediterranean Feast`,\n          description: `Mediterranean-inspired lunch`,\n          calories: Math.round(dailyCalories * 0.30),\n          ingredients: goal === \"weight_gain\" ? \n            [\"Salmon\", \"Quinoa\", \"Vegetables\", \"Feta cheese\", \"Olive oil\"] :\n            [\"Tuna\", \"Mixed salad\", \"Chickpeas\", \"Lemon dressing\"],\n        }\n      ];\n\n      const dinnerVariations = [\n        {\n          name: `Evening Nourishment`,\n          description: `Satisfying dinner with ${Math.round(dailyCalories * 0.35)} calories`,\n          calories: Math.round(dailyCalories * 0.35),\n          ingredients: goal === \"weight_gain\" ? \n            [\"Beef\", \"Sweet potato\", \"Broccoli\", \"Butter\", \"Herbs\"] :\n            [\"Grilled fish\", \"Vegetables\", \"Brown rice\", \"Herbs\"],\n        },\n        {\n          name: `Comfort Dinner`,\n          description: `Hearty evening meal`,\n          calories: Math.round(dailyCalories * 0.35),\n          ingredients: goal === \"weight_gain\" ? \n            [\"Turkey\", \"Pasta\", \"Vegetables\", \"Cheese\", \"Olive oil\"] :\n            [\"Chicken\", \"Roasted vegetables\", \"Quinoa\", \"Light sauce\"],\n        }\n      ];\n\n      // Select variations based on day to ensure variety\n      const breakfastMeal = breakfastVariations[day % 2];\n      const lunchMeal = lunchVariations[day % 2];\n      const dinnerMeal = dinnerVariations[day % 2];\n\n      const meals = [\n        {\n          mealType: \"breakfast\",\n          name: breakfastMeal.name,\n          description: breakfastMeal.description,\n          calories: breakfastMeal.calories,\n          protein: goal === \"weight_gain\" ? Math.round(breakfastMeal.calories * 0.20 / 4) : Math.round(breakfastMeal.calories * 0.25 / 4),\n          carbs: goal === \"weight_gain\" ? Math.round(breakfastMeal.calories * 0.50 / 4) : Math.round(breakfastMeal.calories * 0.40 / 4),\n          fat: goal === \"weight_gain\" ? Math.round(breakfastMeal.calories * 0.30 / 9) : Math.round(breakfastMeal.calories * 0.35 / 9),\n          ingredients: breakfastMeal.ingredients,\n          instructions: [\"Prepare base ingredients\", \"Combine and mix\", \"Add toppings\", \"Serve fresh\"],\n          prepTime: 15,\n          servings: 1,\n        },\n        {\n          mealType: \"lunch\",\n          name: lunchMeal.name,\n          description: lunchMeal.description,\n          calories: lunchMeal.calories,\n          protein: goal === \"weight_gain\" ? Math.round(lunchMeal.calories * 0.25 / 4) : Math.round(lunchMeal.calories * 0.30 / 4),\n          carbs: goal === \"weight_gain\" ? Math.round(lunchMeal.calories * 0.45 / 4) : Math.round(lunchMeal.calories * 0.35 / 4),\n          fat: goal === \"weight_gain\" ? Math.round(lunchMeal.calories * 0.30 / 9) : Math.round(lunchMeal.calories * 0.35 / 9),\n          ingredients: lunchMeal.ingredients,\n          instructions: [\"Cook protein\", \"Prepare grain/base\", \"Add vegetables\", \"Combine with dressing\"],\n          prepTime: 25,\n          servings: 1,\n        },\n        {\n          mealType: \"dinner\",\n          name: dinnerMeal.name,\n          description: dinnerMeal.description,\n          calories: dinnerMeal.calories,\n          protein: goal === \"weight_gain\" ? Math.round(dinnerMeal.calories * 0.25 / 4) : Math.round(dinnerMeal.calories * 0.30 / 4),\n          carbs: goal === \"weight_gain\" ? Math.round(dinnerMeal.calories * 0.45 / 4) : Math.round(dinnerMeal.calories * 0.30 / 4),\n          fat: goal === \"weight_gain\" ? Math.round(dinnerMeal.calories * 0.30 / 9) : Math.round(dinnerMeal.calories * 0.40 / 9),\n          ingredients: dinnerMeal.ingredients,\n          instructions: [\"Season protein\", \"Cook thoroughly\", \"Prepare sides\", \"Plate and serve\"],\n          prepTime: 35,\n          servings: 1,\n        },\n        {\n          mealType: \"snack\",\n          name: \"Healthy Snack\",\n          description: `Nutritious snack with ${Math.round(dailyCalories * 0.10)} calories`,\n          calories: Math.round(dailyCalories * 0.10),\n          protein: Math.round(dailyCalories * 0.10 * 0.20 / 4),\n          carbs: Math.round(dailyCalories * 0.10 * 0.40 / 4),\n          fat: Math.round(dailyCalories * 0.10 * 0.40 / 9),\n          ingredients: goal === \"weight_gain\" ? \n            [\"Mixed nuts\", \"Dried fruit\", \"Yogurt\"] :\n            [\"Apple\", \"Almond butter\", \"Greek yogurt\"],\n          instructions: [\"Prepare snack\", \"Enjoy between meals\"],\n          prepTime: 5,\n          servings: 1,\n        }\n      ];\n\n      meals.forEach((meal, index) => {\n        const mealId = randomUUID();\n        const mealPlanMeal: MealPlanMeal = {\n          id: mealId,\n          mealPlanDayId: dayId,\n          mealType: meal.mealType as \"breakfast\" | \"lunch\" | \"dinner\" | \"snack\",\n          name: meal.name,\n          description: meal.description,\n          calories: meal.calories,\n          protein: meal.protein,\n          carbs: meal.carbs,\n          fat: meal.fat,\n          ingredients: meal.ingredients,\n          instructions: meal.instructions,\n          prepTime: meal.prepTime,\n          servings: meal.servings,\n        };\n        this.mealPlanMeals.set(mealId, mealPlanMeal);\n      });\n    }\n  }\n\n  // AI Difficulty Adjustments implementation\n  async getRecentWorkoutsForExercise(userId: string, exerciseId: string, limit: number): Promise<(Workout & { exercises: WorkoutExercise[] })[]> {\n    const allWorkouts = Array.from(this.workouts.values())\n      .filter(workout => workout.userId === userId)\n      .sort((a, b) => new Date(b.date).getTime() - new Date(a.date).getTime());\n\n    const workoutsWithExercises: (Workout & { exercises: WorkoutExercise[] })[] = [];\n    \n    for (const workout of allWorkouts) {\n      const workoutExercises = Array.from(this.workoutExercises.values())\n        .filter(we => we.workoutId === workout.id && we.exerciseId === exerciseId);\n      \n      if (workoutExercises.length > 0) {\n        workoutsWithExercises.push({\n          ...workout,\n          exercises: workoutExercises\n        });\n        \n        if (workoutsWithExercises.length >= limit) {\n          break;\n        }\n      }\n    }\n    \n    return workoutsWithExercises;\n  }\n\n  async createAiDifficultyAdjustment(adjustment: InsertAiDifficultyAdjustment): Promise<AiDifficultyAdjustment> {\n    const id = randomUUID();\n    const now = new Date();\n    const newAdjustment: AiDifficultyAdjustment = {\n      id,\n      ...adjustment,\n      createdAt: now,\n      updatedAt: now,\n    };\n    this.aiDifficultyAdjustments.set(id, newAdjustment);\n    return newAdjustment;\n  }\n\n  async getPendingAiAdjustments(userId: string): Promise<AiDifficultyAdjustment[]> {\n    return Array.from(this.aiDifficultyAdjustments.values())\n      .filter(adjustment => adjustment.userId === userId && !adjustment.applied)\n      .sort((a, b) => new Date(b.createdAt).getTime() - new Date(a.createdAt).getTime());\n  }\n\n  async applyAiDifficultyAdjustment(adjustmentId: string): Promise<boolean> {\n    const adjustment = this.aiDifficultyAdjustments.get(adjustmentId);\n    if (!adjustment) {\n      return false;\n    }\n\n    const updatedAdjustment = {\n      ...adjustment,\n      applied: true,\n      appliedAt: new Date(),\n      updatedAt: new Date(),\n    };\n    \n    this.aiDifficultyAdjustments.set(adjustmentId, updatedAdjustment);\n    return true;\n  }\n\n  // Meal Tracking methods implementation\n  async getMealEntries(userId: string, date?: string): Promise<MealEntry[]> {\n    const entries = Array.from(this.mealEntries.values()).filter(entry => entry.userId === userId);\n    \n    if (date) {\n      const targetDate = new Date(date);\n      return entries.filter(entry => {\n        const entryDate = new Date(entry.loggedAt);\n        return entryDate.toDateString() === targetDate.toDateString();\n      });\n    }\n    \n    return entries.sort((a, b) => new Date(b.loggedAt).getTime() - new Date(a.loggedAt).getTime());\n  }\n\n  async createMealEntry(entry: InsertMealEntry): Promise<MealEntry> {\n    const id = randomUUID();\n    const newEntry: MealEntry = {\n      ...entry,\n      id,\n      loggedAt: entry.loggedAt || new Date(),\n    };\n    \n    this.mealEntries.set(id, newEntry);\n    \n    // Update user activity to maintain streak\n    await this.updateUserActivity(entry.userId, newEntry.loggedAt);\n    \n    return newEntry;\n  }\n\n  async getMealEntry(id: string): Promise<MealEntry | undefined> {\n    return this.mealEntries.get(id);\n  }\n\n  async deleteMealEntry(id: string): Promise<boolean> {\n    return this.mealEntries.delete(id);\n  }\n\n  // Workout Planner methods\n  async getWorkoutPreferences(userId: string): Promise<WorkoutPreferences | undefined> {\n    return Array.from(this.workoutPreferences.values()).find(p => p.userId === userId);\n  }\n\n  async saveWorkoutPreferences(preferences: InsertWorkoutPreferences): Promise<WorkoutPreferences> {\n    const id = randomUUID();\n    const workoutPreferences: WorkoutPreferences = {\n      ...preferences,\n      id,\n      createdAt: new Date(),\n      updatedAt: new Date(),\n    };\n    \n    // Remove any existing preferences for this user\n    for (const [key, existing] of this.workoutPreferences.entries()) {\n      if (existing.userId === preferences.userId) {\n        this.workoutPreferences.delete(key);\n        break;\n      }\n    }\n    \n    this.workoutPreferences.set(id, workoutPreferences);\n    return workoutPreferences;\n  }\n\n  async getWorkoutPlan(userId: string): Promise<(WorkoutPlan & { plannedWorkouts: PlannedWorkout[] }) | undefined> {\n    const plan = Array.from(this.workoutPlans.values()).find(p => p.userId === userId && p.isActive);\n    if (!plan) return undefined;\n    \n    const plannedWorkouts = Array.from(this.plannedWorkouts.values())\n      .filter(pw => pw.planId === plan.id);\n    \n    return {\n      ...plan,\n      plannedWorkouts\n    };\n  }\n\n  async createWorkoutPlan(plan: InsertWorkoutPlan): Promise<WorkoutPlan> {\n    const id = randomUUID();\n    const workoutPlan: WorkoutPlan = {\n      ...plan,\n      id,\n      createdAt: new Date(),\n      updatedAt: new Date(),\n    };\n    \n    // Deactivate any existing active plans for this user\n    for (const [key, existing] of this.workoutPlans.entries()) {\n      if (existing.userId === plan.userId && existing.isActive) {\n        this.workoutPlans.set(key, { ...existing, isActive: false, updatedAt: new Date() });\n      }\n    }\n    \n    this.workoutPlans.set(id, workoutPlan);\n    return workoutPlan;\n  }\n\n  async createPlannedWorkouts(plannedWorkouts: InsertPlannedWorkout[]): Promise<PlannedWorkout[]> {\n    const result: PlannedWorkout[] = [];\n    \n    for (const plannedWorkout of plannedWorkouts) {\n      const id = randomUUID();\n      const workout: PlannedWorkout = {\n        ...plannedWorkout,\n        id,\n        createdAt: new Date(),\n        updatedAt: new Date(),\n      };\n      \n      this.plannedWorkouts.set(id, workout);\n      result.push(workout);\n    }\n    \n    return result;\n  }\n}\n\n// Database Storage Implementation\nexport class DatabaseStorage implements IStorage {\n  // Authentication methods\n  async createUserWithPassword(userData: SignUpData): Promise<User> {\n    try {\n      // Check if username or email already exists\n      const existingUser = await this.getUserByUsernameOrEmail(userData.username) || \n                          await this.getUserByUsernameOrEmail(userData.email);\n      \n      if (existingUser) {\n        throw new Error(\"Username or email already exists\");\n      }\n      \n      // Hash the password\n      const saltRounds = 12;\n      const passwordHash = await bcrypt.hash(userData.password, saltRounds);\n      \n      // Create user in database\n      const [user] = await db\n        .insert(users)\n        .values({\n          email: userData.email,\n          username: userData.username,\n          passwordHash,\n          firstName: userData.firstName,\n          lastName: userData.lastName,\n          authProvider: \"local\",\n          isEmailVerified: false,\n          subscriptionStatus: \"free_trial\",\n          subscriptionExpiresAt: new Date(Date.now() + (7 * 24 * 60 * 60 * 1000)), // 7 days from now\n        })\n        .returning();\n      \n      return user;\n    } catch (error) {\n      throw error;\n    }\n  }\n\n  async getUserByUsernameOrEmail(identifier: string): Promise<User | undefined> {\n    const [user] = await db\n      .select()\n      .from(users)\n      .where(or(eq(users.username, identifier), eq(users.email, identifier)));\n    return user;\n  }\n\n  async getUserByEmail(email: string): Promise<User | undefined> {\n    const [user] = await db\n      .select()\n      .from(users)\n      .where(eq(users.email, email));\n    return user;\n  }\n\n  async getUsersByAppleTransactionId(transactionId: string): Promise<User[]> {\n    const usersResult = await db\n      .select()\n      .from(users)\n      .where(eq(users.appleOriginalTransactionId, transactionId));\n    return usersResult;\n  }\n\n  async getUser(id: string): Promise<User | undefined> {\n    const [user] = await db\n      .select()\n      .from(users)\n      .where(eq(users.id, id));\n    return user;\n  }\n\n  async upsertUser(userData: UpsertUser): Promise<User> {\n    const [user] = await db\n      .insert(users)\n      .values(userData)\n      .onConflictDoUpdate({\n        target: users.id,\n        set: {\n          ...userData,\n          updatedAt: new Date(),\n        },\n      })\n      .returning();\n    return user;\n  }\n\n\n  async verifyUserEmail(userId: string): Promise<User | undefined> {\n    const [user] = await db\n      .update(users)\n      .set({ isEmailVerified: true, updatedAt: new Date() })\n      .where(eq(users.id, userId))\n      .returning();\n    return user;\n  }\n\n  // Fallback to MemStorage for other methods not yet implemented\n  private memStorage = new MemStorage();\n\n  // Delegate all other methods to MemStorage for now  \n  async getUsers(): Promise<User[]> { \n    // Get users from both database and memStorage\n    const dbUsers = await db.select().from(users);\n    const memUsers = await this.memStorage.getUsers();\n    return [...dbUsers, ...memUsers];\n  }\n  async getUserByUsername(username: string): Promise<User | undefined> { return this.memStorage.getUserByUsername(username); }\n  async createUser(user: InsertUser): Promise<User> { return this.memStorage.createUser(user); }\n  async updateUserStreak(id: string, streak: number): Promise<User | undefined> { return this.memStorage.updateUserStreak(id, streak); }\n  \n  async updateUserActivity(id: string, activityDate: Date): Promise<User | undefined> { return this.memStorage.updateUserActivity(id, activityDate); }\n  \n  // Activity logging methods\n  async createUserActivity(activityData: InsertUserActivityLog): Promise<UserActivityLog> { return this.memStorage.createUserActivity(activityData); }\n  async getUserActivities(userId: string, limit?: number): Promise<UserActivityLog[]> { return this.memStorage.getUserActivities(userId, limit); }\n  \n  async updateUser(id: string, updates: Partial<User>): Promise<User | undefined> {\n    try {\n      const [user] = await db\n        .update(users)\n        .set({ ...updates, updatedAt: new Date() })\n        .where(eq(users.id, id))\n        .returning();\n      return user;\n    } catch (error) {\n      console.error('Database updateUser error:', error);\n      return undefined;\n    }\n  }\n  \n  // Exercise methods\n  async getExercises(): Promise<Exercise[]> { return this.memStorage.getExercises(); }\n  async getExercisesByCategory(category: string): Promise<Exercise[]> { return this.memStorage.getExercisesByCategory(category); }\n  async searchExercises(query: string): Promise<Exercise[]> { return this.memStorage.searchExercises(query); }\n  async getExercise(id: string): Promise<Exercise | undefined> { return this.memStorage.getExercise(id); }\n  async createExercise(exercise: InsertExercise): Promise<Exercise> { return this.memStorage.createExercise(exercise); }\n  \n  // Workout methods\n  async getWorkouts(userId: string): Promise<Workout[]> { return this.memStorage.getWorkouts(userId); }\n  async getWorkout(id: string): Promise<WorkoutWithExercises | undefined> { return this.memStorage.getWorkout(id); }\n  async createWorkout(workout: InsertWorkout): Promise<Workout> { return this.memStorage.createWorkout(workout); }\n  async getWorkoutsByDateRange(userId: string, startDate: Date, endDate: Date): Promise<Workout[]> { return this.memStorage.getWorkoutsByDateRange(userId, startDate, endDate); }\n  \n  // Workout Exercise methods\n  async createWorkoutExercise(workoutExercise: InsertWorkoutExercise): Promise<WorkoutExercise> { return this.memStorage.createWorkoutExercise(workoutExercise); }\n  async getWorkoutExercises(workoutId: string): Promise<(WorkoutExercise & { exercise: Exercise })[]> { return this.memStorage.getWorkoutExercises(workoutId); }\n  \n  // Goal methods\n  async getGoals(userId: string): Promise<Goal[]> { return this.memStorage.getGoals(userId); }\n  async createGoal(goal: InsertGoal): Promise<Goal> { return this.memStorage.createGoal(goal); }\n  async updateGoal(id: string, updates: Partial<Goal>): Promise<Goal | undefined> { return this.memStorage.updateGoal(id, updates); }\n  async deleteGoal(id: string): Promise<boolean> { return this.memStorage.deleteGoal(id); }\n\n  // Workout Planner methods\n  async getWorkoutPreferences(userId: string): Promise<WorkoutPreferences | undefined> { return this.memStorage.getWorkoutPreferences(userId); }\n  async saveWorkoutPreferences(preferences: InsertWorkoutPreferences): Promise<WorkoutPreferences> { return this.memStorage.saveWorkoutPreferences(preferences); }\n  async getWorkoutPlan(userId: string): Promise<(WorkoutPlan & { plannedWorkouts: PlannedWorkout[] }) | undefined> { return this.memStorage.getWorkoutPlan(userId); }\n  async createWorkoutPlan(plan: InsertWorkoutPlan): Promise<WorkoutPlan> { return this.memStorage.createWorkoutPlan(plan); }\n  async createPlannedWorkouts(plannedWorkouts: InsertPlannedWorkout[]): Promise<PlannedWorkout[]> { return this.memStorage.createPlannedWorkouts(plannedWorkouts); }\n\n  // Meal Tracking methods\n  async getMealEntries(userId: string, date?: string): Promise<MealEntry[]> { return this.memStorage.getMealEntries(userId, date); }\n  async createMealEntry(entry: InsertMealEntry): Promise<MealEntry> { return this.memStorage.createMealEntry(entry); }\n  async getMealEntry(id: string): Promise<MealEntry | undefined> { return this.memStorage.getMealEntry(id); }\n  async deleteMealEntry(id: string): Promise<boolean> { return this.memStorage.deleteMealEntry(id); }\n  \n  // Stats methods\n  async getUserStats(userId: string): Promise<UserStats> { return this.memStorage.getUserStats(userId); }\n  async getAdvancedProgressMetrics(userId: string): Promise<any> { return this.memStorage.getAdvancedProgressMetrics(userId); }\n  async getWeightProgressData(userId: string): Promise<any> { return this.memStorage.getWeightProgressData(userId); }\n  \n  // Leaderboard methods\n  async getLeaderboard(): Promise<LeaderboardEntry[]> { return this.memStorage.getLeaderboard(); }\n  \n  // All other methods delegate to MemStorage for now\n  async getTrainers(filters?: any): Promise<TrainerWithServices[]> { return this.memStorage.getTrainers(filters); }\n  async getTrainer(id: string): Promise<TrainerWithServices | undefined> { return this.memStorage.getTrainer(id); }\n  async getTrainerByUserId(userId: string): Promise<Trainer | undefined> { return this.memStorage.getTrainerByUserId(userId); }\n  async createTrainer(trainer: InsertTrainer): Promise<Trainer> { return this.memStorage.createTrainer(trainer); }\n  async updateTrainer(id: string, updates: Partial<Trainer>): Promise<Trainer | undefined> { return this.memStorage.updateTrainer(id, updates); }\n  async getTrainerServices(trainerId: string): Promise<TrainerService[]> { return this.memStorage.getTrainerServices(trainerId); }\n  async createTrainerService(service: InsertTrainerService): Promise<TrainerService> { return this.memStorage.createTrainerService(service); }\n  async updateTrainerService(id: string, updates: Partial<TrainerService>): Promise<TrainerService | undefined> { return this.memStorage.updateTrainerService(id, updates); }\n  async getBookings(userId: string): Promise<BookingWithDetails[]> { return this.memStorage.getBookings(userId); }\n  async getTrainerBookings(trainerId: string): Promise<BookingWithDetails[]> { return this.memStorage.getTrainerBookings(trainerId); }\n  async getBooking(id: string): Promise<BookingWithDetails | undefined> { return this.memStorage.getBooking(id); }\n  async createBooking(booking: InsertBooking): Promise<Booking> { return this.memStorage.createBooking(booking); }\n  async updateBooking(id: string, updates: Partial<Booking>): Promise<Booking | undefined> { return this.memStorage.updateBooking(id, updates); }\n  async getTrainerReviews(trainerId: string): Promise<TrainerReviewWithUser[]> { return this.memStorage.getTrainerReviews(trainerId); }\n  async createTrainerReview(review: InsertTrainerReview): Promise<TrainerReview> { return this.memStorage.createTrainerReview(review); }\n  async updateTrainerRating(trainerId: string): Promise<void> { return this.memStorage.updateTrainerRating(trainerId); }\n  async getFoodEntries(userId: string, date?: Date): Promise<FoodEntry[]> { return this.memStorage.getFoodEntries(userId, date); }\n  async createFoodEntry(foodEntry: InsertFoodEntry): Promise<FoodEntry> { return this.memStorage.createFoodEntry(foodEntry); }\n  async updateFoodEntry(id: string, updates: Partial<FoodEntry>): Promise<FoodEntry | undefined> { return this.memStorage.updateFoodEntry(id, updates); }\n  async deleteFoodEntry(id: string): Promise<boolean> { return this.memStorage.deleteFoodEntry(id); }\n  async getMileTrackerSessions(userId: string): Promise<MileTrackerSessionWithSplits[]> { return this.memStorage.getMileTrackerSessions(userId); }\n  async getMileTrackerSession(id: string): Promise<MileTrackerSessionWithSplits | undefined> { return this.memStorage.getMileTrackerSession(id); }\n  async getActiveMileTrackerSession(userId: string): Promise<MileTrackerSessionWithSplits | undefined> { return this.memStorage.getActiveMileTrackerSession(userId); }\n  async createMileTrackerSession(session: InsertMileTrackerSession): Promise<MileTrackerSession> { return this.memStorage.createMileTrackerSession(session); }\n  async updateMileTrackerSession(id: string, updates: Partial<MileTrackerSession>): Promise<MileTrackerSession | undefined> { return this.memStorage.updateMileTrackerSession(id, updates); }\n  async createMileTrackerSplit(split: InsertMileTrackerSplit): Promise<MileTrackerSplit> { return this.memStorage.createMileTrackerSplit(split); }\n  async getMileTrackerSplits(sessionId: string): Promise<MileTrackerSplit[]> { return this.memStorage.getMileTrackerSplits(sessionId); }\n  async getCommunityPosts(limit: number = 50): Promise<CommunityPostWithUser[]> {\n    try {\n      const posts = await db\n        .select({\n          id: communityPosts.id,\n          userId: communityPosts.userId,\n          content: communityPosts.content,\n          postType: communityPosts.postType,\n          workoutId: communityPosts.workoutId,\n          imageUrl: communityPosts.imageUrl,\n          likes: communityPosts.likes,\n          createdAt: communityPosts.createdAt,\n          dislikes: communityPosts.dislikes,\n          // User data\n          userFirstName: users.firstName,\n          userLastName: users.lastName,\n          userEmail: users.email,\n          userStreak: users.streak,\n          userProfileImageUrl: users.profileImageUrl,\n        })\n        .from(communityPosts)\n        .innerJoin(users, eq(communityPosts.userId, users.id))\n        .orderBy(desc(communityPosts.createdAt))\n        .limit(limit);\n\n      const postsWithUsers: CommunityPostWithUser[] = [];\n      \n      for (const row of posts) {\n        const postWithUser: CommunityPostWithUser = {\n          id: row.id,\n          userId: row.userId,\n          content: row.content,\n          postType: row.postType,\n          workoutId: row.workoutId,\n          imageUrl: row.imageUrl,\n          likes: row.likes,\n          createdAt: row.createdAt,\n          user: {\n            id: row.userId,\n            firstName: row.userFirstName || \"\",\n            lastName: row.userLastName || \"\",\n            email: row.userEmail || \"\",\n            streak: row.userStreak,\n            profileImageUrl: row.userProfileImageUrl || null,\n          },\n          dislikes: row.dislikes,\n        };\n\n        // Add workout info if it's a workout progress post\n        if (row.workoutId) {\n          const [workout] = await db\n            .select()\n            .from(workouts)\n            .where(eq(workouts.id, row.workoutId));\n          \n          if (workout) {\n            postWithUser.workout = {\n              id: workout.id,\n              name: workout.name,\n              category: workout.category,\n              duration: workout.duration,\n              caloriesBurned: workout.caloriesBurned,\n            };\n          }\n        }\n\n        postsWithUsers.push(postWithUser);\n      }\n\n      console.log(`Returning ${postsWithUsers.length} posts from database`);\n      return postsWithUsers;\n    } catch (error) {\n      console.error(\"Error getting community posts from database:\", error);\n      throw error;\n    }\n  }\n  async createCommunityPost(post: InsertCommunityPost): Promise<CommunityPost> {\n    try {\n      const [newPost] = await db\n        .insert(communityPosts)\n        .values(post)\n        .returning();\n      \n      console.log(`Created community post with ID: ${newPost.id}`);\n      return newPost;\n    } catch (error) {\n      console.error(\"Error creating community post in database:\", error);\n      throw error;\n    }\n  }\n  async likeCommunityPost(postId: string): Promise<CommunityPost | undefined> {\n    try {\n      const [updatedPost] = await db\n        .update(communityPosts)\n        .set({ \n          likes: sql`${communityPosts.likes} + 1`\n        })\n        .where(eq(communityPosts.id, postId))\n        .returning();\n      \n      console.log(`Liked community post with ID: ${postId}, new likes: ${updatedPost?.likes}`);\n      return updatedPost;\n    } catch (error) {\n      console.error(\"Error liking community post in database:\", error);\n      throw error;\n    }\n  }\n\n  async dislikeCommunityPost(postId: string): Promise<CommunityPost | undefined> {\n    try {\n      const [updatedPost] = await db\n        .update(communityPosts)\n        .set({ \n          dislikes: sql`${communityPosts.dislikes} + 1`\n        })\n        .where(eq(communityPosts.id, postId))\n        .returning();\n      \n      console.log(`Disliked community post with ID: ${postId}, new dislikes: ${updatedPost?.dislikes}`);\n      return updatedPost;\n    } catch (error) {\n      console.error(\"Error disliking community post in database:\", error);\n      throw error;\n    }\n  }\n\n  async deleteCommunityPost(postId: string, userId: string): Promise<boolean> {\n    try {\n      const result = await db\n        .delete(communityPosts)\n        .where(and(eq(communityPosts.id, postId), eq(communityPosts.userId, userId)))\n        .returning();\n      \n      const deleted = result.length > 0;\n      if (deleted) {\n        console.log(`Deleted community post with ID: ${postId}`);\n      } else {\n        console.log(`Failed to delete community post with ID: ${postId} (not found or unauthorized)`);\n      }\n      \n      return deleted;\n    } catch (error) {\n      console.error(\"Error deleting community post in database:\", error);\n      throw error;\n    }\n  }\n\n  // Progress Photos\n  async getProgressPhotos(userId: string, limit: number = 50): Promise<ProgressPhotoWithWorkout[]> {\n    try {\n      const photos = await db\n        .select()\n        .from(progressPhotos)\n        .where(eq(progressPhotos.userId, userId))\n        .orderBy(desc(progressPhotos.createdAt))\n        .limit(limit);\n\n      const photosWithWorkouts: ProgressPhotoWithWorkout[] = [];\n      \n      for (const photo of photos) {\n        let workout = undefined;\n        if (photo.workoutId) {\n          const [workoutData] = await db\n            .select()\n            .from(workouts)\n            .where(eq(workouts.id, photo.workoutId));\n          \n          if (workoutData) {\n            workout = {\n              id: workoutData.id,\n              name: workoutData.name,\n              category: workoutData.category,\n              date: workoutData.date,\n            };\n          }\n        }\n\n        photosWithWorkouts.push({\n          ...photo,\n          workout,\n        });\n      }\n\n      console.log(`Returning ${photosWithWorkouts.length} progress photos from database`);\n      return photosWithWorkouts;\n    } catch (error) {\n      console.error(\"Error getting progress photos from database:\", error);\n      throw error;\n    }\n  }\n\n  async createProgressPhoto(photo: InsertProgressPhoto): Promise<ProgressPhoto> {\n    try {\n      const [newPhoto] = await db\n        .insert(progressPhotos)\n        .values(photo)\n        .returning();\n      \n      console.log(`Created progress photo with ID: ${newPhoto.id}`);\n      return newPhoto;\n    } catch (error) {\n      console.error(\"Error creating progress photo in database:\", error);\n      throw error;\n    }\n  }\n\n  async getProgressPhoto(id: string): Promise<ProgressPhoto | undefined> {\n    try {\n      const [photo] = await db\n        .select()\n        .from(progressPhotos)\n        .where(eq(progressPhotos.id, id));\n      \n      return photo;\n    } catch (error) {\n      console.error(\"Error getting progress photo from database:\", error);\n      throw error;\n    }\n  }\n\n  async updateProgressPhoto(id: string, updates: Partial<ProgressPhoto>): Promise<ProgressPhoto | undefined> {\n    try {\n      const [updatedPhoto] = await db\n        .update(progressPhotos)\n        .set(updates)\n        .where(eq(progressPhotos.id, id))\n        .returning();\n      \n      if (updatedPhoto) {\n        console.log(`Updated progress photo with ID: ${id}`);\n      }\n      return updatedPhoto;\n    } catch (error) {\n      console.error(\"Error updating progress photo in database:\", error);\n      throw error;\n    }\n  }\n\n  async deleteProgressPhoto(id: string, userId: string): Promise<boolean> {\n    try {\n      const result = await db\n        .delete(progressPhotos)\n        .where(and(eq(progressPhotos.id, id), eq(progressPhotos.userId, userId)))\n        .returning();\n      \n      const deleted = result.length > 0;\n      if (deleted) {\n        console.log(`Deleted progress photo with ID: ${id}`);\n      } else {\n        console.log(`Failed to delete progress photo with ID: ${id} (not found or unauthorized)`);\n      }\n      \n      return deleted;\n    } catch (error) {\n      console.error(\"Error deleting progress photo in database:\", error);\n      throw error;\n    }\n  }\n\n  async getProgressPhotosByDateRange(userId: string, startDate: Date, endDate: Date): Promise<ProgressPhotoWithWorkout[]> {\n    try {\n      const photos = await db\n        .select()\n        .from(progressPhotos)\n        .where(\n          and(\n            eq(progressPhotos.userId, userId),\n            sql`${progressPhotos.createdAt} >= ${startDate}`,\n            sql`${progressPhotos.createdAt} <= ${endDate}`\n          )\n        )\n        .orderBy(progressPhotos.createdAt);\n\n      const photosWithWorkouts: ProgressPhotoWithWorkout[] = [];\n      \n      for (const photo of photos) {\n        let workout = undefined;\n        if (photo.workoutId) {\n          const [workoutData] = await db\n            .select()\n            .from(workouts)\n            .where(eq(workouts.id, photo.workoutId));\n          \n          if (workoutData) {\n            workout = {\n              id: workoutData.id,\n              name: workoutData.name,\n              category: workoutData.category,\n              date: workoutData.date,\n            };\n          }\n        }\n\n        photosWithWorkouts.push({\n          ...photo,\n          workout,\n        });\n      }\n\n      return photosWithWorkouts;\n    } catch (error) {\n      console.error(\"Error getting progress photos by date range from database:\", error);\n      throw error;\n    }\n  }\n\n  // Subscription Audit\n  async createSubscriptionAudit(audit: InsertSubscriptionAudit): Promise<SubscriptionAudit> {\n    try {\n      const [newAudit] = await db\n        .insert(subscriptionAudit)\n        .values(audit)\n        .returning();\n      \n      console.log(`Created subscription audit with ID: ${newAudit.id}`);\n      return newAudit;\n    } catch (error) {\n      console.error(\"Error creating subscription audit in database:\", error);\n      throw error;\n    }\n  }\n\n  // Notification Preferences\n  async getNotificationPreferences(userId: string): Promise<NotificationPreferences | undefined> {\n    try {\n      const [preferences] = await db\n        .select()\n        .from(notificationPreferences)\n        .where(eq(notificationPreferences.userId, userId));\n      \n      return preferences;\n    } catch (error) {\n      console.error(\"Error getting notification preferences from database:\", error);\n      throw error;\n    }\n  }\n\n  async createNotificationPreferences(preferences: InsertNotificationPreferences): Promise<NotificationPreferences> {\n    try {\n      const [newPreferences] = await db\n        .insert(notificationPreferences)\n        .values(preferences)\n        .returning();\n      \n      console.log(`Created notification preferences with ID: ${newPreferences.id}`);\n      return newPreferences;\n    } catch (error) {\n      console.error(\"Error creating notification preferences in database:\", error);\n      throw error;\n    }\n  }\n\n  async updateNotificationPreferences(userId: string, updates: Partial<NotificationPreferences>): Promise<NotificationPreferences | undefined> {\n    try {\n      const [updated] = await db\n        .update(notificationPreferences)\n        .set({ ...updates, updatedAt: new Date() })\n        .where(eq(notificationPreferences.userId, userId))\n        .returning();\n      \n      console.log(`Updated notification preferences for user: ${userId}`);\n      return updated;\n    } catch (error) {\n      console.error(\"Error updating notification preferences in database:\", error);\n      throw error;\n    }\n  }\n\n  async checkWorkoutReminderNeeded(userId: string): Promise<boolean> {\n    try {\n      // Get user's last workout\n      const [user] = await db\n        .select()\n        .from(users)\n        .where(eq(users.id, userId));\n      \n      if (!user || !user.lastWorkoutDate) {\n        return true; // No workout logged yet, reminder needed\n      }\n\n      // Get notification preferences\n      const prefs = await this.getNotificationPreferences(userId);\n      if (!prefs || !prefs.workoutRemindersEnabled) {\n        return false; // Reminders disabled\n      }\n\n      // Check if 24 hours have passed since last workout\n      const now = new Date();\n      const lastWorkout = new Date(user.lastWorkoutDate);\n      const hoursSinceLastWorkout = (now.getTime() - lastWorkout.getTime()) / (1000 * 60 * 60);\n\n      // Check if we've already sent a reminder recently (within last 6 hours)\n      if (prefs.lastWorkoutReminderSent) {\n        const lastReminder = new Date(prefs.lastWorkoutReminderSent);\n        const hoursSinceLastReminder = (now.getTime() - lastReminder.getTime()) / (1000 * 60 * 60);\n        if (hoursSinceLastReminder < 6) {\n          return false; // Already sent reminder recently\n        }\n      }\n\n      return hoursSinceLastWorkout >= 24;\n    } catch (error) {\n      console.error(\"Error checking workout reminder needed:\", error);\n      return false;\n    }\n  }\n\n  async getMealPlans(goal?: string): Promise<MealPlanWithDetails[]> { return this.memStorage.getMealPlans(goal); }\n  async getMealPlan(id: string): Promise<MealPlanWithDetails | undefined> { return this.memStorage.getMealPlan(id); }\n  async createMealPlan(mealPlan: InsertMealPlan): Promise<MealPlan> { return this.memStorage.createMealPlan(mealPlan); }\n  async getUserMealPlan(userId: string): Promise<UserMealPlanWithDetails | undefined> { return this.memStorage.getUserMealPlan(userId); }\n  async assignMealPlan(userMealPlan: InsertUserMealPlan): Promise<UserMealPlan> { return this.memStorage.assignMealPlan(userMealPlan); }\n  async getTotalCommissions(): Promise<{ totalCommissions: number; totalBookings: number }> { return this.memStorage.getTotalCommissions(); }\n  async markBookingAsPaid(bookingId: string, totalPrice: number): Promise<Booking | undefined> { return this.memStorage.markBookingAsPaid(bookingId, totalPrice); }\n  async getCalendarNotes(userId: string, date?: Date): Promise<CalendarNote[]> { return this.memStorage.getCalendarNotes(userId, date); }\n  async getCalendarNote(id: string): Promise<CalendarNote | undefined> { return this.memStorage.getCalendarNote(id); }\n  async createCalendarNote(note: InsertCalendarNote): Promise<CalendarNote> { return this.memStorage.createCalendarNote(note); }\n  async updateCalendarNote(id: string, updates: Partial<CalendarNote>): Promise<CalendarNote | undefined> { return this.memStorage.updateCalendarNote(id, updates); }\n  async deleteCalendarNote(id: string): Promise<boolean> { return this.memStorage.deleteCalendarNote(id); }\n  async getUserMealPreferences(userId: string): Promise<UserMealPreferences | undefined> { return this.memStorage.getUserMealPreferences(userId); }\n  async createUserMealPreferences(preferences: InsertUserMealPreferences): Promise<UserMealPreferences> { return this.memStorage.createUserMealPreferences(preferences); }\n  async updateUserMealPreferences(userId: string, updates: Partial<UserMealPreferences>): Promise<UserMealPreferences | undefined> { return this.memStorage.updateUserMealPreferences(userId, updates); }\n  async getUsersForWeeklyMealPlanGeneration(): Promise<{ userId: string; preferences: UserMealPreferences }[]> { return this.memStorage.getUsersForWeeklyMealPlanGeneration(); }\n  async createAIMealPlan(mealPlan: InsertMealPlan, days: { dayNumber: number; name: string; meals: any[] }[]): Promise<MealPlan> { return this.memStorage.createAIMealPlan(mealPlan, days); }\n  async getFoodItems(category?: string): Promise<FoodItem[]> { return this.memStorage.getFoodItems(category); }\n  async createFoodItem(foodItem: InsertFoodItem): Promise<FoodItem> { return this.memStorage.createFoodItem(foodItem); }\n  async getFoodItemsWithUserPreferences(userId: string, category?: string): Promise<FoodItemWithPreference[]> { return this.memStorage.getFoodItemsWithUserPreferences(userId, category); }\n  async getUserFoodPreferences(userId: string): Promise<UserFoodPreference[]> { return this.memStorage.getUserFoodPreferences(userId); }\n  async setUserFoodPreference(preference: InsertUserFoodPreference): Promise<UserFoodPreference> { return this.memStorage.setUserFoodPreference(preference); }\n  async updateUserFoodPreference(userId: string, foodItemId: string, preference: string): Promise<UserFoodPreference | undefined> { return this.memStorage.updateUserFoodPreference(userId, foodItemId, preference); }\n  async deleteUserFoodPreference(userId: string, foodItemId: string): Promise<boolean> { return this.memStorage.deleteUserFoodPreference(userId, foodItemId); }\n  async getRecentWorkoutsForExercise(userId: string, exerciseId: string, limit: number): Promise<(Workout & { exercises: WorkoutExercise[] })[]> { return this.memStorage.getRecentWorkoutsForExercise(userId, exerciseId, limit); }\n  async createAiDifficultyAdjustment(adjustment: InsertAiDifficultyAdjustment): Promise<AiDifficultyAdjustment> { return this.memStorage.createAiDifficultyAdjustment(adjustment); }\n  async getPendingAiAdjustments(userId: string): Promise<AiDifficultyAdjustment[]> { return this.memStorage.getPendingAiAdjustments(userId); }\n  async applyAiDifficultyAdjustment(adjustmentId: string): Promise<boolean> { return this.memStorage.applyAiDifficultyAdjustment(adjustmentId); }\n  async seedLeaderboardData(): Promise<void> { \n    console.log(\"🔥 DatabaseStorage.seedLeaderboardData() called - delegating to MemStorage\");\n    return this.memStorage.seedLeaderboardData(); \n  }\n  \n  // Payment and Stripe methods\n  async createPayment(insertPayment: InsertPayment): Promise<Payment> { return this.memStorage.createPayment(insertPayment); }\n  async updatePayment(id: string, updates: Partial<Payment>): Promise<Payment | undefined> { return this.memStorage.updatePayment(id, updates); }\n  async getPayment(id: string): Promise<Payment | undefined> { return this.memStorage.getPayment(id); }\n  async getPaymentByStripeId(stripePaymentIntentId: string): Promise<Payment | undefined> { return this.memStorage.getPaymentByStripeId(stripePaymentIntentId); }\n  async getUserPayments(userId: string): Promise<Payment[]> { return this.memStorage.getUserPayments(userId); }\n  async updateStripeCustomerId(userId: string, stripeCustomerId: string): Promise<User | undefined> { \n    return this.updateUser(userId, { stripeCustomerId }); \n  }\n  async updateUserStripeInfo(userId: string, stripeCustomerId: string, stripeSubscriptionId: string): Promise<User | undefined> { \n    return this.updateUser(userId, { stripeCustomerId, stripeSubscriptionId }); \n  }\n  \n  // News and announcements\n  async getNews(limit?: number): Promise<News[]> { return this.memStorage.getNews(limit); }\n  async getNewsItem(id: string): Promise<News | undefined> { return this.memStorage.getNewsItem(id); }\n  async createNews(newsItem: InsertNews): Promise<News> { return this.memStorage.createNews(newsItem); }\n}\n\nexport const storage = new DatabaseStorage();\n","size_bytes":166405},"client/src/components/ui/dialog.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as DialogPrimitive from \"@radix-ui/react-dialog\"\nimport { X } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Dialog = DialogPrimitive.Root\n\nconst DialogTrigger = DialogPrimitive.Trigger\n\nconst DialogPortal = DialogPrimitive.Portal\n\nconst DialogClose = DialogPrimitive.Close\n\nconst DialogOverlay = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <DialogPrimitive.Overlay\n    ref={ref}\n    className={cn(\n      \"fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0\",\n      className\n    )}\n    {...props}\n  />\n))\nDialogOverlay.displayName = DialogPrimitive.Overlay.displayName\n\nconst DialogContent = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Content>\n>(({ className, children, ...props }, ref) => (\n  <DialogPortal>\n    <DialogOverlay />\n    <DialogPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg\",\n        className\n      )}\n      {...props}\n    >\n      {children}\n      <DialogPrimitive.Close className=\"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground\">\n        <X className=\"h-4 w-4\" />\n        <span className=\"sr-only\">Close</span>\n      </DialogPrimitive.Close>\n    </DialogPrimitive.Content>\n  </DialogPortal>\n))\nDialogContent.displayName = DialogPrimitive.Content.displayName\n\nconst DialogHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col space-y-1.5 text-center sm:text-left\",\n      className\n    )}\n    {...props}\n  />\n)\nDialogHeader.displayName = \"DialogHeader\"\n\nconst DialogFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2\",\n      className\n    )}\n    {...props}\n  />\n)\nDialogFooter.displayName = \"DialogFooter\"\n\nconst DialogTitle = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <DialogPrimitive.Title\n    ref={ref}\n    className={cn(\n      \"text-lg font-semibold leading-none tracking-tight\",\n      className\n    )}\n    {...props}\n  />\n))\nDialogTitle.displayName = DialogPrimitive.Title.displayName\n\nconst DialogDescription = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <DialogPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nDialogDescription.displayName = DialogPrimitive.Description.displayName\n\nexport {\n  Dialog,\n  DialogPortal,\n  DialogOverlay,\n  DialogClose,\n  DialogTrigger,\n  DialogContent,\n  DialogHeader,\n  DialogFooter,\n  DialogTitle,\n  DialogDescription,\n}\n","size_bytes":3848},"client/src/hooks/useTheme.tsx":{"content":"import { createContext, useContext, useEffect, ReactNode } from 'react';\n\ntype Theme = 'dark';\n\ninterface ThemeContextType {\n  theme: Theme;\n}\n\nconst ThemeContext = createContext<ThemeContextType | undefined>(undefined);\n\nexport function ThemeProvider({ children }: { children: ReactNode }) {\n  useEffect(() => {\n    // Always apply dark theme\n    document.documentElement.classList.add('dark');\n  }, []);\n\n  return (\n    <ThemeContext.Provider value={{ theme: 'dark' }}>\n      {children}\n    </ThemeContext.Provider>\n  );\n}\n\nexport function useTheme() {\n  const context = useContext(ThemeContext);\n  if (context === undefined) {\n    throw new Error('useTheme must be used within a ThemeProvider');\n  }\n  return context;\n}","size_bytes":722},"client/src/pages/workouts.tsx":{"content":"import { Activity, Plus } from \"lucide-react\";\nimport { Button } from \"@/components/ui/button\";\nimport WorkoutLogger from \"@/components/workout-logger\";\nimport RecentWorkouts from \"@/components/recent-workouts\";\nimport WorkoutRecommendations from \"@/components/workout-recommendations\";\nimport QuickStats from \"@/components/quick-stats\";\n\nexport default function WorkoutsPage() {\n  return (\n    <div className=\"font-inter bg-black text-gray-200 min-h-screen\">      \n      <main className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6\">\n        {/* Page Header */}\n        <div className=\"flex items-center justify-between mb-8\">\n          <div className=\"flex items-center gap-3\">\n            <div className=\"p-3 bg-gradient-to-br from-red-600 to-red-700 rounded-xl shadow-lg shadow-red-500/50\">\n              <Activity className=\"w-8 h-8 text-white\" />\n            </div>\n            <div>\n              <h1 className=\"text-3xl font-bold bg-gradient-to-r from-red-500 to-red-700 bg-clip-text text-transparent\" data-testid=\"workouts-title\">\n                Workouts\n              </h1>\n              <p className=\"text-gray-400\">\n                Track your fitness journey and log your workouts\n              </p>\n            </div>\n          </div>\n          <Button \n            onClick={() => {\n              const workoutLogger = document.getElementById('workout-logger');\n              if (workoutLogger) {\n                workoutLogger.scrollIntoView({ \n                  behavior: 'smooth',\n                  block: 'start' \n                });\n              }\n            }}\n            className=\"flex items-center gap-2 bg-gradient-to-r from-red-600 to-red-700 hover:from-red-700 hover:to-red-800 text-white shadow-lg shadow-red-500/50 border-0\"\n            data-testid=\"start-workout-button\"\n          >\n            <Plus className=\"w-4 h-4\" />\n            Start Workout\n          </Button>\n        </div>\n\n        {/* Quick Stats */}\n        <div className=\"mb-8\">\n          <QuickStats />\n        </div>\n\n        {/* Main Content Grid */}\n        <div className=\"grid lg:grid-cols-3 gap-8\">\n          {/* Workout Logger & Recent Workouts */}\n          <div className=\"lg:col-span-2 space-y-8\">\n            <WorkoutLogger />\n            <RecentWorkouts />\n          </div>\n          \n          {/* Sidebar */}\n          <div className=\"space-y-8\">\n            <WorkoutRecommendations />\n          </div>\n        </div>\n      </main>\n    </div>\n  );\n}","size_bytes":2461},"client/src/components/ui/breadcrumb.tsx":{"content":"import * as React from \"react\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport { ChevronRight, MoreHorizontal } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Breadcrumb = React.forwardRef<\n  HTMLElement,\n  React.ComponentPropsWithoutRef<\"nav\"> & {\n    separator?: React.ReactNode\n  }\n>(({ ...props }, ref) => <nav ref={ref} aria-label=\"breadcrumb\" {...props} />)\nBreadcrumb.displayName = \"Breadcrumb\"\n\nconst BreadcrumbList = React.forwardRef<\n  HTMLOListElement,\n  React.ComponentPropsWithoutRef<\"ol\">\n>(({ className, ...props }, ref) => (\n  <ol\n    ref={ref}\n    className={cn(\n      \"flex flex-wrap items-center gap-1.5 break-words text-sm text-muted-foreground sm:gap-2.5\",\n      className\n    )}\n    {...props}\n  />\n))\nBreadcrumbList.displayName = \"BreadcrumbList\"\n\nconst BreadcrumbItem = React.forwardRef<\n  HTMLLIElement,\n  React.ComponentPropsWithoutRef<\"li\">\n>(({ className, ...props }, ref) => (\n  <li\n    ref={ref}\n    className={cn(\"inline-flex items-center gap-1.5\", className)}\n    {...props}\n  />\n))\nBreadcrumbItem.displayName = \"BreadcrumbItem\"\n\nconst BreadcrumbLink = React.forwardRef<\n  HTMLAnchorElement,\n  React.ComponentPropsWithoutRef<\"a\"> & {\n    asChild?: boolean\n  }\n>(({ asChild, className, ...props }, ref) => {\n  const Comp = asChild ? Slot : \"a\"\n\n  return (\n    <Comp\n      ref={ref}\n      className={cn(\"transition-colors hover:text-foreground\", className)}\n      {...props}\n    />\n  )\n})\nBreadcrumbLink.displayName = \"BreadcrumbLink\"\n\nconst BreadcrumbPage = React.forwardRef<\n  HTMLSpanElement,\n  React.ComponentPropsWithoutRef<\"span\">\n>(({ className, ...props }, ref) => (\n  <span\n    ref={ref}\n    role=\"link\"\n    aria-disabled=\"true\"\n    aria-current=\"page\"\n    className={cn(\"font-normal text-foreground\", className)}\n    {...props}\n  />\n))\nBreadcrumbPage.displayName = \"BreadcrumbPage\"\n\nconst BreadcrumbSeparator = ({\n  children,\n  className,\n  ...props\n}: React.ComponentProps<\"li\">) => (\n  <li\n    role=\"presentation\"\n    aria-hidden=\"true\"\n    className={cn(\"[&>svg]:w-3.5 [&>svg]:h-3.5\", className)}\n    {...props}\n  >\n    {children ?? <ChevronRight />}\n  </li>\n)\nBreadcrumbSeparator.displayName = \"BreadcrumbSeparator\"\n\nconst BreadcrumbEllipsis = ({\n  className,\n  ...props\n}: React.ComponentProps<\"span\">) => (\n  <span\n    role=\"presentation\"\n    aria-hidden=\"true\"\n    className={cn(\"flex h-9 w-9 items-center justify-center\", className)}\n    {...props}\n  >\n    <MoreHorizontal className=\"h-4 w-4\" />\n    <span className=\"sr-only\">More</span>\n  </span>\n)\nBreadcrumbEllipsis.displayName = \"BreadcrumbElipssis\"\n\nexport {\n  Breadcrumb,\n  BreadcrumbList,\n  BreadcrumbItem,\n  BreadcrumbLink,\n  BreadcrumbPage,\n  BreadcrumbSeparator,\n  BreadcrumbEllipsis,\n}\n","size_bytes":2712},"client/src/components/ui/toggle.tsx":{"content":"import * as React from \"react\"\nimport * as TogglePrimitive from \"@radix-ui/react-toggle\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst toggleVariants = cva(\n  \"inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-background transition-colors hover:bg-muted hover:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=on]:bg-accent data-[state=on]:text-accent-foreground [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0 gap-2\",\n  {\n    variants: {\n      variant: {\n        default: \"bg-transparent\",\n        outline:\n          \"border border-input bg-transparent hover:bg-accent hover:text-accent-foreground\",\n      },\n      size: {\n        default: \"h-10 px-3 min-w-10\",\n        sm: \"h-9 px-2.5 min-w-9\",\n        lg: \"h-11 px-5 min-w-11\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  }\n)\n\nconst Toggle = React.forwardRef<\n  React.ElementRef<typeof TogglePrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof TogglePrimitive.Root> &\n    VariantProps<typeof toggleVariants>\n>(({ className, variant, size, ...props }, ref) => (\n  <TogglePrimitive.Root\n    ref={ref}\n    className={cn(toggleVariants({ variant, size, className }))}\n    {...props}\n  />\n))\n\nToggle.displayName = TogglePrimitive.Root.displayName\n\nexport { Toggle, toggleVariants }\n","size_bytes":1527},"client/src/pages/community.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery, useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport { MessageSquare, Heart, Trophy, Dumbbell, Send, Target, Clock, Sparkles, Zap, Users, TrendingUp, Image, Upload, ThumbsDown, Trash2 } from \"lucide-react\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Avatar, AvatarFallback, AvatarImage } from \"@/components/ui/avatar\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport { ObjectUploader } from \"@/components/ObjectUploader\";\nimport { useNewAuth } from \"@/hooks/useNewAuth\";\nimport type { CommunityPostWithUser } from \"@shared/schema\";\nimport type { UploadResult } from \"@uppy/core\";\n\nexport default function Community() {\n  const [newPostContent, setNewPostContent] = useState(\"\");\n  const [selectedPostType, setSelectedPostType] = useState<\"message\" | \"workout_progress\" | \"goal_achievement\">(\"message\");\n  const [uploadedImageUrl, setUploadedImageUrl] = useState<string | null>(null);\n  const [imagePreview, setImagePreview] = useState<string | null>(null);\n  \n  const { toast } = useToast();\n  const queryClient = useQueryClient();\n  const { user: currentUser } = useNewAuth();\n\n  const { data: posts = [], isLoading } = useQuery<CommunityPostWithUser[]>({\n    queryKey: [\"/api/community/posts\"],\n  });\n\n  const createPostMutation = useMutation({\n    mutationFn: async (postData: { content: string; postType: string; workoutId?: string; imageUrl?: string }) => {\n      const response = await apiRequest(\"POST\", \"/api/community/posts\", postData);\n      return response.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/community/posts\"] });\n      setNewPostContent(\"\");\n      setSelectedPostType(\"message\");\n      setUploadedImageUrl(null);\n      setImagePreview(null);\n      toast({ title: \"Post shared!\", description: \"Your post has been shared with the community.\" });\n    },\n    onError: () => {\n      toast({ title: \"Error\", description: \"Failed to share post\", variant: \"destructive\" });\n    }\n  });\n\n  const likeMutation = useMutation({\n    mutationFn: async (postId: string) => {\n      const response = await apiRequest(\"POST\", `/api/community/posts/${postId}/like`);\n      return response.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/community/posts\"] });\n    }\n  });\n\n  const dislikeMutation = useMutation({\n    mutationFn: async (postId: string) => {\n      const response = await apiRequest(\"POST\", `/api/community/posts/${postId}/dislike`);\n      return response.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/community/posts\"] });\n    },\n    onError: () => {\n      toast({ title: \"Error\", description: \"Failed to dislike post\", variant: \"destructive\" });\n    }\n  });\n\n  const deletePostMutation = useMutation({\n    mutationFn: async (postId: string) => {\n      const response = await apiRequest(\"DELETE\", `/api/community/posts/${postId}`);\n      return response.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/community/posts\"] });\n      toast({ title: \"Post deleted\", description: \"Your post has been deleted successfully.\" });\n    },\n    onError: (error: any) => {\n      toast({ \n        title: \"Error\", \n        description: error.message || \"Failed to delete post\", \n        variant: \"destructive\" \n      });\n    }\n  });\n\n  const handleSubmitPost = () => {\n    if (!newPostContent.trim()) return;\n    \n    createPostMutation.mutate({\n      content: newPostContent.trim(),\n      postType: selectedPostType,\n      imageUrl: uploadedImageUrl || undefined,\n    });\n  };\n\n  const handleGetUploadParameters = async () => {\n    const response = await apiRequest(\"POST\", \"/api/objects/upload\");\n    const data = await response.json();\n    return {\n      method: \"PUT\" as const,\n      url: data.uploadURL,\n    };\n  };\n\n  const handleUploadComplete = async (result: UploadResult<Record<string, unknown>, Record<string, unknown>>) => {\n    if (result.successful && result.successful.length > 0) {\n      const uploadedFile = result.successful[0];\n      const uploadURL = uploadedFile.uploadURL;\n      \n      // Set ACL policy for the uploaded image\n      try {\n        const response = await apiRequest(\"PUT\", \"/api/community/post-images\", {\n          imageURL: uploadURL\n        });\n        const data = await response.json();\n        \n        setUploadedImageUrl(data.objectPath || null);\n        setImagePreview(uploadURL || null);\n        toast({ \n          title: \"Image uploaded!\", \n          description: \"Your image is ready to share with your post.\" \n        });\n      } catch (error) {\n        console.error(\"Error setting image ACL:\", error);\n        toast({ \n          title: \"Upload error\", \n          description: \"Image uploaded but failed to process. Try again.\", \n          variant: \"destructive\" \n        });\n      }\n    }\n  };\n\n  const handleRemoveImage = () => {\n    setUploadedImageUrl(null);\n    setImagePreview(null);\n  };\n\n  const handleLike = (postId: string) => {\n    likeMutation.mutate(postId);\n  };\n\n  const handleDislike = (postId: string) => {\n    dislikeMutation.mutate(postId);\n  };\n\n  const handleDeletePost = (postId: string) => {\n    if (confirm(\"Are you sure you want to delete this post? This action cannot be undone.\")) {\n      deletePostMutation.mutate(postId);\n    }\n  };\n\n  const formatTimeAgo = (date: string) => {\n    const now = new Date();\n    const postDate = new Date(date);\n    const diffMs = now.getTime() - postDate.getTime();\n    const diffMins = Math.floor(diffMs / (1000 * 60));\n    const diffHours = Math.floor(diffMins / 60);\n    const diffDays = Math.floor(diffHours / 24);\n    \n    if (diffMins < 1) return \"Just now\";\n    if (diffMins < 60) return `${diffMins}m ago`;\n    if (diffHours < 24) return `${diffHours}h ago`;\n    return `${diffDays}d ago`;\n  };\n\n  const getPostTypeIcon = (postType: string) => {\n    switch (postType) {\n      case \"workout_progress\":\n        return <Dumbbell className=\"text-primary\" size={16} />;\n      case \"goal_achievement\":\n        return <Target className=\"text-green-600\" size={16} />;\n      default:\n        return <MessageSquare className=\"text-gray-600\" size={16} />;\n    }\n  };\n\n  const getPostTypeBadge = (postType: string) => {\n    switch (postType) {\n      case \"workout_progress\":\n        return <Badge className=\"bg-gradient-to-r from-red-500/20 to-orange-500/20 text-red-700 border-red-300 animate-pulse\">💪 Workout Beast</Badge>;\n      case \"goal_achievement\":\n        return <Badge className=\"bg-gradient-to-r from-green-500/20 to-emerald-500/20 text-green-700 border-green-300 animate-bounce\">🎯 Goal Crusher</Badge>;\n      default:\n        return <Badge className=\"bg-gradient-to-r from-blue-500/20 to-purple-500/20 text-blue-700 border-blue-300\">💭 Community Voice</Badge>;\n    }\n  };\n\n  return (\n    <div className=\"min-h-screen bg-gradient-to-br from-purple-50 via-pink-50 to-red-50 dark:from-gray-900 dark:via-purple-900/20 dark:to-red-900/20 relative overflow-hidden\">\n      {/* Enhanced animated background */}\n      <div className=\"absolute inset-0 overflow-hidden pointer-events-none\">\n        {/* Large animated gradient orbs */}\n        <div className=\"absolute -top-40 -right-40 w-80 h-80 bg-gradient-to-br from-purple-400/30 to-pink-400/30 rounded-full blur-3xl animate-pulse\"></div>\n        <div className=\"absolute -bottom-40 -left-40 w-80 h-80 bg-gradient-to-br from-red-400/30 to-orange-400/30 rounded-full blur-3xl animate-pulse\" style={{animationDelay: '1s'}}></div>\n        <div className=\"absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-96 h-96 bg-gradient-to-br from-blue-400/20 to-purple-400/20 rounded-full blur-3xl animate-pulse\" style={{animationDelay: '2s'}}></div>\n        \n        {/* Floating fitness icons */}\n        <div className=\"absolute top-20 left-[10%] animate-bounce opacity-40\" style={{animationDuration: '3s', animationDelay: '0s'}}>\n          <Dumbbell className=\"w-8 h-8 text-purple-400\" />\n        </div>\n        <div className=\"absolute top-40 right-[15%] animate-bounce opacity-40\" style={{animationDuration: '4s', animationDelay: '1s'}}>\n          <Trophy className=\"w-10 h-10 text-yellow-400\" />\n        </div>\n        <div className=\"absolute top-[60%] left-[5%] animate-bounce opacity-40\" style={{animationDuration: '3.5s', animationDelay: '2s'}}>\n          <Target className=\"w-9 h-9 text-green-400\" />\n        </div>\n        <div className=\"absolute bottom-32 right-[8%] animate-bounce opacity-40\" style={{animationDuration: '4.5s', animationDelay: '0.5s'}}>\n          <Zap className=\"w-8 h-8 text-orange-400\" />\n        </div>\n        <div className=\"absolute top-[35%] right-[25%] animate-bounce opacity-30\" style={{animationDuration: '5s', animationDelay: '1.5s'}}>\n          <Heart className=\"w-7 h-7 text-pink-400\" />\n        </div>\n        <div className=\"absolute bottom-[45%] left-[20%] animate-bounce opacity-30\" style={{animationDuration: '3.8s', animationDelay: '2.5s'}}>\n          <TrendingUp className=\"w-8 h-8 text-red-400\" />\n        </div>\n        \n        {/* Animated gradient lines */}\n        <div className=\"absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-purple-500 via-pink-500 to-red-500 animate-pulse\"></div>\n        <div className=\"absolute bottom-0 left-0 w-full h-1 bg-gradient-to-r from-red-500 via-pink-500 to-purple-500 animate-pulse\" style={{animationDelay: '1s'}}></div>\n        \n        {/* Floating particles */}\n        <div className=\"absolute top-[25%] left-[30%] w-2 h-2 bg-purple-400 rounded-full animate-ping opacity-20\" style={{animationDuration: '3s'}}></div>\n        <div className=\"absolute top-[70%] right-[35%] w-3 h-3 bg-pink-400 rounded-full animate-ping opacity-20\" style={{animationDuration: '4s', animationDelay: '1s'}}></div>\n        <div className=\"absolute bottom-[30%] left-[40%] w-2 h-2 bg-red-400 rounded-full animate-ping opacity-20\" style={{animationDuration: '3.5s', animationDelay: '2s'}}></div>\n        <div className=\"absolute top-[15%] right-[45%] w-2 h-2 bg-yellow-400 rounded-full animate-ping opacity-20\" style={{animationDuration: '5s', animationDelay: '0.5s'}}></div>\n      </div>\n      \n      <div className=\"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-6 md:py-8 relative z-10\">\n        {/* Mobile-native header */}\n        <div className=\"mb-6 md:mb-12\">\n          <div className=\"flex items-center gap-3 mb-4 md:mb-6\">\n            <div className=\"flex items-center justify-center w-12 h-12 md:w-16 md:h-16 bg-gradient-to-br from-purple-500 to-pink-500 rounded-full shrink-0\">\n              <Users className=\"w-6 h-6 md:w-8 md:h-8 text-white\" />\n            </div>\n            <h1 className=\"text-[32px] md:text-5xl font-black bg-gradient-to-r from-purple-600 via-pink-600 to-red-600 bg-clip-text text-transparent tracking-tight leading-none\">\n              Community Hub\n            </h1>\n          </div>\n          <p className=\"text-base md:text-xl text-gray-700 dark:text-gray-300 mb-4 md:mb-6 leading-snug\">\n            Share your victories, inspire others, and get motivated 🚀\n          </p>\n          <div className=\"flex flex-wrap gap-3 md:gap-4\">\n            <div className=\"flex items-center gap-1.5 text-purple-600 bg-purple-50 dark:bg-purple-900/20 px-3 py-2 rounded-full\">\n              <Sparkles className=\"w-4 h-4\" />\n              <span className=\"text-sm font-medium\">Share</span>\n            </div>\n            <div className=\"flex items-center gap-1.5 text-pink-600 bg-pink-50 dark:bg-pink-900/20 px-3 py-2 rounded-full\">\n              <Heart className=\"w-4 h-4\" />\n              <span className=\"text-sm font-medium\">Motivate</span>\n            </div>\n            <div className=\"flex items-center gap-1.5 text-red-600 bg-red-50 dark:bg-red-900/20 px-3 py-2 rounded-full\">\n              <TrendingUp className=\"w-4 h-4\" />\n              <span className=\"text-sm font-medium\">Level Up</span>\n            </div>\n          </div>\n        </div>\n\n        {/* Create Post */}\n        <Card className=\"mb-6 md:mb-12 bg-gradient-to-br from-white to-purple-50/50 dark:from-gray-800 dark:to-purple-900/20 border-purple-200 dark:border-purple-700 shadow-lg md:shadow-xl\">\n          <CardHeader className=\"bg-gradient-to-r from-purple-500/10 via-pink-500/10 to-red-500/10 p-4 md:p-6\">\n            <CardTitle className=\"flex items-center text-lg md:text-2xl\">\n              <div className=\"w-8 h-8 md:w-10 md:h-10 bg-gradient-to-br from-purple-500 to-pink-500 rounded-full flex items-center justify-center mr-2 md:mr-3 shrink-0\">\n                <Sparkles className=\"w-4 h-4 md:w-5 md:h-5 text-white\" />\n              </div>\n              <span className=\"bg-gradient-to-r from-purple-600 to-pink-600 bg-clip-text text-transparent\">\n                Share Your Journey\n              </span>\n            </CardTitle>\n          </CardHeader>\n          <CardContent className=\"space-y-4 md:space-y-6 p-4 md:p-6\">\n            <div>\n              <label className=\"block text-sm md:text-sm font-semibold text-gray-700 dark:text-gray-200 mb-2 flex items-center\">\n                <Target className=\"w-4 h-4 mr-2 text-purple-500\" />\n                Choose Your Vibe\n              </label>\n              <Select value={selectedPostType} onValueChange={(value: \"message\" | \"workout_progress\" | \"goal_achievement\") => setSelectedPostType(value)}>\n                <SelectTrigger className=\"w-full min-h-[44px] bg-gradient-to-r from-purple-50 to-pink-50 border-purple-200 hover:border-purple-300 transition-colors text-base\" data-testid=\"select-post-type\">\n                  <SelectValue />\n                </SelectTrigger>\n                <SelectContent>\n                  <SelectItem value=\"message\" className=\"cursor-pointer hover:bg-purple-50 min-h-[44px] text-base\">\n                    💬 <span className=\"font-medium\">General Thoughts</span>\n                  </SelectItem>\n                  <SelectItem value=\"workout_progress\" className=\"cursor-pointer hover:bg-red-50 min-h-[44px] text-base\">\n                    💪 <span className=\"font-medium\">Workout Beast Mode</span>\n                  </SelectItem>\n                  <SelectItem value=\"goal_achievement\" className=\"cursor-pointer hover:bg-green-50 min-h-[44px] text-base\">\n                    🎯 <span className=\"font-medium\">Goal Crusher</span>\n                  </SelectItem>\n                </SelectContent>\n              </Select>\n            </div>\n\n            <div>\n              <label className=\"block text-sm md:text-sm font-semibold text-gray-700 dark:text-gray-200 mb-2 flex items-center\">\n                <MessageSquare className=\"w-4 h-4 mr-2 text-pink-500\" />\n                Express Yourself\n              </label>\n              <Textarea\n                placeholder={\n                  selectedPostType === \"workout_progress\" \n                    ? \"🔥 Just crushed an amazing workout! Tell us about it...\"\n                    : selectedPostType === \"goal_achievement\"\n                    ? \"🎉 Goal achieved! Share your victory story...\"\n                    : \"💭 What's motivating you today?\"\n                }\n                value={newPostContent}\n                onChange={(e) => setNewPostContent(e.target.value)}\n                rows={4}\n                className=\"w-full bg-gradient-to-br from-gray-900 to-gray-800 dark:from-gray-800 dark:to-gray-700 border-purple-200 focus:border-purple-400 focus:ring-purple-400 transition-all duration-200 text-base text-white min-h-[100px]\"\n                data-testid=\"textarea-post-content\"\n              />\n            </div>\n\n            {/* Image Upload Section */}\n            <div>\n              <label className=\"block text-sm font-semibold text-gray-700 dark:text-gray-200 mb-2 flex items-center\">\n                <Image className=\"w-4 h-4 mr-2 text-orange-500\" />\n                Add a Picture (Optional)\n              </label>\n              \n              {/* Image Preview */}\n              {imagePreview && (\n                <div className=\"mb-3 relative\">\n                  <img \n                    src={imagePreview}\n                    alt=\"Preview\"\n                    className=\"w-full max-w-sm h-32 object-cover rounded-lg border-2 border-purple-200 shadow-lg\"\n                  />\n                  <Button\n                    onClick={handleRemoveImage}\n                    variant=\"destructive\"\n                    size=\"sm\"\n                    className=\"absolute top-2 right-2 rounded-full\"\n                  >\n                    ×\n                  </Button>\n                </div>\n              )}\n              \n              {/* Upload Button */}\n              {!imagePreview && (\n                <ObjectUploader\n                  maxNumberOfFiles={1}\n                  maxFileSize={5242880} // 5MB\n                  onGetUploadParameters={handleGetUploadParameters}\n                  onComplete={handleUploadComplete}\n                  buttonClassName=\"w-full bg-gradient-to-r from-orange-400 to-yellow-400 hover:from-orange-500 hover:to-yellow-500 text-white font-semibold py-3 px-6 rounded-lg shadow-lg hover:shadow-xl transition-all duration-200\"\n                >\n                  <div className=\"flex items-center justify-center space-x-2\">\n                    <Upload className=\"w-5 h-5\" />\n                    <span>Upload Photo</span>\n                  </div>\n                </ObjectUploader>\n              )}\n            </div>\n\n            <div className=\"flex justify-end\">\n              <Button \n                onClick={handleSubmitPost}\n                disabled={!newPostContent.trim() || createPostMutation.isPending}\n                className=\"w-full md:w-auto min-h-[44px] px-6 py-3 bg-gradient-to-r from-purple-500 via-pink-500 to-red-500 hover:from-purple-600 hover:via-pink-600 hover:to-red-600 text-white font-bold text-base rounded-full shadow-lg active:scale-95 transition-all duration-200\"\n                data-testid=\"button-submit-post\"\n              >\n                {createPostMutation.isPending ? (\n                  <>\n                    <div className=\"animate-spin rounded-full h-5 w-5 border-b-2 border-white mr-2\"></div>\n                    Sharing...\n                  </>\n                ) : (\n                  <>\n                    <Send className=\"mr-2\" size={18} />\n                    Launch Post 🚀\n                  </>\n                )}\n              </Button>\n            </div>\n          </CardContent>\n        </Card>\n\n        {/* Posts Feed */}\n        <div className=\"space-y-4 md:space-y-3\">\n          {isLoading ? (\n            Array.from({ length: 3 }).map((_, i) => (\n              <Card key={i} className=\"bg-gradient-to-br from-white to-gray-50 dark:from-gray-800 dark:to-gray-700 shadow-lg\">\n                <CardContent className=\"p-4 md:p-6\">\n                  <div className=\"animate-pulse space-y-4\">\n                    <div className=\"flex items-center space-x-4\">\n                      <div className=\"w-12 h-12 bg-gradient-to-br from-purple-200 to-pink-200 rounded-full\"></div>\n                      <div className=\"space-y-3 flex-1\">\n                        <div className=\"h-4 bg-gradient-to-r from-purple-200 to-pink-200 rounded-full w-40\"></div>\n                        <div className=\"h-3 bg-gradient-to-r from-gray-200 to-gray-300 rounded-full w-32\"></div>\n                      </div>\n                    </div>\n                    <div className=\"space-y-3\">\n                      <div className=\"h-5 bg-gradient-to-r from-gray-200 to-gray-300 rounded-full w-full\"></div>\n                      <div className=\"h-5 bg-gradient-to-r from-gray-200 to-gray-300 rounded-full w-3/4\"></div>\n                    </div>\n                  </div>\n                </CardContent>\n              </Card>\n            ))\n          ) : posts.length > 0 ? (\n            posts.map((post, index) => (\n              <Card \n                key={post.id} \n                className=\"bg-gradient-to-br from-white via-purple-50/30 to-pink-50/30 dark:from-gray-800 dark:via-purple-900/10 dark:to-pink-900/10 shadow-md active:shadow-lg transition-all duration-200 border-purple-100 dark:border-purple-700/50 overflow-hidden\"\n                data-testid={`card-post-${post.id}`}\n              >\n                <CardContent className=\"p-4 md:p-3\">\n                  <div className=\"flex items-start gap-3 md:gap-2\">\n                    {/* Enhanced Avatar with status ring */}\n                    <div className=\"relative shrink-0\">\n                      <div className={`absolute -inset-1 rounded-full ${\n                        post.user.streak > 0 \n                          ? 'bg-gradient-to-r from-yellow-400 to-orange-400' \n                          : 'bg-gradient-to-r from-purple-400 to-pink-400'\n                      }`}></div>\n                      <Avatar className=\"relative w-10 h-10 md:w-8 md:h-8 border-2 border-white shadow-sm\">\n                        {post.user.profileImageUrl && (\n                          <AvatarImage \n                            src={post.user.profileImageUrl} \n                            alt={`${post.user.firstName || 'User'}'s profile`}\n                            className=\"object-cover\"\n                          />\n                        )}\n                        <AvatarFallback className=\"bg-gradient-to-br from-purple-500 to-pink-500 text-white text-base md:text-sm font-bold\">\n                          {(post.user.firstName?.charAt(0) || post.user.email?.charAt(0) || 'U').toUpperCase()}\n                        </AvatarFallback>\n                      </Avatar>\n                      {/* Status indicator */}\n                      {post.user.streak > 0 && (\n                        <div className=\"absolute -bottom-1 -right-1 w-5 h-5 md:w-4 md:h-4 bg-yellow-500 rounded-full flex items-center justify-center shadow-sm border border-white\">\n                          <span className=\"text-xs md:text-[10px] font-bold text-white\">{post.user.streak}</span>\n                        </div>\n                      )}\n                    </div>\n                    \n                    <div className=\"flex-1 space-y-2 md:space-y-1 min-w-0\">\n                      <div className=\"flex items-start justify-between gap-2\">\n                        <div className=\"flex-1 min-w-0\">\n                          <div className=\"flex items-center gap-2 flex-wrap\">\n                            <p className=\"text-sm md:text-xs font-bold bg-gradient-to-r from-purple-700 to-pink-700 bg-clip-text text-transparent truncate\">\n                              {post.user.firstName && post.user.lastName \n                                ? `${post.user.firstName} ${post.user.lastName}`\n                                : 'Fitness Warrior'}\n                            </p>\n                            {post.user.streak > 0 && (\n                              <div className=\"flex items-center gap-1 bg-gradient-to-r from-yellow-500 to-orange-500 px-2 py-0.5 rounded-full shrink-0\">\n                                <Trophy size={12} className=\"text-white\" />\n                                <span className=\"text-xs font-bold text-white\">{post.user.streak}🔥</span>\n                              </div>\n                            )}\n                          </div>\n                          <p className=\"text-xs md:text-[10px] text-gray-600 dark:text-gray-400\">\n                            {formatTimeAgo(post.createdAt.toString())}\n                          </p>\n                        </div>\n                        <div className=\"flex items-center gap-1.5 shrink-0\">\n                          <div className=\"hidden md:block\">{getPostTypeBadge(post.postType)}</div>\n                          {/* Delete button - only show for user's own posts */}\n                          {currentUser && post.userId === currentUser.id && (\n                            <Button\n                              variant=\"ghost\"\n                              size=\"sm\"\n                              onClick={() => handleDeletePost(post.id)}\n                              className=\"min-h-[44px] min-w-[44px] md:h-7 md:w-7 p-0 text-red-500 hover:text-red-700 hover:bg-red-50 active:scale-95 rounded-full transition-all\"\n                              data-testid={`button-delete-post-${post.id}`}\n                            >\n                              <Trash2 size={16} className=\"md:w-3 md:h-3\" />\n                            </Button>\n                          )}\n                        </div>\n                      </div>\n                      \n                      <div className=\"text-gray-800 dark:text-gray-100 whitespace-pre-wrap leading-relaxed md:leading-snug p-3 md:p-2 bg-gradient-to-br from-white/50 to-purple-50/50 dark:from-gray-700/50 dark:to-purple-900/20 rounded-lg md:rounded-md border border-purple-100 dark:border-purple-800 text-[15px] md:text-xs\">\n                        {post.content}\n                      </div>\n\n                      {/* Display image if available */}\n                      {post.imageUrl && (\n                        <div className=\"mt-2\">\n                          <img\n                            src={post.imageUrl}\n                            alt=\"Post image\"\n                            className=\"w-full max-w-xs h-48 md:max-w-32 md:h-20 object-cover rounded-lg md:rounded border-2 md:border border-purple-200 dark:border-purple-700 shadow-md\"\n                            data-testid={`img-post-${post.id}`}\n                          />\n                        </div>\n                      )}\n\n                      {/* Enhanced workout info if it's a workout progress post */}\n                      {post.workout && (\n                        <div className=\"bg-gradient-to-br from-red-50 via-orange-50 to-yellow-50 dark:from-red-900/20 dark:via-orange-900/20 dark:to-yellow-900/20 rounded p-2 border border-red-200 dark:border-red-700 shadow-inner\">\n                          <div className=\"flex items-center justify-between\">\n                            <div className=\"space-y-1\">\n                              <p className=\"font-bold text-red-700 dark:text-red-300 flex items-center\" style={{fontSize: '11px'}}>\n                                <Dumbbell className=\"w-3 h-3 mr-1\" />\n                                {post.workout.name}\n                              </p>\n                              <p className=\"text-red-600 dark:text-red-400 capitalize font-medium px-1.5 py-0.5 bg-red-100 dark:bg-red-800 rounded-full\" style={{fontSize: '10px'}}>\n                                {post.workout.category}\n                              </p>\n                            </div>\n                            <div className=\"text-right space-y-0.5\">\n                              <div className=\"flex items-center justify-end space-x-0.5 text-orange-600 dark:text-orange-400\">\n                                <Clock size={10} />\n                                <span className=\"font-bold\" style={{fontSize: '10px'}}>{post.workout.duration}min</span>\n                              </div>\n                              <div className=\"flex items-center justify-end space-x-0.5 text-yellow-600 dark:text-yellow-400\">\n                                <span style={{fontSize: '10px'}}>🔥</span>\n                                <span className=\"font-bold\" style={{fontSize: '10px'}}>{post.workout.caloriesBurned}cal</span>\n                              </div>\n                            </div>\n                          </div>\n                        </div>\n                      )}\n                      \n                      <div className=\"flex items-center justify-between pt-2 md:pt-1 border-t border-purple-100 dark:border-purple-800\">\n                        <div className=\"flex items-center gap-2\">\n                          {/* Like Button */}\n                          <Button\n                            variant=\"ghost\"\n                            size=\"sm\"\n                            onClick={() => handleLike(post.id)}\n                            disabled={likeMutation.isPending}\n                            className=\"h-11 md:h-7 px-3 md:px-2 text-sm md:text-xs text-gray-600 hover:text-red-500 hover:bg-red-50 active:scale-95 transition-all\"\n                            data-testid={`button-like-post-${post.id}`}\n                          >\n                            <Heart \n                              className=\"mr-1.5 md:mr-1\" \n                              size={16} \n                            />\n                            <span className=\"font-bold\">\n                              Like\n                            </span>\n                          </Button>\n                          \n                          {/* Dislike Button */}\n                          <Button\n                            variant=\"ghost\"\n                            size=\"sm\"\n                            onClick={() => handleDislike(post.id)}\n                            disabled={dislikeMutation.isPending}\n                            className=\"h-11 md:h-7 px-3 md:px-2 text-sm md:text-xs text-gray-600 hover:text-blue-500 hover:bg-blue-50 active:scale-95 transition-all\"\n                            data-testid={`button-dislike-post-${post.id}`}\n                          >\n                            <ThumbsDown \n                              className=\"mr-1.5 md:mr-1\" \n                              size={16} \n                            />\n                            <span className=\"font-bold\">\n                              Dislike\n                            </span>\n                          </Button>\n                        </div>\n                        \n                        <div className=\"flex items-center gap-2\">\n                          {/* Likes Count */}\n                          <div className=\"bg-gradient-to-r from-red-100 to-pink-100 px-2.5 md:px-2 py-1 md:py-0.5 rounded-full\">\n                            <span className=\"text-sm md:text-xs font-bold text-red-700\" data-testid={`text-likes-${post.id}`}>\n                              {post.likes} ❤️\n                            </span>\n                          </div>\n                          {/* Dislikes Count */}\n                          <div className=\"bg-gradient-to-r from-blue-100 to-indigo-100 px-2.5 md:px-2 py-1 md:py-0.5 rounded-full\">\n                            <span className=\"text-sm md:text-xs font-bold text-blue-700\" data-testid={`text-dislikes-${post.id}`}>\n                              {post.dislikes || 0} 👎\n                            </span>\n                          </div>\n                        </div>\n                      </div>\n                    </div>\n                  </div>\n                </CardContent>\n              </Card>\n            ))\n          ) : (\n            <Card className=\"bg-gradient-to-br from-purple-50 via-pink-50 to-red-50 dark:from-gray-800 dark:via-purple-900/20 dark:to-red-900/20 shadow-lg border-purple-200 dark:border-purple-700\">\n              <CardContent className=\"p-6 md:p-8\">\n                <div className=\"text-center py-8 md:py-16\">\n                  <div className=\"relative mb-6 md:mb-8\">\n                    <div className=\"w-20 h-20 md:w-24 md:h-24 bg-gradient-to-br from-purple-400 to-pink-400 rounded-full mx-auto flex items-center justify-center shadow-xl\">\n                      <Sparkles className=\"w-10 h-10 md:w-12 md:h-12 text-white\" />\n                    </div>\n                  </div>\n                  <h3 className=\"text-2xl md:text-3xl font-bold bg-gradient-to-r from-purple-600 via-pink-600 to-red-600 bg-clip-text text-transparent mb-3 md:mb-4\">\n                    Ready to Ignite the Community? 🚀\n                  </h3>\n                  <p className=\"text-base md:text-xl text-gray-700 dark:text-gray-300 mb-6 md:mb-8 max-w-2xl mx-auto\">\n                    Be the spark that starts the fire! Share your fitness journey and inspire others.\n                  </p>\n                  <Button \n                    onClick={() => setNewPostContent(\"Just started my fitness journey and feeling amazing! 💪🔥\")}\n                    className=\"w-full md:w-auto min-h-[44px] px-6 md:px-8 py-3 md:py-4 bg-gradient-to-r from-purple-500 via-pink-500 to-red-500 hover:from-purple-600 hover:via-pink-600 hover:to-red-600 text-white font-bold text-base md:text-xl rounded-full shadow-lg active:scale-95 transition-all duration-200\"\n                    data-testid=\"button-start-first-post\"\n                  >\n                    <Sparkles className=\"mr-2 md:mr-3\" size={20} />\n                    Light Up the Feed! ✨\n                  </Button>\n                </div>\n              </CardContent>\n            </Card>\n          )}\n        </div>\n      </div>\n    </div>\n  );\n}","size_bytes":33020},"client/src/pages/dashboard.tsx":{"content":"import { Activity, Play, Users, Star, Clock, Shield, Target, BarChart3, Utensils, Brain, Dumbbell } from \"lucide-react\";\nimport { Button } from \"@/components/ui/button\";\nimport NavigationHeader from \"@/components/navigation-header\";\nimport MobileNavigation from \"@/components/mobile-navigation\";\n\nexport default function Dashboard() {\n  return (\n    <div className=\"font-inter bg-gray-50 dark:bg-gray-900 text-gray-800 dark:text-gray-200 min-h-screen\">\n      <NavigationHeader />\n      <MobileNavigation />\n      \n      <div className=\"relative min-h-screen bg-black hexagon-bg hexagon-pattern overflow-hidden\">\n        {/* Hexagonal background elements */}\n        <div className=\"fixed inset-0 pointer-events-none z-0\">\n          <div className=\"absolute top-20 left-10 w-32 h-28 opacity-20 animate-pulse\" style={{animationDuration: '6s'}}>\n            <svg viewBox=\"0 0 120 104\" className=\"w-full h-full\">\n              <polygon points=\"30,2 90,2 120,52 90,102 30,102 0,52\" fill=\"#dc2626\" stroke=\"#dc2626\" strokeWidth=\"2\" opacity=\"0.3\"/>\n            </svg>\n          </div>\n          <div className=\"absolute top-40 right-16 w-24 h-21 opacity-15 animate-bounce\" style={{animationDuration: '8s'}}>\n            <svg viewBox=\"0 0 120 104\" className=\"w-full h-full\">\n              <polygon points=\"30,2 90,2 120,52 90,102 30,102 0,52\" fill=\"none\" stroke=\"#dc2626\" strokeWidth=\"1\" opacity=\"0.4\"/>\n            </svg>\n          </div>\n          <div className=\"absolute top-96 left-1/4 w-28 h-24 opacity-25 animate-ping\" style={{animationDuration: '10s'}}>\n            <svg viewBox=\"0 0 120 104\" className=\"w-full h-full\">\n              <polygon points=\"30,2 90,2 120,52 90,102 30,102 0,52\" fill=\"#000000\" stroke=\"#dc2626\" strokeWidth=\"2\" opacity=\"0.6\"/>\n            </svg>\n          </div>\n          <div className=\"absolute bottom-80 right-1/3 w-20 h-17 opacity-30 animate-bounce\" style={{animationDuration: '7s'}}>\n            <svg viewBox=\"0 0 120 104\" className=\"w-full h-full\">\n              <polygon points=\"30,2 90,2 120,52 90,102 30,102 0,52\" fill=\"#dc2626\" stroke=\"#000000\" strokeWidth=\"1\" opacity=\"0.5\"/>\n            </svg>\n          </div>\n          <div className=\"absolute bottom-40 left-20 w-36 h-31 opacity-20 animate-pulse\" style={{animationDuration: '9s'}}>\n            <svg viewBox=\"0 0 120 104\" className=\"w-full h-full\">\n              <polygon points=\"30,2 90,2 120,52 90,102 30,102 0,52\" fill=\"none\" stroke=\"#dc2626\" strokeWidth=\"2\" opacity=\"0.3\"/>\n            </svg>\n          </div>\n          <div className=\"absolute top-1/3 right-1/4 w-26 h-22 opacity-15 animate-ping\" style={{animationDuration: '12s'}}>\n            <svg viewBox=\"0 0 120 104\" className=\"w-full h-full\">\n              <polygon points=\"30,2 90,2 120,52 90,102 30,102 0,52\" fill=\"#000000\" stroke=\"#dc2626\" strokeWidth=\"1\" opacity=\"0.4\"/>\n            </svg>\n          </div>\n        </div>\n\n        {/* Hero Section */}\n        <main className=\"relative z-10 container mx-auto px-4 py-16 pt-32\">\n          <div className=\"text-center space-y-8 max-w-4xl mx-auto\">\n            <h1 className=\"text-4xl md:text-6xl font-bold text-white\">\n              Your Complete\n              <span className=\"text-transparent bg-clip-text bg-gradient-to-r from-red-600 to-red-400 block\">\n                Fitness Journey\n              </span>\n              Starts Here\n            </h1>\n            \n            <p className=\"text-2xl font-bold text-black mb-4\">\n              Eat Clean, Think Smart, Train HARD!\n            </p>\n            \n            <p className=\"text-xl text-gray-300 max-w-3xl mx-auto leading-relaxed\">\n              FlexFlow is your all-in-one fitness companion featuring AI-powered workout recommendations, \n              personalized meal planning, progress tracking, and a supportive community to help you reach \n              your health and fitness goals faster than ever before.\n            </p>\n\n            <div className=\"space-y-4\">\n              <Button size=\"lg\" className=\"text-lg px-8 py-4\" asChild>\n                <a href=\"/home\">\n                  <Play className=\"mr-2\" size={20} />\n                  Start Your Journey\n                </a>\n              </Button>\n              <p className=\"text-sm text-gray-400\">Access your personalized dashboard</p>\n            </div>\n          </div>\n\n          {/* App Features Section */}\n          <div className=\"relative z-10 mt-20\">\n            <div className=\"text-center mb-16\">\n              <h2 className=\"text-3xl font-bold text-white mb-4\">Complete Fitness Ecosystem</h2>\n              <p className=\"text-xl text-gray-300 max-w-3xl mx-auto\">\n                Everything you need to transform your health and fitness journey in one powerful application\n              </p>\n            </div>\n\n            {/* Core Features Grid */}\n            <div className=\"grid md:grid-cols-2 lg:grid-cols-3 gap-8 mb-16\">\n              <div className=\"text-center p-6 rounded-2xl bg-black border border-red-600/30 shadow-lg shadow-red-600/20\">\n                <div className=\"w-16 h-16 bg-red-600/20 rounded-full flex items-center justify-center mx-auto mb-4\">\n                  <Dumbbell className=\"text-red-600\" size={24} />\n                </div>\n                <h3 className=\"font-semibold text-lg mb-2 text-white\">Smart Workout Tracking</h3>\n                <p className=\"text-gray-300 text-sm\">\n                  Log exercises with sets, reps, and weights. AI automatically adjusts workout difficulty \n                  based on your performance and progress patterns.\n                </p>\n              </div>\n\n              <div className=\"text-center p-6 rounded-2xl bg-black border border-red-600/30 shadow-lg shadow-red-600/20\">\n                <div className=\"w-16 h-16 bg-red-600/20 rounded-full flex items-center justify-center mx-auto mb-4\">\n                  <Brain className=\"text-red-600\" size={24} />\n                </div>\n                <h3 className=\"font-semibold text-lg mb-2 text-white\">AI-Powered Plans</h3>\n                <p className=\"text-gray-300 text-sm\">\n                  Get personalized workout and nutrition plans based on your age, goals, fitness level, \n                  and preferences. Plans adapt as you progress.\n                </p>\n              </div>\n\n              <div className=\"text-center p-6 rounded-2xl bg-black border border-red-600/30 shadow-lg shadow-red-600/20\">\n                <div className=\"w-16 h-16 bg-red-600/20 rounded-full flex items-center justify-center mx-auto mb-4\">\n                  <BarChart3 className=\"text-red-600\" size={24} />\n                </div>\n                <h3 className=\"font-semibold text-lg mb-2 text-white\">Advanced Analytics</h3>\n                <p className=\"text-gray-300 text-sm\">\n                  Track strength gains, endurance improvements, and body composition changes with \n                  detailed charts and performance insights.\n                </p>\n              </div>\n\n              <div className=\"text-center p-6 rounded-2xl bg-black border border-red-600/30 shadow-lg shadow-red-600/20\">\n                <div className=\"w-16 h-16 bg-red-600/20 rounded-full flex items-center justify-center mx-auto mb-4\">\n                  <Utensils className=\"text-red-600\" size={24} />\n                </div>\n                <h3 className=\"font-semibold text-lg mb-2 text-white\">Personalized Nutrition</h3>\n                <p className=\"text-gray-300 text-sm\">\n                  Custom meal plans with calorie and macro tracking. Barcode scanner for easy food logging \n                  and recipe recommendations based on your dietary goals.\n                </p>\n              </div>\n\n              <div className=\"text-center p-6 rounded-2xl bg-black border border-red-600/30 shadow-lg shadow-red-600/20\">\n                <div className=\"w-16 h-16 bg-red-600/20 rounded-full flex items-center justify-center mx-auto mb-4\">\n                  <Clock className=\"text-red-600\" size={24} />\n                </div>\n                <h3 className=\"font-semibold text-lg mb-2 text-white\">Activity Tracking</h3>\n                <p className=\"text-gray-300 text-sm\">\n                  Built-in mile tracker with GPS integration, workout timers, and comprehensive \n                  activity monitoring for running, walking, and cardio sessions.\n                </p>\n              </div>\n\n              <div className=\"text-center p-6 rounded-2xl bg-black border border-red-600/30 shadow-lg shadow-red-600/20\">\n                <div className=\"w-16 h-16 bg-red-600/20 rounded-full flex items-center justify-center mx-auto mb-4\">\n                  <Users className=\"text-red-600\" size={24} />\n                </div>\n                <h3 className=\"font-semibold text-lg mb-2 text-white\">Social Community</h3>\n                <p className=\"text-gray-300 text-sm\">\n                  Connect with fitness enthusiasts, compete on leaderboards, share achievements, \n                  and get motivated by a supportive community.\n                </p>\n              </div>\n            </div>\n\n            {/* Premium Features Section */}\n            <div className=\"bg-gradient-to-r from-red-600/10 to-red-800/10 rounded-2xl p-8 border border-red-600/20\">\n              <div className=\"text-center mb-8\">\n                <div className=\"w-16 h-16 bg-red-600/20 rounded-full flex items-center justify-center mx-auto mb-4\">\n                  <Shield className=\"text-red-600\" size={32} />\n                </div>\n                <h3 className=\"text-2xl font-bold text-white mb-2\">Premium Features</h3>\n                <p className=\"text-gray-300\">Unlock the full potential of your fitness journey</p>\n              </div>\n              \n              <div className=\"grid md:grid-cols-2 gap-6\">\n                <div className=\"flex items-start space-x-3\">\n                  <Star className=\"text-yellow-500 flex-shrink-0 mt-1\" size={20} />\n                  <div>\n                    <h4 className=\"font-semibold text-white\">Advanced Meal Planning</h4>\n                    <p className=\"text-gray-300 text-sm\">Custom recipes, shopping lists, and nutrition coaching</p>\n                  </div>\n                </div>\n                <div className=\"flex items-start space-x-3\">\n                  <BarChart3 className=\"text-blue-500 flex-shrink-0 mt-1\" size={20} />\n                  <div>\n                    <h4 className=\"font-semibold text-white\">Deep Analytics</h4>\n                    <p className=\"text-gray-300 text-sm\">Detailed body composition tracking and trend analysis</p>\n                  </div>\n                </div>\n                <div className=\"flex items-start space-x-3\">\n                  <Shield className=\"text-purple-500 flex-shrink-0 mt-1\" size={20} />\n                  <div>\n                    <h4 className=\"font-semibold text-white\">Priority Support</h4>\n                    <p className=\"text-gray-300 text-sm\">24/7 customer support and exclusive features access</p>\n                  </div>\n                </div>\n              </div>\n            </div>\n          </div>\n\n          {/* CTA Section */}\n          <div className=\"relative z-10 text-center mt-20 p-8 rounded-2xl bg-gradient-to-r from-primary to-secondary text-white\">\n            <h2 className=\"text-3xl font-bold mb-4\">Ready to Transform Your Fitness?</h2>\n            <p className=\"text-xl mb-6 opacity-90\">\n              Access all your tools and start tracking your journey today\n            </p>\n            <Button size=\"lg\" variant=\"secondary\" className=\"text-lg px-8 py-4\" asChild>\n              <a href=\"/home\">\n                <Play className=\"mr-2\" size={20} />\n                Go to Dashboard\n              </a>\n            </Button>\n          </div>\n        </main>\n      </div>\n    </div>\n  );\n}","size_bytes":11732},"client/src/pages/mile-tracker.tsx":{"content":"import { useState, useEffect, useRef } from \"react\";\nimport { useQuery, useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport { Play, Pause, Square, Timer, Activity, Target, History, MapPin, Zap, Flame, Trophy, Gauge } from \"lucide-react\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Progress } from \"@/components/ui/progress\";\nimport { Slider } from \"@/components/ui/slider\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport FeatureGate from \"@/components/feature-gate\";\nimport type { MileTrackerSessionWithSplits } from \"@shared/schema\";\nimport { MapContainer, TileLayer, Polyline, Marker, useMap } from 'react-leaflet';\nimport 'leaflet/dist/leaflet.css';\nimport L from 'leaflet';\n\n// Fix for default marker icons in Leaflet\ndelete (L.Icon.Default.prototype as any)._getIconUrl;\nL.Icon.Default.mergeOptions({\n  iconRetinaUrl: 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-icon-2x.png',\n  iconUrl: 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-icon.png',\n  shadowUrl: 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-shadow.png',\n});\n\nexport default function MileTracker() {\n  const [selectedActivity, setSelectedActivity] = useState<\"run\" | \"walk\" | \"bike\">(\"run\");\n  const [isRunning, setIsRunning] = useState(false);\n  const [currentTime, setCurrentTime] = useState(0);\n  const [currentMile, setCurrentMile] = useState(0);\n  const [showHistory, setShowHistory] = useState(false);\n  \n  // GPS tracking state\n  const [gpsEnabled, setGpsEnabled] = useState(false);\n  const [gpsDistance, setGpsDistance] = useState(0); // in miles\n  const [gpsAccuracy, setGpsAccuracy] = useState<number | null>(null); // in meters\n  const [currentSpeed, setCurrentSpeed] = useState<number | null>(null); // in mph\n  const [gpsPath, setGpsPath] = useState<[number, number][]>([]); // Array of [lat, lng] coordinates\n  const [currentPosition, setCurrentPosition] = useState<[number, number] | null>(null);\n  \n  const timerRef = useRef<NodeJS.Timeout | null>(null);\n  const gpsWatchRef = useRef<number | null>(null);\n  const previousPositionRef = useRef<{ lat: number; lon: number; timestamp: number } | null>(null);\n  const lastMileDistanceRef = useRef(0); // Track distance at last mile completion\n  \n  const { toast } = useToast();\n  const queryClient = useQueryClient();\n\n  const { data: activeSession, refetch: refetchActiveSession } = useQuery<MileTrackerSessionWithSplits>({\n    queryKey: [\"/api/mile-tracker/sessions/active\"],\n    retry: false,\n  });\n\n  const { data: sessions = [] } = useQuery<MileTrackerSessionWithSplits[]>({\n    queryKey: [\"/api/mile-tracker/sessions\"],\n    enabled: showHistory,\n  });\n\n  const startSessionMutation = useMutation({\n    mutationFn: async (activityType: string) => {\n      const response = await apiRequest(\"POST\", \"/api/mile-tracker/sessions\", {\n        activityType,\n        totalDistance: 0,\n        totalTime: 0,\n        averagePace: null,\n      });\n      return response.json();\n    },\n    onSuccess: () => {\n      refetchActiveSession();\n      setIsRunning(true);\n      setCurrentTime(0);\n      setCurrentMile(1);\n      toast({ title: \"Session Started!\", description: `Started tracking your ${selectedActivity}` });\n    },\n    onError: () => {\n      toast({ title: \"Error\", description: \"Failed to start session\", variant: \"destructive\" });\n    }\n  });\n\n  const completeMileMutation = useMutation({\n    mutationFn: async ({ sessionId, mileNumber, splitTime, cumulativeTime }: {\n      sessionId: string;\n      mileNumber: number;\n      splitTime: number;\n      cumulativeTime: number;\n    }) => {\n      const pace = splitTime; // pace in seconds per mile\n      const response = await apiRequest(\"POST\", `/api/mile-tracker/sessions/${sessionId}/splits`, {\n        mileNumber,\n        splitTime,\n        cumulativeTime,\n        pace,\n      });\n      return response.json();\n    },\n    onSuccess: () => {\n      refetchActiveSession();\n      queryClient.invalidateQueries({ queryKey: [\"/api/mile-tracker/sessions\"] });\n      toast({ \n        title: \"Mile Completed!\", \n        description: `Mile ${currentMile} completed in ${formatTime(getLastMileTime())}`\n      });\n      setCurrentMile(prev => prev + 1);\n    }\n  });\n\n  const finishSessionMutation = useMutation({\n    mutationFn: async (sessionId: string) => {\n      const totalDistance = currentMile > 1 ? (currentMile - 1) * 1000 : 0; // Convert to meters * 1000 for precision\n      const averagePace = currentTime > 0 && currentMile > 1 ? Math.round(currentTime / (currentMile - 1)) : null;\n      \n      const response = await apiRequest(\"PATCH\", `/api/mile-tracker/sessions/${sessionId}`, {\n        status: \"completed\",\n        totalDistance,\n        totalTime: currentTime,\n        averagePace,\n        completedAt: new Date().toISOString(),\n      });\n      return response.json();\n    },\n    onSuccess: () => {\n      setIsRunning(false);\n      setCurrentTime(0);\n      setCurrentMile(0);\n      refetchActiveSession();\n      queryClient.invalidateQueries({ queryKey: [\"/api/mile-tracker/sessions\"] });\n      toast({ title: \"Session Completed!\", description: \"Great job on your workout!\" });\n    }\n  });\n\n  // Timer effect\n  useEffect(() => {\n    if (isRunning) {\n      timerRef.current = setInterval(() => {\n        setCurrentTime(prev => prev + 1);\n      }, 1000);\n    } else {\n      if (timerRef.current) {\n        clearInterval(timerRef.current);\n        timerRef.current = null;\n      }\n    }\n\n    return () => {\n      if (timerRef.current) {\n        clearInterval(timerRef.current);\n      }\n    };\n  }, [isRunning]);\n\n  // Load active session on component mount\n  useEffect(() => {\n    if (activeSession && activeSession.status === \"active\") {\n      setIsRunning(false); // Will be set to true by user\n      setCurrentMile(activeSession.splits.length + 1);\n      \n      // Calculate current time based on splits\n      const lastSplit = activeSession.splits[activeSession.splits.length - 1];\n      if (lastSplit) {\n        setCurrentTime(lastSplit.cumulativeTime);\n      }\n    }\n  }, [activeSession]);\n\n  const formatTime = (seconds: number): string => {\n    const hours = Math.floor(seconds / 3600);\n    const minutes = Math.floor((seconds % 3600) / 60);\n    const secs = seconds % 60;\n    \n    if (hours > 0) {\n      return `${hours}:${minutes.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;\n    }\n    return `${minutes}:${secs.toString().padStart(2, '0')}`;\n  };\n\n  const formatPace = (seconds: number): string => {\n    const minutes = Math.floor(seconds / 60);\n    const secs = seconds % 60;\n    return `${minutes}:${secs.toString().padStart(2, '0')}`;\n  };\n\n  const getLastMileTime = (): number => {\n    if (!activeSession || activeSession.splits.length === 0) return 0;\n    const lastSplit = activeSession.splits[activeSession.splits.length - 1];\n    return lastSplit.splitTime;\n  };\n\n  const getCurrentPace = (): string => {\n    if (currentMile <= 1 || currentTime === 0) return \"--:--\";\n    const averageSecondsPerMile = currentTime / (currentMile - 1);\n    return formatPace(Math.round(averageSecondsPerMile));\n  };\n\n  const getActivityIcon = (activity: string) => {\n    switch (activity) {\n      case \"run\":\n        return \"🔥🏃‍♂️💨\";\n      case \"walk\":\n        return \"⚡🚶‍♂️💪\";\n      case \"bike\":\n        return \"🏁🚴‍♂️🔥\";\n      default:\n        return \"🔥🏃‍♂️💨\";\n    }\n  };\n\n  const getActivityColor = (activity: string) => {\n    switch (activity) {\n      case \"run\":\n        return \"bg-gradient-to-r from-red-600 to-red-800 text-white border-red-500 shadow-lg shadow-red-500/25\";\n      case \"walk\":\n        return \"bg-gradient-to-r from-red-700 to-black text-white border-red-600 shadow-lg shadow-red-600/25\";\n      case \"bike\":\n        return \"bg-gradient-to-r from-black to-red-700 text-white border-red-500 shadow-lg shadow-red-500/25\";\n      default:\n        return \"bg-gradient-to-r from-red-600 to-red-800 text-white border-red-500 shadow-lg shadow-red-500/25\";\n    }\n  };\n\n  // GPS Functions - Haversine formula to calculate distance between two GPS points\n  const calculateDistance = (lat1: number, lon1: number, lat2: number, lon2: number): number => {\n    const R = 3958.8; // Earth radius in miles\n    \n    const lat1Rad = lat1 * (Math.PI / 180);\n    const lat2Rad = lat2 * (Math.PI / 180);\n    const deltaLat = (lat2 - lat1) * (Math.PI / 180);\n    const deltaLon = (lon2 - lon1) * (Math.PI / 180);\n    \n    const a = Math.sin(deltaLat/2) * Math.sin(deltaLat/2) +\n              Math.cos(lat1Rad) * Math.cos(lat2Rad) *\n              Math.sin(deltaLon/2) * Math.sin(deltaLon/2);\n    \n    const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));\n    return R * c;\n  };\n\n  const handleGPSPosition = (position: GeolocationPosition) => {\n    const currentLat = position.coords.latitude;\n    const currentLon = position.coords.longitude;\n    const accuracy = position.coords.accuracy;\n    const speed = position.coords.speed; // in m/s\n    \n    setGpsAccuracy(accuracy);\n    \n    // Convert speed from m/s to mph\n    if (speed !== null && speed >= 0) {\n      setCurrentSpeed(speed * 2.237); // m/s to mph conversion\n    }\n    \n    // Only process GPS data if accuracy is good (< 100m)\n    if (accuracy < 100) {\n      setCurrentPosition([currentLat, currentLon]);\n      setGpsPath(prev => [...prev, [currentLat, currentLon]]);\n      \n      if (previousPositionRef.current) {\n        const distance = calculateDistance(\n          previousPositionRef.current.lat,\n          previousPositionRef.current.lon,\n          currentLat,\n          currentLon\n        );\n        \n        // Only add distance if movement is significant (> ~16 feet to filter GPS drift)\n        if (distance > 0.003) {\n          setGpsDistance(prev => {\n            const newDistance = prev + distance;\n            \n            // Auto-complete mile if we've traveled 1 mile since last mile marker\n            if (activeSession && isRunning && newDistance - lastMileDistanceRef.current >= 1.0) {\n              completeMile();\n              lastMileDistanceRef.current = newDistance;\n            }\n            \n            return newDistance;\n          });\n        }\n      }\n      \n      // Only update previous position if current accuracy is good\n      previousPositionRef.current = {\n        lat: currentLat,\n        lon: currentLon,\n        timestamp: position.timestamp\n      };\n    }\n  };\n\n  const handleGPSError = (error: GeolocationPositionError) => {\n    let message = \"GPS error occurred\";\n    \n    switch(error.code) {\n      case error.PERMISSION_DENIED:\n        message = \"Location access denied. Please enable location permissions.\";\n        break;\n      case error.POSITION_UNAVAILABLE:\n        message = \"Location unavailable. Make sure GPS is enabled.\";\n        break;\n      case error.TIMEOUT:\n        message = \"Location request timed out.\";\n        break;\n    }\n    \n    toast({ title: \"GPS Error\", description: message, variant: \"destructive\" });\n    setGpsEnabled(false);\n  };\n\n  const startGPSTracking = () => {\n    if (!('geolocation' in navigator)) {\n      toast({ \n        title: \"GPS Not Available\", \n        description: \"Your device doesn't support GPS tracking.\", \n        variant: \"destructive\" \n      });\n      return;\n    }\n\n    const watchId = navigator.geolocation.watchPosition(\n      handleGPSPosition,\n      handleGPSError,\n      {\n        enableHighAccuracy: true,\n        timeout: 5000,\n        maximumAge: 0\n      }\n    );\n    \n    gpsWatchRef.current = watchId;\n    setGpsEnabled(true);\n    toast({ title: \"GPS Enabled\", description: \"Tracking your location in real-time\" });\n  };\n\n  const stopGPSTracking = () => {\n    if (gpsWatchRef.current !== null) {\n      navigator.geolocation.clearWatch(gpsWatchRef.current);\n      gpsWatchRef.current = null;\n    }\n    setGpsEnabled(false);\n    setGpsAccuracy(null);\n    setCurrentSpeed(null);\n  };\n\n  const startSession = () => {\n    startSessionMutation.mutate(selectedActivity);\n    // Reset GPS tracking data\n    setGpsDistance(0);\n    setGpsPath([]);\n    setCurrentPosition(null);\n    previousPositionRef.current = null;\n    lastMileDistanceRef.current = 0;\n  };\n\n  const pauseResume = () => {\n    if (!isRunning) {\n      // Starting the session - automatically enable GPS\n      if (!gpsEnabled) {\n        startGPSTracking();\n      }\n    }\n    setIsRunning(!isRunning);\n  };\n\n  const completeMile = () => {\n    if (!activeSession) return;\n    \n    const lastSplitTime = activeSession.splits.length > 0 \n      ? activeSession.splits[activeSession.splits.length - 1].cumulativeTime \n      : 0;\n    const splitTime = currentTime - lastSplitTime;\n    \n    completeMileMutation.mutate({\n      sessionId: activeSession.id,\n      mileNumber: currentMile,\n      splitTime,\n      cumulativeTime: currentTime,\n    });\n  };\n\n  const finishSession = () => {\n    if (!activeSession) return;\n    finishSessionMutation.mutate(activeSession.id);\n    stopGPSTracking(); // Stop GPS when session ends\n  };\n\n  // Clean up GPS tracking on unmount\n  useEffect(() => {\n    return () => {\n      stopGPSTracking();\n    };\n  }, []);\n\n  // Component to auto-center map on current position\n  function MapUpdater({ center }: { center: [number, number] | null }) {\n    const map = useMap();\n    useEffect(() => {\n      if (center) {\n        map.setView(center, 16);\n      }\n    }, [center, map]);\n    return null;\n  }\n\n  if (showHistory) {\n    return (\n      <div className=\"min-h-screen bg-gradient-to-br from-black via-gray-900 to-red-950\">\n        <div className=\"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-8\">\n          <div className=\"flex items-center justify-between mb-8\">\n            <div>\n              <h1 className=\"text-4xl font-bold bg-gradient-to-r from-red-500 to-red-300 bg-clip-text text-transparent mb-2 flex items-center\">\n                <Trophy className=\"mr-3 text-red-500\" size={40} />\n                🔥 SPEED HISTORY 🔥\n              </h1>\n              <p className=\"text-red-300 font-semibold\">Your legendary racing sessions and conquests</p>\n            </div>\n            <Button onClick={() => setShowHistory(false)} className=\"bg-red-600 hover:bg-red-700 text-white border border-red-500\">\n              <Zap className=\"mr-2\" size={16} />\n              Back to Action\n            </Button>\n          </div>\n\n          <div className=\"space-y-4\">\n            {sessions.map((session) => (\n              <Card key={session.id} className=\"bg-gradient-to-r from-gray-900 to-black border border-red-500/30 shadow-xl shadow-red-500/10\">\n                <CardContent className=\"pt-6\">\n                  <div className=\"flex items-center justify-between\">\n                    <div className=\"flex items-center space-x-4\">\n                      <div className=\"text-3xl animate-pulse\">\n                        {getActivityIcon(session.activityType)}\n                      </div>\n                      <div>\n                        <div className=\"flex items-center space-x-2\">\n                          <h3 className=\"font-bold text-xl capitalize text-red-400 flex items-center\">\n                            <Flame className=\"mr-1\" size={18} />\n                            EPIC {session.activityType.toUpperCase()}\n                          </h3>\n                          <Badge className={getActivityColor(session.activityType)}>\n                            🏁 {session.splits.length} {session.splits.length === 1 ? 'MILE' : 'MILES'} 🏁\n                          </Badge>\n                        </div>\n                        <p className=\"text-red-300 font-medium\">\n                          ⚡ {new Date(session.startedAt).toLocaleDateString()} at{' '}\n                          {new Date(session.startedAt).toLocaleTimeString()}\n                        </p>\n                      </div>\n                    </div>\n                    <div className=\"text-right\">\n                      <p className=\"text-3xl font-bold text-red-400 font-mono\">\n                        {formatTime(session.totalTime)}\n                      </p>\n                      <p className=\"text-sm text-red-300 font-semibold\">\n                        💨 Avg Speed: {session.averagePace ? formatPace(session.averagePace) : '--:--'}/mile\n                      </p>\n                    </div>\n                  </div>\n                  \n                  {session.splits.length > 0 && (\n                    <div className=\"mt-4 pt-4 border-t border-red-500/30\">\n                      <h4 className=\"font-bold text-red-400 mb-2 flex items-center\">\n                        <Gauge className=\"mr-2\" size={18} />\n                        🔥 SPEED SPLITS 🔥\n                      </h4>\n                      <div className=\"grid grid-cols-2 md:grid-cols-4 gap-2\">\n                        {session.splits.map((split, index) => (\n                          <div key={split.id} className=\"bg-gradient-to-br from-red-900 to-black rounded-lg p-3 text-center border border-red-500/40 shadow-lg\">\n                            <p className=\"text-sm font-bold text-red-300\">🏃‍♂️ MILE {split.mileNumber}</p>\n                            <p className=\"text-xl font-bold text-red-400 font-mono\">\n                              {formatTime(split.splitTime)}\n                            </p>\n                            <p className=\"text-xs text-red-300 font-semibold\">\n                              ⚡ {formatPace(split.pace)}/mile\n                            </p>\n                            {index === 0 && session.splits.length > 1 && (\n                              <div className=\"text-xs text-yellow-400 font-bold\">💫 FASTEST</div>\n                            )}\n                          </div>\n                        ))}\n                      </div>\n                    </div>\n                  )}\n                </CardContent>\n              </Card>\n            ))}\n            \n            {sessions.length === 0 && (\n              <Card className=\"bg-gradient-to-r from-gray-900 to-black border border-red-500/30 shadow-xl\">\n                <CardContent className=\"pt-6\">\n                  <div className=\"text-center py-8\">\n                    <div className=\"text-6xl mb-4\">🏁💨</div>\n                    <h3 className=\"text-2xl font-bold text-red-400 mb-2\">🔥 NO LEGENDS YET 🔥</h3>\n                    <p className=\"text-red-300 font-semibold\">\n                      Your racing legacy starts with the first mile. Ready to become a speed demon?\n                    </p>\n                  </div>\n                </CardContent>\n              </Card>\n            )}\n          </div>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <FeatureGate feature=\"mile_tracker\">\n      <div className=\"min-h-screen bg-gradient-to-br from-black via-gray-900 to-red-950 relative overflow-hidden\">\n      {/* Animated background effects */}\n      <div className=\"absolute inset-0 bg-gradient-to-r from-red-500/5 to-transparent animate-pulse\"></div>\n      <div className=\"absolute top-10 left-10 text-red-500/20 text-9xl\">🔥</div>\n      <div className=\"absolute bottom-10 right-10 text-red-500/20 text-9xl\">⚡</div>\n      \n      <div className=\"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-8 relative z-10\">\n        <div className=\"mb-8\">\n          <div className=\"flex flex-col sm:flex-row sm:items-center gap-4 mb-2\">\n            <h1 className=\"text-3xl sm:text-5xl font-bold bg-gradient-to-r from-red-500 via-red-400 to-yellow-400 bg-clip-text text-transparent flex items-center animate-pulse\">\n              <Flame className=\"mr-2 sm:mr-3 text-red-500\" size={40} />\n              🏁 SPEED DEMON TRACKER 🔥\n            </h1>\n            <Button \n              variant=\"outline\" \n              onClick={() => setShowHistory(true)}\n              className=\"bg-gradient-to-r from-red-600 to-red-800 text-white border border-red-500 hover:from-red-700 hover:to-red-900 shadow-lg shadow-red-500/25 w-full sm:w-auto\"\n            >\n              <Trophy className=\"mr-2\" size={16} />\n              📜 Hall of Fame\n            </Button>\n          </div>\n          <p className=\"text-red-300 font-bold text-base sm:text-lg\">⚡ Unleash your inner speed demon and dominate every mile! 💨</p>\n        </div>\n\n        {!activeSession ? (\n          /* Start New Session */\n          <div className=\"space-y-6\">\n            <Card className=\"bg-gradient-to-br from-gray-900 to-black border border-red-500/50 shadow-2xl shadow-red-500/20\">\n              <CardHeader>\n                <CardTitle className=\"flex items-center text-2xl font-bold text-red-400\">\n                  <Zap className=\"mr-3 text-red-500 animate-pulse\" size={32} />\n                  🔥 IGNITE YOUR SPEED 🔥\n                </CardTitle>\n              </CardHeader>\n              <CardContent className=\"space-y-6\">\n                <div>\n                  <label className=\"block text-lg font-bold text-red-300 mb-3\">\n                    ⚡ Choose Your Racing Mode ⚡\n                  </label>\n                  <Select value={selectedActivity} onValueChange={(value: \"run\" | \"walk\" | \"bike\") => setSelectedActivity(value)}>\n                    <SelectTrigger className=\"w-full bg-gray-800 border-red-500/50 text-white text-lg font-semibold\">\n                      <SelectValue />\n                    </SelectTrigger>\n                    <SelectContent className=\"bg-gray-800 border-red-500/50\">\n                      <SelectItem value=\"run\" className=\"text-white font-bold text-lg\">🔥🏃‍♂️💨 BLAZING RUN</SelectItem>\n                      <SelectItem value=\"walk\" className=\"text-white font-bold text-lg\">⚡🚶‍♂️💪 POWER WALK</SelectItem>\n                      <SelectItem value=\"bike\" className=\"text-white font-bold text-lg\">🏁🚴‍♂️🔥 SPEED CYCLING</SelectItem>\n                    </SelectContent>\n                  </Select>\n                </div>\n\n                <Button \n                  onClick={startSession}\n                  disabled={startSessionMutation.isPending}\n                  className=\"w-full bg-gradient-to-r from-red-600 via-red-700 to-red-800 hover:from-red-700 hover:via-red-800 hover:to-red-900 text-white border border-red-500 shadow-lg shadow-red-500/50 text-xl font-bold py-6\"\n                  size=\"lg\"\n                >\n                  <Flame className=\"mr-3 animate-bounce\" size={24} />\n                  {startSessionMutation.isPending ? \"🔥 IGNITING...\" : `🏁 START ${selectedActivity.toUpperCase()} DOMINATION! 💨`}\n                </Button>\n              </CardContent>\n            </Card>\n          </div>\n        ) : (\n          /* Active Session */\n          <div className=\"space-y-6\">\n            {/* Main Timer Display */}\n            <Card className=\"bg-gradient-to-br from-red-950 via-black to-gray-900 border border-red-500/50 shadow-2xl shadow-red-500/30\">\n              <CardContent className=\"pt-6\">\n                <div className=\"text-center relative\">\n                  {/* Animated fire effects */}\n                  <div className=\"absolute top-0 left-1/2 transform -translate-x-1/2 text-6xl animate-bounce\">🔥</div>\n                  \n                  <div className=\"flex items-center justify-center mb-6 mt-8\">\n                    <Badge className={`${getActivityColor(activeSession.activityType)} text-xl px-4 py-2 animate-pulse`}>\n                      {getActivityIcon(activeSession.activityType)} BEAST MODE {activeSession.activityType.toUpperCase()}\n                    </Badge>\n                  </div>\n                  \n                  <div className=\"text-9xl font-bold bg-gradient-to-r from-red-400 via-red-500 to-yellow-400 bg-clip-text text-transparent mb-4 font-mono tracking-wider animate-pulse drop-shadow-lg\">\n                    {formatTime(currentTime)}\n                  </div>\n                  \n                  <div className=\"text-2xl text-red-300 mb-4 font-bold\">\n                    🏃‍♂️ MILE {currentMile} • ⚡ SPEED: {getCurrentPace()}/mile 💨\n                  </div>\n\n                  {/* GPS Stats Display */}\n                  {gpsEnabled && (\n                    <div className=\"mb-6 p-4 bg-gradient-to-r from-blue-900/50 to-purple-900/50 rounded-xl border border-blue-500/30\">\n                      <div className=\"flex items-center justify-center gap-6 flex-wrap text-sm\">\n                        <div className=\"flex items-center gap-2\">\n                          <MapPin className=\"text-blue-400\" size={16} />\n                          <span className=\"text-blue-300 font-semibold\">\n                            GPS: {gpsDistance.toFixed(2)} mi\n                          </span>\n                        </div>\n                        {currentSpeed !== null && (\n                          <div className=\"flex items-center gap-2\">\n                            <Gauge className=\"text-green-400\" size={16} />\n                            <span className=\"text-green-300 font-semibold\">\n                              {currentSpeed.toFixed(1)} mph\n                            </span>\n                          </div>\n                        )}\n                        {gpsAccuracy !== null && (\n                          <div className=\"flex items-center gap-2\">\n                            <Activity className=\"text-yellow-400\" size={16} />\n                            <span className={`font-semibold ${\n                              gpsAccuracy < 20 ? 'text-green-300' : \n                              gpsAccuracy < 50 ? 'text-yellow-300' : \n                              'text-orange-300'\n                            }`}>\n                              ±{gpsAccuracy.toFixed(0)}m\n                            </span>\n                          </div>\n                        )}\n                      </div>\n                    </div>\n                  )}\n\n                  <div className=\"flex justify-center space-x-4 flex-wrap gap-4\">\n                    <Button \n                      onClick={pauseResume}\n                      className={isRunning ? \n                        \"bg-gradient-to-r from-yellow-600 to-yellow-700 hover:from-yellow-700 hover:to-yellow-800 text-white border border-yellow-500 shadow-lg shadow-yellow-500/25\" :\n                        \"bg-gradient-to-r from-green-600 to-green-700 hover:from-green-700 hover:to-green-800 text-white border border-green-500 shadow-lg shadow-green-500/25\"\n                      }\n                      size=\"lg\"\n                      data-testid={isRunning ? \"button-pause\" : \"button-unleash\"}\n                    >\n                      {isRunning ? <Pause className=\"mr-2 animate-pulse\" size={20} /> : <Play className=\"mr-2 animate-bounce\" size={20} />}\n                      {isRunning ? \"⏸️ CHILL\" : \"▶️ UNLEASH!\"}\n                    </Button>\n                    \n                    <Button \n                      onClick={completeMile}\n                      className=\"bg-gradient-to-r from-red-600 to-red-800 hover:from-red-700 hover:to-red-900 text-white border border-red-500 shadow-lg shadow-red-500/25\"\n                      size=\"lg\"\n                      disabled={!isRunning || completeMileMutation.isPending}\n                      data-testid=\"button-complete-mile\"\n                    >\n                      <Target className=\"mr-2 animate-spin\" size={20} />\n                      {completeMileMutation.isPending ? \"🔥 RECORDING...\" : `🏁 CRUSH MILE ${currentMile}!`}\n                    </Button>\n                    \n                    <Button \n                      onClick={finishSession}\n                      className=\"bg-gradient-to-r from-gray-700 to-black hover:from-gray-800 hover:to-gray-900 text-red-400 border border-red-500 shadow-lg shadow-red-500/25\"\n                      size=\"lg\"\n                      disabled={finishSessionMutation.isPending}\n                      data-testid=\"button-finish-session\"\n                    >\n                      <Square className=\"mr-2\" size={20} />\n                      {finishSessionMutation.isPending ? \"🔥 WRAPPING UP...\" : \"🏆 VICTORY LAP!\"}\n                    </Button>\n                  </div>\n                </div>\n              </CardContent>\n            </Card>\n\n            {/* GPS Map */}\n            {gpsEnabled && (\n              <Card className=\"bg-gradient-to-br from-gray-900 to-black border border-blue-500/50 shadow-xl shadow-blue-500/20\">\n                <CardHeader>\n                  <CardTitle className=\"flex items-center text-2xl font-bold text-blue-400\">\n                    <MapPin className=\"mr-3 text-blue-500 animate-pulse\" size={28} />\n                    🗺️ LIVE GPS TRACKING 📍\n                  </CardTitle>\n                </CardHeader>\n                <CardContent>\n                  {currentPosition ? (\n                    <>\n                      <div className=\"h-[400px] rounded-lg overflow-hidden border-2 border-blue-500/30\">\n                        <MapContainer\n                          center={currentPosition}\n                          zoom={16}\n                          style={{ height: '100%', width: '100%' }}\n                          className=\"z-0\"\n                        >\n                          <TileLayer\n                            attribution='&copy; <a href=\"https://www.openstreetmap.org/copyright\">OpenStreetMap</a>'\n                            url=\"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png\"\n                          />\n                          <MapUpdater center={currentPosition} />\n                          {gpsPath.length > 1 && (\n                            <Polyline\n                              positions={gpsPath}\n                              color=\"#ef4444\"\n                              weight={4}\n                              opacity={0.8}\n                            />\n                          )}\n                          <Marker position={currentPosition} />\n                        </MapContainer>\n                      </div>\n                      <div className=\"mt-4 text-center\">\n                        <p className=\"text-blue-300 font-semibold\">\n                          🎯 Total Distance: <span className=\"text-blue-400 text-lg font-bold\">{gpsDistance.toFixed(2)} miles</span>\n                        </p>\n                        {gpsPath.length > 0 && (\n                          <p className=\"text-sm text-blue-400/70 mt-1\">\n                            📊 {gpsPath.length} GPS points tracked\n                          </p>\n                        )}\n                      </div>\n                    </>\n                  ) : (\n                    <div className=\"h-[400px] rounded-lg border-2 border-blue-500/30 bg-gray-800/50 flex flex-col items-center justify-center\">\n                      <div className=\"animate-pulse text-6xl mb-4\">🛰️</div>\n                      <p className=\"text-blue-400 text-xl font-bold mb-2\">Acquiring GPS Signal...</p>\n                      <p className=\"text-blue-300 text-sm\">Please wait while we locate you</p>\n                      {gpsAccuracy !== null && (\n                        <p className=\"text-yellow-400 text-xs mt-2\">\n                          Signal accuracy: ±{gpsAccuracy.toFixed(0)}m\n                          {gpsAccuracy >= 100 && \" (waiting for better signal)\"}\n                        </p>\n                      )}\n                    </div>\n                  )}\n                </CardContent>\n              </Card>\n            )}\n\n            {/* Mile Splits */}\n            {activeSession.splits.length > 0 && (\n              <Card className=\"bg-gradient-to-br from-gray-900 to-black border border-red-500/50 shadow-xl shadow-red-500/20\">\n                <CardHeader>\n                  <CardTitle className=\"flex items-center text-2xl font-bold text-red-400\">\n                    <Gauge className=\"mr-3 text-red-500 animate-spin\" size={28} />\n                    🔥 SPEED DEMON SPLITS 💨\n                  </CardTitle>\n                </CardHeader>\n                <CardContent>\n                  <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4\">\n                    {activeSession.splits.map((split, index) => (\n                      <div\n                        key={split.id}\n                        className=\"bg-gradient-to-br from-red-900 to-black rounded-lg p-4 text-center border border-red-500/40 shadow-lg hover:shadow-red-500/30 transition-all duration-300\"\n                      >\n                        <p className=\"text-lg font-bold text-red-300 mb-2\">\n                          🏃‍♂️ MILE {split.mileNumber} 🔥\n                        </p>\n                        <p className=\"text-3xl font-bold text-red-400 mb-2 font-mono\">\n                          {formatTime(split.splitTime)}\n                        </p>\n                        <p className=\"text-sm text-red-300 font-semibold\">\n                          ⚡ PACE: {formatPace(split.pace)}/mile\n                        </p>\n                        {index === activeSession.splits.indexOf(activeSession.splits.reduce((fastest, current) => \n                          current.pace < fastest.pace ? current : fastest\n                        )) && activeSession.splits.length > 1 && (\n                          <div className=\"text-sm text-yellow-400 font-bold mt-2 animate-pulse\">\n                            💫 FASTEST SPLIT! 💫\n                          </div>\n                        )}\n                      </div>\n                    ))}\n                  </div>\n                </CardContent>\n              </Card>\n            )}\n\n            {/* Session Stats */}\n            <div className=\"grid grid-cols-2 md:grid-cols-4 gap-4\">\n              <Card className=\"bg-gradient-to-br from-red-900 to-black border border-red-500/40 shadow-lg\">\n                <CardContent className=\"pt-6 text-center\">\n                  <MapPin className=\"mx-auto mb-2 text-red-400 animate-pulse\" size={28} />\n                  <p className=\"text-3xl font-bold text-red-400 font-mono\">\n                    {activeSession.splits.length}\n                  </p>\n                  <p className=\"text-sm text-red-300 font-bold\">🏁 MILES CRUSHED</p>\n                </CardContent>\n              </Card>\n              \n              <Card className=\"bg-gradient-to-br from-red-900 to-black border border-red-500/40 shadow-lg\">\n                <CardContent className=\"pt-6 text-center\">\n                  <Gauge className=\"mx-auto mb-2 text-red-400 animate-spin\" size={28} />\n                  <p className=\"text-3xl font-bold text-red-400 font-mono\">\n                    {getCurrentPace()}\n                  </p>\n                  <p className=\"text-sm text-red-300 font-bold\">⚡ CURRENT SPEED</p>\n                </CardContent>\n              </Card>\n              \n              <Card className=\"bg-gradient-to-br from-red-900 to-black border border-red-500/40 shadow-lg\">\n                <CardContent className=\"pt-6 text-center\">\n                  <Trophy className=\"mx-auto mb-2 text-yellow-400 animate-bounce\" size={28} />\n                  <p className=\"text-3xl font-bold text-yellow-400 font-mono\">\n                    {activeSession.splits.length > 0 \n                      ? formatPace(Math.min(...activeSession.splits.map(s => s.pace)))\n                      : \"--:--\"\n                    }\n                  </p>\n                  <p className=\"text-sm text-yellow-300 font-bold\">💫 BEAST MILE</p>\n                </CardContent>\n              </Card>\n              \n              <Card className=\"bg-gradient-to-br from-red-900 to-black border border-red-500/40 shadow-lg\">\n                <CardContent className=\"pt-6 text-center\">\n                  <Flame className=\"mx-auto mb-2 text-red-500 animate-pulse\" size={28} />\n                  <p className=\"text-3xl font-bold text-red-400 font-mono\">\n                    {currentMile}\n                  </p>\n                  <p className=\"text-sm text-red-300 font-bold\">🔥 NEXT TARGET</p>\n                </CardContent>\n              </Card>\n            </div>\n          </div>\n        )}\n      </div>\n    </div>\n    </FeatureGate>\n  );\n}","size_bytes":36347},"client/src/pages/meal-plans.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { useQuery, useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport { Clock, Users, Target, TrendingUp, TrendingDown, Calendar, ChefHat, Sparkles, Settings, ChevronDown, ChevronUp, Heart } from \"lucide-react\";\nimport { FoodPreferences } from \"@/components/food-preferences\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport { Alert, AlertDescription } from \"@/components/ui/alert\";\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogTrigger } from \"@/components/ui/dialog\";\nimport { Form, FormControl, FormField, FormItem, FormLabel, FormMessage } from \"@/components/ui/form\";\nimport { Input } from \"@/components/ui/input\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { Textarea } from \"@/components/ui/textarea\";\nimport { Checkbox } from \"@/components/ui/checkbox\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { useForm } from \"react-hook-form\";\nimport { zodResolver } from \"@hookform/resolvers/zod\";\nimport { z } from \"zod\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport FeatureGate from \"@/components/feature-gate\";\nimport type { MealPlanWithDetails, UserMealPlanWithDetails, UserMealPreferences } from \"@shared/schema\";\nimport { PageMedicalDisclaimer, AIGeneratedDisclaimer } from \"@/components/medical-disclaimer\";\nimport { HealthSources } from \"@/components/health-sources\";\n\nconst mealPlanGenerationSchema = z.object({\n  goal: z.enum([\"weight_loss\", \"weight_gain\", \"maintenance\"]),\n  dailyCalories: z.number().min(1200).max(4000),\n  dietaryRestrictions: z.array(z.string()).optional(),\n  allergies: z.array(z.string()).optional(),\n  preferences: z.array(z.string()).optional(),\n  duration: z.number().min(3).max(14).default(7),\n});\n\ntype MealPlanGenerationForm = z.infer<typeof mealPlanGenerationSchema>;\n\nexport default function MealPlans() {\n  const [selectedPlan, setSelectedPlan] = useState<MealPlanWithDetails | null>(null);\n  const [selectedDay, setSelectedDay] = useState(1);\n  const [showAIDialog, setShowAIDialog] = useState(false);\n  const [showFoodPreferences, setShowFoodPreferences] = useState(false);\n  const [expandedIngredients, setExpandedIngredients] = useState<Set<string>>(new Set());\n  const [activeTab, setActiveTab] = useState<string>(\"plans\");\n  const [selectedPlanId, setSelectedPlanId] = useState<string>(\"\");\n  \n  const { toast } = useToast();\n  const queryClient = useQueryClient();\n\n  // Fetch meal plans\n  const { data: mealPlans = [], isLoading } = useQuery<MealPlanWithDetails[]>({\n    queryKey: [\"/api/meal-plans\"],\n  });\n\n  // Fetch user's current meal plan\n  const { data: userMealPlan } = useQuery<UserMealPlanWithDetails>({\n    queryKey: [\"/api/user-meal-plan\"],\n    retry: false,\n  });\n\n  // Fetch user meal preferences\n  const { data: userPreferences } = useQuery<UserMealPreferences>({\n    queryKey: [\"/api/user-meal-preferences\"],\n    retry: false,\n  });\n\n  // Fetch user food preferences to check if they exist\n  const { data: userFoodPreferences = [] } = useQuery<any[]>({\n    queryKey: [\"/api/user-food-preferences\"],\n    retry: false,\n  });\n\n  // AI Meal Plan Generation Form\n  const form = useForm<MealPlanGenerationForm>({\n    resolver: zodResolver(mealPlanGenerationSchema),\n    defaultValues: {\n      goal: \"maintenance\",\n      dailyCalories: 2000,\n      dietaryRestrictions: [],\n      allergies: [],\n      preferences: [],\n      duration: 7,\n    },\n  });\n\n  // Update form when userPreferences loads\n  useEffect(() => {\n    if (userPreferences) {\n      form.reset({\n        goal: userPreferences.goal as \"weight_loss\" | \"weight_gain\" | \"maintenance\",\n        dailyCalories: userPreferences.dailyCalories,\n        dietaryRestrictions: userPreferences.dietaryRestrictions || [],\n        allergies: userPreferences.allergies || [],\n        preferences: userPreferences.preferences || [],\n        duration: 7,\n      });\n    }\n  }, [userPreferences, form]);\n\n  const assignMealPlanMutation = useMutation({\n    mutationFn: async (planId: string) => {\n      console.log(\"Assigning meal plan:\", planId);\n      const response = await apiRequest(\"POST\", \"/api/user-meal-plan\", {\n        mealPlanId: planId,\n        startDate: new Date().toISOString(),\n        isActive: true,\n      });\n      \n      return response.json();\n    },\n    onSuccess: (data) => {\n      console.log(\"Meal plan assigned successfully:\", data);\n      queryClient.invalidateQueries({ queryKey: [\"/api/user-meal-plan\"] });\n      toast({ \n        title: \"Meal Plan Assigned!\", \n        description: \"Your new meal plan is now active.\" \n      });\n    },\n    onError: (error: any) => {\n      console.error(\"Assignment error:\", error);\n      toast({ \n        title: \"Error\", \n        description: error.message || \"Failed to assign meal plan\", \n        variant: \"destructive\" \n      });\n    }\n  });\n\n  const generateMealPlanMutation = useMutation({\n    mutationFn: async (data: MealPlanGenerationForm) => {\n      const response = await apiRequest(\"POST\", \"/api/generate-meal-plan\", data);\n      return response.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/meal-plans\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/user-meal-plan\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/user-meal-preferences\"] });\n      setShowAIDialog(false);\n      form.reset();\n      toast({ \n        title: \"AI Meal Plan Generated!\", \n        description: \"Your personalized meal plan has been created and assigned.\" \n      });\n    },\n    onError: (error: any) => {\n      toast({ \n        title: \"Error\", \n        description: error.message || \"Failed to generate meal plan\", \n        variant: \"destructive\" \n      });\n    }\n  });\n\n  const generatePersonalizedMealPlanMutation = useMutation({\n    mutationFn: async (data: { goal: string; dailyCalories: number; duration?: number }) => {\n      const response = await apiRequest(\"POST\", \"/api/generate-personalized-meal-plan\", data);\n      return response.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/meal-plans\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/user-meal-plan\"] });\n      setShowFoodPreferences(false);\n      toast({ \n        title: \"Personalized Meal Plan Created!\", \n        description: \"Your meal plan has been generated based on your food preferences and is now active.\" \n      });\n    },\n    onError: (error: any) => {\n      toast({ \n        title: \"Error\", \n        description: error.message || \"Failed to generate personalized meal plan\", \n        variant: \"destructive\" \n      });\n    }\n  });\n\n  const filteredPlans = mealPlans;\n\n  const getGoalIcon = (goal: string) => {\n    switch (goal) {\n      case \"weight_loss\":\n        return <TrendingDown className=\"text-blue-500\" size={20} />;\n      case \"weight_gain\":\n        return <TrendingUp className=\"text-green-500\" size={20} />;\n      default:\n        return <Target className=\"text-gray-500\" size={20} />;\n    }\n  };\n\n  const getGoalColor = (goal: string) => {\n    switch (goal) {\n      case \"weight_loss\":\n        return \"bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-300\";\n      case \"weight_gain\":\n        return \"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-300\";\n      default:\n        return \"bg-gray-100 text-gray-800 dark:bg-gray-900 dark:text-gray-300\";\n    }\n  };\n\n  const formatGoalName = (goal: string) => {\n    return goal.replace(\"_\", \" \").replace(/\\b\\w/g, l => l.toUpperCase());\n  };\n\n  const getMealsByType = (day: any, type: string) => {\n    return day.meals.filter((meal: any) => meal.mealType === type);\n  };\n\n  const handleAssignPlan = (planId: string) => {\n    assignMealPlanMutation.mutate(planId);\n  };\n\n  const onSubmitAIMealPlan = (data: MealPlanGenerationForm) => {\n    generateMealPlanMutation.mutate(data);\n  };\n\n  const handleFoodPreferencesComplete = (preferences: any[], estimatedCalories: number = 2000) => {\n    // Default values\n    const defaultGoal = \"maintenance\";\n    const defaultDuration = 7;\n\n    generatePersonalizedMealPlanMutation.mutate({\n      goal: defaultGoal,\n      dailyCalories: estimatedCalories,\n      duration: defaultDuration\n    });\n  };\n\n  const toggleIngredients = (mealId: string) => {\n    setExpandedIngredients(prev => {\n      const newSet = new Set(prev);\n      if (newSet.has(mealId)) {\n        newSet.delete(mealId);\n      } else {\n        newSet.add(mealId);\n      }\n      return newSet;\n    });\n  };\n\n  if (isLoading) {\n    return (\n      <div className=\"min-h-screen bg-gray-50 dark:bg-gray-900 flex items-center justify-center\">\n        <div className=\"animate-spin w-8 h-8 border-4 border-primary border-t-transparent rounded-full\" />\n      </div>\n    );\n  }\n\n  return (\n    <FeatureGate feature=\"meal_plans\">\n      <div className=\"min-h-screen bg-gray-50 dark:bg-gray-900\">\n      <div className=\"max-w-6xl mx-auto px-3 sm:px-4 py-4 pb-20 md:pb-8\">\n        <div className=\"text-center mb-6\">\n          <h1 className=\"text-2xl font-bold text-gray-900 dark:text-white mb-1\">Meal Plans</h1>\n          <p className=\"text-sm text-gray-600 dark:text-gray-400\">Choose a meal plan to support your fitness goals</p>\n        </div>\n\n        <PageMedicalDisclaimer type=\"nutrition\" />\n\n        {/* Main Tabs */}\n        <Tabs value={activeTab} onValueChange={setActiveTab} className=\"space-y-6\">\n          <TabsList className=\"grid w-full grid-cols-3 max-w-2xl mx-auto\">\n            <TabsTrigger value=\"plans\">Available Plans</TabsTrigger>\n            <TabsTrigger value=\"current\">My Current Plan</TabsTrigger>\n            <TabsTrigger value=\"preferences\" className=\"flex items-center gap-2\">\n              <Heart className=\"w-4 h-4\" />\n              Food Preferences\n            </TabsTrigger>\n          </TabsList>\n\n          {/* Available Plans Tab */}\n          <TabsContent value=\"plans\" className=\"space-y-6\">\n            <div className=\"flex justify-center\">\n              <Dialog open={showAIDialog} onOpenChange={setShowAIDialog}>\n                <DialogTrigger asChild>\n                  <Button className=\"bg-gradient-to-r from-purple-600 to-blue-600 hover:from-purple-700 hover:to-blue-700 text-white\" data-testid=\"generate-ai-meal-plan\">\n                    <Sparkles className=\"w-4 h-4 mr-2\" />\n                    Generate AI Meal Plan\n                  </Button>\n                </DialogTrigger>\n                <DialogContent className=\"max-w-2xl max-h-[90vh] overflow-y-auto\">\n              <DialogHeader>\n                <DialogTitle>Generate Personalized Meal Plan</DialogTitle>\n              </DialogHeader>\n              <AIGeneratedDisclaimer />\n              <Form {...form}>\n                <form onSubmit={form.handleSubmit(onSubmitAIMealPlan)} className=\"space-y-6\">\n                  {userFoodPreferences.length > 0 && (\n                    <Alert className=\"bg-blue-50 dark:bg-blue-950 border-blue-200 dark:border-blue-800\">\n                      <Heart className=\"h-4 w-4 text-blue-600 dark:text-blue-400\" />\n                      <AlertDescription className=\"text-blue-800 dark:text-blue-200\">\n                        Your saved food preferences will be automatically incorporated into this meal plan.\n                      </AlertDescription>\n                    </Alert>\n                  )}\n                  <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                    <FormField\n                      control={form.control}\n                      name=\"goal\"\n                      render={({ field }) => (\n                        <FormItem>\n                          <FormLabel>Fitness Goal</FormLabel>\n                          <Select onValueChange={field.onChange} defaultValue={field.value}>\n                            <FormControl>\n                              <SelectTrigger>\n                                <SelectValue placeholder=\"Select your goal\" />\n                              </SelectTrigger>\n                            </FormControl>\n                            <SelectContent>\n                              <SelectItem value=\"weight_loss\">Weight Loss</SelectItem>\n                              <SelectItem value=\"weight_gain\">Weight Gain</SelectItem>\n                              <SelectItem value=\"maintenance\">Maintenance</SelectItem>\n                            </SelectContent>\n                          </Select>\n                          <FormMessage />\n                        </FormItem>\n                      )}\n                    />\n                    <FormField\n                      control={form.control}\n                      name=\"dailyCalories\"\n                      render={({ field }) => (\n                        <FormItem>\n                          <FormLabel>Daily Calories</FormLabel>\n                          <FormControl>\n                            <Input \n                              type=\"number\" \n                              placeholder=\"2000\" \n                              {...field}\n                              onChange={(e) => field.onChange(parseInt(e.target.value) || 0)}\n                            />\n                          </FormControl>\n                          <FormMessage />\n                        </FormItem>\n                      )}\n                    />\n                  </div>\n                  <FormField\n                    control={form.control}\n                    name=\"duration\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel>Plan Duration (days)</FormLabel>\n                        <FormControl>\n                          <Input \n                            type=\"number\" \n                            placeholder=\"7\" \n                            {...field}\n                            onChange={(e) => field.onChange(parseInt(e.target.value) || 7)}\n                          />\n                        </FormControl>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n                  <FormField\n                    control={form.control}\n                    name=\"dietaryRestrictions\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel>Dietary Restrictions</FormLabel>\n                        <FormControl>\n                          <Textarea \n                            placeholder=\"e.g., vegetarian, gluten-free, dairy-free (separate with commas)\"\n                            value={field.value?.join(\", \") || \"\"}\n                            onChange={(e) => field.onChange(e.target.value.split(\",\").map(s => s.trim()).filter(Boolean))}\n                          />\n                        </FormControl>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n                  <FormField\n                    control={form.control}\n                    name=\"allergies\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel>Allergies</FormLabel>\n                        <FormControl>\n                          <Textarea \n                            placeholder=\"e.g., nuts, shellfish, eggs (separate with commas)\"\n                            value={field.value?.join(\", \") || \"\"}\n                            onChange={(e) => field.onChange(e.target.value.split(\",\").map(s => s.trim()).filter(Boolean))}\n                          />\n                        </FormControl>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n                  <FormField\n                    control={form.control}\n                    name=\"preferences\"\n                    render={({ field }) => (\n                      <FormItem>\n                        <FormLabel>Food Preferences</FormLabel>\n                        <FormControl>\n                          <Textarea \n                            placeholder=\"e.g., Mediterranean, low-carb, high-protein (separate with commas)\"\n                            value={field.value?.join(\", \") || \"\"}\n                            onChange={(e) => field.onChange(e.target.value.split(\",\").map(s => s.trim()).filter(Boolean))}\n                          />\n                        </FormControl>\n                        <FormMessage />\n                      </FormItem>\n                    )}\n                  />\n                  <div className=\"flex justify-end space-x-2\">\n                    <Button type=\"button\" variant=\"outline\" onClick={() => setShowAIDialog(false)}>\n                      Cancel\n                    </Button>\n                    <Button type=\"submit\" disabled={generateMealPlanMutation.isPending}>\n                      {generateMealPlanMutation.isPending ? (\n                        <>\n                          <div className=\"w-4 h-4 border-2 border-current border-t-transparent rounded-full animate-spin mr-2\" />\n                          Generating...\n                        </>\n                      ) : (\n                        <>\n                          <Sparkles className=\"w-4 h-4 mr-2\" />\n                          Generate Meal Plan\n                        </>\n                      )}\n                    </Button>\n                  </div>\n                </form>\n              </Form>\n            </DialogContent>\n          </Dialog>\n        </div>\n\n        {/* Current Meal Plan */}\n        {userMealPlan && (\n          <Card className=\"mb-8 border-primary dark:border-primary\">\n            <CardHeader>\n              <CardTitle className=\"flex items-center\">\n                <ChefHat className=\"mr-2\" size={20} />\n                Your Active Meal Plan\n              </CardTitle>\n            </CardHeader>\n            <CardContent>\n              <div className=\"flex items-center justify-between\">\n                <div>\n                  <h3 className=\"text-lg font-semibold\">{userMealPlan.mealPlan.name}</h3>\n                  <p className=\"text-sm text-gray-600 dark:text-gray-400 mt-1\">\n                    {userMealPlan.mealPlan.description}\n                  </p>\n                  <div className=\"flex items-center mt-3 space-x-4\">\n                    <Badge className={getGoalColor(userMealPlan.mealPlan.goal)}>\n                      {formatGoalName(userMealPlan.mealPlan.goal)}\n                    </Badge>\n                    <span className=\"text-sm text-gray-600 dark:text-gray-400\">\n                      {userMealPlan.mealPlan.dailyCalories} cal/day\n                    </span>\n                  </div>\n                </div>\n                <Button \n                  onClick={() => setSelectedPlan(userMealPlan.mealPlan)} \n                  variant=\"outline\"\n                >\n                  View Details\n                </Button>\n              </div>\n            </CardContent>\n          </Card>\n        )}\n\n        {/* Meal Plan Selector */}\n        <div className=\"max-w-2xl mx-auto mb-8\">\n          <Select value={selectedPlanId} onValueChange={(value) => {\n            setSelectedPlanId(value);\n            const plan = filteredPlans.find(p => p.id === value);\n            if (plan) {\n              setSelectedPlan(plan);\n            }\n          }}>\n            <SelectTrigger className=\"w-full\" data-testid=\"select-meal-plan\">\n              <SelectValue placeholder=\"Select a meal plan\" />\n            </SelectTrigger>\n            <SelectContent>\n              {filteredPlans.map((plan) => (\n                <SelectItem key={plan.id} value={plan.id}>\n                  {plan.name}\n                </SelectItem>\n              ))}\n            </SelectContent>\n          </Select>\n        </div>\n\n        {/* Selected Plan Details */}\n        {selectedPlanId && filteredPlans.find(p => p.id === selectedPlanId) && (\n          <Card className=\"max-w-4xl mx-auto\">\n            <CardHeader>\n              <div className=\"flex items-center justify-between\">\n                <div className=\"flex items-center\">\n                  {getGoalIcon(filteredPlans.find(p => p.id === selectedPlanId)!.goal)}\n                  <CardTitle className=\"ml-2\">{filteredPlans.find(p => p.id === selectedPlanId)!.name}</CardTitle>\n                </div>\n                <Badge className={getGoalColor(filteredPlans.find(p => p.id === selectedPlanId)!.goal)} variant=\"secondary\">\n                  {formatGoalName(filteredPlans.find(p => p.id === selectedPlanId)!.goal)}\n                </Badge>\n              </div>\n            </CardHeader>\n            <CardContent className=\"space-y-6\">\n              <p className=\"text-gray-600 dark:text-gray-400\">\n                {filteredPlans.find(p => p.id === selectedPlanId)!.description}\n              </p>\n              \n              <div className=\"grid grid-cols-2 md:grid-cols-4 gap-4\">\n                <div className=\"text-center p-4 bg-gray-50 dark:bg-gray-800 rounded-lg\">\n                  <div className=\"text-2xl font-bold text-primary\">{filteredPlans.find(p => p.id === selectedPlanId)!.dailyCalories}</div>\n                  <div className=\"text-sm text-gray-600 dark:text-gray-400\">Calories/day</div>\n                </div>\n                <div className=\"text-center p-4 bg-gray-50 dark:bg-gray-800 rounded-lg\">\n                  <div className=\"text-2xl font-bold text-green-600\">{filteredPlans.find(p => p.id === selectedPlanId)!.dailyProtein}g</div>\n                  <div className=\"text-sm text-gray-600 dark:text-gray-400\">Protein/day</div>\n                </div>\n                <div className=\"text-center p-4 bg-gray-50 dark:bg-gray-800 rounded-lg\">\n                  <div className=\"text-2xl font-bold text-blue-600\">{filteredPlans.find(p => p.id === selectedPlanId)!.dailyCarbs}g</div>\n                  <div className=\"text-sm text-gray-600 dark:text-gray-400\">Carbs/day</div>\n                </div>\n                <div className=\"text-center p-4 bg-gray-50 dark:bg-gray-800 rounded-lg\">\n                  <div className=\"text-2xl font-bold text-orange-600\">{filteredPlans.find(p => p.id === selectedPlanId)!.dailyFat}g</div>\n                  <div className=\"text-sm text-gray-600 dark:text-gray-400\">Fat/day</div>\n                </div>\n              </div>\n\n              <div className=\"flex space-x-3\">\n                <Button\n                  onClick={() => setSelectedPlan(filteredPlans.find(p => p.id === selectedPlanId)!)}\n                  variant=\"outline\"\n                  className=\"flex-1\"\n                  data-testid=\"button-view-details\"\n                >\n                  View Full Details\n                </Button>\n                <Button\n                  onClick={() => handleAssignPlan(selectedPlanId)}\n                  disabled={assignMealPlanMutation.isPending || userMealPlan?.mealPlanId === selectedPlanId}\n                  className=\"flex-1\"\n                  data-testid=\"button-start-plan\"\n                >\n                  {userMealPlan?.mealPlanId === selectedPlanId ? \"Active Plan\" : \"Start This Plan\"}\n                </Button>\n              </div>\n            </CardContent>\n          </Card>\n        )}\n\n        {/* Meal Plan Details Dialog */}\n        <Dialog open={!!selectedPlan} onOpenChange={() => setSelectedPlan(null)}>\n          <DialogContent className=\"max-w-4xl max-h-[80vh] overflow-y-auto\">\n            {selectedPlan && (\n              <>\n                <DialogHeader>\n                  <DialogTitle className=\"flex items-center\">\n                    {getGoalIcon(selectedPlan.goal)}\n                    <span className=\"ml-2\">{selectedPlan.name}</span>\n                  </DialogTitle>\n                </DialogHeader>\n                \n                <div className=\"space-y-6\">\n                  <div>\n                    <p className=\"text-gray-600 dark:text-gray-400 mb-4\">\n                      {selectedPlan.description}\n                    </p>\n                    \n                    <div className=\"grid grid-cols-2 md:grid-cols-4 gap-4 mb-6\">\n                      <div className=\"text-center\">\n                        <div className=\"text-2xl font-bold text-primary\">{selectedPlan.dailyCalories}</div>\n                        <div className=\"text-xs text-gray-600 dark:text-gray-400\">Calories/day</div>\n                      </div>\n                      <div className=\"text-center\">\n                        <div className=\"text-2xl font-bold text-green-600\">{selectedPlan.dailyProtein}g</div>\n                        <div className=\"text-xs text-gray-600 dark:text-gray-400\">Protein/day</div>\n                      </div>\n                      <div className=\"text-center\">\n                        <div className=\"text-2xl font-bold text-blue-600\">{selectedPlan.dailyCarbs}g</div>\n                        <div className=\"text-xs text-gray-600 dark:text-gray-400\">Carbs/day</div>\n                      </div>\n                      <div className=\"text-center\">\n                        <div className=\"text-2xl font-bold text-orange-600\">{selectedPlan.dailyFat}g</div>\n                        <div className=\"text-xs text-gray-600 dark:text-gray-400\">Fat/day</div>\n                      </div>\n                    </div>\n                  </div>\n\n                  {/* Day Selector */}\n                  <div>\n                    <div className=\"flex items-center mb-4\">\n                      <Calendar className=\"mr-2\" size={20} />\n                      <span className=\"font-semibold\">Daily Meal Plan</span>\n                    </div>\n                    \n                    <div className=\"flex flex-wrap gap-2 mb-6\">\n                      {selectedPlan.days.map((day) => (\n                        <Button\n                          key={day.id}\n                          variant={selectedDay === day.dayNumber ? \"default\" : \"outline\"}\n                          size=\"sm\"\n                          onClick={() => setSelectedDay(day.dayNumber)}\n                        >\n                          {day.name}\n                        </Button>\n                      ))}\n                    </div>\n                  </div>\n\n                  {/* Meals for Selected Day */}\n                  {selectedPlan.days\n                    .filter(day => day.dayNumber === selectedDay)\n                    .map(day => (\n                      <div key={day.id} className=\"space-y-4\">\n                        {[\"breakfast\", \"lunch\", \"dinner\", \"snack\"].map(mealType => {\n                          const meals = getMealsByType(day, mealType);\n                          if (meals.length === 0) return null;\n                          \n                          return (\n                            <div key={mealType} className=\"border rounded-lg p-4 dark:border-gray-700\">\n                              <h4 className=\"font-semibold text-lg mb-3 capitalize\">\n                                {mealType}\n                              </h4>\n                              <div className=\"grid md:grid-cols-2 gap-4\">\n                                {meals.map((meal: any) => (\n                                  <div key={meal.id} className=\"bg-gray-50 dark:bg-gray-800 rounded-lg p-4\">\n                                    {/* Meal Image */}\n                                    {meal.imageUrl && (\n                                      <div className=\"mb-3 rounded-lg overflow-hidden\">\n                                        <img \n                                          src={meal.imageUrl} \n                                          alt={meal.name}\n                                          className=\"w-full h-40 object-cover\"\n                                          loading=\"lazy\"\n                                          data-testid={`meal-image-${meal.id}`}\n                                        />\n                                      </div>\n                                    )}\n                                    \n                                    <div className=\"flex items-center justify-between mb-2\">\n                                      <h5 className=\"font-medium\">{meal.name}</h5>\n                                      {meal.prepTime && (\n                                        <Badge variant=\"outline\" className=\"text-xs\">\n                                          <Clock size={12} className=\"mr-1\" />\n                                          {meal.prepTime}min\n                                        </Badge>\n                                      )}\n                                    </div>\n                                    \n                                    <p className=\"text-sm text-gray-600 dark:text-gray-400 mb-3\">\n                                      {meal.description}\n                                    </p>\n                                    \n                                    <div className=\"grid grid-cols-4 gap-2 text-xs mb-3\">\n                                      <div className=\"text-center\">\n                                        <div className=\"font-semibold\">{meal.calories}</div>\n                                        <div className=\"text-gray-500\">cal</div>\n                                      </div>\n                                      <div className=\"text-center\">\n                                        <div className=\"font-semibold\">{meal.protein}g</div>\n                                        <div className=\"text-gray-500\">protein</div>\n                                      </div>\n                                      <div className=\"text-center\">\n                                        <div className=\"font-semibold\">{meal.carbs}g</div>\n                                        <div className=\"text-gray-500\">carbs</div>\n                                      </div>\n                                      <div className=\"text-center\">\n                                        <div className=\"font-semibold\">{meal.fat}g</div>\n                                        <div className=\"text-gray-500\">fat</div>\n                                      </div>\n                                    </div>\n                                    \n                                    <div className=\"space-y-2\">\n                                      <div>\n                                        <button\n                                          onClick={() => toggleIngredients(meal.id)}\n                                          className=\"flex items-center justify-between w-full text-left hover:bg-gray-100 dark:hover:bg-gray-700 rounded p-1 transition-colors\"\n                                          data-testid={`ingredients-toggle-${meal.id}`}\n                                        >\n                                          <h6 className=\"text-xs font-semibold text-gray-700 dark:text-gray-300\">\n                                            Ingredients ({meal.ingredients.length})\n                                          </h6>\n                                          {expandedIngredients.has(meal.id) ? (\n                                            <ChevronUp size={14} className=\"text-gray-500\" />\n                                          ) : (\n                                            <ChevronDown size={14} className=\"text-gray-500\" />\n                                          )}\n                                        </button>\n                                        {expandedIngredients.has(meal.id) ? (\n                                          // Show all ingredients with images when expanded\n                                          <div className=\"grid grid-cols-2 gap-2 mt-2\">\n                                            {meal.ingredients.map((ingredient: string, idx: number) => (\n                                              <div key={idx} className=\"flex items-center gap-2 p-2 bg-white dark:bg-gray-900 rounded\">\n                                                {meal.ingredientImages && meal.ingredientImages[ingredient] && (\n                                                  <img \n                                                    src={meal.ingredientImages[ingredient]} \n                                                    alt={ingredient}\n                                                    className=\"w-10 h-10 rounded object-cover flex-shrink-0\"\n                                                    loading=\"lazy\"\n                                                    data-testid={`ingredient-image-${idx}`}\n                                                    onError={(e) => {\n                                                      // Hide image if it fails to load\n                                                      e.currentTarget.style.display = 'none';\n                                                    }}\n                                                  />\n                                                )}\n                                                <span className=\"text-xs text-gray-700 dark:text-gray-300\">{ingredient}</span>\n                                              </div>\n                                            ))}\n                                          </div>\n                                        ) : (\n                                          // Show only first 3 when collapsed\n                                          <ul className=\"text-xs text-gray-600 dark:text-gray-400\">\n                                            {meal.ingredients.slice(0, 3).map((ingredient: string, idx: number) => (\n                                              <li key={idx} className=\"py-0.5 flex items-center gap-2\">\n                                                {meal.ingredientImages && meal.ingredientImages[ingredient] && (\n                                                  <img \n                                                    src={meal.ingredientImages[ingredient]} \n                                                    alt={ingredient}\n                                                    className=\"w-6 h-6 rounded object-cover inline-block\"\n                                                    loading=\"lazy\"\n                                                    onError={(e) => {\n                                                      e.currentTarget.style.display = 'none';\n                                                    }}\n                                                  />\n                                                )}\n                                                <span>• {ingredient}</span>\n                                              </li>\n                                            ))}\n                                            {meal.ingredients.length > 3 && (\n                                              <li className=\"py-0.5 italic text-blue-600 dark:text-blue-400\">\n                                                • Click to see {meal.ingredients.length - 3} more ingredients...\n                                              </li>\n                                            )}\n                                          </ul>\n                                        )}\n                                      </div>\n                                    </div>\n                                  </div>\n                                ))}\n                              </div>\n                            </div>\n                          );\n                        })}\n                      </div>\n                    ))}\n\n                  <div className=\"flex justify-end space-x-3 pt-4 border-t dark:border-gray-700\">\n                    <Button\n                      variant=\"outline\"\n                      onClick={() => setSelectedPlan(null)}\n                    >\n                      Close\n                    </Button>\n                    <Button\n                      onClick={() => handleAssignPlan(selectedPlan.id)}\n                      disabled={assignMealPlanMutation.isPending || userMealPlan?.mealPlanId === selectedPlan.id}\n                    >\n                      {userMealPlan?.mealPlanId === selectedPlan.id ? \"Currently Active\" : \"Start This Plan\"}\n                    </Button>\n                  </div>\n                </div>\n              </>\n            )}\n          </DialogContent>\n        </Dialog>\n        \n        <HealthSources />\n          </TabsContent>\n\n          {/* Current Plan Tab */}\n          <TabsContent value=\"current\" className=\"space-y-6\">\n            {userMealPlan ? (\n              <Card>\n                <CardContent className=\"p-6\">\n                  <div className=\"flex items-center justify-between\">\n                    <div>\n                      <h3 className=\"text-lg font-semibold\">{userMealPlan.mealPlan.name}</h3>\n                      <p className=\"text-sm text-gray-600 dark:text-gray-400 mt-1\">\n                        {userMealPlan.mealPlan.description}\n                      </p>\n                      <div className=\"flex items-center mt-3 space-x-4\">\n                        <Badge className={getGoalColor(userMealPlan.mealPlan.goal)}>\n                          {formatGoalName(userMealPlan.mealPlan.goal)}\n                        </Badge>\n                        <span className=\"text-sm text-gray-600 dark:text-gray-400\">\n                          {userMealPlan.mealPlan.dailyCalories} cal/day\n                        </span>\n                      </div>\n                    </div>\n                    <Button \n                      onClick={() => setSelectedPlan(userMealPlan.mealPlan)} \n                      variant=\"outline\"\n                    >\n                      View Details\n                    </Button>\n                  </div>\n                </CardContent>\n              </Card>\n            ) : (\n              <Card>\n                <CardContent className=\"p-6 text-center\">\n                  <ChefHat className=\"w-12 h-12 text-gray-400 mx-auto mb-4\" />\n                  <h3 className=\"text-lg font-semibold mb-2\">No Active Meal Plan</h3>\n                  <p className=\"text-gray-600 dark:text-gray-400 mb-4\">\n                    You don't have an active meal plan yet. Browse our meal plans or create a personalized one based on your food preferences.\n                  </p>\n                  <div className=\"space-x-3\">\n                    <Button onClick={() => setShowAIDialog(true)} data-testid=\"button-generate-ai-plan\">\n                      Generate AI Plan\n                    </Button>\n                    <Button variant=\"outline\" onClick={() => setActiveTab(\"preferences\")} data-testid=\"button-set-food-preferences\">\n                      Set Food Preferences\n                    </Button>\n                  </div>\n                </CardContent>\n              </Card>\n            )}\n            \n            <HealthSources />\n          </TabsContent>\n\n          {/* Food Preferences Tab */}\n          <TabsContent value=\"preferences\" className=\"space-y-6\">\n            <Card>\n              <CardContent className=\"p-6\">\n                <FoodPreferences \n                  onComplete={handleFoodPreferencesComplete}\n                  showCalorieCalculator={true}\n                />\n                {generatePersonalizedMealPlanMutation.isPending && (\n                  <div className=\"mt-6 text-center\">\n                    <div className=\"animate-spin w-8 h-8 border-4 border-primary border-t-transparent rounded-full mx-auto mb-4\" />\n                    <p className=\"text-gray-600 dark:text-gray-400\">\n                      Generating your personalized meal plan based on your food preferences...\n                    </p>\n                  </div>\n                )}\n              </CardContent>\n            </Card>\n          </TabsContent>\n        </Tabs>\n      </div>\n    </div>\n    </FeatureGate>\n  );\n}","size_bytes":39811},"client/src/components/ui/aspect-ratio.tsx":{"content":"import * as AspectRatioPrimitive from \"@radix-ui/react-aspect-ratio\"\n\nconst AspectRatio = AspectRatioPrimitive.Root\n\nexport { AspectRatio }\n","size_bytes":140},"replit.md":{"content":"# FlexFlow - Fitness and Wellness Application\n\n## Overview\n\nFlexFlow is a comprehensive fitness and wellness application built with React and Express. It combines workout tracking, trainer marketplace, AI-powered workout planning, and personalized meal planning into a unified platform. Users can log workouts, track progress, set goals, book personal trainers, and monitor nutrition through an intuitive dashboard.\n\n## Recent Enhancements (October 2025)\n\n### AI Workout Planner\n- **Personalized Exercise Plans**: AI generates specific exercises with sets, reps, rest periods, and form cues based on user goals\n- **Goal-Based Programming**: Different workout structures for weight loss, muscle gain, and general fitness\n- **Progressive 4-Week Plans**: Automatically increases difficulty over time\n- **Equipment Consideration**: Workouts tailored to available equipment (bodyweight, dumbbells, full gym, etc.)\n- **Injury Accommodation**: Avoids exercises that could aggravate user-specified limitations\n\n### AI Meal Plan Generator (Enhanced October 2025)\n- **Goal-Specific Meals**: AI generates distinctly different meals tailored to each goal\n  - **Weight Loss**: High-volume, low-calorie foods with lean proteins and vegetables (grilled chicken salads, vegetable stir-fries, egg white omelets)\n  - **Weight Gain**: Calorie-dense, nutrient-rich foods with healthy fats (pasta dishes, nut butters, smoothies, rice bowls, protein pancakes)\n  - **Maintenance**: Balanced meals with moderate portions and variety (mix of lean proteins, whole grains, healthy fats)\n- **Enhanced AI Prompts**: Explicit goal-specific guidelines with concrete food examples ensure proper differentiation\n- **Maximum Variety Constraint**: AI generates unique meals across full plan duration with no repetition\n- **Personalized Preferences**: Incorporates user food likes/dislikes when provided\n- **Macro-Optimized**: Different macro ratios per goal (higher protein for weight loss, higher carbs for weight gain)\n- **Goal-Specific Ingredient Lists**: Separate food databases for each goal (weight loss fats, weight gain fats, maintenance fats)\n\n### Content Moderation\n- **AI-Powered Filtering**: OpenAI moderation API prevents inappropriate text content in community posts\n- **Image Moderation**: Vision API scans uploaded images for inappropriate visual content\n- **Real-Time Protection**: Content is filtered before posting to maintain community standards\n\n### Apple App Store Connect Integration (November 2025)\n- **Native iOS Subscriptions**: Premium subscriptions handled through App Store Connect with official Apple library (@apple/app-store-server-library)\n- **Receipt Validation**: Backend API validates App Store receipts and syncs subscription status across devices\n- **Webhook Support**: Server Notifications endpoint handles subscription lifecycle events (renewals, expirations, cancellations, refunds)\n- **Transaction Tracking**: Stores Apple original transaction IDs to prevent duplicate subscriptions and enable cross-device sync\n- **Security**: Returns 503 when Apple credentials are missing; gracefully degrades functionality\n- **Required Environment Variables**:\n  - `APPLE_KEY_ID`: App Store Connect API key identifier\n  - `APPLE_ISSUER_ID`: App Store Connect issuer ID\n  - `APPLE_PRIVATE_KEY`: App Store Connect API private key (ES256 format)\n  - `APPLE_BUNDLE_ID`: iOS app bundle identifier (e.g., com.flexflow.app)\n  - `APPLE_APP_ID`: Numeric Apple app ID\n- **User Flow**: Web app directs users to download native iOS app for purchases; subscriptions automatically sync to web after purchase\n\n## User Preferences\n\nPreferred communication style: Simple, everyday language.\n\n## System Architecture\n\n### Frontend Architecture\n- **Framework**: React 18 with TypeScript for type safety and modern component patterns\n- **Routing**: Wouter for lightweight client-side routing\n- **State Management**: TanStack Query (React Query) for server state management and caching\n- **UI Components**: Radix UI primitives with custom Tailwind CSS styling using the shadcn/ui component system\n- **Styling**: Tailwind CSS with CSS variables for theming and responsive design\n- **Build Tool**: Vite for fast development and optimized production builds\n\n### Backend Architecture\n- **Runtime**: Node.js with Express.js framework\n- **Language**: TypeScript for type safety across the entire stack\n- **API Design**: RESTful API with JSON responses\n- **Error Handling**: Centralized error handling middleware with structured error responses\n- **Logging**: Custom request/response logging middleware for API monitoring\n\n### Data Storage Solutions\n- **Database**: PostgreSQL with Drizzle ORM for type-safe database operations\n- **Schema Management**: Drizzle Kit for database migrations and schema management\n- **Connection**: Neon Database serverless PostgreSQL for cloud hosting\n- **Development Storage**: In-memory storage implementation for development and testing\n\n### Database Schema Design\n- **Users**: Basic user information with streak tracking\n- **Exercises**: Comprehensive exercise catalog with categories, muscle groups, and equipment\n- **Workouts**: User workout sessions with duration, calories, and notes\n- **Workout Exercises**: Junction table linking workouts to specific exercises with sets, reps, weight, and duration\n- **Goals**: User-defined fitness goals with progress tracking\n\n### Authentication and Authorization\n- **Current Implementation**: Mock user system for development\n- **Session Management**: Express sessions with PostgreSQL session store (connect-pg-simple)\n- **Future Enhancement**: Ready for implementation of proper authentication system\n\n### UI/UX Design Patterns\n- **Design System**: Consistent component library based on shadcn/ui with Radix UI primitives\n- **Responsive Design**: Mobile-first approach with adaptive layouts for desktop and mobile\n- **Theme System**: CSS custom properties for consistent theming and dark mode support\n- **Accessibility**: WCAG-compliant components with proper ARIA labels and keyboard navigation\n\n### Development Tools and Configuration\n- **Type Safety**: Shared TypeScript schemas between frontend and backend\n- **Code Quality**: ESLint and TypeScript compiler for code validation\n- **Build Process**: Separate build processes for client and server with optimized bundling\n- **Development Environment**: Hot module replacement and error overlay for rapid development\n\n## External Dependencies\n\n### Database and Infrastructure\n- **Neon Database**: Serverless PostgreSQL database hosting\n- **Drizzle ORM**: Type-safe database ORM with PostgreSQL dialect\n- **Database Connection**: @neondatabase/serverless for optimized serverless connections\n\n### UI and Styling Framework\n- **Radix UI**: Comprehensive set of accessible UI primitives for React\n- **Tailwind CSS**: Utility-first CSS framework with PostCSS processing\n- **Lucide Icons**: Modern icon library for consistent iconography\n- **Class Variance Authority**: Type-safe utility for managing component variants\n\n### Data Fetching and State Management\n- **TanStack Query**: Powerful data synchronization for React applications\n- **React Hook Form**: Performant forms with easy validation\n- **Zod**: Schema validation for runtime type checking\n\n### Development and Build Tools\n- **Vite**: Next-generation frontend tooling for fast development and builds\n- **TypeScript**: Static type checking for JavaScript\n- **React DevTools**: Development tools integration for debugging\n- **ESBuild**: Fast JavaScript bundler for server-side code\n\n### Utility Libraries\n- **Date-fns**: Modern JavaScript date utility library\n- **clsx**: Utility for constructing className strings conditionally\n- **Nanoid**: Secure URL-friendly unique string ID generator\n- **Wouter**: Minimalist routing library for React applications\n\n### Chart and Visualization\n- **Chart.js**: External CDN-loaded charting library for progress visualization\n- **Recharts**: React chart components (included in dependencies but Chart.js used via CDN)","size_bytes":8002},"client/src/components/ui/button.tsx":{"content":"import * as React from \"react\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst buttonVariants = cva(\n  \"inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\",\n  {\n    variants: {\n      variant: {\n        default: \"bg-primary text-primary-foreground hover:bg-primary/90\",\n        destructive:\n          \"bg-destructive text-destructive-foreground hover:bg-destructive/90\",\n        outline:\n          \"border border-input bg-background hover:bg-accent hover:text-accent-foreground\",\n        secondary:\n          \"bg-secondary text-secondary-foreground hover:bg-secondary/80\",\n        ghost: \"hover:bg-accent hover:text-accent-foreground\",\n        link: \"text-primary underline-offset-4 hover:underline\",\n      },\n      size: {\n        default: \"h-10 px-4 py-2\",\n        sm: \"h-9 rounded-md px-3\",\n        lg: \"h-11 rounded-md px-8\",\n        icon: \"h-10 w-10\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  }\n)\n\nexport interface ButtonProps\n  extends React.ButtonHTMLAttributes<HTMLButtonElement>,\n    VariantProps<typeof buttonVariants> {\n  asChild?: boolean\n}\n\nconst Button = React.forwardRef<HTMLButtonElement, ButtonProps>(\n  ({ className, variant, size, asChild = false, ...props }, ref) => {\n    const Comp = asChild ? Slot : \"button\"\n    return (\n      <Comp\n        className={cn(buttonVariants({ variant, size, className }))}\n        ref={ref}\n        {...props}\n      />\n    )\n  }\n)\nButton.displayName = \"Button\"\n\nexport { Button, buttonVariants }\n","size_bytes":1901},"client/src/pages/landing.tsx":{"content":"import { Activity, Play, Users, Star, Clock, Shield, Target, BarChart3, Utensils, Brain, Dumbbell } from \"lucide-react\";\nimport { Button } from \"@/components/ui/button\";\n\nexport default function Landing() {\n  return (\n    <div className=\"relative min-h-screen bg-black hexagon-bg hexagon-pattern overflow-hidden\">\n      {/* Hexagonal background elements */}\n      <div className=\"fixed inset-0 pointer-events-none z-0\">\n        <div className=\"absolute top-20 left-10 w-32 h-28 opacity-20 animate-pulse\" style={{animationDuration: '6s'}}>\n          <svg viewBox=\"0 0 120 104\" className=\"w-full h-full\">\n            <polygon points=\"30,2 90,2 120,52 90,102 30,102 0,52\" fill=\"#dc2626\" stroke=\"#dc2626\" strokeWidth=\"2\" opacity=\"0.3\"/>\n          </svg>\n        </div>\n        <div className=\"absolute top-40 right-16 w-24 h-21 opacity-15 animate-bounce\" style={{animationDuration: '8s'}}>\n          <svg viewBox=\"0 0 120 104\" className=\"w-full h-full\">\n            <polygon points=\"30,2 90,2 120,52 90,102 30,102 0,52\" fill=\"none\" stroke=\"#dc2626\" strokeWidth=\"1\" opacity=\"0.4\"/>\n          </svg>\n        </div>\n        <div className=\"absolute top-96 left-1/4 w-28 h-24 opacity-25 animate-ping\" style={{animationDuration: '10s'}}>\n          <svg viewBox=\"0 0 120 104\" className=\"w-full h-full\">\n            <polygon points=\"30,2 90,2 120,52 90,102 30,102 0,52\" fill=\"#000000\" stroke=\"#dc2626\" strokeWidth=\"2\" opacity=\"0.6\"/>\n          </svg>\n        </div>\n        <div className=\"absolute bottom-80 right-1/3 w-20 h-17 opacity-30 animate-bounce\" style={{animationDuration: '7s'}}>\n          <svg viewBox=\"0 0 120 104\" className=\"w-full h-full\">\n            <polygon points=\"30,2 90,2 120,52 90,102 30,102 0,52\" fill=\"#dc2626\" stroke=\"#000000\" strokeWidth=\"1\" opacity=\"0.5\"/>\n          </svg>\n        </div>\n        <div className=\"absolute bottom-40 left-20 w-36 h-31 opacity-20 animate-pulse\" style={{animationDuration: '9s'}}>\n          <svg viewBox=\"0 0 120 104\" className=\"w-full h-full\">\n            <polygon points=\"30,2 90,2 120,52 90,102 30,102 0,52\" fill=\"none\" stroke=\"#dc2626\" strokeWidth=\"2\" opacity=\"0.3\"/>\n          </svg>\n        </div>\n        <div className=\"absolute top-1/3 right-1/4 w-26 h-22 opacity-15 animate-ping\" style={{animationDuration: '12s'}}>\n          <svg viewBox=\"0 0 120 104\" className=\"w-full h-full\">\n            <polygon points=\"30,2 90,2 120,52 90,102 30,102 0,52\" fill=\"#000000\" stroke=\"#dc2626\" strokeWidth=\"1\" opacity=\"0.4\"/>\n          </svg>\n        </div>\n      </div>\n      {/* Header */}\n      <header className=\"relative z-10 px-4 lg:px-6 h-14 flex items-center border-b bg-black/90 border-red-600/30 backdrop-blur\">\n        <div className=\"flex items-center space-x-2\">\n          <Activity className=\"text-red-600\" size={32} />\n          <h1 className=\"text-xl font-bold text-white\">FlexFlow</h1>\n        </div>\n        <div className=\"ml-auto\">\n          <Button asChild>\n            <a href=\"/auth-selection\">Sign In</a>\n          </Button>\n        </div>\n      </header>\n\n      {/* Hero Section */}\n      <main className=\"relative z-10 container mx-auto px-4 py-16\">\n        <div className=\"text-center space-y-8 max-w-4xl mx-auto\">\n          <h1 className=\"text-4xl md:text-6xl font-bold text-white\">\n            Your Complete\n            <span className=\"text-transparent bg-clip-text bg-gradient-to-r from-red-600 to-red-400 block\">\n              Fitness Journey\n            </span>\n            Starts Here\n          </h1>\n          \n          <p className=\"text-2xl font-bold text-black mb-4\">\n            Eat Clean, Think Smart, Train HARD!\n          </p>\n          \n          <p className=\"text-xl text-gray-300 max-w-3xl mx-auto leading-relaxed\">\n            FlexFlow is your all-in-one fitness companion featuring AI-powered workout recommendations, \n            personalized meal planning, progress tracking, and a supportive community to help you reach \n            your health and fitness goals faster than ever before.\n          </p>\n\n          <div className=\"space-y-4\">\n            <Button size=\"lg\" className=\"text-lg px-8 py-4\" asChild>\n              <a href=\"/onboarding\">\n                <Play className=\"mr-2\" size={20} />\n                Get Started Free\n              </a>\n            </Button>\n            <p className=\"text-sm text-gray-400\">7-day free trial</p>\n          </div>\n        </div>\n\n        {/* App Features Section */}\n        <div className=\"relative z-10 mt-20\">\n          <div className=\"text-center mb-16\">\n            <h2 className=\"text-3xl font-bold text-white mb-4\">Complete Fitness Ecosystem</h2>\n            <p className=\"text-xl text-gray-300 max-w-3xl mx-auto\">\n              Everything you need to transform your health and fitness journey in one powerful application\n            </p>\n          </div>\n\n          {/* Core Features Grid */}\n          <div className=\"grid md:grid-cols-2 lg:grid-cols-3 gap-8 mb-16\">\n            <div className=\"text-center p-6 rounded-2xl bg-black border border-red-600/30 shadow-lg shadow-red-600/20\">\n              <div className=\"w-16 h-16 bg-red-600/20 rounded-full flex items-center justify-center mx-auto mb-4\">\n                <Dumbbell className=\"text-red-600\" size={24} />\n              </div>\n              <h3 className=\"font-semibold text-lg mb-2 text-white\">Smart Workout Tracking</h3>\n              <p className=\"text-gray-300 text-sm\">\n                Log exercises with sets, reps, and weights. AI automatically adjusts workout difficulty \n                based on your performance and progress patterns.\n              </p>\n            </div>\n\n            <div className=\"text-center p-6 rounded-2xl bg-black border border-red-600/30 shadow-lg shadow-red-600/20\">\n              <div className=\"w-16 h-16 bg-red-600/20 rounded-full flex items-center justify-center mx-auto mb-4\">\n                <Brain className=\"text-red-600\" size={24} />\n              </div>\n              <h3 className=\"font-semibold text-lg mb-2 text-white\">AI-Powered Plans</h3>\n              <p className=\"text-gray-300 text-sm\">\n                Get personalized workout and nutrition plans based on your age, goals, fitness level, \n                and preferences. Plans adapt as you progress.\n              </p>\n            </div>\n\n            <div className=\"text-center p-6 rounded-2xl bg-black border border-red-600/30 shadow-lg shadow-red-600/20\">\n              <div className=\"w-16 h-16 bg-red-600/20 rounded-full flex items-center justify-center mx-auto mb-4\">\n                <BarChart3 className=\"text-red-600\" size={24} />\n              </div>\n              <h3 className=\"font-semibold text-lg mb-2 text-white\">Advanced Analytics</h3>\n              <p className=\"text-gray-300 text-sm\">\n                Track strength gains, endurance improvements, and body composition changes with \n                detailed charts and performance insights.\n              </p>\n            </div>\n\n            <div className=\"text-center p-6 rounded-2xl bg-black border border-red-600/30 shadow-lg shadow-red-600/20\">\n              <div className=\"w-16 h-16 bg-red-600/20 rounded-full flex items-center justify-center mx-auto mb-4\">\n                <Utensils className=\"text-red-600\" size={24} />\n              </div>\n              <h3 className=\"font-semibold text-lg mb-2 text-white\">Personalized Nutrition</h3>\n              <p className=\"text-gray-300 text-sm\">\n                Custom meal plans with calorie and macro tracking. Barcode scanner for easy food logging \n                and recipe recommendations based on your dietary goals.\n              </p>\n            </div>\n\n            <div className=\"text-center p-6 rounded-2xl bg-black border border-red-600/30 shadow-lg shadow-red-600/20\">\n              <div className=\"w-16 h-16 bg-red-600/20 rounded-full flex items-center justify-center mx-auto mb-4\">\n                <Clock className=\"text-red-600\" size={24} />\n              </div>\n              <h3 className=\"font-semibold text-lg mb-2 text-white\">Activity Tracking</h3>\n              <p className=\"text-gray-300 text-sm\">\n                Built-in mile tracker with GPS integration, workout timers, and comprehensive \n                activity monitoring for running, walking, and cardio sessions.\n              </p>\n            </div>\n\n            <div className=\"text-center p-6 rounded-2xl bg-black border border-red-600/30 shadow-lg shadow-red-600/20\">\n              <div className=\"w-16 h-16 bg-red-600/20 rounded-full flex items-center justify-center mx-auto mb-4\">\n                <Users className=\"text-red-600\" size={24} />\n              </div>\n              <h3 className=\"font-semibold text-lg mb-2 text-white\">Social Community</h3>\n              <p className=\"text-gray-300 text-sm\">\n                Connect with fitness enthusiasts, compete on leaderboards, share achievements, \n                and get motivated by a supportive community.\n              </p>\n            </div>\n          </div>\n\n          {/* Premium Features Section */}\n          <div className=\"bg-gradient-to-r from-red-600/10 to-red-800/10 rounded-2xl p-8 border border-red-600/20\">\n            <div className=\"text-center mb-8\">\n              <div className=\"w-16 h-16 bg-red-600/20 rounded-full flex items-center justify-center mx-auto mb-4\">\n                <Shield className=\"text-red-600\" size={32} />\n              </div>\n              <h3 className=\"text-2xl font-bold text-white mb-2\">Premium Features</h3>\n              <p className=\"text-gray-300\">Unlock the full potential of your fitness journey</p>\n            </div>\n            \n            <div className=\"grid md:grid-cols-2 gap-6\">\n              <div className=\"flex items-start space-x-3\">\n                <Star className=\"text-yellow-500 flex-shrink-0 mt-1\" size={20} />\n                <div>\n                  <h4 className=\"font-semibold text-white\">Advanced Meal Planning</h4>\n                  <p className=\"text-gray-300 text-sm\">Custom recipes, shopping lists, and nutrition coaching</p>\n                </div>\n              </div>\n              <div className=\"flex items-start space-x-3\">\n                <BarChart3 className=\"text-blue-500 flex-shrink-0 mt-1\" size={20} />\n                <div>\n                  <h4 className=\"font-semibold text-white\">Deep Analytics</h4>\n                  <p className=\"text-gray-300 text-sm\">Detailed body composition tracking and trend analysis</p>\n                </div>\n              </div>\n              <div className=\"flex items-start space-x-3\">\n                <Shield className=\"text-purple-500 flex-shrink-0 mt-1\" size={20} />\n                <div>\n                  <h4 className=\"font-semibold text-white\">Priority Support</h4>\n                  <p className=\"text-gray-300 text-sm\">24/7 customer support and exclusive features access</p>\n                </div>\n              </div>\n            </div>\n          </div>\n        </div>\n\n        {/* CTA Section */}\n        <div className=\"relative z-10 text-center mt-20 p-8 rounded-2xl bg-gradient-to-r from-primary to-secondary text-white\">\n          <h2 className=\"text-3xl font-bold mb-4\">Ready to Transform Your Fitness?</h2>\n          <p className=\"text-xl mb-6 opacity-90\">\n            Join thousands of users already achieving their goals with FlexFlow\n          </p>\n          <Button size=\"lg\" variant=\"secondary\" className=\"text-lg px-8 py-4\" asChild>\n            <a href=\"/api/login\">\n              <Play className=\"mr-2\" size={20} />\n              Start Your Journey\n            </a>\n          </Button>\n        </div>\n      </main>\n\n      {/* Footer */}\n      <footer className=\"relative z-10 border-t bg-black/90 backdrop-blur py-8\">\n        <div className=\"container mx-auto px-4\">\n          <div className=\"flex flex-col md:flex-row justify-between items-center space-y-4 md:space-y-0\">\n            <div className=\"flex items-center space-x-2\">\n              <Activity className=\"text-red-600\" size={24} />\n              <span className=\"text-white font-semibold\">FlexFlow</span>\n            </div>\n            \n            <div className=\"flex flex-col md:flex-row items-center space-y-2 md:space-y-0 md:space-x-6\">\n              <a \n                href=\"/terms-of-service\" \n                className=\"text-gray-300 hover:text-white transition-colors text-sm\"\n                data-testid=\"terms-link\"\n              >\n                Terms of Service\n              </a>\n              <a \n                href=\"/privacy-policy\" \n                className=\"text-gray-300 hover:text-white transition-colors text-sm\"\n                data-testid=\"privacy-link\"\n              >\n                Privacy Policy\n              </a>\n            </div>\n            \n            <div className=\"text-center md:text-right\">\n              <p className=\"text-gray-400 text-sm\">\n                © 2024 FlexFlow. All rights reserved.\n              </p>\n              <p className=\"text-gray-500 text-xs mt-1\">\n                CEO Steven Bates Jr\n              </p>\n            </div>\n          </div>\n        </div>\n      </footer>\n    </div>\n  );\n}","size_bytes":13047},"client/src/components/ui/alert-dialog.tsx":{"content":"import * as React from \"react\"\nimport * as AlertDialogPrimitive from \"@radix-ui/react-alert-dialog\"\n\nimport { cn } from \"@/lib/utils\"\nimport { buttonVariants } from \"@/components/ui/button\"\n\nconst AlertDialog = AlertDialogPrimitive.Root\n\nconst AlertDialogTrigger = AlertDialogPrimitive.Trigger\n\nconst AlertDialogPortal = AlertDialogPrimitive.Portal\n\nconst AlertDialogOverlay = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Overlay\n    className={cn(\n      \"fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0\",\n      className\n    )}\n    {...props}\n    ref={ref}\n  />\n))\nAlertDialogOverlay.displayName = AlertDialogPrimitive.Overlay.displayName\n\nconst AlertDialogContent = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPortal>\n    <AlertDialogOverlay />\n    <AlertDialogPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg\",\n        className\n      )}\n      {...props}\n    />\n  </AlertDialogPortal>\n))\nAlertDialogContent.displayName = AlertDialogPrimitive.Content.displayName\n\nconst AlertDialogHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col space-y-2 text-center sm:text-left\",\n      className\n    )}\n    {...props}\n  />\n)\nAlertDialogHeader.displayName = \"AlertDialogHeader\"\n\nconst AlertDialogFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2\",\n      className\n    )}\n    {...props}\n  />\n)\nAlertDialogFooter.displayName = \"AlertDialogFooter\"\n\nconst AlertDialogTitle = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Title\n    ref={ref}\n    className={cn(\"text-lg font-semibold\", className)}\n    {...props}\n  />\n))\nAlertDialogTitle.displayName = AlertDialogPrimitive.Title.displayName\n\nconst AlertDialogDescription = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nAlertDialogDescription.displayName =\n  AlertDialogPrimitive.Description.displayName\n\nconst AlertDialogAction = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Action>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Action>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Action\n    ref={ref}\n    className={cn(buttonVariants(), className)}\n    {...props}\n  />\n))\nAlertDialogAction.displayName = AlertDialogPrimitive.Action.displayName\n\nconst AlertDialogCancel = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Cancel>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Cancel>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Cancel\n    ref={ref}\n    className={cn(\n      buttonVariants({ variant: \"outline\" }),\n      \"mt-2 sm:mt-0\",\n      className\n    )}\n    {...props}\n  />\n))\nAlertDialogCancel.displayName = AlertDialogPrimitive.Cancel.displayName\n\nexport {\n  AlertDialog,\n  AlertDialogPortal,\n  AlertDialogOverlay,\n  AlertDialogTrigger,\n  AlertDialogContent,\n  AlertDialogHeader,\n  AlertDialogFooter,\n  AlertDialogTitle,\n  AlertDialogDescription,\n  AlertDialogAction,\n  AlertDialogCancel,\n}\n","size_bytes":4420},"client/src/components/ui/pagination.tsx":{"content":"import * as React from \"react\"\nimport { ChevronLeft, ChevronRight, MoreHorizontal } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\nimport { ButtonProps, buttonVariants } from \"@/components/ui/button\"\n\nconst Pagination = ({ className, ...props }: React.ComponentProps<\"nav\">) => (\n  <nav\n    role=\"navigation\"\n    aria-label=\"pagination\"\n    className={cn(\"mx-auto flex w-full justify-center\", className)}\n    {...props}\n  />\n)\nPagination.displayName = \"Pagination\"\n\nconst PaginationContent = React.forwardRef<\n  HTMLUListElement,\n  React.ComponentProps<\"ul\">\n>(({ className, ...props }, ref) => (\n  <ul\n    ref={ref}\n    className={cn(\"flex flex-row items-center gap-1\", className)}\n    {...props}\n  />\n))\nPaginationContent.displayName = \"PaginationContent\"\n\nconst PaginationItem = React.forwardRef<\n  HTMLLIElement,\n  React.ComponentProps<\"li\">\n>(({ className, ...props }, ref) => (\n  <li ref={ref} className={cn(\"\", className)} {...props} />\n))\nPaginationItem.displayName = \"PaginationItem\"\n\ntype PaginationLinkProps = {\n  isActive?: boolean\n} & Pick<ButtonProps, \"size\"> &\n  React.ComponentProps<\"a\">\n\nconst PaginationLink = ({\n  className,\n  isActive,\n  size = \"icon\",\n  ...props\n}: PaginationLinkProps) => (\n  <a\n    aria-current={isActive ? \"page\" : undefined}\n    className={cn(\n      buttonVariants({\n        variant: isActive ? \"outline\" : \"ghost\",\n        size,\n      }),\n      className\n    )}\n    {...props}\n  />\n)\nPaginationLink.displayName = \"PaginationLink\"\n\nconst PaginationPrevious = ({\n  className,\n  ...props\n}: React.ComponentProps<typeof PaginationLink>) => (\n  <PaginationLink\n    aria-label=\"Go to previous page\"\n    size=\"default\"\n    className={cn(\"gap-1 pl-2.5\", className)}\n    {...props}\n  >\n    <ChevronLeft className=\"h-4 w-4\" />\n    <span>Previous</span>\n  </PaginationLink>\n)\nPaginationPrevious.displayName = \"PaginationPrevious\"\n\nconst PaginationNext = ({\n  className,\n  ...props\n}: React.ComponentProps<typeof PaginationLink>) => (\n  <PaginationLink\n    aria-label=\"Go to next page\"\n    size=\"default\"\n    className={cn(\"gap-1 pr-2.5\", className)}\n    {...props}\n  >\n    <span>Next</span>\n    <ChevronRight className=\"h-4 w-4\" />\n  </PaginationLink>\n)\nPaginationNext.displayName = \"PaginationNext\"\n\nconst PaginationEllipsis = ({\n  className,\n  ...props\n}: React.ComponentProps<\"span\">) => (\n  <span\n    aria-hidden\n    className={cn(\"flex h-9 w-9 items-center justify-center\", className)}\n    {...props}\n  >\n    <MoreHorizontal className=\"h-4 w-4\" />\n    <span className=\"sr-only\">More pages</span>\n  </span>\n)\nPaginationEllipsis.displayName = \"PaginationEllipsis\"\n\nexport {\n  Pagination,\n  PaginationContent,\n  PaginationEllipsis,\n  PaginationItem,\n  PaginationLink,\n  PaginationNext,\n  PaginationPrevious,\n}\n","size_bytes":2751},"client/src/pages/progress.tsx":{"content":"import { TrendingUp, Target, Award } from \"lucide-react\";\nimport ProgressOverview from \"@/components/progress-overview\";\nimport ProgressCharts from \"@/components/progress-charts\";\nimport GoalsWidget from \"@/components/goals-widget\";\nimport QuickStats from \"@/components/quick-stats\";\n\nexport default function ProgressPage() {\n  return (\n    <div className=\"font-inter bg-gradient-to-br from-black via-gray-900 to-black text-white min-h-screen\">      \n      <main className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6\">\n        {/* Page Header */}\n        <div className=\"flex items-center gap-3 mb-8 border-b border-red-500/30 pb-6\">\n          <div className=\"p-3 bg-gradient-to-br from-red-600 to-red-700 rounded-lg shadow-lg shadow-red-500/30\">\n            <TrendingUp className=\"w-8 h-8 text-white\" />\n          </div>\n          <div>\n            <h1 className=\"text-3xl font-bold text-white\" data-testid=\"progress-title\">\n              Progress\n            </h1>\n            <p className=\"text-gray-400\">\n              Track your fitness achievements and analyze your performance\n            </p>\n          </div>\n        </div>\n\n        {/* Quick Stats */}\n        <div className=\"mb-8\">\n          <QuickStats />\n        </div>\n\n        {/* Progress Overview */}\n        <div className=\"mb-8\">\n          <ProgressOverview />\n        </div>\n\n        {/* Main Content Grid */}\n        <div className=\"grid lg:grid-cols-3 gap-8\">\n          {/* Progress Charts */}\n          <div className=\"lg:col-span-2\">\n            <ProgressCharts />\n          </div>\n          \n          {/* Goals Sidebar */}\n          <div className=\"space-y-8\">\n            <GoalsWidget />\n            \n            {/* Progress Insights */}\n            <section className=\"bg-gradient-to-br from-gray-900 to-black rounded-2xl shadow-2xl shadow-red-500/20 border-2 border-red-500/30 p-6\">\n              <div className=\"flex items-center gap-2 mb-4\">\n                <Award className=\"w-5 h-5 text-red-500\" />\n                <h3 className=\"text-lg font-bold text-white\">Progress Insights</h3>\n              </div>\n              <div className=\"space-y-4\">\n                <div className=\"p-4 bg-gradient-to-r from-red-900/40 to-black/60 border border-red-500/30 rounded-lg hover:border-red-500/50 transition-colors\">\n                  <h4 className=\"font-medium text-red-400 mb-1\">Weekly Streak</h4>\n                  <p className=\"text-sm text-gray-300\">\n                    Keep up the great work! Consistent workouts lead to better results.\n                  </p>\n                </div>\n                <div className=\"p-4 bg-gradient-to-r from-red-900/30 to-black/60 border border-red-500/30 rounded-lg hover:border-red-500/50 transition-colors\">\n                  <h4 className=\"font-medium text-red-400 mb-1\">Strength Progress</h4>\n                  <p className=\"text-sm text-gray-300\">\n                    Your weight progress shows steady improvement in strength training.\n                  </p>\n                </div>\n                <div className=\"p-4 bg-gradient-to-r from-red-900/40 to-black/60 border border-red-500/30 rounded-lg hover:border-red-500/50 transition-colors\">\n                  <h4 className=\"font-medium text-red-400 mb-1\">Goal Achievement</h4>\n                  <p className=\"text-sm text-gray-300\">\n                    You're making excellent progress toward your fitness goals!\n                  </p>\n                </div>\n              </div>\n            </section>\n          </div>\n        </div>\n      </main>\n    </div>\n  );\n}","size_bytes":3539},"client/src/components/food-preferences.tsx":{"content":"import React, { useState } from 'react';\nimport { useQuery, useMutation } from '@tanstack/react-query';\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport { Heart, ThumbsUp, ThumbsDown, X, Calculator, Sparkles } from \"lucide-react\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { apiRequest, queryClient } from \"@/lib/queryClient\";\nimport type { FoodItemWithPreference } from \"@shared/schema\";\n\ninterface FoodPreferencesProps {\n  onComplete?: (preferences: any[]) => void;\n  showCalorieCalculator?: boolean;\n}\n\nconst preferenceIcons = {\n  love: { icon: Heart, color: \"text-red-500\", bg: \"bg-red-50 border-red-200\" },\n  like: { icon: ThumbsUp, color: \"text-green-500\", bg: \"bg-green-50 border-green-200\" },\n  dislike: { icon: ThumbsDown, color: \"text-orange-500\", bg: \"bg-orange-50 border-orange-200\" },\n  never: { icon: X, color: \"text-red-600\", bg: \"bg-red-100 border-red-300\" },\n};\n\nconst categories = [\n  { id: \"proteins\", name: \"Proteins\", icon: \"🥩\" },\n  { id: \"grains\", name: \"Grains\", icon: \"🌾\" },\n  { id: \"vegetables\", name: \"Vegetables\", icon: \"🥬\" },\n  { id: \"fruits\", name: \"Fruits\", icon: \"🍎\" },\n  { id: \"dairy\", name: \"Dairy\", icon: \"🥛\" },\n  { id: \"fats\", name: \"Healthy Fats\", icon: \"🥑\" },\n  { id: \"nuts\", name: \"Nuts & Seeds\", icon: \"🥜\" },\n  { id: \"legumes\", name: \"Legumes\", icon: \"🫘\" },\n];\n\nexport function FoodPreferences({ onComplete, showCalorieCalculator = true }: FoodPreferencesProps) {\n  const [selectedCategory, setSelectedCategory] = useState(\"proteins\");\n  const [selectedFoods, setSelectedFoods] = useState<{[key: string]: string}>({});\n  const [estimatedCalories, setEstimatedCalories] = useState(2000);\n  const { toast } = useToast();\n\n  // Fetch food items with user preferences\n  const { data: foodItems = [], isLoading } = useQuery<FoodItemWithPreference[]>({\n    queryKey: [\"/api/food-items-with-preferences\", selectedCategory],\n    queryFn: () => apiRequest(\"GET\", `/api/food-items-with-preferences?category=${selectedCategory}`).then(res => res.json()),\n  });\n\n  // Set preference mutation\n  const setPreferenceMutation = useMutation({\n    mutationFn: async ({ foodItemId, preference }: { foodItemId: string; preference: string }) => {\n      const response = await apiRequest(\"POST\", \"/api/user-food-preference\", {\n        foodItemId,\n        preference,\n      });\n      return response.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/food-items-with-preferences\"] });\n      queryClient.invalidateQueries({ queryKey: [\"/api/user-food-preferences\"] });\n    },\n    onError: () => {\n      toast({\n        title: \"Error\",\n        description: \"Failed to save food preference\",\n        variant: \"destructive\",\n      });\n    }\n  });\n\n  const handlePreferenceChange = (foodItemId: string, preference: string) => {\n    setSelectedFoods(prev => ({ ...prev, [foodItemId]: preference }));\n    setPreferenceMutation.mutate({ foodItemId, preference });\n  };\n\n  const calculateEstimatedCalories = () => {\n    const likedFoods = Object.entries(selectedFoods).filter(([_, pref]) => pref === \"like\" || pref === \"love\");\n    if (likedFoods.length === 0) return 2000;\n\n    const totalCalories = likedFoods.reduce((sum, [foodId]) => {\n      const food = foodItems.find(item => item.id === foodId);\n      return sum + (food?.caloriesPer100g || 0);\n    }, 0);\n\n    // Rough estimate: assume user eats variety of liked foods\n    const averageCaloriesPer100g = totalCalories / likedFoods.length;\n    // Assume ~6-8 servings per day of various foods\n    return Math.round(averageCaloriesPer100g * 7); // 700g total food per day\n  };\n\n  const getSelectedPreference = (foodItem: FoodItemWithPreference) => {\n    return selectedFoods[foodItem.id] || foodItem.userPreference?.preference || null;\n  };\n\n  const completedCategories = categories.filter(category => {\n    return foodItems.some(item => \n      item.category === category.id && getSelectedPreference(item)\n    );\n  }).length;\n\n  React.useEffect(() => {\n    const newEstimate = calculateEstimatedCalories();\n    setEstimatedCalories(newEstimate);\n  }, [selectedFoods, foodItems]);\n\n  return (\n    <div className=\"space-y-6\">\n      <div className=\"text-center space-y-2\">\n        <h2 className=\"text-2xl font-bold flex items-center justify-center gap-2\">\n          <Sparkles className=\"w-6 h-6 text-primary\" />\n          Food Preferences\n        </h2>\n        <p className=\"text-gray-600 dark:text-gray-400\">\n          Tell us which foods you like to get personalized meal plans\n        </p>\n        <div className=\"flex items-center justify-center gap-4 text-sm\">\n          <Badge variant=\"outline\">{completedCategories}/{categories.length} categories completed</Badge>\n          {showCalorieCalculator && (\n            <Badge variant=\"secondary\" className=\"flex items-center gap-1\">\n              <Calculator className=\"w-3 h-3\" />\n              Est. {estimatedCalories} cal/day\n            </Badge>\n          )}\n        </div>\n      </div>\n\n      <Tabs value={selectedCategory} onValueChange={setSelectedCategory}>\n        <TabsList className=\"grid grid-cols-4 lg:grid-cols-8 w-full\">\n          {categories.map((category) => (\n            <TabsTrigger key={category.id} value={category.id} className=\"text-xs\">\n              <span className=\"mr-1\">{category.icon}</span>\n              <span className=\"hidden sm:inline\">{category.name}</span>\n            </TabsTrigger>\n          ))}\n        </TabsList>\n\n        {categories.map((category) => (\n          <TabsContent key={category.id} value={category.id} className=\"space-y-4\">\n            <div className=\"text-center\">\n              <h3 className=\"text-lg font-semibold\">{category.icon} {category.name}</h3>\n              <p className=\"text-sm text-gray-600 dark:text-gray-400\">\n                Rate these {category.name.toLowerCase()} to personalize your meal plans\n              </p>\n            </div>\n\n            {isLoading ? (\n              <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4\">\n                {Array.from({ length: 6 }).map((_, i) => (\n                  <Card key={i} className=\"animate-pulse\">\n                    <CardContent className=\"p-4\">\n                      <div className=\"h-4 bg-gray-200 rounded mb-2\"></div>\n                      <div className=\"h-3 bg-gray-100 rounded mb-3\"></div>\n                      <div className=\"flex gap-2\">\n                        {Array.from({ length: 4 }).map((_, j) => (\n                          <div key={j} className=\"w-8 h-8 bg-gray-100 rounded\"></div>\n                        ))}\n                      </div>\n                    </CardContent>\n                  </Card>\n                ))}\n              </div>\n            ) : (\n              <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4\">\n                {foodItems\n                  .filter(item => item.category === category.id)\n                  .map((foodItem) => {\n                    const selectedPref = getSelectedPreference(foodItem);\n                    return (\n                      <Card key={foodItem.id} className=\"hover:shadow-md transition-shadow\">\n                        <CardContent className=\"p-4\">\n                          <div className=\"space-y-3\">\n                            <div>\n                              <h4 className=\"font-medium\">{foodItem.name}</h4>\n                              <p className=\"text-xs text-gray-500\">\n                                {foodItem.caloriesPer100g} cal per 100g\n                              </p>\n                              <p className=\"text-xs text-gray-400\">\n                                {foodItem.commonServingSize}\n                              </p>\n                            </div>\n\n                            <div className=\"flex gap-1\">\n                              {Object.entries(preferenceIcons).map(([pref, config]) => {\n                                const Icon = config.icon;\n                                const isSelected = selectedPref === pref;\n                                return (\n                                  <button\n                                    key={pref}\n                                    onClick={() => handlePreferenceChange(foodItem.id, pref)}\n                                    className={`p-2 rounded-md border transition-all ${\n                                      isSelected \n                                        ? `${config.bg} ${config.color} border-current scale-110` \n                                        : \"border-gray-200 hover:border-gray-300 text-gray-400 hover:text-gray-600\"\n                                    }`}\n                                    title={pref.charAt(0).toUpperCase() + pref.slice(1)}\n                                    data-testid={`preference-${pref}-${foodItem.id}`}\n                                  >\n                                    <Icon className=\"w-4 h-4\" />\n                                  </button>\n                                );\n                              })}\n                            </div>\n\n                            {selectedPref && (\n                              <Badge variant=\"outline\" className=\"text-xs\">\n                                {selectedPref.charAt(0).toUpperCase() + selectedPref.slice(1)}\n                              </Badge>\n                            )}\n                          </div>\n                        </CardContent>\n                      </Card>\n                    );\n                  })}\n              </div>\n            )}\n          </TabsContent>\n        ))}\n      </Tabs>\n\n      {completedCategories >= 3 && onComplete && (\n        <div className=\"text-center pt-4\">\n          <Button \n            onClick={() => onComplete(Object.entries(selectedFoods))}\n            size=\"lg\"\n            className=\"min-w-48\"\n            data-testid=\"complete-preferences\"\n          >\n            <Sparkles className=\"w-4 h-4 mr-2\" />\n            Generate My Meal Plan\n          </Button>\n          <p className=\"text-xs text-gray-500 mt-2\">\n            You've completed {completedCategories} categories. You can continue or generate your plan now.\n          </p>\n        </div>\n      )}\n    </div>\n  );\n}","size_bytes":10394},"client/src/pages/terms-of-service.tsx":{"content":"import { Activity } from \"lucide-react\";\nimport { Button } from \"@/components/ui/button\";\n\nexport default function TermsOfService() {\n  return (\n    <div className=\"min-h-screen bg-gray-50 dark:bg-gray-900\">\n      {/* Header */}\n      <header className=\"px-4 lg:px-6 h-14 flex items-center border-b bg-white dark:bg-gray-800 shadow-sm\">\n        <div className=\"flex items-center space-x-2\">\n          <Activity className=\"text-red-600\" size={32} />\n          <h1 className=\"text-xl font-bold text-gray-900 dark:text-white\">FlexFlow</h1>\n        </div>\n        <div className=\"ml-auto\">\n          <Button asChild variant=\"outline\">\n            <a href=\"/\" data-testid=\"back-home\">Back to Home</a>\n          </Button>\n        </div>\n      </header>\n\n      {/* Content */}\n      <main className=\"container mx-auto px-4 py-12 max-w-4xl\">\n        <div className=\"bg-white dark:bg-gray-800 rounded-lg shadow-lg p-8\">\n          <h1 className=\"text-3xl font-bold text-gray-900 dark:text-white mb-8\">Terms of Service</h1>\n          \n          <div className=\"prose prose-gray dark:prose-invert max-w-none\">\n            <p className=\"text-sm text-gray-600 dark:text-gray-400 mb-6\">\n              Last updated: {new Date().toLocaleDateString()}\n            </p>\n\n            <section className=\"mb-8\">\n              <h2 className=\"text-xl font-semibold mb-4\">1. Acceptance of Terms</h2>\n              <p>\n                By accessing and using FlexFlow (\"the Service\"), you accept and agree to be bound by the terms \n                and provision of this agreement. These Terms of Service govern your use of the FlexFlow fitness \n                tracking application and related services.\n              </p>\n            </section>\n\n            <section className=\"mb-8\">\n              <h2 className=\"text-xl font-semibold mb-4\">2. Use of the Service</h2>\n              <p>FlexFlow provides fitness tracking, workout logging, and wellness management tools. You agree to:</p>\n              <ul className=\"list-disc pl-6 mt-2\">\n                <li>Use the Service only for lawful purposes</li>\n                <li>Provide accurate and complete information when creating your account</li>\n                <li>Maintain the security and confidentiality of your account credentials</li>\n                <li>Not share your account with others</li>\n                <li>Not use the Service to upload harmful or inappropriate content</li>\n              </ul>\n            </section>\n\n            <section className=\"mb-8\">\n              <h2 className=\"text-xl font-semibold mb-4\">3. User Accounts</h2>\n              <p>\n                You are responsible for maintaining the confidentiality of your account information and password. \n                You agree to accept responsibility for all activities that occur under your account.\n              </p>\n            </section>\n\n            <section className=\"mb-8\">\n              <h2 className=\"text-xl font-semibold mb-4\">4. Subscription and Payments</h2>\n              <p>\n                FlexFlow offers both free and premium subscription tiers. Premium subscriptions are billed \n                automatically on a recurring basis. You may cancel your subscription at any time through \n                your account settings.\n              </p>\n            </section>\n\n            <section className=\"mb-8\">\n              <h2 className=\"text-xl font-semibold mb-4\">5. Health and Safety Disclaimer</h2>\n              <p>\n                FlexFlow is not a substitute for professional medical advice. Always consult with healthcare \n                professionals before starting any fitness program. Use of fitness tracking data should not \n                replace medical supervision for health conditions.\n              </p>\n            </section>\n\n            <section className=\"mb-8\">\n              <h2 className=\"text-xl font-semibold mb-4\">6. Data Privacy</h2>\n              <p>\n                Your privacy is important to us. Please review our Privacy Policy, which also governs your \n                use of the Service, to understand our practices regarding your personal information.\n              </p>\n            </section>\n\n            <section className=\"mb-8\">\n              <h2 className=\"text-xl font-semibold mb-4\">7. Limitation of Liability</h2>\n              <p>\n                FlexFlow shall not be liable for any indirect, incidental, special, consequential, or punitive \n                damages, or any loss of profits or revenues, whether incurred directly or indirectly, or any \n                loss of data, use, goodwill, or other intangible losses.\n              </p>\n            </section>\n\n            <section className=\"mb-8\">\n              <h2 className=\"text-xl font-semibold mb-4\">8. Modifications to Terms</h2>\n              <p>\n                We reserve the right to modify these terms at any time. We will notify users of any material \n                changes via email or through the Service. Continued use of the Service after such modifications \n                constitutes acceptance of the updated terms.\n              </p>\n            </section>\n\n            <section className=\"mb-8\">\n              <h2 className=\"text-xl font-semibold mb-4\">9. Contact Information</h2>\n              <p>\n                If you have any questions about these Terms of Service, please contact us through the \n                FlexFlow application or website.\n              </p>\n            </section>\n          </div>\n        </div>\n      </main>\n    </div>\n  );\n}","size_bytes":5521},"client/src/components/ui/sidebar.tsx":{"content":"import * as React from \"react\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport { VariantProps, cva } from \"class-variance-authority\"\nimport { PanelLeft } from \"lucide-react\"\n\nimport { useIsMobile } from \"@/hooks/use-mobile\"\nimport { cn } from \"@/lib/utils\"\nimport { Button } from \"@/components/ui/button\"\nimport { Input } from \"@/components/ui/input\"\nimport { Separator } from \"@/components/ui/separator\"\nimport {\n  Sheet,\n  SheetContent,\n  SheetDescription,\n  SheetHeader,\n  SheetTitle,\n} from \"@/components/ui/sheet\"\nimport { Skeleton } from \"@/components/ui/skeleton\"\nimport {\n  Tooltip,\n  TooltipContent,\n  TooltipProvider,\n  TooltipTrigger,\n} from \"@/components/ui/tooltip\"\n\nconst SIDEBAR_COOKIE_NAME = \"sidebar_state\"\nconst SIDEBAR_COOKIE_MAX_AGE = 60 * 60 * 24 * 7\nconst SIDEBAR_WIDTH = \"16rem\"\nconst SIDEBAR_WIDTH_MOBILE = \"18rem\"\nconst SIDEBAR_WIDTH_ICON = \"3rem\"\nconst SIDEBAR_KEYBOARD_SHORTCUT = \"b\"\n\ntype SidebarContextProps = {\n  state: \"expanded\" | \"collapsed\"\n  open: boolean\n  setOpen: (open: boolean) => void\n  openMobile: boolean\n  setOpenMobile: (open: boolean) => void\n  isMobile: boolean\n  toggleSidebar: () => void\n}\n\nconst SidebarContext = React.createContext<SidebarContextProps | null>(null)\n\nfunction useSidebar() {\n  const context = React.useContext(SidebarContext)\n  if (!context) {\n    throw new Error(\"useSidebar must be used within a SidebarProvider.\")\n  }\n\n  return context\n}\n\nconst SidebarProvider = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> & {\n    defaultOpen?: boolean\n    open?: boolean\n    onOpenChange?: (open: boolean) => void\n  }\n>(\n  (\n    {\n      defaultOpen = true,\n      open: openProp,\n      onOpenChange: setOpenProp,\n      className,\n      style,\n      children,\n      ...props\n    },\n    ref\n  ) => {\n    const isMobile = useIsMobile()\n    const [openMobile, setOpenMobile] = React.useState(false)\n\n    // This is the internal state of the sidebar.\n    // We use openProp and setOpenProp for control from outside the component.\n    const [_open, _setOpen] = React.useState(defaultOpen)\n    const open = openProp ?? _open\n    const setOpen = React.useCallback(\n      (value: boolean | ((value: boolean) => boolean)) => {\n        const openState = typeof value === \"function\" ? value(open) : value\n        if (setOpenProp) {\n          setOpenProp(openState)\n        } else {\n          _setOpen(openState)\n        }\n\n        // This sets the cookie to keep the sidebar state.\n        document.cookie = `${SIDEBAR_COOKIE_NAME}=${openState}; path=/; max-age=${SIDEBAR_COOKIE_MAX_AGE}`\n      },\n      [setOpenProp, open]\n    )\n\n    // Helper to toggle the sidebar.\n    const toggleSidebar = React.useCallback(() => {\n      return isMobile\n        ? setOpenMobile((open) => !open)\n        : setOpen((open) => !open)\n    }, [isMobile, setOpen, setOpenMobile])\n\n    // Adds a keyboard shortcut to toggle the sidebar.\n    React.useEffect(() => {\n      const handleKeyDown = (event: KeyboardEvent) => {\n        if (\n          event.key === SIDEBAR_KEYBOARD_SHORTCUT &&\n          (event.metaKey || event.ctrlKey)\n        ) {\n          event.preventDefault()\n          toggleSidebar()\n        }\n      }\n\n      window.addEventListener(\"keydown\", handleKeyDown)\n      return () => window.removeEventListener(\"keydown\", handleKeyDown)\n    }, [toggleSidebar])\n\n    // We add a state so that we can do data-state=\"expanded\" or \"collapsed\".\n    // This makes it easier to style the sidebar with Tailwind classes.\n    const state = open ? \"expanded\" : \"collapsed\"\n\n    const contextValue = React.useMemo<SidebarContextProps>(\n      () => ({\n        state,\n        open,\n        setOpen,\n        isMobile,\n        openMobile,\n        setOpenMobile,\n        toggleSidebar,\n      }),\n      [state, open, setOpen, isMobile, openMobile, setOpenMobile, toggleSidebar]\n    )\n\n    return (\n      <SidebarContext.Provider value={contextValue}>\n        <TooltipProvider delayDuration={0}>\n          <div\n            style={\n              {\n                \"--sidebar-width\": SIDEBAR_WIDTH,\n                \"--sidebar-width-icon\": SIDEBAR_WIDTH_ICON,\n                ...style,\n              } as React.CSSProperties\n            }\n            className={cn(\n              \"group/sidebar-wrapper flex min-h-svh w-full has-[[data-variant=inset]]:bg-sidebar\",\n              className\n            )}\n            ref={ref}\n            {...props}\n          >\n            {children}\n          </div>\n        </TooltipProvider>\n      </SidebarContext.Provider>\n    )\n  }\n)\nSidebarProvider.displayName = \"SidebarProvider\"\n\nconst Sidebar = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> & {\n    side?: \"left\" | \"right\"\n    variant?: \"sidebar\" | \"floating\" | \"inset\"\n    collapsible?: \"offcanvas\" | \"icon\" | \"none\"\n  }\n>(\n  (\n    {\n      side = \"left\",\n      variant = \"sidebar\",\n      collapsible = \"offcanvas\",\n      className,\n      children,\n      ...props\n    },\n    ref\n  ) => {\n    const { isMobile, state, openMobile, setOpenMobile } = useSidebar()\n\n    if (collapsible === \"none\") {\n      return (\n        <div\n          className={cn(\n            \"flex h-full w-[--sidebar-width] flex-col bg-sidebar text-sidebar-foreground\",\n            className\n          )}\n          ref={ref}\n          {...props}\n        >\n          {children}\n        </div>\n      )\n    }\n\n    if (isMobile) {\n      return (\n        <Sheet open={openMobile} onOpenChange={setOpenMobile} {...props}>\n          <SheetContent\n            data-sidebar=\"sidebar\"\n            data-mobile=\"true\"\n            className=\"w-[--sidebar-width] bg-sidebar p-0 text-sidebar-foreground [&>button]:hidden\"\n            style={\n              {\n                \"--sidebar-width\": SIDEBAR_WIDTH_MOBILE,\n              } as React.CSSProperties\n            }\n            side={side}\n          >\n            <SheetHeader className=\"sr-only\">\n              <SheetTitle>Sidebar</SheetTitle>\n              <SheetDescription>Displays the mobile sidebar.</SheetDescription>\n            </SheetHeader>\n            <div className=\"flex h-full w-full flex-col\">{children}</div>\n          </SheetContent>\n        </Sheet>\n      )\n    }\n\n    return (\n      <div\n        ref={ref}\n        className=\"group peer hidden text-sidebar-foreground md:block\"\n        data-state={state}\n        data-collapsible={state === \"collapsed\" ? collapsible : \"\"}\n        data-variant={variant}\n        data-side={side}\n      >\n        {/* This is what handles the sidebar gap on desktop */}\n        <div\n          className={cn(\n            \"relative w-[--sidebar-width] bg-transparent transition-[width] duration-200 ease-linear\",\n            \"group-data-[collapsible=offcanvas]:w-0\",\n            \"group-data-[side=right]:rotate-180\",\n            variant === \"floating\" || variant === \"inset\"\n              ? \"group-data-[collapsible=icon]:w-[calc(var(--sidebar-width-icon)_+_theme(spacing.4))]\"\n              : \"group-data-[collapsible=icon]:w-[--sidebar-width-icon]\"\n          )}\n        />\n        <div\n          className={cn(\n            \"fixed inset-y-0 z-10 hidden h-svh w-[--sidebar-width] transition-[left,right,width] duration-200 ease-linear md:flex\",\n            side === \"left\"\n              ? \"left-0 group-data-[collapsible=offcanvas]:left-[calc(var(--sidebar-width)*-1)]\"\n              : \"right-0 group-data-[collapsible=offcanvas]:right-[calc(var(--sidebar-width)*-1)]\",\n            // Adjust the padding for floating and inset variants.\n            variant === \"floating\" || variant === \"inset\"\n              ? \"p-2 group-data-[collapsible=icon]:w-[calc(var(--sidebar-width-icon)_+_theme(spacing.4)_+2px)]\"\n              : \"group-data-[collapsible=icon]:w-[--sidebar-width-icon] group-data-[side=left]:border-r group-data-[side=right]:border-l\",\n            className\n          )}\n          {...props}\n        >\n          <div\n            data-sidebar=\"sidebar\"\n            className=\"flex h-full w-full flex-col bg-sidebar group-data-[variant=floating]:rounded-lg group-data-[variant=floating]:border group-data-[variant=floating]:border-sidebar-border group-data-[variant=floating]:shadow\"\n          >\n            {children}\n          </div>\n        </div>\n      </div>\n    )\n  }\n)\nSidebar.displayName = \"Sidebar\"\n\nconst SidebarTrigger = React.forwardRef<\n  React.ElementRef<typeof Button>,\n  React.ComponentProps<typeof Button>\n>(({ className, onClick, ...props }, ref) => {\n  const { toggleSidebar } = useSidebar()\n\n  return (\n    <Button\n      ref={ref}\n      data-sidebar=\"trigger\"\n      variant=\"ghost\"\n      size=\"icon\"\n      className={cn(\"h-7 w-7\", className)}\n      onClick={(event) => {\n        onClick?.(event)\n        toggleSidebar()\n      }}\n      {...props}\n    >\n      <PanelLeft />\n      <span className=\"sr-only\">Toggle Sidebar</span>\n    </Button>\n  )\n})\nSidebarTrigger.displayName = \"SidebarTrigger\"\n\nconst SidebarRail = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<\"button\">\n>(({ className, ...props }, ref) => {\n  const { toggleSidebar } = useSidebar()\n\n  return (\n    <button\n      ref={ref}\n      data-sidebar=\"rail\"\n      aria-label=\"Toggle Sidebar\"\n      tabIndex={-1}\n      onClick={toggleSidebar}\n      title=\"Toggle Sidebar\"\n      className={cn(\n        \"absolute inset-y-0 z-20 hidden w-4 -translate-x-1/2 transition-all ease-linear after:absolute after:inset-y-0 after:left-1/2 after:w-[2px] hover:after:bg-sidebar-border group-data-[side=left]:-right-4 group-data-[side=right]:left-0 sm:flex\",\n        \"[[data-side=left]_&]:cursor-w-resize [[data-side=right]_&]:cursor-e-resize\",\n        \"[[data-side=left][data-state=collapsed]_&]:cursor-e-resize [[data-side=right][data-state=collapsed]_&]:cursor-w-resize\",\n        \"group-data-[collapsible=offcanvas]:translate-x-0 group-data-[collapsible=offcanvas]:after:left-full group-data-[collapsible=offcanvas]:hover:bg-sidebar\",\n        \"[[data-side=left][data-collapsible=offcanvas]_&]:-right-2\",\n        \"[[data-side=right][data-collapsible=offcanvas]_&]:-left-2\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nSidebarRail.displayName = \"SidebarRail\"\n\nconst SidebarInset = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"main\">\n>(({ className, ...props }, ref) => {\n  return (\n    <main\n      ref={ref}\n      className={cn(\n        \"relative flex w-full flex-1 flex-col bg-background\",\n        \"md:peer-data-[variant=inset]:m-2 md:peer-data-[state=collapsed]:peer-data-[variant=inset]:ml-2 md:peer-data-[variant=inset]:ml-0 md:peer-data-[variant=inset]:rounded-xl md:peer-data-[variant=inset]:shadow\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nSidebarInset.displayName = \"SidebarInset\"\n\nconst SidebarInput = React.forwardRef<\n  React.ElementRef<typeof Input>,\n  React.ComponentProps<typeof Input>\n>(({ className, ...props }, ref) => {\n  return (\n    <Input\n      ref={ref}\n      data-sidebar=\"input\"\n      className={cn(\n        \"h-8 w-full bg-background shadow-none focus-visible:ring-2 focus-visible:ring-sidebar-ring\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nSidebarInput.displayName = \"SidebarInput\"\n\nconst SidebarHeader = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\">\n>(({ className, ...props }, ref) => {\n  return (\n    <div\n      ref={ref}\n      data-sidebar=\"header\"\n      className={cn(\"flex flex-col gap-2 p-2\", className)}\n      {...props}\n    />\n  )\n})\nSidebarHeader.displayName = \"SidebarHeader\"\n\nconst SidebarFooter = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\">\n>(({ className, ...props }, ref) => {\n  return (\n    <div\n      ref={ref}\n      data-sidebar=\"footer\"\n      className={cn(\"flex flex-col gap-2 p-2\", className)}\n      {...props}\n    />\n  )\n})\nSidebarFooter.displayName = \"SidebarFooter\"\n\nconst SidebarSeparator = React.forwardRef<\n  React.ElementRef<typeof Separator>,\n  React.ComponentProps<typeof Separator>\n>(({ className, ...props }, ref) => {\n  return (\n    <Separator\n      ref={ref}\n      data-sidebar=\"separator\"\n      className={cn(\"mx-2 w-auto bg-sidebar-border\", className)}\n      {...props}\n    />\n  )\n})\nSidebarSeparator.displayName = \"SidebarSeparator\"\n\nconst SidebarContent = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\">\n>(({ className, ...props }, ref) => {\n  return (\n    <div\n      ref={ref}\n      data-sidebar=\"content\"\n      className={cn(\n        \"flex min-h-0 flex-1 flex-col gap-2 overflow-auto group-data-[collapsible=icon]:overflow-hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nSidebarContent.displayName = \"SidebarContent\"\n\nconst SidebarGroup = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\">\n>(({ className, ...props }, ref) => {\n  return (\n    <div\n      ref={ref}\n      data-sidebar=\"group\"\n      className={cn(\"relative flex w-full min-w-0 flex-col p-2\", className)}\n      {...props}\n    />\n  )\n})\nSidebarGroup.displayName = \"SidebarGroup\"\n\nconst SidebarGroupLabel = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> & { asChild?: boolean }\n>(({ className, asChild = false, ...props }, ref) => {\n  const Comp = asChild ? Slot : \"div\"\n\n  return (\n    <Comp\n      ref={ref}\n      data-sidebar=\"group-label\"\n      className={cn(\n        \"flex h-8 shrink-0 items-center rounded-md px-2 text-xs font-medium text-sidebar-foreground/70 outline-none ring-sidebar-ring transition-[margin,opacity] duration-200 ease-linear focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0\",\n        \"group-data-[collapsible=icon]:-mt-8 group-data-[collapsible=icon]:opacity-0\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nSidebarGroupLabel.displayName = \"SidebarGroupLabel\"\n\nconst SidebarGroupAction = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<\"button\"> & { asChild?: boolean }\n>(({ className, asChild = false, ...props }, ref) => {\n  const Comp = asChild ? Slot : \"button\"\n\n  return (\n    <Comp\n      ref={ref}\n      data-sidebar=\"group-action\"\n      className={cn(\n        \"absolute right-3 top-3.5 flex aspect-square w-5 items-center justify-center rounded-md p-0 text-sidebar-foreground outline-none ring-sidebar-ring transition-transform hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0\",\n        // Increases the hit area of the button on mobile.\n        \"after:absolute after:-inset-2 after:md:hidden\",\n        \"group-data-[collapsible=icon]:hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nSidebarGroupAction.displayName = \"SidebarGroupAction\"\n\nconst SidebarGroupContent = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\">\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    data-sidebar=\"group-content\"\n    className={cn(\"w-full text-sm\", className)}\n    {...props}\n  />\n))\nSidebarGroupContent.displayName = \"SidebarGroupContent\"\n\nconst SidebarMenu = React.forwardRef<\n  HTMLUListElement,\n  React.ComponentProps<\"ul\">\n>(({ className, ...props }, ref) => (\n  <ul\n    ref={ref}\n    data-sidebar=\"menu\"\n    className={cn(\"flex w-full min-w-0 flex-col gap-1\", className)}\n    {...props}\n  />\n))\nSidebarMenu.displayName = \"SidebarMenu\"\n\nconst SidebarMenuItem = React.forwardRef<\n  HTMLLIElement,\n  React.ComponentProps<\"li\">\n>(({ className, ...props }, ref) => (\n  <li\n    ref={ref}\n    data-sidebar=\"menu-item\"\n    className={cn(\"group/menu-item relative\", className)}\n    {...props}\n  />\n))\nSidebarMenuItem.displayName = \"SidebarMenuItem\"\n\nconst sidebarMenuButtonVariants = cva(\n  \"peer/menu-button flex w-full items-center gap-2 overflow-hidden rounded-md p-2 text-left text-sm outline-none ring-sidebar-ring transition-[width,height,padding] hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 active:bg-sidebar-accent active:text-sidebar-accent-foreground disabled:pointer-events-none disabled:opacity-50 group-has-[[data-sidebar=menu-action]]/menu-item:pr-8 aria-disabled:pointer-events-none aria-disabled:opacity-50 data-[active=true]:bg-sidebar-accent data-[active=true]:font-medium data-[active=true]:text-sidebar-accent-foreground data-[state=open]:hover:bg-sidebar-accent data-[state=open]:hover:text-sidebar-accent-foreground group-data-[collapsible=icon]:!size-8 group-data-[collapsible=icon]:!p-2 [&>span:last-child]:truncate [&>svg]:size-4 [&>svg]:shrink-0\",\n  {\n    variants: {\n      variant: {\n        default: \"hover:bg-sidebar-accent hover:text-sidebar-accent-foreground\",\n        outline:\n          \"bg-background shadow-[0_0_0_1px_hsl(var(--sidebar-border))] hover:bg-sidebar-accent hover:text-sidebar-accent-foreground hover:shadow-[0_0_0_1px_hsl(var(--sidebar-accent))]\",\n      },\n      size: {\n        default: \"h-8 text-sm\",\n        sm: \"h-7 text-xs\",\n        lg: \"h-12 text-sm group-data-[collapsible=icon]:!p-0\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  }\n)\n\nconst SidebarMenuButton = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<\"button\"> & {\n    asChild?: boolean\n    isActive?: boolean\n    tooltip?: string | React.ComponentProps<typeof TooltipContent>\n  } & VariantProps<typeof sidebarMenuButtonVariants>\n>(\n  (\n    {\n      asChild = false,\n      isActive = false,\n      variant = \"default\",\n      size = \"default\",\n      tooltip,\n      className,\n      ...props\n    },\n    ref\n  ) => {\n    const Comp = asChild ? Slot : \"button\"\n    const { isMobile, state } = useSidebar()\n\n    const button = (\n      <Comp\n        ref={ref}\n        data-sidebar=\"menu-button\"\n        data-size={size}\n        data-active={isActive}\n        className={cn(sidebarMenuButtonVariants({ variant, size }), className)}\n        {...props}\n      />\n    )\n\n    if (!tooltip) {\n      return button\n    }\n\n    if (typeof tooltip === \"string\") {\n      tooltip = {\n        children: tooltip,\n      }\n    }\n\n    return (\n      <Tooltip>\n        <TooltipTrigger asChild>{button}</TooltipTrigger>\n        <TooltipContent\n          side=\"right\"\n          align=\"center\"\n          hidden={state !== \"collapsed\" || isMobile}\n          {...tooltip}\n        />\n      </Tooltip>\n    )\n  }\n)\nSidebarMenuButton.displayName = \"SidebarMenuButton\"\n\nconst SidebarMenuAction = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<\"button\"> & {\n    asChild?: boolean\n    showOnHover?: boolean\n  }\n>(({ className, asChild = false, showOnHover = false, ...props }, ref) => {\n  const Comp = asChild ? Slot : \"button\"\n\n  return (\n    <Comp\n      ref={ref}\n      data-sidebar=\"menu-action\"\n      className={cn(\n        \"absolute right-1 top-1.5 flex aspect-square w-5 items-center justify-center rounded-md p-0 text-sidebar-foreground outline-none ring-sidebar-ring transition-transform hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 peer-hover/menu-button:text-sidebar-accent-foreground [&>svg]:size-4 [&>svg]:shrink-0\",\n        // Increases the hit area of the button on mobile.\n        \"after:absolute after:-inset-2 after:md:hidden\",\n        \"peer-data-[size=sm]/menu-button:top-1\",\n        \"peer-data-[size=default]/menu-button:top-1.5\",\n        \"peer-data-[size=lg]/menu-button:top-2.5\",\n        \"group-data-[collapsible=icon]:hidden\",\n        showOnHover &&\n          \"group-focus-within/menu-item:opacity-100 group-hover/menu-item:opacity-100 data-[state=open]:opacity-100 peer-data-[active=true]/menu-button:text-sidebar-accent-foreground md:opacity-0\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nSidebarMenuAction.displayName = \"SidebarMenuAction\"\n\nconst SidebarMenuBadge = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\">\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    data-sidebar=\"menu-badge\"\n    className={cn(\n      \"pointer-events-none absolute right-1 flex h-5 min-w-5 select-none items-center justify-center rounded-md px-1 text-xs font-medium tabular-nums text-sidebar-foreground\",\n      \"peer-hover/menu-button:text-sidebar-accent-foreground peer-data-[active=true]/menu-button:text-sidebar-accent-foreground\",\n      \"peer-data-[size=sm]/menu-button:top-1\",\n      \"peer-data-[size=default]/menu-button:top-1.5\",\n      \"peer-data-[size=lg]/menu-button:top-2.5\",\n      \"group-data-[collapsible=icon]:hidden\",\n      className\n    )}\n    {...props}\n  />\n))\nSidebarMenuBadge.displayName = \"SidebarMenuBadge\"\n\nconst SidebarMenuSkeleton = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> & {\n    showIcon?: boolean\n  }\n>(({ className, showIcon = false, ...props }, ref) => {\n  // Random width between 50 to 90%.\n  const width = React.useMemo(() => {\n    return `${Math.floor(Math.random() * 40) + 50}%`\n  }, [])\n\n  return (\n    <div\n      ref={ref}\n      data-sidebar=\"menu-skeleton\"\n      className={cn(\"flex h-8 items-center gap-2 rounded-md px-2\", className)}\n      {...props}\n    >\n      {showIcon && (\n        <Skeleton\n          className=\"size-4 rounded-md\"\n          data-sidebar=\"menu-skeleton-icon\"\n        />\n      )}\n      <Skeleton\n        className=\"h-4 max-w-[--skeleton-width] flex-1\"\n        data-sidebar=\"menu-skeleton-text\"\n        style={\n          {\n            \"--skeleton-width\": width,\n          } as React.CSSProperties\n        }\n      />\n    </div>\n  )\n})\nSidebarMenuSkeleton.displayName = \"SidebarMenuSkeleton\"\n\nconst SidebarMenuSub = React.forwardRef<\n  HTMLUListElement,\n  React.ComponentProps<\"ul\">\n>(({ className, ...props }, ref) => (\n  <ul\n    ref={ref}\n    data-sidebar=\"menu-sub\"\n    className={cn(\n      \"mx-3.5 flex min-w-0 translate-x-px flex-col gap-1 border-l border-sidebar-border px-2.5 py-0.5\",\n      \"group-data-[collapsible=icon]:hidden\",\n      className\n    )}\n    {...props}\n  />\n))\nSidebarMenuSub.displayName = \"SidebarMenuSub\"\n\nconst SidebarMenuSubItem = React.forwardRef<\n  HTMLLIElement,\n  React.ComponentProps<\"li\">\n>(({ ...props }, ref) => <li ref={ref} {...props} />)\nSidebarMenuSubItem.displayName = \"SidebarMenuSubItem\"\n\nconst SidebarMenuSubButton = React.forwardRef<\n  HTMLAnchorElement,\n  React.ComponentProps<\"a\"> & {\n    asChild?: boolean\n    size?: \"sm\" | \"md\"\n    isActive?: boolean\n  }\n>(({ asChild = false, size = \"md\", isActive, className, ...props }, ref) => {\n  const Comp = asChild ? Slot : \"a\"\n\n  return (\n    <Comp\n      ref={ref}\n      data-sidebar=\"menu-sub-button\"\n      data-size={size}\n      data-active={isActive}\n      className={cn(\n        \"flex h-7 min-w-0 -translate-x-px items-center gap-2 overflow-hidden rounded-md px-2 text-sidebar-foreground outline-none ring-sidebar-ring hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 active:bg-sidebar-accent active:text-sidebar-accent-foreground disabled:pointer-events-none disabled:opacity-50 aria-disabled:pointer-events-none aria-disabled:opacity-50 [&>span:last-child]:truncate [&>svg]:size-4 [&>svg]:shrink-0 [&>svg]:text-sidebar-accent-foreground\",\n        \"data-[active=true]:bg-sidebar-accent data-[active=true]:text-sidebar-accent-foreground\",\n        size === \"sm\" && \"text-xs\",\n        size === \"md\" && \"text-sm\",\n        \"group-data-[collapsible=icon]:hidden\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nSidebarMenuSubButton.displayName = \"SidebarMenuSubButton\"\n\nexport {\n  Sidebar,\n  SidebarContent,\n  SidebarFooter,\n  SidebarGroup,\n  SidebarGroupAction,\n  SidebarGroupContent,\n  SidebarGroupLabel,\n  SidebarHeader,\n  SidebarInput,\n  SidebarInset,\n  SidebarMenu,\n  SidebarMenuAction,\n  SidebarMenuBadge,\n  SidebarMenuButton,\n  SidebarMenuItem,\n  SidebarMenuSkeleton,\n  SidebarMenuSub,\n  SidebarMenuSubButton,\n  SidebarMenuSubItem,\n  SidebarProvider,\n  SidebarRail,\n  SidebarSeparator,\n  SidebarTrigger,\n  useSidebar,\n}\n","size_bytes":23567},"client/src/components/ui/skeleton.tsx":{"content":"import { cn } from \"@/lib/utils\"\n\nfunction Skeleton({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) {\n  return (\n    <div\n      className={cn(\"animate-pulse rounded-md bg-muted\", className)}\n      {...props}\n    />\n  )\n}\n\nexport { Skeleton }\n","size_bytes":261},"client/src/pages/workout-planner.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { useQuery, useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Progress } from \"@/components/ui/progress\";\nimport { Separator } from \"@/components/ui/separator\";\nimport { RadioGroup, RadioGroupItem } from \"@/components/ui/radio-group\";\nimport { Checkbox } from \"@/components/ui/checkbox\";\nimport { Label } from \"@/components/ui/label\";\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from \"@/components/ui/tabs\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport FeatureGate from \"@/components/feature-gate\";\nimport { PageMedicalDisclaimer, AIGeneratedDisclaimer } from \"@/components/medical-disclaimer\";\nimport { HealthSources } from \"@/components/health-sources\";\nimport { \n  Target, \n  Clock, \n  Dumbbell, \n  Activity, \n  Calendar,\n  CheckCircle2,\n  Play,\n  RotateCcw,\n  TrendingUp,\n  Users,\n  Award,\n  Loader2\n} from \"lucide-react\";\nimport { WorkoutPreferences, WorkoutPlan, PlannedWorkout } from \"@shared/schema\";\n\ninterface QuestionnaireData {\n  fitnessLevel: string;\n  primaryGoals: string[];\n  workoutDaysPerWeek: number;\n  sessionDuration: number;\n  availableEquipment: string[];\n  preferredWorkoutTypes: string[];\n  injuriesOrLimitations: string[];\n}\n\nexport default function WorkoutPlannerPage() {\n  const [currentStep, setCurrentStep] = useState(0);\n  const [questionnaire, setQuestionnaire] = useState<QuestionnaireData>({\n    fitnessLevel: \"\",\n    primaryGoals: [],\n    workoutDaysPerWeek: 3,\n    sessionDuration: 45,\n    availableEquipment: [],\n    preferredWorkoutTypes: [],\n    injuriesOrLimitations: []\n  });\n  const [showPlan, setShowPlan] = useState(false);\n\n  const { toast } = useToast();\n  const queryClient = useQueryClient();\n\n  // Check if user has existing preferences\n  const { data: preferences } = useQuery<WorkoutPreferences>({\n    queryKey: [\"/api/workout-preferences\"],\n  });\n\n  // Get user's workout plan\n  const { data: workoutPlan } = useQuery<WorkoutPlan & { plannedWorkouts: PlannedWorkout[] }>({\n    queryKey: [\"/api/workout-plan\"],\n    enabled: !!preferences || showPlan,\n  });\n\n  // Load existing preferences into questionnaire\n  useEffect(() => {\n    if (preferences) {\n      setQuestionnaire({\n        fitnessLevel: preferences.fitnessLevel,\n        primaryGoals: preferences.primaryGoals,\n        workoutDaysPerWeek: preferences.workoutDaysPerWeek,\n        sessionDuration: preferences.sessionDuration,\n        availableEquipment: preferences.availableEquipment,\n        preferredWorkoutTypes: preferences.preferredWorkoutTypes,\n        injuriesOrLimitations: preferences.injuriesOrLimitations || []\n      });\n      setShowPlan(true);\n    }\n  }, [preferences]);\n\n  // Save preferences mutation\n  const savePreferencesMutation = useMutation({\n    mutationFn: async (data: QuestionnaireData) => {\n      const response = await apiRequest(\"POST\", \"/api/workout-preferences\", data);\n      return response.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/workout-preferences\"] });\n      toast({\n        title: \"Preferences Saved! 🎯\",\n        description: \"Your workout preferences have been saved successfully.\",\n      });\n      // After saving preferences, generate the plan\n      generatePlanMutation.mutate();\n    },\n  });\n\n  // Generate plan mutation\n  const generatePlanMutation = useMutation({\n    mutationFn: async () => {\n      const response = await apiRequest(\"POST\", \"/api/workout-plan/generate\", {});\n      if (!response.ok) {\n        const error = await response.json();\n        throw new Error(error.message || \"Failed to generate workout plan\");\n      }\n      return response.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/workout-plan\"] });\n      setShowPlan(true);\n      toast({\n        title: \"Workout Plan Generated! 🏋️‍♂️\",\n        description: \"Your personalized workout plan is ready!\",\n      });\n    },\n    onError: (error: Error) => {\n      toast({\n        title: \"Generation Failed\",\n        description: error.message || \"Failed to generate workout plan. Please try again.\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const questions = [\n    {\n      title: \"What's your current fitness level?\",\n      key: \"fitnessLevel\",\n      type: \"radio\",\n      options: [\n        { value: \"beginner\", label: \"Beginner\", description: \"New to working out or returning after a long break\" },\n        { value: \"intermediate\", label: \"Intermediate\", description: \"Regular workouts for 6+ months\" },\n        { value: \"advanced\", label: \"Advanced\", description: \"Consistent training for 2+ years\" }\n      ]\n    },\n    {\n      title: \"What are your primary fitness goals?\",\n      key: \"primaryGoals\",\n      type: \"checkbox\",\n      options: [\n        { value: \"lose_weight\", label: \"Lose Weight\", description: \"Burn calories and reduce body fat\" },\n        { value: \"build_muscle\", label: \"Build Muscle\", description: \"Increase muscle mass and strength\" },\n        { value: \"improve_endurance\", label: \"Improve Endurance\", description: \"Better cardiovascular fitness\" },\n        { value: \"general_fitness\", label: \"General Fitness\", description: \"Overall health and wellness\" },\n        { value: \"sport_specific\", label: \"Sport-Specific\", description: \"Training for a particular sport\" }\n      ]\n    },\n    {\n      title: \"How many days per week can you workout?\",\n      key: \"workoutDaysPerWeek\",\n      type: \"radio\",\n      options: [\n        { value: \"2\", label: \"2 days\", description: \"Minimal time commitment\" },\n        { value: \"3\", label: \"3 days\", description: \"Balanced approach\" },\n        { value: \"4\", label: \"4 days\", description: \"Dedicated routine\" },\n        { value: \"5\", label: \"5 days\", description: \"High commitment\" },\n        { value: \"6\", label: \"6 days\", description: \"Very high commitment\" }\n      ]\n    },\n    {\n      title: \"How long can each workout session be?\",\n      key: \"sessionDuration\",\n      type: \"radio\",\n      options: [\n        { value: \"30\", label: \"30 minutes\", description: \"Quick and efficient\" },\n        { value: \"45\", label: \"45 minutes\", description: \"Standard length\" },\n        { value: \"60\", label: \"60 minutes\", description: \"Comprehensive workout\" },\n        { value: \"90\", label: \"90 minutes\", description: \"Extended training\" }\n      ]\n    },\n    {\n      title: \"What equipment do you have access to?\",\n      key: \"availableEquipment\",\n      type: \"checkbox\",\n      options: [\n        { value: \"bodyweight\", label: \"Bodyweight\", description: \"No equipment needed\" },\n        { value: \"dumbbells\", label: \"Dumbbells\", description: \"Various weights\" },\n        { value: \"barbell\", label: \"Barbell\", description: \"Olympic or standard\" },\n        { value: \"resistance_bands\", label: \"Resistance Bands\", description: \"Portable resistance\" },\n        { value: \"pull_up_bar\", label: \"Pull-up Bar\", description: \"For upper body\" },\n        { value: \"gym_access\", label: \"Full Gym\", description: \"Complete gym facility\" }\n      ]\n    },\n    {\n      title: \"What types of workouts do you prefer?\",\n      key: \"preferredWorkoutTypes\",\n      type: \"checkbox\",\n      options: [\n        { value: \"strength\", label: \"Strength Training\", description: \"Weight lifting and resistance\" },\n        { value: \"cardio\", label: \"Cardio\", description: \"Running, cycling, HIIT\" },\n        { value: \"yoga\", label: \"Yoga\", description: \"Flexibility and mindfulness\" },\n        { value: \"pilates\", label: \"Pilates\", description: \"Core strength and stability\" },\n        { value: \"functional\", label: \"Functional Training\", description: \"Real-world movement patterns\" }\n      ]\n    },\n    {\n      key: \"injuriesOrLimitations\",\n      title: \"Do you have any injuries or physical limitations?\",\n      type: \"checkbox\",\n      options: [\n        { value: \"none\", label: \"No injuries or limitations\", description: \"I can do all exercises\" },\n        { value: \"knee\", label: \"Knee issues\", description: \"Knee pain or limitations\" },\n        { value: \"back\", label: \"Back problems\", description: \"Lower or upper back issues\" },\n        { value: \"shoulder\", label: \"Shoulder issues\", description: \"Shoulder pain or mobility limits\" },\n        { value: \"ankle\", label: \"Ankle problems\", description: \"Ankle instability or pain\" },\n        { value: \"wrist\", label: \"Wrist/hand issues\", description: \"Wrist pain or grip limitations\" },\n        { value: \"other\", label: \"Other limitations\", description: \"Other physical restrictions\" }\n      ]\n    }\n  ];\n\n  const handleAnswerChange = (key: string, value: any, isCheckbox = false) => {\n    setQuestionnaire(prev => ({\n      ...prev,\n      [key]: isCheckbox \n        ? (prev[key as keyof QuestionnaireData] as string[]).includes(value)\n          ? (prev[key as keyof QuestionnaireData] as string[]).filter((item: string) => item !== value)\n          : [...(prev[key as keyof QuestionnaireData] as string[]), value]\n        : value\n    }));\n  };\n\n  const handleNext = () => {\n    if (currentStep < questions.length - 1) {\n      setCurrentStep(currentStep + 1);\n    } else {\n      // Final step - save preferences (which will trigger plan generation)\n      savePreferencesMutation.mutate(questionnaire);\n    }\n  };\n\n  const handlePrevious = () => {\n    if (currentStep > 0) {\n      setCurrentStep(currentStep - 1);\n    }\n  };\n\n  const isStepValid = () => {\n    const question = questions[currentStep];\n    const value = questionnaire[question.key as keyof QuestionnaireData];\n    \n    if (question.type === \"checkbox\") {\n      return Array.isArray(value) && value.length > 0;\n    }\n    \n    return value !== \"\" && value !== undefined;\n  };\n\n  const renderWeeklySchedule = () => {\n    if (!workoutPlan?.plannedWorkouts) {\n      return (\n        <Card className=\"bg-black/80 border-red-800/30\">\n          <CardContent className=\"p-12 text-center space-y-4\">\n            <div className=\"w-16 h-16 bg-red-600/20 rounded-full flex items-center justify-center mx-auto\">\n              <Dumbbell className=\"w-8 h-8 text-red-500\" />\n            </div>\n            <h3 className=\"text-xl font-semibold text-white\">No Workout Plan Generated Yet</h3>\n            <p className=\"text-gray-400 max-w-md mx-auto\">\n              Click the \"Generate New Plan\" button below to create your personalized AI-powered workout plan.\n            </p>\n            <Button \n              onClick={() => generatePlanMutation.mutate()} \n              disabled={generatePlanMutation.isPending}\n              className=\"bg-gradient-to-r from-red-600 to-red-700 hover:from-red-700 hover:to-red-800\"\n              data-testid=\"button-generate-initial-plan\"\n            >\n              {generatePlanMutation.isPending ? (\n                <>\n                  <Loader2 className=\"mr-2 h-4 w-4 animate-spin\" />\n                  Generating Your Plan...\n                </>\n              ) : (\n                <>\n                  <Play className=\"mr-2 h-4 w-4\" />\n                  Generate My Workout Plan\n                </>\n              )}\n            </Button>\n          </CardContent>\n        </Card>\n      );\n    }\n\n    const daysOfWeek = [\"Sunday\", \"Monday\", \"Tuesday\", \"Wednesday\", \"Thursday\", \"Friday\", \"Saturday\"];\n    const currentWeek = 1; // For now, show first week\n    \n    const weekWorkouts = workoutPlan.plannedWorkouts.filter(w => w.weekNumber === currentWeek);\n    \n    return (\n      <div className=\"grid gap-4\">\n        <h3 className=\"text-lg font-semibold flex items-center gap-2 text-white\">\n          <Calendar className=\"w-5 h-5\" />\n          Weekly Schedule - Week {currentWeek}\n        </h3>\n        <div className=\"grid gap-3\">\n          {daysOfWeek.map((day, index) => {\n            const dayWorkout = weekWorkouts.find(w => w.dayOfWeek === index);\n            \n            return (\n              <Card key={day} className={`p-4 ${dayWorkout?.isRestDay ? 'bg-gray-900/50' : 'bg-gray-900/70'}`} data-testid={`workout-card-${day.toLowerCase()}`}>\n                <div className=\"flex items-center justify-between\">\n                  <div className=\"flex items-center gap-3\">\n                    <div className=\"w-2 h-2 rounded-full bg-primary\" />\n                    <span className=\"font-medium text-white\">{day}</span>\n                  </div>\n                  <div className=\"flex items-center gap-2\">\n                    {dayWorkout ? (\n                      dayWorkout.isRestDay ? (\n                        <Badge variant=\"secondary\" className=\"flex items-center gap-1\">\n                          <RotateCcw className=\"w-3 h-3\" />\n                          Rest Day\n                        </Badge>\n                      ) : (\n                        <div className=\"flex items-center gap-2\">\n                          <Badge variant=\"default\" className=\"flex items-center gap-1\">\n                            <Dumbbell className=\"w-3 h-3\" />\n                            {dayWorkout.workoutType}\n                          </Badge>\n                          <span className=\"text-sm text-gray-400\">\n                            {dayWorkout.estimatedDuration}min\n                          </span>\n                        </div>\n                      )\n                    ) : (\n                      <Badge variant=\"outline\">No workout</Badge>\n                    )}\n                  </div>\n                </div>\n                {dayWorkout && !dayWorkout.isRestDay && (\n                  <div className=\"mt-3 space-y-3\">\n                    <div className=\"space-y-1\">\n                      <h4 className=\"font-semibold text-white\">{dayWorkout.name}</h4>\n                      <p className=\"text-sm text-gray-400\">{dayWorkout.description}</p>\n                    </div>\n                    \n                    {dayWorkout.exercises && Array.isArray(dayWorkout.exercises) && dayWorkout.exercises.length > 0 ? (\n                      <div className=\"space-y-2 mt-4 pt-3 border-t border-gray-700\">\n                        <h5 className=\"text-sm font-medium text-white flex items-center gap-2\">\n                          <Activity className=\"w-4 h-4 text-primary\" />\n                          Exercises ({dayWorkout.exercises.length})\n                        </h5>\n                        <div className=\"space-y-3\">\n                          {(dayWorkout.exercises as any[]).map((exercise: any, idx: number) => (\n                            <div key={idx} className=\"bg-gray-800/50 rounded-lg p-3 space-y-1\" data-testid={`exercise-${idx}`}>\n                              <div className=\"flex items-start justify-between\">\n                                <span className=\"font-medium text-white text-sm\">{exercise.name}</span>\n                                <Badge variant=\"outline\" className=\"text-xs\">\n                                  {exercise.sets} × {exercise.reps}\n                                </Badge>\n                              </div>\n                              <div className=\"flex items-center gap-3 text-xs text-gray-400\">\n                                <span>Rest: {exercise.restSeconds}s</span>\n                              </div>\n                              {exercise.notes && (\n                                <p className=\"text-xs text-gray-500 mt-1 italic\">{exercise.notes}</p>\n                              )}\n                            </div>\n                          ))}\n                        </div>\n                      </div>\n                    ) : null}\n                  </div>\n                )}\n              </Card>\n            );\n          })}\n        </div>\n      </div>\n    );\n  };\n\n  if (showPlan && preferences) {\n    return (\n      <FeatureGate feature=\"workout_planner\">\n        <div className=\"container mx-auto px-4 py-8 space-y-8\">\n        <div className=\"text-center space-y-4\">\n          <h1 className=\"text-3xl font-bold text-white flex items-center justify-center gap-3\">\n            <Target className=\"w-8 h-8 text-primary\" />\n            Your Personalized Workout Plan\n          </h1>\n          <p className=\"text-gray-600 max-w-2xl mx-auto\">\n            Based on your preferences, we've created a customized workout plan with rest days included.\n          </p>\n        </div>\n\n        <PageMedicalDisclaimer type=\"exercise\" />\n        <AIGeneratedDisclaimer />\n\n        <Tabs defaultValue=\"schedule\" className=\"w-full\">\n          <TabsList className=\"grid w-full grid-cols-3\">\n            <TabsTrigger value=\"schedule\">Weekly Schedule</TabsTrigger>\n            <TabsTrigger value=\"preferences\">Your Preferences</TabsTrigger>\n            <TabsTrigger value=\"progress\">Progress</TabsTrigger>\n          </TabsList>\n\n          <TabsContent value=\"schedule\" className=\"space-y-6\">\n            {renderWeeklySchedule()}\n            \n            <div className=\"flex gap-4 justify-center\">\n              <Button \n                onClick={() => generatePlanMutation.mutate()} \n                disabled={generatePlanMutation.isPending}\n                className=\"flex items-center gap-2\"\n              >\n                <RotateCcw className=\"w-4 h-4\" />\n                {generatePlanMutation.isPending ? \"Generating...\" : \"Generate New Plan\"}\n              </Button>\n              <Button \n                variant=\"outline\" \n                onClick={() => setShowPlan(false)}\n                className=\"flex items-center gap-2\"\n              >\n                <Target className=\"w-4 h-4\" />\n                Retake Quiz\n              </Button>\n            </div>\n          </TabsContent>\n\n          <TabsContent value=\"preferences\" className=\"space-y-6\">\n            <Card>\n              <CardHeader>\n                <CardTitle>Your Workout Preferences</CardTitle>\n                <CardDescription>These settings were used to create your plan</CardDescription>\n              </CardHeader>\n              <CardContent className=\"space-y-4\">\n                <div className=\"grid md:grid-cols-2 gap-4\">\n                  <div>\n                    <Label className=\"text-sm font-medium text-white\">Fitness Level</Label>\n                    <Badge variant=\"outline\" className=\"mt-1 capitalize\">{preferences.fitnessLevel}</Badge>\n                  </div>\n                  <div>\n                    <Label className=\"text-sm font-medium text-white\">Workout Days</Label>\n                    <Badge variant=\"outline\" className=\"mt-1\">{preferences.workoutDaysPerWeek} days/week</Badge>\n                  </div>\n                  <div>\n                    <Label className=\"text-sm font-medium text-white\">Session Duration</Label>\n                    <Badge variant=\"outline\" className=\"mt-1\">{preferences.sessionDuration} minutes</Badge>\n                  </div>\n                  <div>\n                    <Label className=\"text-sm font-medium text-white\">Primary Goals</Label>\n                    <div className=\"flex flex-wrap gap-1 mt-1\">\n                      {preferences.primaryGoals.map(goal => (\n                        <Badge key={goal} variant=\"secondary\" className=\"text-xs\">\n                          {goal.replace(\"_\", \" \")}\n                        </Badge>\n                      ))}\n                    </div>\n                  </div>\n                </div>\n              </CardContent>\n            </Card>\n          </TabsContent>\n\n          <TabsContent value=\"progress\" className=\"space-y-6\">\n            <Card>\n              <CardHeader>\n                <CardTitle className=\"flex items-center gap-2\">\n                  <TrendingUp className=\"w-5 h-5\" />\n                  Weekly Progress\n                </CardTitle>\n                <CardDescription>Track your workout completion</CardDescription>\n              </CardHeader>\n              <CardContent>\n                <div className=\"space-y-4\">\n                  <div className=\"flex items-center justify-between\">\n                    <span className=\"text-sm text-gray-600\">This Week</span>\n                    <span className=\"text-sm font-medium\">0/{preferences.workoutDaysPerWeek} completed</span>\n                  </div>\n                  <Progress value={0} className=\"w-full\" />\n                </div>\n              </CardContent>\n            </Card>\n          </TabsContent>\n        </Tabs>\n        \n        <HealthSources />\n      </div>\n      </FeatureGate>\n    );\n  }\n\n  // Questionnaire flow\n  const currentQuestion = questions[currentStep];\n  const progress = ((currentStep + 1) / questions.length) * 100;\n\n  return (\n    <FeatureGate feature=\"workout_planner\">\n      <div className=\"container mx-auto px-4 py-8 max-w-3xl\">\n      <div className=\"text-center space-y-4 mb-8\">\n        <h1 className=\"text-3xl font-bold text-white flex items-center justify-center gap-3\">\n          <Target className=\"w-8 h-8 text-primary\" />\n          Workout Planner\n        </h1>\n        <p className=\"text-gray-600\">\n          Let's create a personalized workout plan tailored to your goals and preferences\n        </p>\n        <div className=\"space-y-2\">\n          <div className=\"flex items-center justify-between text-sm text-gray-500\">\n            <span>Question {currentStep + 1} of {questions.length}</span>\n            <span>{Math.round(progress)}% complete</span>\n          </div>\n          <Progress value={progress} className=\"w-full\" />\n        </div>\n      </div>\n\n      <PageMedicalDisclaimer type=\"exercise\" />\n      <AIGeneratedDisclaimer />\n\n      <Card className=\"mb-6\">\n        <CardHeader>\n          <CardTitle className=\"text-xl\">{currentQuestion.title}</CardTitle>\n        </CardHeader>\n        <CardContent className=\"space-y-4\">\n          {currentQuestion.type === \"radio\" ? (\n            <RadioGroup\n              value={questionnaire[currentQuestion.key as keyof QuestionnaireData] as string}\n              onValueChange={(value) => handleAnswerChange(currentQuestion.key, value)}\n            >\n              {currentQuestion.options.map((option) => (\n                <div key={option.value} className=\"flex items-start space-x-3 p-3 rounded-lg border hover:bg-gray-50 transition-colors\">\n                  <RadioGroupItem value={option.value} id={option.value} className=\"mt-0.5\" />\n                  <div className=\"flex-1\">\n                    <Label htmlFor={option.value} className=\"font-medium cursor-pointer\">\n                      {option.label}\n                    </Label>\n                    <p className=\"text-sm text-gray-500 mt-1\">{option.description}</p>\n                  </div>\n                </div>\n              ))}\n            </RadioGroup>\n          ) : (\n            <div className=\"space-y-3\">\n              {currentQuestion.options.map((option) => {\n                const isChecked = (questionnaire[currentQuestion.key as keyof QuestionnaireData] as string[]).includes(option.value);\n                return (\n                  <div key={option.value} className=\"flex items-start space-x-3 p-3 rounded-lg border hover:bg-gray-50 transition-colors\">\n                    <Checkbox\n                      id={option.value}\n                      checked={isChecked}\n                      onCheckedChange={() => handleAnswerChange(currentQuestion.key, option.value, true)}\n                      className=\"mt-0.5\"\n                    />\n                    <div className=\"flex-1\">\n                      <Label htmlFor={option.value} className=\"font-medium cursor-pointer\">\n                        {option.label}\n                      </Label>\n                      <p className=\"text-sm text-gray-500 mt-1\">{option.description}</p>\n                    </div>\n                  </div>\n                );\n              })}\n            </div>\n          )}\n        </CardContent>\n      </Card>\n\n      <div className=\"flex justify-between\">\n        <Button\n          variant=\"outline\"\n          onClick={handlePrevious}\n          disabled={currentStep === 0}\n          className=\"flex items-center gap-2\"\n        >\n          Previous\n        </Button>\n        <Button\n          onClick={handleNext}\n          disabled={!isStepValid() || savePreferencesMutation.isPending || generatePlanMutation.isPending}\n          className=\"flex items-center gap-2\"\n          data-testid=\"next-button\"\n        >\n          {currentStep === questions.length - 1 ? (\n            savePreferencesMutation.isPending || generatePlanMutation.isPending ? (\n              \"Creating Plan...\"\n            ) : (\n              \"Create My Plan\"\n            )\n          ) : (\n            \"Next\"\n          )}\n        </Button>\n      </div>\n      \n      <HealthSources />\n    </div>\n    </FeatureGate>\n  );\n}","size_bytes":24666},"client/src/components/ui/calendar.tsx":{"content":"import * as React from \"react\"\nimport { ChevronLeft, ChevronRight } from \"lucide-react\"\nimport { DayPicker } from \"react-day-picker\"\n\nimport { cn } from \"@/lib/utils\"\nimport { buttonVariants } from \"@/components/ui/button\"\n\nexport type CalendarProps = React.ComponentProps<typeof DayPicker>\n\nfunction Calendar({\n  className,\n  classNames,\n  showOutsideDays = true,\n  ...props\n}: CalendarProps) {\n  return (\n    <DayPicker\n      showOutsideDays={showOutsideDays}\n      className={cn(\"p-3\", className)}\n      classNames={{\n        months: \"flex flex-col sm:flex-row space-y-4 sm:space-x-4 sm:space-y-0\",\n        month: \"space-y-4\",\n        caption: \"flex justify-center pt-1 relative items-center\",\n        caption_label: \"text-sm font-medium\",\n        nav: \"space-x-1 flex items-center\",\n        nav_button: cn(\n          buttonVariants({ variant: \"outline\" }),\n          \"h-7 w-7 bg-transparent p-0 opacity-50 hover:opacity-100\"\n        ),\n        nav_button_previous: \"absolute left-1\",\n        nav_button_next: \"absolute right-1\",\n        table: \"w-full border-collapse space-y-1\",\n        head_row: \"flex\",\n        head_cell:\n          \"text-muted-foreground rounded-md w-9 font-normal text-[0.8rem]\",\n        row: \"flex w-full mt-2\",\n        cell: \"h-9 w-9 text-center text-sm p-0 relative [&:has([aria-selected].day-range-end)]:rounded-r-md [&:has([aria-selected].day-outside)]:bg-accent/50 [&:has([aria-selected])]:bg-accent first:[&:has([aria-selected])]:rounded-l-md last:[&:has([aria-selected])]:rounded-r-md focus-within:relative focus-within:z-20\",\n        day: cn(\n          buttonVariants({ variant: \"ghost\" }),\n          \"h-9 w-9 p-0 font-normal aria-selected:opacity-100\"\n        ),\n        day_range_end: \"day-range-end\",\n        day_selected:\n          \"bg-primary text-primary-foreground hover:bg-primary hover:text-primary-foreground focus:bg-primary focus:text-primary-foreground\",\n        day_today: \"bg-accent text-accent-foreground\",\n        day_outside:\n          \"day-outside text-muted-foreground aria-selected:bg-accent/50 aria-selected:text-muted-foreground\",\n        day_disabled: \"text-muted-foreground opacity-50\",\n        day_range_middle:\n          \"aria-selected:bg-accent aria-selected:text-accent-foreground\",\n        day_hidden: \"invisible\",\n        ...classNames,\n      }}\n      components={{\n        IconLeft: ({ className, ...props }) => (\n          <ChevronLeft className={cn(\"h-4 w-4\", className)} {...props} />\n        ),\n        IconRight: ({ className, ...props }) => (\n          <ChevronRight className={cn(\"h-4 w-4\", className)} {...props} />\n        ),\n      }}\n      {...props}\n    />\n  )\n}\nCalendar.displayName = \"Calendar\"\n\nexport { Calendar }\n","size_bytes":2695},"client/src/components/ui/label.tsx":{"content":"import * as React from \"react\"\nimport * as LabelPrimitive from \"@radix-ui/react-label\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst labelVariants = cva(\n  \"text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70\"\n)\n\nconst Label = React.forwardRef<\n  React.ElementRef<typeof LabelPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof LabelPrimitive.Root> &\n    VariantProps<typeof labelVariants>\n>(({ className, ...props }, ref) => (\n  <LabelPrimitive.Root\n    ref={ref}\n    className={cn(labelVariants(), className)}\n    {...props}\n  />\n))\nLabel.displayName = LabelPrimitive.Root.displayName\n\nexport { Label }\n","size_bytes":710},"client/src/components/ui/tabs.tsx":{"content":"import * as React from \"react\"\nimport * as TabsPrimitive from \"@radix-ui/react-tabs\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Tabs = TabsPrimitive.Root\n\nconst TabsList = React.forwardRef<\n  React.ElementRef<typeof TabsPrimitive.List>,\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.List>\n>(({ className, ...props }, ref) => (\n  <TabsPrimitive.List\n    ref={ref}\n    className={cn(\n      \"inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\nTabsList.displayName = TabsPrimitive.List.displayName\n\nconst TabsTrigger = React.forwardRef<\n  React.ElementRef<typeof TabsPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.Trigger>\n>(({ className, ...props }, ref) => (\n  <TabsPrimitive.Trigger\n    ref={ref}\n    className={cn(\n      \"inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm\",\n      className\n    )}\n    {...props}\n  />\n))\nTabsTrigger.displayName = TabsPrimitive.Trigger.displayName\n\nconst TabsContent = React.forwardRef<\n  React.ElementRef<typeof TabsPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <TabsPrimitive.Content\n    ref={ref}\n    className={cn(\n      \"mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2\",\n      className\n    )}\n    {...props}\n  />\n))\nTabsContent.displayName = TabsPrimitive.Content.displayName\n\nexport { Tabs, TabsList, TabsTrigger, TabsContent }\n","size_bytes":1883},"tailwind.config.ts":{"content":"import type { Config } from \"tailwindcss\";\n\nexport default {\n  darkMode: [\"class\"],\n  content: [\"./client/index.html\", \"./client/src/**/*.{js,jsx,ts,tsx}\"],\n  theme: {\n    extend: {\n      borderRadius: {\n        lg: \"var(--radius)\",\n        md: \"calc(var(--radius) - 2px)\",\n        sm: \"calc(var(--radius) - 4px)\",\n      },\n      colors: {\n        background: \"var(--background)\",\n        foreground: \"var(--foreground)\",\n        card: {\n          DEFAULT: \"var(--card)\",\n          foreground: \"var(--card-foreground)\",\n        },\n        popover: {\n          DEFAULT: \"var(--popover)\",\n          foreground: \"var(--popover-foreground)\",\n        },\n        primary: {\n          DEFAULT: \"var(--primary)\",\n          foreground: \"var(--primary-foreground)\",\n        },\n        secondary: {\n          DEFAULT: \"var(--secondary)\",\n          foreground: \"var(--secondary-foreground)\",\n        },\n        muted: {\n          DEFAULT: \"var(--muted)\",\n          foreground: \"var(--muted-foreground)\",\n        },\n        accent: {\n          DEFAULT: \"var(--accent)\",\n          foreground: \"var(--accent-foreground)\",\n        },\n        destructive: {\n          DEFAULT: \"var(--destructive)\",\n          foreground: \"var(--destructive-foreground)\",\n        },\n        border: \"var(--border)\",\n        input: \"var(--input)\",\n        ring: \"var(--ring)\",\n        chart: {\n          \"1\": \"var(--chart-1)\",\n          \"2\": \"var(--chart-2)\",\n          \"3\": \"var(--chart-3)\",\n          \"4\": \"var(--chart-4)\",\n          \"5\": \"var(--chart-5)\",\n        },\n        sidebar: {\n          DEFAULT: \"var(--sidebar-background)\",\n          foreground: \"var(--sidebar-foreground)\",\n          primary: \"var(--sidebar-primary)\",\n          \"primary-foreground\": \"var(--sidebar-primary-foreground)\",\n          accent: \"var(--sidebar-accent)\",\n          \"accent-foreground\": \"var(--sidebar-accent-foreground)\",\n          border: \"var(--sidebar-border)\",\n          ring: \"var(--sidebar-ring)\",\n        },\n      },\n      fontFamily: {\n        sans: [\"var(--font-sans)\"],\n        serif: [\"var(--font-serif)\"],\n        mono: [\"var(--font-mono)\"],\n        inter: [\"Inter\", \"sans-serif\"],\n      },\n      keyframes: {\n        \"accordion-down\": {\n          from: {\n            height: \"0\",\n          },\n          to: {\n            height: \"var(--radix-accordion-content-height)\",\n          },\n        },\n        \"accordion-up\": {\n          from: {\n            height: \"var(--radix-accordion-content-height)\",\n          },\n          to: {\n            height: \"0\",\n          },\n        },\n      },\n      animation: {\n        \"accordion-down\": \"accordion-down 0.2s ease-out\",\n        \"accordion-up\": \"accordion-up 0.2s ease-out\",\n      },\n    },\n  },\n  plugins: [require(\"tailwindcss-animate\"), require(\"@tailwindcss/typography\")],\n} satisfies Config;\n","size_bytes":2806},"client/src/lib/authUtils.ts":{"content":"export function isUnauthorizedError(error: Error): boolean {\n  return /^401: .*Unauthorized/.test(error.message);\n}","size_bytes":115},"client/src/components/ui/radio-group.tsx":{"content":"import * as React from \"react\"\nimport * as RadioGroupPrimitive from \"@radix-ui/react-radio-group\"\nimport { Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst RadioGroup = React.forwardRef<\n  React.ElementRef<typeof RadioGroupPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof RadioGroupPrimitive.Root>\n>(({ className, ...props }, ref) => {\n  return (\n    <RadioGroupPrimitive.Root\n      className={cn(\"grid gap-2\", className)}\n      {...props}\n      ref={ref}\n    />\n  )\n})\nRadioGroup.displayName = RadioGroupPrimitive.Root.displayName\n\nconst RadioGroupItem = React.forwardRef<\n  React.ElementRef<typeof RadioGroupPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof RadioGroupPrimitive.Item>\n>(({ className, ...props }, ref) => {\n  return (\n    <RadioGroupPrimitive.Item\n      ref={ref}\n      className={cn(\n        \"aspect-square h-4 w-4 rounded-full border border-primary text-primary ring-offset-background focus:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50\",\n        className\n      )}\n      {...props}\n    >\n      <RadioGroupPrimitive.Indicator className=\"flex items-center justify-center\">\n        <Circle className=\"h-2.5 w-2.5 fill-current text-current\" />\n      </RadioGroupPrimitive.Indicator>\n    </RadioGroupPrimitive.Item>\n  )\n})\nRadioGroupItem.displayName = RadioGroupPrimitive.Item.displayName\n\nexport { RadioGroup, RadioGroupItem }\n","size_bytes":1467},"client/src/main.tsx":{"content":"import { createRoot } from \"react-dom/client\";\nimport App from \"./App\";\nimport \"./index.css\";\n\ncreateRoot(document.getElementById(\"root\")!).render(<App />);\n","size_bytes":157},"client/src/components/ui/command.tsx":{"content":"import * as React from \"react\"\nimport { type DialogProps } from \"@radix-ui/react-dialog\"\nimport { Command as CommandPrimitive } from \"cmdk\"\nimport { Search } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Dialog, DialogContent } from \"@/components/ui/dialog\"\n\nconst Command = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive\n    ref={ref}\n    className={cn(\n      \"flex h-full w-full flex-col overflow-hidden rounded-md bg-popover text-popover-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\nCommand.displayName = CommandPrimitive.displayName\n\nconst CommandDialog = ({ children, ...props }: DialogProps) => {\n  return (\n    <Dialog {...props}>\n      <DialogContent className=\"overflow-hidden p-0 shadow-lg\">\n        <Command className=\"[&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-muted-foreground [&_[cmdk-group]:not([hidden])_~[cmdk-group]]:pt-0 [&_[cmdk-group]]:px-2 [&_[cmdk-input-wrapper]_svg]:h-5 [&_[cmdk-input-wrapper]_svg]:w-5 [&_[cmdk-input]]:h-12 [&_[cmdk-item]]:px-2 [&_[cmdk-item]]:py-3 [&_[cmdk-item]_svg]:h-5 [&_[cmdk-item]_svg]:w-5\">\n          {children}\n        </Command>\n      </DialogContent>\n    </Dialog>\n  )\n}\n\nconst CommandInput = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Input>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Input>\n>(({ className, ...props }, ref) => (\n  <div className=\"flex items-center border-b px-3\" cmdk-input-wrapper=\"\">\n    <Search className=\"mr-2 h-4 w-4 shrink-0 opacity-50\" />\n    <CommandPrimitive.Input\n      ref={ref}\n      className={cn(\n        \"flex h-11 w-full rounded-md bg-transparent py-3 text-sm outline-none placeholder:text-muted-foreground disabled:cursor-not-allowed disabled:opacity-50\",\n        className\n      )}\n      {...props}\n    />\n  </div>\n))\n\nCommandInput.displayName = CommandPrimitive.Input.displayName\n\nconst CommandList = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.List>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.List>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.List\n    ref={ref}\n    className={cn(\"max-h-[300px] overflow-y-auto overflow-x-hidden\", className)}\n    {...props}\n  />\n))\n\nCommandList.displayName = CommandPrimitive.List.displayName\n\nconst CommandEmpty = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Empty>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Empty>\n>((props, ref) => (\n  <CommandPrimitive.Empty\n    ref={ref}\n    className=\"py-6 text-center text-sm\"\n    {...props}\n  />\n))\n\nCommandEmpty.displayName = CommandPrimitive.Empty.displayName\n\nconst CommandGroup = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Group>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Group>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.Group\n    ref={ref}\n    className={cn(\n      \"overflow-hidden p-1 text-foreground [&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:py-1.5 [&_[cmdk-group-heading]]:text-xs [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-muted-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\n\nCommandGroup.displayName = CommandPrimitive.Group.displayName\n\nconst CommandSeparator = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 h-px bg-border\", className)}\n    {...props}\n  />\n))\nCommandSeparator.displayName = CommandPrimitive.Separator.displayName\n\nconst CommandItem = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Item>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default gap-2 select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none data-[disabled=true]:pointer-events-none data-[selected='true']:bg-accent data-[selected=true]:text-accent-foreground data-[disabled=true]:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\",\n      className\n    )}\n    {...props}\n  />\n))\n\nCommandItem.displayName = CommandPrimitive.Item.displayName\n\nconst CommandShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\n        \"ml-auto text-xs tracking-widest text-muted-foreground\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\nCommandShortcut.displayName = \"CommandShortcut\"\n\nexport {\n  Command,\n  CommandDialog,\n  CommandInput,\n  CommandList,\n  CommandEmpty,\n  CommandGroup,\n  CommandItem,\n  CommandShortcut,\n  CommandSeparator,\n}\n","size_bytes":4885},"client/src/components/ui/sheet.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as SheetPrimitive from \"@radix-ui/react-dialog\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\nimport { X } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Sheet = SheetPrimitive.Root\n\nconst SheetTrigger = SheetPrimitive.Trigger\n\nconst SheetClose = SheetPrimitive.Close\n\nconst SheetPortal = SheetPrimitive.Portal\n\nconst SheetOverlay = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <SheetPrimitive.Overlay\n    className={cn(\n      \"fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0\",\n      className\n    )}\n    {...props}\n    ref={ref}\n  />\n))\nSheetOverlay.displayName = SheetPrimitive.Overlay.displayName\n\nconst sheetVariants = cva(\n  \"fixed z-50 gap-4 bg-background p-6 shadow-lg transition ease-in-out data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:duration-300 data-[state=open]:duration-500\",\n  {\n    variants: {\n      side: {\n        top: \"inset-x-0 top-0 border-b data-[state=closed]:slide-out-to-top data-[state=open]:slide-in-from-top\",\n        bottom:\n          \"inset-x-0 bottom-0 border-t data-[state=closed]:slide-out-to-bottom data-[state=open]:slide-in-from-bottom\",\n        left: \"inset-y-0 left-0 h-full w-3/4 border-r data-[state=closed]:slide-out-to-left data-[state=open]:slide-in-from-left sm:max-w-sm\",\n        right:\n          \"inset-y-0 right-0 h-full w-3/4  border-l data-[state=closed]:slide-out-to-right data-[state=open]:slide-in-from-right sm:max-w-sm\",\n      },\n    },\n    defaultVariants: {\n      side: \"right\",\n    },\n  }\n)\n\ninterface SheetContentProps\n  extends React.ComponentPropsWithoutRef<typeof SheetPrimitive.Content>,\n    VariantProps<typeof sheetVariants> {}\n\nconst SheetContent = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Content>,\n  SheetContentProps\n>(({ side = \"right\", className, children, ...props }, ref) => (\n  <SheetPortal>\n    <SheetOverlay />\n    <SheetPrimitive.Content\n      ref={ref}\n      className={cn(sheetVariants({ side }), className)}\n      {...props}\n    >\n      {children}\n      <SheetPrimitive.Close className=\"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-secondary\">\n        <X className=\"h-4 w-4\" />\n        <span className=\"sr-only\">Close</span>\n      </SheetPrimitive.Close>\n    </SheetPrimitive.Content>\n  </SheetPortal>\n))\nSheetContent.displayName = SheetPrimitive.Content.displayName\n\nconst SheetHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col space-y-2 text-center sm:text-left\",\n      className\n    )}\n    {...props}\n  />\n)\nSheetHeader.displayName = \"SheetHeader\"\n\nconst SheetFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2\",\n      className\n    )}\n    {...props}\n  />\n)\nSheetFooter.displayName = \"SheetFooter\"\n\nconst SheetTitle = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <SheetPrimitive.Title\n    ref={ref}\n    className={cn(\"text-lg font-semibold text-foreground\", className)}\n    {...props}\n  />\n))\nSheetTitle.displayName = SheetPrimitive.Title.displayName\n\nconst SheetDescription = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <SheetPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nSheetDescription.displayName = SheetPrimitive.Description.displayName\n\nexport {\n  Sheet,\n  SheetPortal,\n  SheetOverlay,\n  SheetTrigger,\n  SheetClose,\n  SheetContent,\n  SheetHeader,\n  SheetFooter,\n  SheetTitle,\n  SheetDescription,\n}\n","size_bytes":4281},"client/src/components/ObjectUploader.tsx":{"content":"import { useState } from \"react\";\nimport type { ReactNode } from \"react\";\nimport Uppy from \"@uppy/core\";\nimport { DashboardModal } from \"@uppy/react\";\nimport \"@uppy/core/dist/style.min.css\";\nimport \"@uppy/dashboard/dist/style.min.css\";\nimport AwsS3 from \"@uppy/aws-s3\";\nimport type { UploadResult } from \"@uppy/core\";\nimport { Button } from \"@/components/ui/button\";\n\ninterface ObjectUploaderProps {\n  maxNumberOfFiles?: number;\n  maxFileSize?: number;\n  onGetUploadParameters: () => Promise<{\n    method: \"PUT\";\n    url: string;\n  }>;\n  onComplete?: (\n    result: UploadResult<Record<string, unknown>, Record<string, unknown>>\n  ) => void;\n  buttonClassName?: string;\n  children: ReactNode;\n}\n\n/**\n * A file upload component that renders as a button and provides a modal interface for\n * file management.\n * \n * Features:\n * - Renders as a customizable button that opens a file upload modal\n * - Provides a modal interface for:\n *   - File selection\n *   - File preview\n *   - Upload progress tracking\n *   - Upload status display\n * \n * The component uses Uppy under the hood to handle all file upload functionality.\n * All file management features are automatically handled by the Uppy dashboard modal.\n * \n * @param props - Component props\n * @param props.maxNumberOfFiles - Maximum number of files allowed to be uploaded\n *   (default: 1)\n * @param props.maxFileSize - Maximum file size in bytes (default: 10MB)\n * @param props.onGetUploadParameters - Function to get upload parameters (method and URL).\n *   Typically used to fetch a presigned URL from the backend server for direct-to-S3\n *   uploads.\n * @param props.onComplete - Callback function called when upload is complete. Typically\n *   used to make post-upload API calls to update server state and set object ACL\n *   policies.\n * @param props.buttonClassName - Optional CSS class name for the button\n * @param props.children - Content to be rendered inside the button\n */\nexport function ObjectUploader({\n  maxNumberOfFiles = 1,\n  maxFileSize = 10485760, // 10MB default\n  onGetUploadParameters,\n  onComplete,\n  buttonClassName,\n  children,\n}: ObjectUploaderProps) {\n  const [showModal, setShowModal] = useState(false);\n  const [uppy] = useState(() =>\n    new Uppy({\n      restrictions: {\n        maxNumberOfFiles,\n        maxFileSize,\n      },\n      autoProceed: false,\n    })\n      .use(AwsS3, {\n        shouldUseMultipart: false,\n        getUploadParameters: onGetUploadParameters,\n      })\n      .on(\"complete\", (result) => {\n        onComplete?.(result);\n      })\n  );\n\n  return (\n    <div>\n      <Button onClick={() => setShowModal(true)} className={buttonClassName}>\n        {children}\n      </Button>\n\n      <DashboardModal\n        uppy={uppy}\n        open={showModal}\n        onRequestClose={() => setShowModal(false)}\n        proudlyDisplayPoweredByUppy={false}\n      />\n    </div>\n  );\n}","size_bytes":2866},"client/src/components/quick-stats.tsx":{"content":"import { useQuery } from \"@tanstack/react-query\";\nimport { Dumbbell, Clock, Flame, Trophy } from \"lucide-react\";\nimport type { UserStats } from \"@shared/schema\";\n\nexport default function QuickStats() {\n  const { data: stats, isLoading } = useQuery<UserStats>({\n    queryKey: [\"/api/stats\"],\n  });\n\n  if (isLoading) {\n    return (\n      <section className=\"mb-8\">\n        <div className=\"grid grid-cols-2 md:grid-cols-4 gap-4\">\n          {[...Array(4)].map((_, i) => (\n            <div key={i} className=\"bg-white rounded-xl p-4 shadow-sm border border-gray-100 animate-pulse\">\n              <div className=\"flex items-center space-x-3\">\n                <div className=\"bg-gray-200 rounded-lg p-2 w-10 h-10\"></div>\n                <div>\n                  <div className=\"h-8 w-8 bg-gray-200 rounded mb-1\"></div>\n                  <div className=\"h-4 w-12 bg-gray-200 rounded\"></div>\n                </div>\n              </div>\n            </div>\n          ))}\n        </div>\n      </section>\n    );\n  }\n\n  if (!stats) {\n    return (\n      <section className=\"mb-8\">\n        <div className=\"bg-white rounded-xl p-6 shadow-sm border border-gray-100\">\n          <p className=\"text-center text-muted\">Unable to load stats</p>\n        </div>\n      </section>\n    );\n  }\n\n  return (\n    <section className=\"mb-8\">\n      <div className=\"grid grid-cols-2 md:grid-cols-4 gap-4\">\n        <div className=\"bg-white rounded-xl p-4 shadow-sm border border-gray-100\">\n          <div className=\"flex items-center space-x-3\">\n            <div className=\"bg-primary bg-opacity-10 rounded-lg p-2\">\n              <Dumbbell className=\"text-primary\" />\n            </div>\n            <div>\n              <p className=\"text-2xl font-bold text-primary\">{stats.totalWorkouts}</p>\n              <p className=\"text-sm text-muted\">Workouts</p>\n            </div>\n          </div>\n        </div>\n        \n        <div className=\"bg-white rounded-xl p-4 shadow-sm border border-gray-100\">\n          <div className=\"flex items-center space-x-3\">\n            <div className=\"bg-secondary bg-opacity-10 rounded-lg p-2\">\n              <Clock className=\"text-secondary\" />\n            </div>\n            <div>\n              <p className=\"text-2xl font-bold text-secondary\">{stats.totalHours}</p>\n              <p className=\"text-sm text-muted\">Hours</p>\n            </div>\n          </div>\n        </div>\n        \n        <div className=\"bg-white rounded-xl p-4 shadow-sm border border-gray-100\">\n          <div className=\"flex items-center space-x-3\">\n            <div className=\"bg-accent bg-opacity-10 rounded-lg p-2\">\n              <Flame className=\"text-accent\" />\n            </div>\n            <div>\n              <p className=\"text-2xl font-bold text-accent\">{stats.caloriesBurned.toLocaleString()}</p>\n              <p className=\"text-sm text-muted\">Calories</p>\n            </div>\n          </div>\n        </div>\n        \n        <div className=\"bg-white rounded-xl p-4 shadow-sm border border-gray-100\">\n          <div className=\"flex items-center space-x-3\">\n            <div className=\"bg-green-500 bg-opacity-10 rounded-lg p-2\">\n              <Trophy className=\"text-green-500\" />\n            </div>\n            <div>\n              <p className=\"text-2xl font-bold text-green-500\">{stats.personalRecords}</p>\n              <p className=\"text-sm text-muted\">PRs</p>\n            </div>\n          </div>\n        </div>\n      </div>\n    </section>\n  );\n}\n","size_bytes":3429},"server/index.ts":{"content":"import express, { type Request, Response, NextFunction } from \"express\";\nimport cookieParser from \"cookie-parser\";\nimport { registerRoutes } from \"./routes\";\nimport { setupVite, serveStatic, log } from \"./vite\";\nimport { badgeService } from \"./badge-service\";\n\nconst app = express();\napp.use(express.json({ limit: '10mb' }));\napp.use(express.urlencoded({ extended: false, limit: '10mb' }));\napp.use(cookieParser());\n\napp.use((req, res, next) => {\n  const start = Date.now();\n  const path = req.path;\n  let capturedJsonResponse: Record<string, any> | undefined = undefined;\n\n  const originalResJson = res.json;\n  res.json = function (bodyJson, ...args) {\n    capturedJsonResponse = bodyJson;\n    return originalResJson.apply(res, [bodyJson, ...args]);\n  };\n\n  res.on(\"finish\", () => {\n    const duration = Date.now() - start;\n    if (path.startsWith(\"/api\")) {\n      let logLine = `${req.method} ${path} ${res.statusCode} in ${duration}ms`;\n      if (capturedJsonResponse) {\n        logLine += ` :: ${JSON.stringify(capturedJsonResponse)}`;\n      }\n\n      if (logLine.length > 80) {\n        logLine = logLine.slice(0, 79) + \"…\";\n      }\n\n      log(logLine);\n    }\n  });\n\n  next();\n});\n\n(async () => {\n  const server = await registerRoutes(app);\n\n  // Initialize badges in the database\n  await badgeService.initializeBadges();\n  log(\"Badges initialized\");\n\n  app.use((err: any, _req: Request, res: Response, _next: NextFunction) => {\n    const status = err.status || err.statusCode || 500;\n    const message = err.message || \"Internal Server Error\";\n\n    res.status(status).json({ message });\n    throw err;\n  });\n\n  // importantly only setup vite in development and after\n  // setting up all the other routes so the catch-all route\n  // doesn't interfere with the other routes\n  if (app.get(\"env\") === \"development\") {\n    await setupVite(app, server);\n  } else {\n    serveStatic(app);\n  }\n\n  // ALWAYS serve the app on the port specified in the environment variable PORT\n  // Other ports are firewalled. Default to 5000 if not specified.\n  // this serves both the API and the client.\n  // It is the only port that is not firewalled.\n  const port = parseInt(process.env.PORT || '5000', 10);\n  server.listen({\n    port,\n    host: \"0.0.0.0\",\n    reusePort: true,\n  }, () => {\n    log(`serving on port ${port}`);\n  });\n})();\n","size_bytes":2323},"client/src/pages/home.tsx":{"content":"import { useEffect, useState } from \"react\";\nimport { Link, useLocation } from \"wouter\";\nimport { Dumbbell, Target, TrendingUp, MapPin, Users, Sparkles, ChevronRight, Plus } from \"lucide-react\";\nimport NavigationHeader from \"@/components/navigation-header\";\nimport MobileNavigation from \"@/components/mobile-navigation\";\nimport QuickStats from \"@/components/quick-stats\";\nimport ProfileEditor from \"@/components/profile-editor\";\nimport { useNewAuth } from \"@/hooks/useNewAuth\";\nimport { Card, CardContent } from \"@/components/ui/card\";\nimport { usePullToRefresh } from \"@/hooks/use-pull-to-refresh\";\nimport { useQueryClient } from \"@tanstack/react-query\";\nimport heroImage from \"@assets/stock_images/men_and_women_workin_dbbf742b.jpg\";\nimport womanWeights1 from \"@assets/stock_images/woman_strength_train_10dee1d1.jpg\";\nimport womanWeights2 from \"@assets/stock_images/woman_strength_train_eff6079d.jpg\";\nimport manCardio1 from \"@assets/stock_images/man_doing_cardio_run_26f92c48.jpg\";\nimport manCardio2 from \"@assets/stock_images/man_doing_cardio_run_1b64af4d.jpg\";\nimport groupFitness1 from \"@assets/stock_images/people_group_fitness_14845970.jpg\";\nimport groupFitness2 from \"@assets/stock_images/people_group_fitness_0fe8a6fd.jpg\";\n\nexport default function Home() {\n  const [showProfileEditor, setShowProfileEditor] = useState(false);\n  const { user } = useNewAuth();\n  const [, navigate] = useLocation();\n  const queryClient = useQueryClient();\n\n  // Pull to refresh functionality - scoped to home page queries\n  const handleRefresh = async () => {\n    await Promise.all([\n      queryClient.invalidateQueries({ queryKey: ['/api/stats'] }),\n      queryClient.invalidateQueries({ queryKey: ['/api/notification-preferences'] }),\n      queryClient.invalidateQueries({ queryKey: ['/api/auth/user'] })\n    ]);\n  };\n\n  const { containerRef, PullToRefreshIndicator, isRefreshing } = usePullToRefresh({\n    onRefresh: handleRefresh\n  });\n\n  // Auto-open profile editor when user first logs in\n  useEffect(() => {\n    const hasShownProfileEditor = localStorage.getItem('hasShownProfileEditor');\n    \n    if (user && !hasShownProfileEditor) {\n      // Small delay to ensure the page has fully loaded\n      const timer = setTimeout(() => {\n        setShowProfileEditor(true);\n        localStorage.setItem('hasShownProfileEditor', 'true');\n      }, 1000);\n      \n      return () => clearTimeout(timer);\n    }\n  }, [user]);\n\n  const features = [\n    {\n      icon: Dumbbell,\n      title: \"Log Workouts\",\n      description: \"Track your exercises, sets, reps, and weight\",\n      link: \"/workouts\",\n      color: \"red-dark\",\n      testId: \"link-workouts\"\n    },\n    {\n      icon: MapPin,\n      title: \"Mile Tracker\",\n      description: \"GPS-powered automatic mile counting for runs\",\n      link: \"/mile-tracker\",\n      color: \"red\",\n      testId: \"link-mile-tracker\"\n    },\n    {\n      icon: TrendingUp,\n      title: \"View Progress\",\n      description: \"See charts and analytics of your fitness journey\",\n      link: \"/progress\",\n      color: \"red-dark\",\n      testId: \"link-progress\"\n    },\n    {\n      icon: Sparkles,\n      title: \"AI Features\",\n      description: \"Get personalized workout & meal recommendations\",\n      link: \"/subscription\",\n      color: \"red-light\",\n      badge: \"Premium\",\n      testId: \"link-premium\"\n    }\n  ];\n\n  const getColorClasses = (color: string) => {\n    const colors = {\n      \"red\": \"from-red-500 to-red-700 hover:from-red-600 hover:to-red-800\",\n      \"red-dark\": \"from-red-700 to-red-900 hover:from-red-800 hover:to-black\",\n      \"red-light\": \"from-red-400 to-red-600 hover:from-red-500 hover:to-red-700\"\n    };\n    return colors[color as keyof typeof colors] || colors.red;\n  };\n\n  return (\n    <div ref={containerRef} className=\"font-inter bg-black text-gray-200 min-h-screen\">\n      <PullToRefreshIndicator />\n      <NavigationHeader />\n      <MobileNavigation />\n      \n      <main className=\"max-w-6xl mx-auto px-4 md:px-6 py-6 pb-24 md:pb-8\">\n        {/* Mobile-native header */}\n        <div className=\"mb-8 md:mb-12\">\n          <h1 className=\"mobile-large-title md:text-5xl bg-gradient-to-r from-red-500 via-orange-500 to-red-700 bg-clip-text text-transparent mb-2 lg:desktop-scale-in mobile-bounce-in\" data-testid=\"text-welcome\">\n            Welcome Back\n          </h1>\n          <p className=\"mobile-subtitle md:text-xl text-gray-400 lg:desktop-fade-in mobile-slide-up\" data-testid=\"text-tagline\">\n            Your complete fitness companion\n          </p>\n        </div>\n\n        {/* Quick access banner - mobile-optimized */}\n        <div className=\"mb-6 p-4 bg-gradient-to-r from-red-600 to-orange-600 rounded-2xl shadow-xl lg:desktop-slide-from-left mobile-bounce-in\">\n          <p className=\"text-white font-medium text-sm md:text-base\" data-testid=\"text-description\">\n            💪 Ready to crush your goals? Start logging workouts or explore AI-powered plans!\n          </p>\n        </div>\n\n        {/* Image Gallery - hidden on mobile for performance */}\n        <div className=\"hidden md:grid\">\n          <p className=\"text-lg text-gray-400 max-w-2xl mx-auto mb-8 text-center\">\n            Track workouts, monitor progress, and use GPS to automatically count your miles. \n            Upgrade to Premium for AI-powered workout and meal recommendations.\n          </p>\n          \n          {/* Image Gallery */}\n          <div className=\"grid grid-cols-2 md:grid-cols-4 gap-4 max-w-6xl mx-auto\">\n            <img \n              src={heroImage} \n              alt=\"Men and women working out together\" \n              className=\"w-full h-48 object-cover rounded-xl shadow-lg shadow-red-900/50 border border-red-500/30 hover:scale-105 transition-transform lg:desktop-fade-in mobile-slide-up\"\n              style={{ animationDelay: '0s' }}\n              data-testid=\"img-hero-1\"\n            />\n            <img \n              src={womanWeights1} \n              alt=\"Woman strength training with weights\" \n              className=\"w-full h-48 object-cover rounded-xl shadow-lg shadow-red-900/50 border border-red-500/30 hover:scale-105 transition-transform lg:desktop-fade-in mobile-slide-up\"\n              style={{ animationDelay: '0.1s' }}\n              data-testid=\"img-hero-2\"\n            />\n            <img \n              src={manCardio1} \n              alt=\"Man doing cardio running\" \n              className=\"w-full h-48 object-cover rounded-xl shadow-lg shadow-red-900/50 border border-red-500/30 hover:scale-105 transition-transform lg:desktop-fade-in mobile-slide-up\"\n              style={{ animationDelay: '0.2s' }}\n              data-testid=\"img-hero-3\"\n            />\n            <img \n              src={groupFitness1} \n              alt=\"Group fitness class\" \n              className=\"w-full h-48 object-cover rounded-xl shadow-lg shadow-red-900/50 border border-red-500/30 hover:scale-105 transition-transform lg:desktop-fade-in mobile-slide-up\"\n              style={{ animationDelay: '0.3s' }}\n              data-testid=\"img-hero-4\"\n            />\n            <img \n              src={womanWeights2} \n              alt=\"Woman weightlifting in gym\" \n              className=\"w-full h-48 object-cover rounded-xl shadow-lg shadow-red-900/50 border border-red-500/30 hover:scale-105 transition-transform lg:desktop-fade-in mobile-slide-up\"\n              style={{ animationDelay: '0.4s' }}\n              data-testid=\"img-hero-5\"\n            />\n            <img \n              src={manCardio2} \n              alt=\"Man fitness exercise\" \n              className=\"w-full h-48 object-cover rounded-xl shadow-lg shadow-red-900/50 border border-red-500/30 hover:scale-105 transition-transform lg:desktop-fade-in mobile-slide-up\"\n              style={{ animationDelay: '0.5s' }}\n              data-testid=\"img-hero-6\"\n            />\n            <img \n              src={groupFitness2} \n              alt=\"People group workout\" \n              className=\"w-full h-48 object-cover rounded-xl shadow-lg shadow-red-900/50 border border-red-500/30 hover:scale-105 transition-transform lg:desktop-fade-in mobile-slide-up\"\n              style={{ animationDelay: '0.6s' }}\n              data-testid=\"img-hero-7\"\n            />\n            <div className=\"w-full h-48 bg-gradient-to-br from-red-500 to-red-700 rounded-xl shadow-lg shadow-red-900/50 border border-red-500/30 flex items-center justify-center hover:scale-105 transition-transform lg:desktop-fade-in mobile-slide-up\" style={{ animationDelay: '0.7s' }}>\n              <div className=\"text-center text-white px-4\">\n                <Dumbbell size={48} className=\"mx-auto mb-3\" />\n                <p className=\"font-bold text-lg\">Start Your Journey</p>\n              </div>\n            </div>\n          </div>\n        </div>\n\n        {/* Quick Stats Overview */}\n        <QuickStats />\n\n        {/* Features Grid - mobile-optimized cards */}\n        <div className=\"mt-8 md:mt-12\">\n          <h2 className=\"text-2xl md:text-3xl font-bold mb-6 text-red-400 mobile-large-title md:mobile-large-title\" data-testid=\"text-features-heading\">\n            Quick Actions\n          </h2>\n          <div className=\"grid md:grid-cols-2 lg:grid-cols-3 gap-4 md:gap-6\">\n            {features.map((feature, index) => {\n              const Icon = feature.icon;\n              const isLogWorkouts = feature.title === \"Log Workouts\";\n              const isMileTracker = feature.title === \"Mile Tracker\";\n              \n              return (\n                <Link key={feature.title} href={feature.link}>\n                  <Card \n                    className={`mobile-card relative overflow-hidden bg-gradient-to-br ${getColorClasses(feature.color)} border-0 shadow-xl hover:shadow-2xl transition-all duration-200 cursor-pointer group h-full touch-ripple lg:desktop-scale-in mobile-bounce-in active:scale-95`}\n                    style={{ animationDelay: `${index * 0.1}s` }}\n                    data-testid={feature.testId}\n                  >\n                    {isLogWorkouts && (\n                      <>\n                        <div className=\"absolute inset-0\">\n                          <img \n                            src={heroImage} \n                            alt=\"Workout background\" \n                            className=\"w-full h-full object-cover opacity-30 group-hover:opacity-40 transition-opacity\"\n                          />\n                          <div className=\"absolute inset-0 bg-gradient-to-br from-red-900/80 to-black/90\"></div>\n                        </div>\n                      </>\n                    )}\n                    {isMileTracker && (\n                      <>\n                        <div className=\"absolute inset-0\">\n                          <img \n                            src={manCardio1} \n                            alt=\"Running background\" \n                            className=\"w-full h-full object-cover opacity-30 group-hover:opacity-40 transition-opacity\"\n                          />\n                          <div className=\"absolute inset-0 bg-gradient-to-br from-red-600/80 to-red-900/90\"></div>\n                        </div>\n                      </>\n                    )}\n                    <CardContent className=\"relative p-6 text-white h-full flex flex-col\">\n                      <div className=\"flex items-start justify-between mb-4\">\n                        <div className=\"p-3 bg-white/20 rounded-lg group-hover:bg-white/30 transition-colors\">\n                          <Icon size={28} />\n                        </div>\n                        {feature.badge && (\n                          <span className=\"px-3 py-1 bg-white/20 rounded-full text-xs font-semibold\">\n                            {feature.badge}\n                          </span>\n                        )}\n                      </div>\n                      <h3 className=\"text-xl font-bold mb-2\">{feature.title}</h3>\n                      <p className=\"text-white/90 text-sm mb-4 flex-grow\">{feature.description}</p>\n                      <div className=\"flex items-center text-sm font-semibold group-hover:translate-x-1 transition-transform\">\n                        Get Started <ChevronRight size={16} className=\"ml-1\" />\n                      </div>\n                    </CardContent>\n                  </Card>\n                </Link>\n              );\n            })}\n          </div>\n        </div>\n\n        {/* Getting Started Tips */}\n        <Card className=\"mt-12 bg-gradient-to-br from-red-950/30 to-black border border-red-500/50 shadow-lg shadow-red-500/20\">\n          <CardContent className=\"p-8\">\n            <h2 className=\"text-2xl font-bold mb-6 text-red-400\" data-testid=\"text-tips-heading\">\n              🚀 Quick Start Guide\n            </h2>\n            <div className=\"grid md:grid-cols-2 gap-6\">\n              <div>\n                <h3 className=\"text-lg font-semibold text-red-300 mb-3\">For Beginners:</h3>\n                <ol className=\"space-y-2 text-gray-300\">\n                  <li className=\"flex items-start\" data-testid=\"text-tip-1\">\n                    <span className=\"text-red-500 font-bold mr-2\">1.</span>\n                    <span>Click <strong className=\"text-red-400\">Log Workouts</strong> to record your first exercise</span>\n                  </li>\n                  <li className=\"flex items-start\" data-testid=\"text-tip-2\">\n                    <span className=\"text-red-500 font-bold mr-2\">2.</span>\n                    <span>Use <strong className=\"text-red-400\">Mile Tracker</strong> to automatically count your running distance</span>\n                  </li>\n                  <li className=\"flex items-start\" data-testid=\"text-tip-3\">\n                    <span className=\"text-red-500 font-bold mr-2\">3.</span>\n                    <span>Check <strong className=\"text-red-400\">View Progress</strong> to see your stats and charts</span>\n                  </li>\n                </ol>\n              </div>\n              <div>\n                <h3 className=\"text-lg font-semibold text-red-300 mb-3\">Popular Features:</h3>\n                <ul className=\"space-y-2 text-gray-300\">\n                  <li className=\"flex items-start\" data-testid=\"text-feature-1\">\n                    <span className=\"text-red-400 mr-2\">📍</span>\n                    <span><strong className=\"text-red-400\">Mile Tracker</strong> uses GPS to auto-count miles while running</span>\n                  </li>\n                  <li className=\"flex items-start\" data-testid=\"text-feature-3\">\n                    <span className=\"text-red-400 mr-2\">✨</span>\n                    <span><strong className=\"text-red-400\">Premium AI</strong> provides personalized workout & meal plans</span>\n                  </li>\n                </ul>\n              </div>\n            </div>\n          </CardContent>\n        </Card>\n      </main>\n\n      {/* Auto-open Profile Editor for new users */}\n      <ProfileEditor \n        isOpen={showProfileEditor} \n        setIsOpen={setShowProfileEditor}\n      />\n\n      {/* Floating Action Button - mobile-native */}\n      <button\n        onClick={() => navigate(\"/workouts\")}\n        className=\"fab mobile-pulse\"\n        aria-label=\"Log new workout\"\n        data-testid=\"button-fab-workout\"\n      >\n        <Plus size={28} />\n      </button>\n    </div>\n  );\n}\n","size_bytes":15216},"client/src/pages/trial-success.tsx":{"content":"import { Activity, CheckCircle, ArrowRight } from \"lucide-react\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Link } from \"wouter\";\n\nexport default function TrialSuccess() {\n\n\n  return (\n    <div className=\"relative min-h-screen bg-gradient-to-br from-primary/5 via-white to-secondary/5 dark:from-gray-900 dark:via-gray-800 dark:to-gray-900 overflow-hidden\">\n      {/* Animated background elements */}\n      <div className=\"fixed inset-0 pointer-events-none z-0\">\n        <div className=\"absolute top-20 left-10 w-72 h-72 bg-gradient-to-br from-purple-400 to-blue-500 rounded-full blur-3xl opacity-20 animate-pulse\"></div>\n        <div className=\"absolute top-40 right-16 w-56 h-56 bg-gradient-to-br from-cyan-400 to-emerald-500 rounded-full blur-2xl opacity-25 animate-bounce\" style={{animationDuration: '4s'}}></div>\n        <div className=\"absolute bottom-20 left-1/4 w-64 h-64 bg-gradient-to-br from-pink-400 to-purple-500 rounded-full blur-3xl opacity-15 animate-ping\" style={{animationDuration: '6s'}}></div>\n        <div className=\"absolute top-60 left-1/2 w-48 h-48 bg-gradient-to-br from-yellow-400 to-orange-500 rounded-full blur-2xl opacity-20 animate-pulse\" style={{animationDuration: '3s'}}></div>\n        <div className=\"absolute bottom-80 right-1/3 w-40 h-40 bg-gradient-to-br from-indigo-400 to-blue-500 rounded-full blur-3xl opacity-30 animate-bounce\" style={{animationDuration: '5s'}}></div>\n      </div>\n\n      {/* Header */}\n      <header className=\"relative z-10 px-4 lg:px-6 h-14 flex items-center border-b bg-white/80 dark:bg-gray-800/80 backdrop-blur\">\n        <div className=\"flex items-center space-x-2\">\n          <Activity className=\"text-primary\" size={32} />\n          <h1 className=\"text-xl font-bold text-gray-900 dark:text-white\">FlexFlow</h1>\n        </div>\n      </header>\n\n      {/* Main Content */}\n      <div className=\"relative z-10 container mx-auto px-4 py-16 max-w-2xl\">\n        <div className=\"text-center mb-8\">\n          <div className=\"flex items-center justify-center mb-6\">\n            <div className=\"relative\">\n              <CheckCircle className=\"text-green-500 w-24 h-24 animate-pulse\" />\n              <div className=\"absolute inset-0 rounded-full bg-green-500/20 animate-ping\"></div>\n            </div>\n          </div>\n          <h1 className=\"text-4xl md:text-5xl font-bold text-gray-900 dark:text-white mb-4\">\n            🎉 Welcome to FlexFlow!\n          </h1>\n          <p className=\"text-xl text-gray-600 dark:text-gray-300\">\n            Your 7-day free trial has started successfully!\n          </p>\n        </div>\n\n        {/* Success Card */}\n        <Card className=\"mb-8 bg-white/80 dark:bg-gray-800/80 backdrop-blur border-0 shadow-xl\">\n          <CardHeader className=\"text-center\">\n            <CardTitle className=\"text-2xl text-green-700 dark:text-green-400\">\n              Trial Activated\n            </CardTitle>\n            <CardDescription>\n              You now have full access to all FlexFlow premium features\n            </CardDescription>\n          </CardHeader>\n          <CardContent>\n            <div className=\"space-y-4 mb-6\">\n              <div className=\"flex items-center space-x-3 p-3 bg-green-50 dark:bg-green-900/20 rounded-lg\">\n                <CheckCircle className=\"w-6 h-6 text-green-500 flex-shrink-0\" />\n                <div>\n                  <div className=\"font-semibold text-green-800 dark:text-green-300\">\n                    Full Premium Access\n                  </div>\n                  <div className=\"text-sm text-green-600 dark:text-green-400\">\n                    Unlimited workouts, meal plans, and trainer consultations\n                  </div>\n                </div>\n              </div>\n\n              <div className=\"flex items-center space-x-3 p-3 bg-blue-50 dark:bg-blue-900/20 rounded-lg\">\n                <CheckCircle className=\"w-6 h-6 text-blue-500 flex-shrink-0\" />\n                <div>\n                  <div className=\"font-semibold text-blue-800 dark:text-blue-300\">\n                    7 Days Free\n                  </div>\n                  <div className=\"text-sm text-blue-600 dark:text-blue-400\">\n                    No charges until your trial expires\n                  </div>\n                </div>\n              </div>\n\n              <div className=\"flex items-center space-x-3 p-3 bg-purple-50 dark:bg-purple-900/20 rounded-lg\">\n                <CheckCircle className=\"w-6 h-6 text-purple-500 flex-shrink-0\" />\n                <div>\n                  <div className=\"font-semibold text-purple-800 dark:text-purple-300\">\n                    Cancel Anytime\n                  </div>\n                  <div className=\"text-sm text-purple-600 dark:text-purple-400\">\n                    No commitment - cancel before trial ends if not satisfied\n                  </div>\n                </div>\n              </div>\n            </div>\n\n            <div className=\"text-center p-4 bg-gray-50 dark:bg-gray-700 rounded-lg mb-6\">\n              <div className=\"text-lg font-semibold text-gray-900 dark:text-white mb-1\">\n                What's Next?\n              </div>\n              <div className=\"text-sm text-gray-600 dark:text-gray-400\">\n                Create your account to access your personalized home and start your fitness journey\n              </div>\n            </div>\n\n            <Link href=\"/auth\">\n              <Button className=\"w-full\" size=\"lg\">\n                Create Your Account <ArrowRight className=\"ml-2 w-4 h-4\" />\n              </Button>\n            </Link>\n          </CardContent>\n        </Card>\n\n        {/* Additional Info */}\n        <div className=\"text-center text-sm text-gray-500 dark:text-gray-400\">\n          <p>Need help? Contact our support team anytime during your trial.</p>\n        </div>\n      </div>\n    </div>\n  );\n}","size_bytes":5899},"client/src/components/navbar.tsx":{"content":"import { Link, useLocation } from \"wouter\";\nimport { Activity, LogOut, Menu, Home, Dumbbell, TrendingUp, Users, ChefHat, Target, Apple, MapPin, Camera, Star, Settings } from \"lucide-react\";\nimport { Button } from \"@/components/ui/button\";\nimport { useNewAuth } from \"@/hooks/useNewAuth\";\nimport { Sheet, SheetContent, SheetTrigger } from \"@/components/ui/sheet\";\nimport { useState } from \"react\";\n\nexport default function Navbar() {\n  const [location] = useLocation();\n  const { signOut } = useNewAuth();\n  const [menuOpen, setMenuOpen] = useState(false);\n\n  const allNavItems = [\n    { path: \"/\", label: \"Home\", icon: Home },\n    { path: \"/workouts\", label: \"Workouts\", icon: Dumbbell },\n    { path: \"/progress\", label: \"Progress\", icon: TrendingUp },\n    { path: \"/community\", label: \"Community\", icon: Users },\n    { path: \"/subscription\", label: \"Premium\", icon: Star },\n    { path: \"/meal-plans\", label: \"Meal Plans\", icon: ChefHat },\n    { path: \"/workout-planner\", label: \"Workout Planner\", icon: Target },\n    { path: \"/meal-tracker\", label: \"Barcode Scanner\", icon: Apple },\n    { path: \"/mile-tracker\", label: \"Mile Tracker\", icon: MapPin },\n    { path: \"/progress-photos\", label: \"Progress Photos\", icon: Camera },\n    { path: \"/settings\", label: \"Settings\", icon: Settings },\n  ];\n\n  const isActive = (path: string) => {\n    if (path === \"/\") return location === \"/\" || location === \"/home\";\n    return location.startsWith(path);\n  };\n\n  return (\n    <nav className=\"bg-white dark:bg-gray-900 border-b border-gray-200 dark:border-gray-800 sticky top-0 z-50\">\n      <div className=\"px-4 sm:px-6\">\n        <div className=\"flex justify-between items-center h-14\">\n          {/* Logo - Centered on Mobile, Left on Desktop */}\n          <Link href=\"/\" className=\"flex items-center space-x-2\">\n            <Activity className=\"text-primary\" size={28} />\n            <h1 className=\"text-lg font-bold text-gray-900 dark:text-white\">FlexFlow</h1>\n          </Link>\n\n          {/* Desktop Sign Out */}\n          <div className=\"hidden md:block\">\n            <Button\n              variant=\"ghost\"\n              size=\"sm\"\n              onClick={signOut}\n              className=\"text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-white\"\n            >\n              <LogOut size={18} className=\"mr-2\" />\n              Sign Out\n            </Button>\n          </div>\n\n          {/* Mobile Menu */}\n          <div className=\"md:hidden\">\n            <Sheet open={menuOpen} onOpenChange={setMenuOpen}>\n              <SheetTrigger asChild>\n                <Button variant=\"ghost\" size=\"sm\" className=\"p-2\">\n                  <Menu size={24} />\n                </Button>\n              </SheetTrigger>\n              <SheetContent side=\"right\" className=\"w-64\">\n                <div className=\"flex flex-col space-y-4 mt-8\">\n                  <Button\n                    variant=\"outline\"\n                    className=\"w-full justify-start text-red-600 border-red-600 hover:bg-red-50 dark:hover:bg-red-900/20\"\n                    onClick={() => {\n                      setMenuOpen(false);\n                      signOut();\n                    }}\n                  >\n                    <LogOut size={18} className=\"mr-2\" />\n                    Sign Out\n                  </Button>\n                </div>\n              </SheetContent>\n            </Sheet>\n          </div>\n        </div>\n\n        {/* Desktop Horizontal Tabs - Only visible on large screens with desktop animations */}\n        <div className=\"hidden lg:block border-t border-gray-200 dark:border-gray-800\">\n          <div className=\"flex items-center space-x-1 overflow-x-auto py-2\">\n            {allNavItems.map((item, index) => {\n              const Icon = item.icon;\n              const active = isActive(item.path);\n              \n              return (\n                <Link \n                  key={item.path}\n                  href={item.path}\n                  data-testid={`desktop-nav-${item.label.toLowerCase().replace(/\\s+/g, '-')}`}\n                >\n                  <button\n                    className={`flex items-center space-x-2 px-4 py-2 rounded-lg text-sm font-medium transition-all duration-300 whitespace-nowrap desktop-slide-from-left ${\n                      active \n                        ? \"bg-primary text-white shadow-sm scale-105\" \n                        : \"text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-800 hover:scale-105\"\n                    }`}\n                    style={{ animationDelay: `${index * 0.03}s` }}\n                  >\n                    <Icon size={16} aria-hidden=\"true\" />\n                    <span>{item.label}</span>\n                  </button>\n                </Link>\n              );\n            })}\n          </div>\n        </div>\n      </div>\n    </nav>\n  );\n}\n","size_bytes":4819},"client/src/pages/privacy-policy.tsx":{"content":"import { Activity } from \"lucide-react\";\nimport { Button } from \"@/components/ui/button\";\n\nexport default function PrivacyPolicy() {\n  return (\n    <div className=\"min-h-screen bg-gray-50 dark:bg-gray-900\">\n      {/* Header */}\n      <header className=\"px-4 lg:px-6 h-14 flex items-center border-b bg-white dark:bg-gray-800 shadow-sm\">\n        <div className=\"flex items-center space-x-2\">\n          <Activity className=\"text-red-600\" size={32} />\n          <h1 className=\"text-xl font-bold text-gray-900 dark:text-white\">FlexFlow</h1>\n        </div>\n        <div className=\"ml-auto\">\n          <Button asChild variant=\"outline\">\n            <a href=\"/\" data-testid=\"back-home\">Back to Home</a>\n          </Button>\n        </div>\n      </header>\n\n      {/* Content */}\n      <main className=\"container mx-auto px-4 py-12 max-w-4xl\">\n        <div className=\"bg-white dark:bg-gray-800 rounded-lg shadow-lg p-8\">\n          <h1 className=\"text-3xl font-bold text-gray-900 dark:text-white mb-8\">Privacy Policy</h1>\n          \n          <div className=\"prose prose-gray dark:prose-invert max-w-none\">\n            <p className=\"text-sm text-gray-600 dark:text-gray-400 mb-6\">\n              Last updated: {new Date().toLocaleDateString()}\n            </p>\n\n            <section className=\"mb-8\">\n              <h2 className=\"text-xl font-semibold mb-4\">1. Information We Collect</h2>\n              <p>FlexFlow collects information you provide directly to us, such as:</p>\n              <ul className=\"list-disc pl-6 mt-2\">\n                <li>Account information (name, email address, username)</li>\n                <li>Profile information (age, height, weight, fitness goals)</li>\n                <li>Workout and fitness data (exercises, sets, reps, duration)</li>\n                <li>Progress tracking data (measurements, achievements, streaks)</li>\n                <li>Communication data when you contact us for support</li>\n              </ul>\n            </section>\n\n            <section className=\"mb-8\">\n              <h2 className=\"text-xl font-semibold mb-4\">2. How We Use Your Information</h2>\n              <p>We use the information we collect to:</p>\n              <ul className=\"list-disc pl-6 mt-2\">\n                <li>Provide and maintain our fitness tracking services</li>\n                <li>Personalize your workout recommendations and meal plans</li>\n                <li>Track your progress and generate fitness analytics</li>\n                <li>Send you notifications about your fitness goals and achievements</li>\n                <li>Provide customer support and respond to your inquiries</li>\n                <li>Improve our services and develop new features</li>\n              </ul>\n            </section>\n\n            <section className=\"mb-8\">\n              <h2 className=\"text-xl font-semibold mb-4\">3. Information Sharing and Disclosure</h2>\n              <p>\n                We do not sell, trade, or otherwise transfer your personal information to third parties. \n                We may share your information in limited circumstances:\n              </p>\n              <ul className=\"list-disc pl-6 mt-2\">\n                <li>With your consent or at your direction</li>\n                <li>To comply with legal obligations or court orders</li>\n                <li>To protect our rights, privacy, safety, or property</li>\n                <li>In connection with business transfers or mergers</li>\n              </ul>\n            </section>\n\n            <section className=\"mb-8\">\n              <h2 className=\"text-xl font-semibold mb-4\">4. Health Data Privacy</h2>\n              <p>\n                Your health and fitness data is especially sensitive. We implement strong security \n                measures to protect this information and will never use your health data for advertising \n                or marketing purposes without your explicit consent.\n              </p>\n            </section>\n\n            <section className=\"mb-8\">\n              <h2 className=\"text-xl font-semibold mb-4\">5. Data Security</h2>\n              <p>\n                We implement appropriate technical and organizational security measures to protect your \n                personal information against unauthorized access, alteration, disclosure, or destruction. \n                This includes encryption of sensitive data and regular security assessments.\n              </p>\n            </section>\n\n            <section className=\"mb-8\">\n              <h2 className=\"text-xl font-semibold mb-4\">6. Data Retention</h2>\n              <p>\n                We retain your personal information for as long as your account is active or as needed \n                to provide you services. If you wish to delete your account or request that we no longer \n                use your information, please contact us.\n              </p>\n            </section>\n\n            <section className=\"mb-8\">\n              <h2 className=\"text-xl font-semibold mb-4\">7. Your Rights and Choices</h2>\n              <p>You have the right to:</p>\n              <ul className=\"list-disc pl-6 mt-2\">\n                <li>Access and update your personal information</li>\n                <li>Delete your account and associated data</li>\n                <li>Opt out of promotional communications</li>\n                <li>Request a copy of your data</li>\n                <li>Restrict or object to certain processing of your data</li>\n              </ul>\n            </section>\n\n            <section className=\"mb-8\">\n              <h2 className=\"text-xl font-semibold mb-4\">8. Cookies and Tracking</h2>\n              <p>\n                We use cookies and similar technologies to enhance your experience, analyze usage patterns, \n                and improve our services. You can control cookie preferences through your browser settings.\n              </p>\n            </section>\n\n            <section className=\"mb-8\">\n              <h2 className=\"text-xl font-semibold mb-4\">9. Children's Privacy</h2>\n              <p>\n                FlexFlow is not intended for use by children under 13 years of age. We do not knowingly \n                collect personal information from children under 13. If you become aware that a child \n                has provided us with personal information, please contact us.\n              </p>\n            </section>\n\n            <section className=\"mb-8\">\n              <h2 className=\"text-xl font-semibold mb-4\">10. Changes to This Privacy Policy</h2>\n              <p>\n                We may update this Privacy Policy from time to time. We will notify you of any material \n                changes by posting the new Privacy Policy on this page and updating the \"Last updated\" date.\n              </p>\n            </section>\n\n            <section className=\"mb-8\">\n              <h2 className=\"text-xl font-semibold mb-4\">11. Contact Us</h2>\n              <p>\n                If you have any questions about this Privacy Policy or our privacy practices, \n                please contact us through the FlexFlow application or website.\n              </p>\n            </section>\n          </div>\n        </div>\n      </main>\n    </div>\n  );\n}","size_bytes":7146},"client/src/components/ui/carousel.tsx":{"content":"import * as React from \"react\"\nimport useEmblaCarousel, {\n  type UseEmblaCarouselType,\n} from \"embla-carousel-react\"\nimport { ArrowLeft, ArrowRight } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Button } from \"@/components/ui/button\"\n\ntype CarouselApi = UseEmblaCarouselType[1]\ntype UseCarouselParameters = Parameters<typeof useEmblaCarousel>\ntype CarouselOptions = UseCarouselParameters[0]\ntype CarouselPlugin = UseCarouselParameters[1]\n\ntype CarouselProps = {\n  opts?: CarouselOptions\n  plugins?: CarouselPlugin\n  orientation?: \"horizontal\" | \"vertical\"\n  setApi?: (api: CarouselApi) => void\n}\n\ntype CarouselContextProps = {\n  carouselRef: ReturnType<typeof useEmblaCarousel>[0]\n  api: ReturnType<typeof useEmblaCarousel>[1]\n  scrollPrev: () => void\n  scrollNext: () => void\n  canScrollPrev: boolean\n  canScrollNext: boolean\n} & CarouselProps\n\nconst CarouselContext = React.createContext<CarouselContextProps | null>(null)\n\nfunction useCarousel() {\n  const context = React.useContext(CarouselContext)\n\n  if (!context) {\n    throw new Error(\"useCarousel must be used within a <Carousel />\")\n  }\n\n  return context\n}\n\nconst Carousel = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement> & CarouselProps\n>(\n  (\n    {\n      orientation = \"horizontal\",\n      opts,\n      setApi,\n      plugins,\n      className,\n      children,\n      ...props\n    },\n    ref\n  ) => {\n    const [carouselRef, api] = useEmblaCarousel(\n      {\n        ...opts,\n        axis: orientation === \"horizontal\" ? \"x\" : \"y\",\n      },\n      plugins\n    )\n    const [canScrollPrev, setCanScrollPrev] = React.useState(false)\n    const [canScrollNext, setCanScrollNext] = React.useState(false)\n\n    const onSelect = React.useCallback((api: CarouselApi) => {\n      if (!api) {\n        return\n      }\n\n      setCanScrollPrev(api.canScrollPrev())\n      setCanScrollNext(api.canScrollNext())\n    }, [])\n\n    const scrollPrev = React.useCallback(() => {\n      api?.scrollPrev()\n    }, [api])\n\n    const scrollNext = React.useCallback(() => {\n      api?.scrollNext()\n    }, [api])\n\n    const handleKeyDown = React.useCallback(\n      (event: React.KeyboardEvent<HTMLDivElement>) => {\n        if (event.key === \"ArrowLeft\") {\n          event.preventDefault()\n          scrollPrev()\n        } else if (event.key === \"ArrowRight\") {\n          event.preventDefault()\n          scrollNext()\n        }\n      },\n      [scrollPrev, scrollNext]\n    )\n\n    React.useEffect(() => {\n      if (!api || !setApi) {\n        return\n      }\n\n      setApi(api)\n    }, [api, setApi])\n\n    React.useEffect(() => {\n      if (!api) {\n        return\n      }\n\n      onSelect(api)\n      api.on(\"reInit\", onSelect)\n      api.on(\"select\", onSelect)\n\n      return () => {\n        api?.off(\"select\", onSelect)\n      }\n    }, [api, onSelect])\n\n    return (\n      <CarouselContext.Provider\n        value={{\n          carouselRef,\n          api: api,\n          opts,\n          orientation:\n            orientation || (opts?.axis === \"y\" ? \"vertical\" : \"horizontal\"),\n          scrollPrev,\n          scrollNext,\n          canScrollPrev,\n          canScrollNext,\n        }}\n      >\n        <div\n          ref={ref}\n          onKeyDownCapture={handleKeyDown}\n          className={cn(\"relative\", className)}\n          role=\"region\"\n          aria-roledescription=\"carousel\"\n          {...props}\n        >\n          {children}\n        </div>\n      </CarouselContext.Provider>\n    )\n  }\n)\nCarousel.displayName = \"Carousel\"\n\nconst CarouselContent = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => {\n  const { carouselRef, orientation } = useCarousel()\n\n  return (\n    <div ref={carouselRef} className=\"overflow-hidden\">\n      <div\n        ref={ref}\n        className={cn(\n          \"flex\",\n          orientation === \"horizontal\" ? \"-ml-4\" : \"-mt-4 flex-col\",\n          className\n        )}\n        {...props}\n      />\n    </div>\n  )\n})\nCarouselContent.displayName = \"CarouselContent\"\n\nconst CarouselItem = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => {\n  const { orientation } = useCarousel()\n\n  return (\n    <div\n      ref={ref}\n      role=\"group\"\n      aria-roledescription=\"slide\"\n      className={cn(\n        \"min-w-0 shrink-0 grow-0 basis-full\",\n        orientation === \"horizontal\" ? \"pl-4\" : \"pt-4\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nCarouselItem.displayName = \"CarouselItem\"\n\nconst CarouselPrevious = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<typeof Button>\n>(({ className, variant = \"outline\", size = \"icon\", ...props }, ref) => {\n  const { orientation, scrollPrev, canScrollPrev } = useCarousel()\n\n  return (\n    <Button\n      ref={ref}\n      variant={variant}\n      size={size}\n      className={cn(\n        \"absolute  h-8 w-8 rounded-full\",\n        orientation === \"horizontal\"\n          ? \"-left-12 top-1/2 -translate-y-1/2\"\n          : \"-top-12 left-1/2 -translate-x-1/2 rotate-90\",\n        className\n      )}\n      disabled={!canScrollPrev}\n      onClick={scrollPrev}\n      {...props}\n    >\n      <ArrowLeft className=\"h-4 w-4\" />\n      <span className=\"sr-only\">Previous slide</span>\n    </Button>\n  )\n})\nCarouselPrevious.displayName = \"CarouselPrevious\"\n\nconst CarouselNext = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<typeof Button>\n>(({ className, variant = \"outline\", size = \"icon\", ...props }, ref) => {\n  const { orientation, scrollNext, canScrollNext } = useCarousel()\n\n  return (\n    <Button\n      ref={ref}\n      variant={variant}\n      size={size}\n      className={cn(\n        \"absolute h-8 w-8 rounded-full\",\n        orientation === \"horizontal\"\n          ? \"-right-12 top-1/2 -translate-y-1/2\"\n          : \"-bottom-12 left-1/2 -translate-x-1/2 rotate-90\",\n        className\n      )}\n      disabled={!canScrollNext}\n      onClick={scrollNext}\n      {...props}\n    >\n      <ArrowRight className=\"h-4 w-4\" />\n      <span className=\"sr-only\">Next slide</span>\n    </Button>\n  )\n})\nCarouselNext.displayName = \"CarouselNext\"\n\nexport {\n  type CarouselApi,\n  Carousel,\n  CarouselContent,\n  CarouselItem,\n  CarouselPrevious,\n  CarouselNext,\n}\n","size_bytes":6210},"server/routes.ts":{"content":"import type { Express } from \"express\";\nimport { createServer, type Server } from \"http\";\nimport multer from \"multer\";\nimport path from \"path\";\nimport { promises as fs } from \"fs\";\nimport { storage } from \"./storage\";\nimport { \n  insertWorkoutSchema, \n  insertWorkoutExerciseSchema, \n  insertGoalSchema,\n  insertTrainerSchema,\n  insertTrainerServiceSchema,\n  insertBookingSchema,\n  insertTrainerReviewSchema,\n  insertFoodEntrySchema,\n  insertMileTrackerSessionSchema,\n  insertMileTrackerSplitSchema,\n  insertCommunityPostSchema,\n  insertProgressPhotoSchema,\n  insertMealPlanSchema,\n  insertUserMealPlanSchema,\n  insertPaymentSchema,\n  insertUserMealPreferencesSchema,\n  insertFoodItemSchema,\n  insertUserFoodPreferenceSchema,\n  insertBadgeSchema\n} from \"@shared/schema\";\nimport { z } from \"zod\";\nimport { ObjectStorageService, ObjectNotFoundError } from \"./objectStorage\";\nimport { ObjectPermission } from \"./objectAcl\";\nimport { analyzeFoodImage } from \"./foodRecognition\";\nimport { generatePersonalizedMealPlan, generateWeeklyMealPlan } from \"./mealPlanGenerator\";\nimport { autoDifficultyAdjuster } from \"./auto-difficulty-adjuster\";\nimport { authService } from \"./auth-service\";\nimport { authenticateToken, optionalAuth, getCurrentUserId as getAuthUserId } from \"./auth-middleware\";\nimport { requireFeatureAccess } from \"./services/subscription.js\";\nimport { PREMIUM_FEATURES } from \"@shared/schema\";\nimport { signUpSchema, signInSchema } from \"@shared/schema\";\nimport { ActivityLogger } from \"./activity-logger\";\nimport { badgeService } from \"./badge-service\";\nimport { createAppleStoreService } from \"./services/apple-store\";\n\nconst appleStoreService = createAppleStoreService();\n\nexport async function registerRoutes(app: Express): Promise<Server> {\n\n  // Note: Removed Replit Auth integration as requested\n\n  // Auth routes\n  app.get('/api/auth/user', authenticateToken, async (req: any, res) => {\n    try {\n      const userId = req.user.id;\n      const user = await storage.getUser(userId);\n      res.json(user);\n    } catch (error) {\n      console.error(\"Error fetching user:\", error);\n      res.status(500).json({ message: \"Failed to fetch user\" });\n    }\n  });\n\n  // New Authentication Routes (Username/Password & Google)\n  \n  // Sign up with username/password\n  app.post('/api/auth/signup', async (req, res) => {\n    try {\n      \n      const userData = signUpSchema.parse(req.body);\n      \n      const result = await authService.signUp(userData);\n\n      // Log account creation activity\n      await ActivityLogger.logActivity({\n        userId: result.user.id,\n        actionType: 'signup',\n        actionDetails: {\n          method: 'email_password',\n          username: result.user.username,\n          email: result.user.email\n        },\n        ipAddress: req.ip,\n        userAgent: req.get('user-agent') || undefined\n      });\n      \n      res.status(201).json({\n        message: \"Account created successfully\",\n        user: result.user,\n        token: result.token\n      });\n    } catch (error: any) {\n      \n      if (error.name === 'ZodError') {\n        return res.status(400).json({\n          message: \"Invalid input data\",\n          errors: error.errors\n        });\n      }\n      \n      res.status(400).json({\n        message: error.message || \"Failed to create account\"\n      });\n    }\n  });\n\n  // Sign in with username/password\n  app.post('/api/auth/signin', async (req, res) => {\n    try {\n      const credentials = signInSchema.parse(req.body);\n      const result = await authService.signIn(credentials);\n\n      // Log login activity\n      await ActivityLogger.logLogin(result.user.id, req.ip, req.get('user-agent') || undefined);\n      \n      res.json({\n        message: \"Signed in successfully\",\n        user: result.user,\n        token: result.token\n      });\n    } catch (error: any) {\n      console.error(\"Sign in error:\", error);\n      \n      if (error.name === 'ZodError') {\n        return res.status(400).json({\n          message: \"Invalid input data\",\n          errors: error.errors\n        });\n      }\n      \n      res.status(401).json({\n        message: error.message || \"Invalid credentials\"\n      });\n    }\n  });\n\n  // Get current user (for JWT auth - supports both Bearer and cookie auth)\n  app.get('/api/auth/me', authenticateToken, async (req, res) => {\n    try {\n      res.json(req.user);\n    } catch (error) {\n      console.error(\"Get user error:\", error);\n      res.status(500).json({ message: \"Failed to fetch user data\" });\n    }\n  });\n\n  // Check authentication status (for cookie-based auth)\n  app.get('/api/auth/status', optionalAuth, async (req, res) => {\n    try {\n      if (req.user) {\n        res.json({ authenticated: true, user: req.user });\n      } else {\n        res.json({ authenticated: false, user: null });\n      }\n    } catch (error) {\n      console.error(\"Auth status check error:\", error);\n      res.json({ authenticated: false, user: null });\n    }\n  });\n\n  // Logout route (clears auth cookie)\n  app.post('/api/auth/logout', optionalAuth, async (req, res) => {\n    try {\n      const userId = getAuthUserId(req);\n\n      // Log logout activity if user was authenticated\n      if (userId) {\n        await ActivityLogger.logLogout(userId);\n      }\n\n      // Clear the auth cookie\n      res.clearCookie('auth-token', {\n        httpOnly: true,\n        secure: process.env.NODE_ENV === 'production',\n        sameSite: 'lax',\n        path: '/'\n      });\n      \n      res.json({ message: \"Logged out successfully\" });\n    } catch (error) {\n      console.error(\"Logout error:\", error);\n      res.status(500).json({ message: \"Failed to logout\" });\n    }\n  });\n\n  // Refresh token\n  app.post('/api/auth/refresh', async (req, res) => {\n    try {\n      const { token } = req.body;\n      \n      if (!token) {\n        return res.status(400).json({ message: \"Token required\" });\n      }\n      \n      const newToken = await authService.refreshToken(token);\n      \n      res.json({\n        message: \"Token refreshed successfully\",\n        token: newToken\n      });\n    } catch (error: any) {\n      console.error(\"Token refresh error:\", error);\n      res.status(401).json({\n        message: error.message || \"Invalid token\"\n      });\n    }\n  });\n\n  // Change password\n  app.post('/api/auth/change-password', authenticateToken, async (req, res) => {\n    try {\n      const { currentPassword, newPassword } = req.body;\n      \n      if (!currentPassword || !newPassword) {\n        return res.status(400).json({ \n          message: \"Current password and new password are required\" \n        });\n      }\n\n      if (newPassword.length < 8) {\n        return res.status(400).json({ \n          message: \"New password must be at least 8 characters long\" \n        });\n      }\n      \n      await authService.changePassword(req.user!.id, currentPassword, newPassword);\n      \n      res.json({\n        message: \"Password changed successfully\"\n      });\n    } catch (error: any) {\n      console.error(\"Change password error:\", error);\n      res.status(400).json({\n        message: error.message || \"Failed to change password\"\n      });\n    }\n  });\n\n  // Badge routes\n  \n  // Get all available badges\n  app.get('/api/badges', async (req, res) => {\n    try {\n      const badges = await storage.getAllBadges();\n      res.json(badges);\n    } catch (error) {\n      console.error(\"Error fetching badges:\", error);\n      res.status(500).json({ message: \"Failed to fetch badges\" });\n    }\n  });\n\n  // Get user's earned badges\n  app.get('/api/user/badges', authenticateToken, async (req, res) => {\n    try {\n      const userId = getAuthUserId(req);\n      if (!userId) {\n        return res.status(401).json({ message: \"User not authenticated\" });\n      }\n      \n      const userBadges = await storage.getUserBadges(userId);\n      res.json(userBadges);\n    } catch (error) {\n      console.error(\"Error fetching user badges:\", error);\n      res.status(500).json({ message: \"Failed to fetch user badges\" });\n    }\n  });\n\n  // Check and award new badges based on current streak\n  app.post('/api/user/badges/check', authenticateToken, async (req, res) => {\n    try {\n      const userId = getAuthUserId(req);\n      if (!userId) {\n        return res.status(401).json({ message: \"User not authenticated\" });\n      }\n      \n      const newBadges = await badgeService.checkAndAwardBadges(userId);\n      res.json({ \n        message: newBadges.length > 0 ? \"New badges earned!\" : \"No new badges\",\n        badges: newBadges \n      });\n    } catch (error) {\n      console.error(\"Error checking badges:\", error);\n      res.status(500).json({ message: \"Failed to check badges\" });\n    }\n  });\n\n  // Get exercises\n  app.get(\"/api/exercises\", async (req, res) => {\n    try {\n      const { category, search } = req.query;\n      \n      let exercises;\n      if (search) {\n        exercises = await storage.searchExercises(search as string);\n      } else if (category) {\n        exercises = await storage.getExercisesByCategory(category as string);\n      } else {\n        exercises = await storage.getExercises();\n      }\n      \n      res.json(exercises);\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to fetch exercises\" });\n    }\n  });\n\n  // Get workouts\n  app.get(\"/api/workouts\", authenticateToken, async (req, res) => {\n    try {\n      const userId = getAuthUserId(req);\n      if (!userId) {\n        return res.status(401).json({ message: \"User not authenticated\" });\n      }\n      const workouts = await storage.getWorkouts(userId);\n      res.json(workouts);\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to fetch workouts\" });\n    }\n  });\n\n  // Get workout by ID\n  app.get(\"/api/workouts/:id\", async (req, res) => {\n    try {\n      const workout = await storage.getWorkout(req.params.id);\n      if (!workout) {\n        return res.status(404).json({ message: \"Workout not found\" });\n      }\n      res.json(workout);\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to fetch workout\" });\n    }\n  });\n\n  // Create workout\n  app.post(\"/api/workouts\", authenticateToken, async (req, res) => {\n    try {\n      const userId = getAuthUserId(req);\n      if (!userId) {\n        return res.status(401).json({ message: \"User not authenticated\" });\n      }\n      const data = insertWorkoutSchema.parse({\n        ...req.body,\n        userId: userId,\n        date: new Date(req.body.date || Date.now())\n      });\n      \n      const workout = await storage.createWorkout(data);\n\n      // If exercise data is provided, create workout exercise entry\n      if (req.body.exerciseData) {\n        try {\n          const exerciseData = insertWorkoutExerciseSchema.parse({\n            ...req.body.exerciseData,\n            workoutId: workout.id\n          });\n          await storage.createWorkoutExercise(exerciseData);\n        } catch (exerciseError) {\n          console.error(\"Error creating workout exercise:\", exerciseError);\n          // Continue execution - workout is created, exercise data is optional\n        }\n      }\n\n      // Log workout creation activity\n      await ActivityLogger.logWorkout(userId, {\n        name: workout.name,\n        duration: workout.duration,\n        caloriesBurned: workout.caloriesBurned,\n        exercises: req.body.exercises || []\n      });\n\n      res.status(201).json(workout);\n    } catch (error) {\n      if (error instanceof z.ZodError) {\n        return res.status(400).json({ message: \"Invalid workout data\", errors: error.errors });\n      }\n      res.status(500).json({ message: \"Failed to create workout\" });\n    }\n  });\n\n  // Add exercise to workout\n  app.post(\"/api/workouts/:workoutId/exercises\", async (req, res) => {\n    try {\n      const data = insertWorkoutExerciseSchema.parse({\n        ...req.body,\n        workoutId: req.params.workoutId\n      });\n      \n      const workoutExercise = await storage.createWorkoutExercise(data);\n      res.status(201).json(workoutExercise);\n    } catch (error) {\n      if (error instanceof z.ZodError) {\n        return res.status(400).json({ message: \"Invalid exercise data\", errors: error.errors });\n      }\n      res.status(500).json({ message: \"Failed to add exercise to workout\" });\n    }\n  });\n\n  // Get user stats\n  app.get(\"/api/stats\", authenticateToken, async (req, res) => {\n    try {\n      const userId = getAuthUserId(req);\n      if (!userId) {\n        return res.status(401).json({ message: \"User not authenticated\" });\n      }\n      const stats = await storage.getUserStats(userId);\n      res.json(stats);\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to fetch stats\" });\n    }\n  });\n\n  // Get advanced progress metrics\n  app.get(\"/api/progress/metrics\", authenticateToken, async (req, res) => {\n    try {\n      const userId = getAuthUserId(req);\n      if (!userId) {\n        return res.status(401).json({ message: \"User not authenticated\" });\n      }\n      const metrics = await storage.getAdvancedProgressMetrics(userId);\n      res.json(metrics);\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to fetch progress metrics\" });\n    }\n  });\n\n  // Get weight progress data for charts\n  app.get(\"/api/progress/weight\", authenticateToken, async (req, res) => {\n    try {\n      const userId = getAuthUserId(req);\n      if (!userId) {\n        return res.status(401).json({ message: \"User not authenticated\" });\n      }\n      const weightProgress = await storage.getWeightProgressData(userId);\n      res.json(weightProgress);\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to fetch weight progress\" });\n    }\n  });\n\n  // Get AI performance analytics data\n  app.get(\"/api/performance-analytics/:timeframe\", authenticateToken, async (req, res) => {\n    try {\n      const userId = getAuthUserId(req);\n      if (!userId) {\n        return res.status(401).json({ message: \"User not authenticated\" });\n      }\n\n      const { timeframe } = req.params;\n      \n      // Calculate date range based on timeframe\n      const now = new Date();\n      const startDate = new Date();\n      switch (timeframe) {\n        case \"7d\":\n          startDate.setDate(now.getDate() - 7);\n          break;\n        case \"30d\":\n          startDate.setDate(now.getDate() - 30);\n          break;\n        case \"90d\":\n          startDate.setDate(now.getDate() - 90);\n          break;\n        default:\n          startDate.setDate(now.getDate() - 7);\n      }\n\n      // Get workouts in the specified timeframe\n      const workouts = await storage.getWorkoutsByDateRange(userId, startDate, now);\n      \n      // Calculate performance trends and analytics\n      const workoutsWithPerformance = workouts.map(workout => ({\n        id: workout.id,\n        name: workout.name,\n        date: workout.date.toISOString(),\n        difficultyLevel: workout.difficultyLevel || 3,\n        perceivedExertion: workout.perceivedExertion || 5,\n        completionRate: workout.completionRate || 100,\n        performanceScore: workout.performanceScore || null,\n        category: workout.category\n      }));\n\n      // Calculate trends\n      const totalWorkouts = workoutsWithPerformance.length;\n      const averageDifficulty = totalWorkouts > 0 \n        ? workoutsWithPerformance.reduce((sum, w) => sum + w.difficultyLevel, 0) / totalWorkouts \n        : 0;\n      const averageExertion = totalWorkouts > 0 \n        ? workoutsWithPerformance.reduce((sum, w) => sum + w.perceivedExertion, 0) / totalWorkouts \n        : 0;\n      const averageCompletion = totalWorkouts > 0 \n        ? workoutsWithPerformance.reduce((sum, w) => sum + w.completionRate, 0) / totalWorkouts \n        : 0;\n\n      // Determine difficulty trend\n      let difficultyTrend: \"improving\" | \"declining\" | \"stable\" = \"stable\";\n      if (totalWorkouts >= 3) {\n        const firstHalf = workoutsWithPerformance.slice(0, Math.floor(totalWorkouts / 2));\n        const secondHalf = workoutsWithPerformance.slice(Math.floor(totalWorkouts / 2));\n        \n        const firstHalfAvg = firstHalf.reduce((sum, w) => sum + w.difficultyLevel, 0) / firstHalf.length;\n        const secondHalfAvg = secondHalf.reduce((sum, w) => sum + w.difficultyLevel, 0) / secondHalf.length;\n        \n        if (secondHalfAvg > firstHalfAvg + 0.3) {\n          difficultyTrend = \"improving\";\n        } else if (secondHalfAvg < firstHalfAvg - 0.3) {\n          difficultyTrend = \"declining\";\n        }\n      }\n\n      // Calculate consistency score (based on workout frequency)\n      const expectedWorkoutsPerWeek = 3; // Assume user should workout 3x per week\n      const weeksInTimeframe = timeframe === \"7d\" ? 1 : timeframe === \"30d\" ? 4 : 12;\n      const expectedWorkouts = expectedWorkoutsPerWeek * weeksInTimeframe;\n      const consistencyScore = Math.min(100, Math.round((totalWorkouts / expectedWorkouts) * 100));\n\n      const analyticsData = {\n        workouts: workoutsWithPerformance.slice(0, 10), // Limit to recent 10 workouts\n        trends: {\n          difficultyTrend,\n          consistencyScore,\n          averageDifficulty: Math.round(averageDifficulty * 10) / 10,\n          averageExertion: Math.round(averageExertion * 10) / 10,\n          completionRate: Math.round(averageCompletion)\n        }\n      };\n\n      res.json(analyticsData);\n    } catch (error) {\n      console.error(\"Failed to fetch performance analytics:\", error);\n      res.status(500).json({ message: \"Failed to fetch performance analytics\" });\n    }\n  });\n\n  // Get AI difficulty recommendations for user\n  app.get(\"/api/ai-recommendations\", authenticateToken, requireFeatureAccess(PREMIUM_FEATURES.WORKOUT_PLANNER), async (req, res) => {\n    try {\n      const userId = getAuthUserId(req);\n      if (!userId) {\n        return res.status(401).json({ message: \"User not authenticated\" });\n      }\n\n      const recommendations = await autoDifficultyAdjuster.getIntelligentRecommendations(userId);\n      res.json(recommendations);\n    } catch (error) {\n      console.error(\"Failed to fetch AI recommendations:\", error);\n      res.status(500).json({ message: \"Failed to fetch AI recommendations\" });\n    }\n  });\n\n  // Apply AI difficulty adjustments\n  app.post(\"/api/ai-adjustments/apply\", authenticateToken, requireFeatureAccess(PREMIUM_FEATURES.WORKOUT_PLANNER), async (req, res) => {\n    try {\n      const userId = getAuthUserId(req);\n      if (!userId) {\n        return res.status(401).json({ message: \"User not authenticated\" });\n      }\n\n      const { exerciseIds } = req.body;\n      if (!Array.isArray(exerciseIds)) {\n        return res.status(400).json({ message: \"exerciseIds must be an array\" });\n      }\n\n      const results = await autoDifficultyAdjuster.applyAutomaticAdjustments(userId, exerciseIds);\n      const appliedCount = results.filter(r => r).length;\n\n      res.json({ \n        message: `Applied ${appliedCount} difficulty adjustments`,\n        appliedCount,\n        totalRequested: exerciseIds.length,\n        results\n      });\n    } catch (error) {\n      console.error(\"Failed to apply AI adjustments:\", error);\n      res.status(500).json({ message: \"Failed to apply AI adjustments\" });\n    }\n  });\n\n  // Get pending AI difficulty adjustments for user\n  app.get(\"/api/ai-adjustments/pending\", authenticateToken, requireFeatureAccess(PREMIUM_FEATURES.WORKOUT_PLANNER), async (req, res) => {\n    try {\n      const userId = getAuthUserId(req);\n      if (!userId) {\n        return res.status(401).json({ message: \"User not authenticated\" });\n      }\n\n      const pendingAdjustments = await storage.getPendingAiAdjustments(userId);\n      res.json(pendingAdjustments);\n    } catch (error) {\n      console.error(\"Failed to fetch pending adjustments:\", error);\n      res.status(500).json({ message: \"Failed to fetch pending adjustments\" });\n    }\n  });\n\n  // Set up multer for file uploads\n  const upload = multer({\n    storage: multer.memoryStorage(),\n    limits: {\n      fileSize: 5 * 1024 * 1024, // 5MB limit\n    },\n    fileFilter: (req, file, cb) => {\n      if (file.mimetype.startsWith('image/')) {\n        cb(null, true);\n      } else {\n        cb(new Error('Only image files are allowed'));\n      }\n    },\n  });\n\n  // Update user profile with image upload\n  app.post(\"/api/user/profile/upload\", authenticateToken, upload.single('profileImage'), async (req, res) => {\n    try {\n      const userId = getAuthUserId(req);\n      if (!userId) {\n        return res.status(401).json({ message: \"User not authenticated\" });\n      }\n      \n      const { firstName, lastName } = req.body;\n      let profileImageUrl = null;\n      \n      // Handle file upload if present\n      if (req.file) {\n        const fileExtension = path.extname(req.file.originalname);\n        const fileName = `profile-${userId}-${Date.now()}${fileExtension}`;\n        \n        // Store in uploads directory\n        const uploadsDir = path.join(process.cwd(), 'uploads', 'profiles');\n        const uploadPath = path.join(uploadsDir, fileName);\n        \n        try {\n          // Ensure directory exists\n          await fs.mkdir(uploadsDir, { recursive: true });\n          // Write file\n          await fs.writeFile(uploadPath, req.file.buffer);\n          profileImageUrl = `/api/user/profile/image/${fileName}`;\n        } catch (error) {\n          console.error('File upload error:', error);\n          return res.status(500).json({ message: \"Failed to upload image\" });\n        }\n      }\n      \n      const updates: any = {\n        updatedAt: new Date()\n      };\n      \n      if (firstName?.trim()) updates.firstName = firstName.trim();\n      if (lastName?.trim()) updates.lastName = lastName.trim();\n      if (profileImageUrl) updates.profileImageUrl = profileImageUrl;\n      \n      const updatedUser = await storage.updateUser(userId, updates);\n      \n      if (!updatedUser) {\n        return res.status(404).json({ message: \"User not found\" });\n      }\n      \n      res.json(updatedUser);\n    } catch (error) {\n      console.error('Profile update error:', error);\n      res.status(500).json({ message: \"Failed to update profile\" });\n    }\n  });\n\n  // Serve profile images (no auth required for display)\n  app.get(\"/api/user/profile/image/:filename\", async (req, res) => {\n    try {\n      const { filename } = req.params;\n      const uploadsDir = path.join(process.cwd(), 'uploads', 'profiles');\n      const imagePath = path.join(uploadsDir, filename);\n      \n      try {\n        await fs.access(imagePath);\n        res.sendFile(path.resolve(imagePath));\n      } catch (error) {\n        res.status(404).json({ message: \"Image not found\" });\n      }\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to serve image\" });\n    }\n  });\n\n  // Update user profile (name only)\n  app.patch(\"/api/user/profile\", authenticateToken, async (req, res) => {\n    try {\n      const userId = getAuthUserId(req);\n      if (!userId) {\n        return res.status(401).json({ message: \"User not authenticated\" });\n      }\n      \n      const { firstName, lastName } = req.body;\n      if (!firstName?.trim() && !lastName?.trim()) {\n        return res.status(400).json({ message: \"First name or last name is required\" });\n      }\n      \n      // Create safe updates object with only allowed profile fields\n      const safeUpdates: Partial<{ firstName: string | null; lastName: string | null; updatedAt: Date }> = {};\n      if (firstName?.trim()) safeUpdates.firstName = firstName.trim();\n      if (lastName?.trim()) safeUpdates.lastName = lastName.trim();\n      safeUpdates.updatedAt = new Date();\n      \n      const updatedUser = await storage.updateUser(userId, safeUpdates);\n      \n      if (!updatedUser) {\n        return res.status(404).json({ message: \"User not found\" });\n      }\n      \n      res.json(updatedUser);\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to update profile\" });\n    }\n  });\n\n  // Get goals\n  app.get(\"/api/goals\", authenticateToken, async (req, res) => {\n    try {\n      const userId = getAuthUserId(req);\n      if (!userId) {\n        return res.status(401).json({ message: \"User not authenticated\" });\n      }\n      const goals = await storage.getGoals(userId);\n      res.json(goals);\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to fetch goals\" });\n    }\n  });\n\n  // Create goal\n  app.post(\"/api/goals\", authenticateToken, async (req, res) => {\n    try {\n      const userId = getAuthUserId(req);\n      if (!userId) {\n        return res.status(401).json({ message: \"User not authenticated\" });\n      }\n      const data = insertGoalSchema.parse({\n        ...req.body,\n        userId: userId\n      });\n      \n      const goal = await storage.createGoal(data);\n\n      // Log goal creation activity\n      await ActivityLogger.logGoalSet(userId, {\n        type: goal.type,\n        target: goal.target,\n        period: goal.period\n      });\n\n      res.status(201).json(goal);\n    } catch (error) {\n      if (error instanceof z.ZodError) {\n        return res.status(400).json({ message: \"Invalid goal data\", errors: error.errors });\n      }\n      res.status(500).json({ message: \"Failed to create goal\" });\n    }\n  });\n  \n  // Update goal\n  app.patch(\"/api/goals/:id\", authenticateToken, async (req, res) => {\n    try {\n      const userId = getAuthUserId(req);\n      if (!userId) {\n        return res.status(401).json({ message: \"User not authenticated\" });\n      }\n      const { id } = req.params;\n      const updates = req.body;\n      \n      const goal = await storage.updateGoal(id, updates);\n      if (!goal) {\n        return res.status(404).json({ message: \"Goal not found\" });\n      }\n      \n      res.json(goal);\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to update goal\" });\n    }\n  });\n\n  // Delete goal\n  app.delete(\"/api/goals/:id\", authenticateToken, async (req, res) => {\n    try {\n      const userId = getAuthUserId(req);\n      if (!userId) {\n        return res.status(401).json({ message: \"User not authenticated\" });\n      }\n      const { id } = req.params;\n      \n      const deleted = await storage.deleteGoal(id);\n      if (!deleted) {\n        return res.status(404).json({ message: \"Goal not found\" });\n      }\n      \n      res.status(200).json({ message: \"Goal deleted successfully\" });\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to delete goal\" });\n    }\n  });\n\n  // Admin endpoint to list all users (for debugging)\n  app.get(\"/api/admin/users\", authenticateToken, async (req, res) => {\n    try {\n      const users = await storage.getUsers();\n      res.json(users.map(u => ({\n        id: u.id,\n        email: u.email,\n        username: u.username,\n        subscriptionStatus: u.subscriptionStatus\n      })));\n    } catch (error: any) {\n      console.error('Error fetching users:', error);\n      res.status(500).json({ message: \"Failed to fetch users: \" + error.message });\n    }\n  });\n\n  // Get workouts by date range (for calendar)\n  app.get(\"/api/workouts/range/:start/:end\", authenticateToken, async (req, res) => {\n    try {\n      const userId = getAuthUserId(req);\n      if (!userId) {\n        return res.status(401).json({ message: \"User not authenticated\" });\n      }\n      const startDate = new Date(req.params.start);\n      const endDate = new Date(req.params.end);\n      \n      const workouts = await storage.getWorkoutsByDateRange(userId, startDate, endDate);\n      res.json(workouts);\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to fetch workouts for date range\" });\n    }\n  });\n\n  // Trainer Routes\n\n  // Get all trainers with optional filtering\n  app.get(\"/api/trainers\", async (req, res) => {\n    try {\n      const { specialties, location, maxRate } = req.query;\n      \n      const filters: any = {};\n      if (specialties) {\n        filters.specialties = Array.isArray(specialties) ? specialties : [specialties];\n      }\n      if (location) filters.location = location as string;\n      if (maxRate) filters.maxRate = parseInt(maxRate as string);\n      \n      const trainers = await storage.getTrainers(Object.keys(filters).length > 0 ? filters : undefined);\n      res.json(trainers);\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to fetch trainers\" });\n    }\n  });\n\n  // Get trainer by ID\n  app.get(\"/api/trainers/:id\", async (req, res) => {\n    try {\n      const trainer = await storage.getTrainer(req.params.id);\n      if (!trainer) {\n        return res.status(404).json({ message: \"Trainer not found\" });\n      }\n      res.json(trainer);\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to fetch trainer\" });\n    }\n  });\n\n  // Create trainer profile\n  app.post(\"/api/trainers\", authenticateToken, async (req, res) => {\n    try {\n      const userId = getAuthUserId(req);\n      if (!userId) {\n        return res.status(401).json({ message: \"User not authenticated\" });\n      }\n      const data = insertTrainerSchema.parse({\n        ...req.body,\n        userId: userId\n      });\n      \n      const trainer = await storage.createTrainer(data);\n      res.status(201).json(trainer);\n    } catch (error) {\n      if (error instanceof z.ZodError) {\n        return res.status(400).json({ message: \"Invalid trainer data\", errors: error.errors });\n      }\n      res.status(500).json({ message: \"Failed to create trainer profile\" });\n    }\n  });\n\n  // Update trainer profile\n  app.patch(\"/api/trainers/:id\", async (req, res) => {\n    try {\n      const trainer = await storage.updateTrainer(req.params.id, req.body);\n      if (!trainer) {\n        return res.status(404).json({ message: \"Trainer not found\" });\n      }\n      res.json(trainer);\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to update trainer\" });\n    }\n  });\n\n  // Get trainer reviews\n  app.get(\"/api/trainers/:id/reviews\", async (req, res) => {\n    try {\n      const reviews = await storage.getTrainerReviews(req.params.id);\n      res.json(reviews);\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to fetch trainer reviews\" });\n    }\n  });\n\n  // Create trainer service\n  app.post(\"/api/trainers/:trainerId/services\", async (req, res) => {\n    try {\n      const data = insertTrainerServiceSchema.parse({\n        ...req.body,\n        trainerId: req.params.trainerId\n      });\n      \n      const service = await storage.createTrainerService(data);\n      res.status(201).json(service);\n    } catch (error) {\n      if (error instanceof z.ZodError) {\n        return res.status(400).json({ message: \"Invalid service data\", errors: error.errors });\n      }\n      res.status(500).json({ message: \"Failed to create service\" });\n    }\n  });\n\n  // Booking Routes\n\n  // Get user bookings\n  app.get(\"/api/bookings\", authenticateToken, async (req, res) => {\n    try {\n      const userId = getAuthUserId(req);\n      if (!userId) {\n        return res.status(401).json({ message: \"User not authenticated\" });\n      }\n      const bookings = await storage.getBookings(userId);\n      res.json(bookings);\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to fetch bookings\" });\n    }\n  });\n\n  // Get booking by ID\n  app.get(\"/api/bookings/:id\", async (req, res) => {\n    try {\n      const booking = await storage.getBooking(req.params.id);\n      if (!booking) {\n        return res.status(404).json({ message: \"Booking not found\" });\n      }\n      res.json(booking);\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to fetch booking\" });\n    }\n  });\n\n  // Create booking\n  app.post(\"/api/bookings\", authenticateToken, async (req, res) => {\n    try {\n      const userId = getAuthUserId(req);\n      if (!userId) {\n        return res.status(401).json({ message: \"User not authenticated\" });\n      }\n      const data = insertBookingSchema.parse({\n        ...req.body,\n        userId: userId,\n        scheduledAt: new Date(req.body.scheduledAt)\n      });\n      \n      const booking = await storage.createBooking(data);\n      res.status(201).json(booking);\n    } catch (error) {\n      if (error instanceof z.ZodError) {\n        return res.status(400).json({ message: \"Invalid booking data\", errors: error.errors });\n      }\n      res.status(500).json({ message: \"Failed to create booking\" });\n    }\n  });\n\n  // Update booking status\n  app.patch(\"/api/bookings/:id\", async (req, res) => {\n    try {\n      const booking = await storage.updateBooking(req.params.id, req.body);\n      if (!booking) {\n        return res.status(404).json({ message: \"Booking not found\" });\n      }\n      res.json(booking);\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to update booking\" });\n    }\n  });\n\n  // Create review for trainer\n  app.post(\"/api/reviews\", authenticateToken, async (req, res) => {\n    try {\n      const userId = getAuthUserId(req);\n      if (!userId) {\n        return res.status(401).json({ message: \"User not authenticated\" });\n      }\n      const data = insertTrainerReviewSchema.parse({\n        ...req.body,\n        userId: userId\n      });\n      \n      const review = await storage.createTrainerReview(data);\n      res.status(201).json(review);\n    } catch (error) {\n      if (error instanceof z.ZodError) {\n        return res.status(400).json({ message: \"Invalid review data\", errors: error.errors });\n      }\n      res.status(500).json({ message: \"Failed to create review\" });\n    }\n  });\n\n  // Food Routes\n\n  // Get food entries for user\n  app.get(\"/api/food-entries\", authenticateToken, async (req, res) => {\n    try {\n      const userId = getAuthUserId(req);\n      if (!userId) {\n        return res.status(401).json({ message: \"User not authenticated\" });\n      }\n      const { date } = req.query;\n      const targetDate = date ? new Date(date as string) : undefined;\n      \n      const entries = await storage.getFoodEntries(userId, targetDate);\n      res.json(entries);\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to fetch food entries\" });\n    }\n  });\n\n  // Get upload URL for food image\n  app.post(\"/api/food/upload-url\", async (req, res) => {\n    try {\n      const objectStorageService = new ObjectStorageService();\n      const uploadURL = await objectStorageService.getObjectEntityUploadURL();\n      res.json({ uploadURL });\n    } catch (error) {\n      console.error(\"Error getting upload URL:\", error);\n      res.status(500).json({ message: \"Failed to get upload URL\" });\n    }\n  });\n\n  // Analyze food image\n  app.post(\"/api/food/analyze\", async (req, res) => {\n    try {\n      const { imageData } = req.body;\n      \n      if (!imageData) {\n        return res.status(400).json({ message: \"Image data is required\" });\n      }\n\n      // Remove data URL prefix if present\n      const base64Data = imageData.replace(/^data:image\\/[a-z]+;base64,/, \"\");\n      \n      const analysis = await analyzeFoodImage(base64Data);\n      res.json(analysis);\n    } catch (error) {\n      console.error(\"Error analyzing food:\", error);\n      res.status(500).json({ message: (error as Error).message || \"Failed to analyze food image\" });\n    }\n  });\n\n  // Create food entry\n  app.post(\"/api/food-entries\", authenticateToken, async (req, res) => {\n    try {\n      const userId = getAuthUserId(req);\n      if (!userId) {\n        return res.status(401).json({ message: \"User not authenticated\" });\n      }\n      const data = insertFoodEntrySchema.parse({\n        ...req.body,\n        userId: userId\n      });\n      \n      const entry = await storage.createFoodEntry(data);\n      res.status(201).json(entry);\n    } catch (error) {\n      if (error instanceof z.ZodError) {\n        return res.status(400).json({ message: \"Invalid food entry data\", errors: error.errors });\n      }\n      res.status(500).json({ message: \"Failed to create food entry\" });\n    }\n  });\n\n  // Update food entry\n  app.patch(\"/api/food-entries/:id\", async (req, res) => {\n    try {\n      const entry = await storage.updateFoodEntry(req.params.id, req.body);\n      if (!entry) {\n        return res.status(404).json({ message: \"Food entry not found\" });\n      }\n      res.json(entry);\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to update food entry\" });\n    }\n  });\n\n  // Delete food entry\n  app.delete(\"/api/food-entries/:id\", async (req, res) => {\n    try {\n      const deleted = await storage.deleteFoodEntry(req.params.id);\n      if (!deleted) {\n        return res.status(404).json({ message: \"Food entry not found\" });\n      }\n      res.status(204).send();\n    } catch (error) {\n      res.status(500).json({ message: \"Failed to delete food entry\" });\n    }\n  });\n\n\n  // Get current user's trainer profile\n  app.get(\"/api/trainers/me\", authenticateToken, async (req, res) => {\n    try {\n      const userId = getAuthUserId(req);\n      if (!userId) {\n        return res.status(401).json({ message: \"User not authenticated\" });\n      }\n      const trainer = await storage.getTrainerByUserId(userId);\n      if (!trainer) {\n        return res.status(404).json({ message: \"User is not a trainer\" });\n      }\n      res.json(trainer);\n    } catch (error) {\n      console.error(\"Error fetching user trainer profile:\", error);\n      res.status(500).json({ message: \"Failed to fetch trainer profile\" });\n    }\n  });\n\n  // Create trainer profile for current user\n  app.post(\"/api/trainers\", authenticateToken, async (req, res) => {\n    try {\n      const userId = getAuthUserId(req);\n      if (!userId) {\n        return res.status(401).json({ message: \"User not authenticated\" });\n      }\n      // Check if user is already a trainer\n      const existingTrainer = await storage.getTrainerByUserId(userId);\n      if (existingTrainer) {\n        return res.status(400).json({ message: \"User is already a trainer\" });\n      }\n\n      const data = insertTrainerSchema.parse({\n        ...req.body,\n        userId: userId\n      });\n      \n      const trainer = await storage.createTrainer(data);\n      res.status(201).json(trainer);\n    } catch (error) {\n      if (error instanceof z.ZodError) {\n        return res.status(400).json({ message: \"Invalid trainer data\", errors: error.errors });\n      }\n      console.error(\"Error creating trainer:\", error);\n      res.status(500).json({ message: \"Failed to create trainer\" });\n    }\n  });\n\n  // Mile Tracker Routes\n\n  // Get all mile tracker sessions for user\n  app.get(\"/api/mile-tracker/sessions\", authenticateToken, requireFeatureAccess(PREMIUM_FEATURES.MILE_TRACKER), async (req, res) => {\n    try {\n      const userId = getAuthUserId(req);\n      if (!userId) {\n        return res.status(401).json({ message: \"User not authenticated\" });\n      }\n      const sessions = await storage.getMileTrackerSessions(userId);\n      res.json(sessions);\n    } catch (error) {\n      console.error(\"Error fetching mile tracker sessions:\", error);\n      res.status(500).json({ message: \"Failed to fetch sessions\" });\n    }\n  });\n\n  // Get active mile tracker session\n  app.get(\"/api/mile-tracker/sessions/active\", authenticateToken, requireFeatureAccess(PREMIUM_FEATURES.MILE_TRACKER), async (req, res) => {\n    try {\n      const userId = getAuthUserId(req);\n      if (!userId) {\n        return res.status(401).json({ message: \"User not authenticated\" });\n      }\n      const activeSession = await storage.getActiveMileTrackerSession(userId);\n      if (!activeSession) {\n        return res.status(404).json({ message: \"No active session found\" });\n      }\n      res.json(activeSession);\n    } catch (error) {\n      console.error(\"Error fetching active mile tracker session:\", error);\n      res.status(500).json({ message: \"Failed to fetch active session\" });\n    }\n  });\n\n  // Get specific mile tracker session\n  app.get(\"/api/mile-tracker/sessions/:id\", async (req, res) => {\n    try {\n      const session = await storage.getMileTrackerSession(req.params.id);\n      if (!session) {\n        return res.status(404).json({ message: \"Session not found\" });\n      }\n      res.json(session);\n    } catch (error) {\n      console.error(\"Error fetching mile tracker session:\", error);\n      res.status(500).json({ message: \"Failed to fetch session\" });\n    }\n  });\n\n  // Start new mile tracker session\n  app.post(\"/api/mile-tracker/sessions\", authenticateToken, requireFeatureAccess(PREMIUM_FEATURES.MILE_TRACKER), async (req, res) => {\n    try {\n      const userId = getAuthUserId(req);\n      if (!userId) {\n        return res.status(401).json({ message: \"User not authenticated\" });\n      }\n      // Check if there's already an active session\n      const activeSession = await storage.getActiveMileTrackerSession(userId);\n      if (activeSession) {\n        return res.status(400).json({ message: \"There's already an active session\" });\n      }\n\n      const data = insertMileTrackerSessionSchema.parse({\n        ...req.body,\n        userId: userId,\n        status: \"active\"\n      });\n      \n      const session = await storage.createMileTrackerSession(data);\n      res.status(201).json(session);\n    } catch (error) {\n      if (error instanceof z.ZodError) {\n        return res.status(400).json({ message: \"Invalid session data\", errors: error.errors });\n      }\n      console.error(\"Error creating mile tracker session:\", error);\n      res.status(500).json({ message: \"Failed to create session\" });\n    }\n  });\n\n  // Update mile tracker session (for completing, pausing, etc.)\n  app.patch(\"/api/mile-tracker/sessions/:id\", authenticateToken, requireFeatureAccess(PREMIUM_FEATURES.MILE_TRACKER), async (req, res) => {\n    try {\n      const session = await storage.updateMileTrackerSession(req.params.id, req.body);\n      if (!session) {\n        return res.status(404).json({ message: \"Session not found\" });\n      }\n      res.json(session);\n    } catch (error) {\n      console.error(\"Error updating mile tracker session:\", error);\n      res.status(500).json({ message: \"Failed to update session\" });\n    }\n  });\n\n  // Add mile split to session\n  app.post(\"/api/mile-tracker/sessions/:sessionId/splits\", authenticateToken, requireFeatureAccess(PREMIUM_FEATURES.MILE_TRACKER), async (req, res) => {\n    try {\n      const userId = getAuthUserId(req);\n      if (!userId) {\n        return res.status(401).json({ message: \"User not authenticated\" });\n      }\n      const sessionId = req.params.sessionId;\n      \n      // Verify session exists and belongs to user\n      const session = await storage.getMileTrackerSession(sessionId);\n      if (!session || session.userId !== userId) {\n        return res.status(404).json({ message: \"Session not found\" });\n      }\n\n      const data = insertMileTrackerSplitSchema.parse({\n        ...req.body,\n        sessionId\n      });\n      \n      const split = await storage.createMileTrackerSplit(data);\n      res.status(201).json(split);\n    } catch (error) {\n      if (error instanceof z.ZodError) {\n        return res.status(400).json({ message: \"Invalid split data\", errors: error.errors });\n      }\n      console.error(\"Error creating mile split:\", error);\n      res.status(500).json({ message: \"Failed to create split\" });\n    }\n  });\n\n  // Community Routes\n\n  // Get all community posts\n  app.get(\"/api/community/posts\", async (req, res) => {\n    try {\n      const limit = req.query.limit ? parseInt(req.query.limit as string) : undefined;\n      const posts = await storage.getCommunityPosts(limit);\n      res.json(posts);\n    } catch (error) {\n      console.error(\"Error fetching community posts:\", error);\n      res.status(500).json({ message: \"Failed to fetch community posts\" });\n    }\n  });\n\n  // Create new community post\n  app.post(\"/api/community/posts\", authenticateToken, async (req, res) => {\n    try {\n      const userId = getAuthUserId(req);\n      if (!userId) {\n        return res.status(401).json({ message: \"User not authenticated\" });\n      }\n      const data = insertCommunityPostSchema.parse({\n        ...req.body,\n        userId: userId\n      });\n      \n      // Moderate post content for inappropriate language\n      const { moderateText } = await import(\"./services/content-moderation\");\n      const contentToModerate = data.content || '';\n      const moderationResult = await moderateText(contentToModerate);\n      \n      if (!moderationResult.isAppropriate) {\n        return res.status(400).json({ \n          message: \"Your post contains inappropriate content and cannot be published.\",\n          reason: moderationResult.reason,\n          categories: moderationResult.categories\n        });\n      }\n      \n      const post = await storage.createCommunityPost(data);\n      res.status(201).json(post);\n    } catch (error) {\n      if (error instanceof z.ZodError) {\n        return res.status(400).json({ message: \"Invalid post data\", errors: error.errors });\n      }\n      console.error(\"Error creating community post:\", error);\n      res.status(500).json({ message: \"Failed to create post\" });\n    }\n  });\n\n  // Like a community post\n  app.post(\"/api/community/posts/:id/like\", async (req, res) => {\n    try {\n      const post = await storage.likeCommunityPost(req.params.id);\n      if (!post) {\n        return res.status(404).json({ message: \"Post not found\" });\n      }\n      res.json(post);\n    } catch (error) {\n      console.error(\"Error liking community post:\", error);\n      res.status(500).json({ message: \"Failed to like post\" });\n    }\n  });\n\n  // Dislike a community post\n  app.post(\"/api/community/posts/:id/dislike\", async (req, res) => {\n    try {\n      const post = await storage.dislikeCommunityPost(req.params.id);\n      if (!post) {\n        return res.status(404).json({ message: \"Post not found\" });\n      }\n      res.json(post);\n    } catch (error) {\n      console.error(\"Error disliking community post:\", error);\n      res.status(500).json({ message: \"Failed to dislike post\" });\n    }\n  });\n\n  // Delete a community post (only by the post author)\n  app.delete(\"/api/community/posts/:id\", authenticateToken, async (req, res) => {\n    try {\n      const userId = getAuthUserId(req);\n      if (!userId) {\n        return res.status(401).json({ message: \"User not authenticated\" });\n      }\n      \n      const deleted = await storage.deleteCommunityPost(req.params.id, userId);\n      if (!deleted) {\n        return res.status(403).json({ message: \"You can only delete your own posts\" });\n      }\n      \n      res.status(200).json({ message: \"Post deleted successfully\" });\n    } catch (error) {\n      console.error(\"Error deleting community post:\", error);\n      res.status(500).json({ message: \"Failed to delete post\" });\n    }\n  });\n\n  // Object Storage Routes for Community Post Images\n\n  // Get upload URL for community post images\n  app.post(\"/api/objects/upload\", async (req, res) => {\n    try {\n      const objectStorageService = new ObjectStorageService();\n      const uploadURL = await objectStorageService.getObjectEntityUploadURL();\n      res.json({ uploadURL });\n    } catch (error) {\n      console.error(\"Error getting upload URL:\", error);\n      res.status(500).json({ error: \"Failed to get upload URL\" });\n    }\n  });\n\n  // Serve uploaded objects (public access for community images)\n  app.get(\"/objects/:objectPath(*)\", async (req, res) => {\n    const objectStorageService = new ObjectStorageService();\n    try {\n      const objectFile = await objectStorageService.getObjectEntityFile(\n        req.path,\n      );\n      objectStorageService.downloadObject(objectFile, res);\n    } catch (error) {\n      console.error(\"Error accessing object:\", error);\n      if (error instanceof ObjectNotFoundError) {\n        return res.sendStatus(404);\n      }\n      return res.sendStatus(500);\n    }\n  });\n\n  // Update community post with image URL after upload\n  app.put(\"/api/community/post-images\", async (req, res) => {\n    if (!req.body.imageURL) {\n      return res.status(400).json({ error: \"imageURL is required\" });\n    }\n\n    try {\n      // Moderate image for inappropriate content\n      const { moderateImage } = await import(\"./services/content-moderation\");\n      const moderationResult = await moderateImage(req.body.imageURL);\n      \n      if (!moderationResult.isAppropriate) {\n        return res.status(400).json({ \n          error: \"This image contains inappropriate content and cannot be uploaded.\",\n          reason: moderationResult.reason,\n          categories: moderationResult.categories\n        });\n      }\n\n      const objectStorageService = new ObjectStorageService();\n      const objectPath = await objectStorageService.trySetObjectEntityAclPolicy(\n        req.body.imageURL,\n        {\n          owner: \"system\", // For public community images\n          visibility: \"public\", // Community images are public by default\n        },\n      );\n\n      res.status(200).json({\n        objectPath: objectPath,\n      });\n    } catch (error) {\n      console.error(\"Error setting community post image:\", error);\n      res.status(500).json({ error: \"Internal server error\" });\n    }\n  });\n\n  // News and Announcements Routes\n\n  // Get all news items\n  app.get(\"/api/news\", async (req, res) => {\n    try {\n      const limit = req.query.limit ? parseInt(req.query.limit as string) : undefined;\n      const newsItems = await storage.getNews(limit);\n      res.json(newsItems);\n    } catch (error) {\n      console.error(\"Error fetching news:\", error);\n      res.status(500).json({ message: \"Failed to fetch news\" });\n    }\n  });\n\n  // Get a specific news item\n  app.get(\"/api/news/:id\", async (req, res) => {\n    try {\n      const newsItem = await storage.getNewsItem(req.params.id);\n      if (!newsItem) {\n        return res.status(404).json({ message: \"News item not found\" });\n      }\n      res.json(newsItem);\n    } catch (error) {\n      console.error(\"Error fetching news item:\", error);\n      res.status(500).json({ message: \"Failed to fetch news item\" });\n    }\n  });\n\n  // Create a news item (admin only in production)\n  app.post(\"/api/news\", async (req, res) => {\n    try {\n      const newsItem = await storage.createNews(req.body);\n      res.status(201).json(newsItem);\n    } catch (error) {\n      console.error(\"Error creating news item:\", error);\n      res.status(500).json({ message: \"Failed to create news item\" });\n    }\n  });\n\n  // Progress Photos Routes\n\n  // Get progress photos for user\n  app.get(\"/api/progress-photos\", authenticateToken, requireFeatureAccess(PREMIUM_FEATURES.PROGRESS_PHOTOS), async (req, res) => {\n    try {\n      const userId = getAuthUserId(req);\n      if (!userId) {\n        return res.status(401).json({ message: \"User not authenticated\" });\n      }\n      \n      const limit = req.query.limit ? parseInt(req.query.limit as string) : undefined;\n      const photos = await storage.getProgressPhotos(userId, limit);\n      res.json(photos);\n    } catch (error) {\n      console.error(\"Error fetching progress photos:\", error);\n      res.status(500).json({ message: \"Failed to fetch progress photos\" });\n    }\n  });\n\n  // Get progress photos by date range\n  app.get(\"/api/progress-photos/date-range\", authenticateToken, async (req, res) => {\n    try {\n      const userId = getAuthUserId(req);\n      if (!userId) {\n        return res.status(401).json({ message: \"User not authenticated\" });\n      }\n      \n      const { startDate, endDate } = req.query;\n      if (!startDate || !endDate) {\n        return res.status(400).json({ message: \"startDate and endDate are required\" });\n      }\n      \n      const photos = await storage.getProgressPhotosByDateRange(\n        userId, \n        new Date(startDate as string), \n        new Date(endDate as string)\n      );\n      res.json(photos);\n    } catch (error) {\n      console.error(\"Error fetching progress photos by date range:\", error);\n      res.status(500).json({ message: \"Failed to fetch progress photos by date range\" });\n    }\n  });\n\n  // Get specific progress photo\n  app.get(\"/api/progress-photos/:id\", async (req, res) => {\n    try {\n      const photo = await storage.getProgressPhoto(req.params.id);\n      if (!photo) {\n        return res.status(404).json({ message: \"Progress photo not found\" });\n      }\n      res.json(photo);\n    } catch (error) {\n      console.error(\"Error fetching progress photo:\", error);\n      res.status(500).json({ message: \"Failed to fetch progress photo\" });\n    }\n  });\n\n  // Create new progress photo\n  app.post(\"/api/progress-photos\", authenticateToken, requireFeatureAccess(PREMIUM_FEATURES.PROGRESS_PHOTOS), async (req, res) => {\n    try {\n      const userId = getAuthUserId(req);\n      if (!userId) {\n        return res.status(401).json({ message: \"User not authenticated\" });\n      }\n      \n      const data = insertProgressPhotoSchema.parse({\n        ...req.body,\n        userId: userId\n      });\n      \n      const photo = await storage.createProgressPhoto(data);\n      res.status(201).json(photo);\n    } catch (error) {\n      if (error instanceof z.ZodError) {\n        return res.status(400).json({ message: \"Invalid progress photo data\", errors: error.errors });\n      }\n      console.error(\"Error creating progress photo:\", error);\n      res.status(500).json({ message: \"Failed to create progress photo\" });\n    }\n  });\n\n  // Update progress photo\n  app.put(\"/api/progress-photos/:id\", authenticateToken, async (req, res) => {\n    try {\n      const userId = getAuthUserId(req);\n      if (!userId) {\n        return res.status(401).json({ message: \"User not authenticated\" });\n      }\n      \n      // First verify the photo belongs to the user\n      const existingPhoto = await storage.getProgressPhoto(req.params.id);\n      if (!existingPhoto || existingPhoto.userId !== userId) {\n        return res.status(403).json({ message: \"You can only update your own progress photos\" });\n      }\n      \n      const updates = req.body;\n      const updatedPhoto = await storage.updateProgressPhoto(req.params.id, updates);\n      \n      if (!updatedPhoto) {\n        return res.status(404).json({ message: \"Progress photo not found\" });\n      }\n      \n      res.json(updatedPhoto);\n    } catch (error) {\n      console.error(\"Error updating progress photo:\", error);\n      res.status(500).json({ message: \"Failed to update progress photo\" });\n    }\n  });\n\n  // Delete progress photo (only by the photo owner)\n  app.delete(\"/api/progress-photos/:id\", authenticateToken, async (req, res) => {\n    try {\n      const userId = getAuthUserId(req);\n      if (!userId) {\n        return res.status(401).json({ message: \"User not authenticated\" });\n      }\n      \n      const deleted = await storage.deleteProgressPhoto(req.params.id, userId);\n      if (!deleted) {\n        return res.status(403).json({ message: \"You can only delete your own progress photos\" });\n      }\n      \n      res.json({ message: \"Progress photo deleted successfully\" });\n    } catch (error) {\n      console.error(\"Error deleting progress photo:\", error);\n      res.status(500).json({ message: \"Failed to delete progress photo\" });\n    }\n  });\n\n  // Update progress photo with image URL after upload\n  app.put(\"/api/progress-photos/image-url\", authenticateToken, async (req, res) => {\n    try {\n      const userId = getAuthUserId(req);\n      if (!userId) {\n        return res.status(401).json({ message: \"User not authenticated\" });\n      }\n      \n      const { photoId, imageURL } = req.body;\n      if (!photoId || !imageURL) {\n        return res.status(400).json({ error: \"photoId and imageURL are required\" });\n      }\n\n      // Verify the photo belongs to the user\n      const existingPhoto = await storage.getProgressPhoto(photoId);\n      if (!existingPhoto || existingPhoto.userId !== userId) {\n        return res.status(403).json({ message: \"You can only update your own progress photos\" });\n      }\n\n      const objectStorageService = new ObjectStorageService();\n      const objectPath = await objectStorageService.trySetObjectEntityAclPolicy(\n        imageURL,\n        {\n          owner: userId, // Progress photos are private to the user\n          visibility: \"private\",\n        },\n      );\n\n      // Update the photo with the image URL\n      const updatedPhoto = await storage.updateProgressPhoto(photoId, { imageUrl: imageURL });\n\n      res.status(200).json({\n        objectPath: objectPath,\n        photo: updatedPhoto\n      });\n    } catch (error) {\n      console.error(\"Error setting progress photo image:\", error);\n      res.status(500).json({ error: \"Internal server error\" });\n    }\n  });\n\n  // Notification Preferences Routes\n\n  // Get notification preferences for user\n  app.get(\"/api/notification-preferences\", authenticateToken, async (req, res) => {\n    try {\n      const userId = getAuthUserId(req);\n      if (!userId) {\n        return res.status(401).json({ message: \"User not authenticated\" });\n      }\n\n      let preferences = await storage.getNotificationPreferences(userId);\n      \n      // Create default preferences if they don't exist\n      if (!preferences) {\n        preferences = await storage.createNotificationPreferences({\n          userId,\n          workoutRemindersEnabled: true,\n          mealNotificationsEnabled: true,\n          breakfastTime: \"08:00\",\n          lunchTime: \"12:00\",\n          dinnerTime: \"18:00\",\n          notificationPermissionGranted: false,\n        });\n      }\n\n      res.json(preferences);\n    } catch (error) {\n      console.error(\"Error fetching notification preferences:\", error);\n      res.status(500).json({ message: \"Failed to fetch notification preferences\" });\n    }\n  });\n\n  // Update notification preferences\n  app.put(\"/api/notification-preferences\", authenticateToken, async (req, res) => {\n    try {\n      const userId = getAuthUserId(req);\n      if (!userId) {\n        return res.status(401).json({ message: \"User not authenticated\" });\n      }\n\n      const updates = req.body;\n      let updatedPreferences = await storage.updateNotificationPreferences(userId, updates);\n\n      // If preferences don't exist, create them first\n      if (!updatedPreferences) {\n        updatedPreferences = await storage.createNotificationPreferences({\n          userId,\n          ...updates,\n        });\n      }\n\n      res.json(updatedPreferences);\n    } catch (error) {\n      console.error(\"Error updating notification preferences:\", error);\n      res.status(500).json({ message: \"Failed to update notification preferences\" });\n    }\n  });\n\n  // Check if workout reminder is needed\n  app.get(\"/api/notification-preferences/workout-reminder-needed\", authenticateToken, async (req, res) => {\n    try {\n      const userId = getAuthUserId(req);\n      if (!userId) {\n        return res.status(401).json({ message: \"User not authenticated\" });\n      }\n\n      const reminderNeeded = await storage.checkWorkoutReminderNeeded(userId);\n      res.json({ reminderNeeded });\n    } catch (error) {\n      console.error(\"Error checking workout reminder:\", error);\n      res.status(500).json({ message: \"Failed to check workout reminder\" });\n    }\n  });\n\n  // Mark workout reminder as sent\n  app.post(\"/api/notification-preferences/workout-reminder-sent\", authenticateToken, async (req, res) => {\n    try {\n      const userId = getAuthUserId(req);\n      if (!userId) {\n        return res.status(401).json({ message: \"User not authenticated\" });\n      }\n\n      await storage.updateNotificationPreferences(userId, {\n        lastWorkoutReminderSent: new Date(),\n      });\n\n      res.json({ success: true });\n    } catch (error) {\n      console.error(\"Error marking workout reminder sent:\", error);\n      res.status(500).json({ message: \"Failed to mark workout reminder sent\" });\n    }\n  });\n\n  // Meal Plan Routes\n\n  // Get all meal plans (optionally filtered by goal)\n  app.get(\"/api/meal-plans\", authenticateToken, requireFeatureAccess(PREMIUM_FEATURES.MEAL_PLANS), async (req, res) => {\n    try {\n      const { goal } = req.query;\n      const mealPlans = await storage.getMealPlans(goal as string);\n      res.json(mealPlans);\n    } catch (error) {\n      console.error(\"Error fetching meal plans:\", error);\n      res.status(500).json({ message: \"Failed to fetch meal plans\" });\n    }\n  });\n\n  // Get specific meal plan by ID\n  app.get(\"/api/meal-plans/:id\", authenticateToken, requireFeatureAccess(PREMIUM_FEATURES.MEAL_PLANS), async (req, res) => {\n    try {\n      const mealPlan = await storage.getMealPlan(req.params.id);\n      if (!mealPlan) {\n        return res.status(404).json({ message: \"Meal plan not found\" });\n      }\n      res.json(mealPlan);\n    } catch (error) {\n      console.error(\"Error fetching meal plan:\", error);\n      res.status(500).json({ message: \"Failed to fetch meal plan\" });\n    }\n  });\n\n  // Create a new meal plan\n  app.post(\"/api/meal-plans\", authenticateToken, requireFeatureAccess(PREMIUM_FEATURES.MEAL_PLANS), async (req, res) => {\n    try {\n      const data = insertMealPlanSchema.parse(req.body);\n      const mealPlan = await storage.createMealPlan(data);\n      res.status(201).json(mealPlan);\n    } catch (error) {\n      if (error instanceof z.ZodError) {\n        return res.status(400).json({ message: \"Invalid meal plan data\", errors: error.errors });\n      }\n      console.error(\"Error creating meal plan:\", error);\n      res.status(500).json({ message: \"Failed to create meal plan\" });\n    }\n  });\n\n  // Get current user's meal plan\n  app.get(\"/api/user-meal-plan\", authenticateToken, requireFeatureAccess(PREMIUM_FEATURES.MEAL_PLANS), async (req, res) => {\n    try {\n      const userId = getAuthUserId(req);\n      if (!userId) {\n        return res.status(401).json({ message: \"User not authenticated\" });\n      }\n      const userMealPlan = await storage.getUserMealPlan(userId);\n      if (!userMealPlan) {\n        return res.status(404).json({ message: \"No active meal plan found\" });\n      }\n      res.json(userMealPlan);\n    } catch (error) {\n      console.error(\"Error fetching user meal plan:\", error);\n      res.status(500).json({ message: \"Failed to fetch user meal plan\" });\n    }\n  });\n\n  // Assign a meal plan to the current user\n  app.post(\"/api/user-meal-plan\", authenticateToken, requireFeatureAccess(PREMIUM_FEATURES.MEAL_PLANS), async (req, res) => {\n    try {\n      const userId = getAuthUserId(req);\n      console.log(\"Assigning meal plan for user:\", userId);\n      console.log(\"Request body:\", req.body);\n      \n      if (!userId) {\n        return res.status(401).json({ message: \"User not authenticated\" });\n      }\n      \n      // Create a custom validation schema that handles date strings\n      const mealPlanAssignmentSchema = insertUserMealPlanSchema.extend({\n        startDate: z.union([z.date(), z.string().transform((str) => new Date(str))])\n      });\n      \n      const data = mealPlanAssignmentSchema.parse({\n        ...req.body,\n        userId: userId\n      });\n      \n      console.log(\"Parsed data:\", data);\n      \n      const userMealPlan = await storage.assignMealPlan(data);\n      console.log(\"Meal plan assigned successfully:\", userMealPlan);\n      \n      res.status(201).json(userMealPlan);\n    } catch (error) {\n      if (error instanceof z.ZodError) {\n        console.error(\"Validation error:\", error.errors);\n        return res.status(400).json({ message: \"Invalid assignment data\", errors: error.errors });\n      }\n      console.error(\"Error assigning meal plan:\", error);\n      res.status(500).json({ message: \"Failed to assign meal plan\" });\n    }\n  });\n\n  // Get user meal preferences\n  app.get(\"/api/user-meal-preferences\", authenticateToken, requireFeatureAccess(PREMIUM_FEATURES.MEAL_PLANS), async (req, res) => {\n    try {\n      const userId = getAuthUserId(req);\n      if (!userId) {\n        return res.status(401).json({ message: \"User not authenticated\" });\n      }\n      const preferences = await storage.getUserMealPreferences(userId);\n      res.json(preferences || null);\n    } catch (error) {\n      console.error(\"Error fetching user meal preferences:\", error);\n      res.status(500).json({ message: \"Failed to fetch meal preferences\" });\n    }\n  });\n\n  // Create or update user meal preferences\n  app.post(\"/api/user-meal-preferences\", authenticateToken, requireFeatureAccess(PREMIUM_FEATURES.MEAL_PLANS), async (req, res) => {\n    try {\n      const userId = getAuthUserId(req);\n      if (!userId) {\n        return res.status(401).json({ message: \"User not authenticated\" });\n      }\n      \n      const data = insertUserMealPreferencesSchema.parse({\n        ...req.body,\n        userId: userId\n      });\n\n      // Check if preferences already exist\n      const existing = await storage.getUserMealPreferences(userId);\n      let preferences;\n      \n      if (existing) {\n        preferences = await storage.updateUserMealPreferences(userId, data);\n      } else {\n        preferences = await storage.createUserMealPreferences(data);\n      }\n      \n      res.json(preferences);\n    } catch (error) {\n      if (error instanceof z.ZodError) {\n        return res.status(400).json({ message: \"Invalid preferences data\", errors: error.errors });\n      }\n      console.error(\"Error saving meal preferences:\", error);\n      res.status(500).json({ message: \"Failed to save meal preferences\" });\n    }\n  });\n\n  // Generate personalized meal plan using AI\n  app.post(\"/api/generate-meal-plan\", authenticateToken, async (req, res) => {\n    try {\n      const userId = getAuthUserId(req);\n      if (!userId) {\n        return res.status(401).json({ message: \"User not authenticated\" });\n      }\n\n      const { goal, dailyCalories, dietaryRestrictions, allergies, preferences, duration = 7 } = req.body;\n      \n      if (!goal || !dailyCalories) {\n        return res.status(400).json({ message: \"Goal and daily calories are required\" });\n      }\n\n      // Fetch user's food preferences to incorporate into meal plan\n      const userPreferences = await storage.getUserFoodPreferences(userId);\n      const likedFoods = userPreferences\n        .filter(pref => pref.preference === \"like\" || pref.preference === \"love\")\n        .map(pref => pref.foodItemId);\n      \n      const dislikedFoods = userPreferences\n        .filter(pref => pref.preference === \"dislike\" || pref.preference === \"never\")\n        .map(pref => pref.foodItemId);\n\n      // Get the actual food items\n      const allFoodItems = await storage.getFoodItems();\n      const likedFoodItems = allFoodItems.filter(item => likedFoods.includes(item.id));\n      const dislikedFoodItems = allFoodItems.filter(item => dislikedFoods.includes(item.id));\n\n      // Generate the meal plan using AI with food preferences if available\n      let generatedPlan;\n      if (likedFoodItems.length > 0 || dislikedFoodItems.length > 0) {\n        // Use personalized meal plan with food preferences\n        generatedPlan = await generatePersonalizedMealPlan({\n          goal,\n          dailyCalories,\n          duration,\n          likedFoods: likedFoodItems.map(item => item.name),\n          dislikedFoods: dislikedFoodItems.map(item => item.name),\n          userId,\n          dietaryRestrictions: dietaryRestrictions || [],\n          allergies: allergies || [],\n          preferences: preferences || []\n        });\n      } else {\n        // Fall back to general preferences if no food preferences set\n        generatedPlan = await generatePersonalizedMealPlan({\n          goal,\n          dailyCalories,\n          dietaryRestrictions: dietaryRestrictions || [],\n          preferences: preferences || [],\n          allergies: allergies || [],\n          duration\n        });\n      }\n\n      // Save the generated meal plan to storage\n      const mealPlan = await storage.createAIMealPlan(\n        {\n          name: generatedPlan.name,\n          description: generatedPlan.description,\n          goal: generatedPlan.goal,\n          dailyCalories: generatedPlan.dailyCalories,\n          dailyProtein: generatedPlan.dailyProtein,\n          dailyCarbs: generatedPlan.dailyCarbs,\n          dailyFat: generatedPlan.dailyFat,\n          duration: generatedPlan.duration,\n        },\n        generatedPlan.days\n      );\n\n      // Update user preferences with last generation date\n      await storage.updateUserMealPreferences(userId, {\n        lastGeneratedAt: new Date(),\n        goal,\n        dailyCalories,\n        dietaryRestrictions: dietaryRestrictions || [],\n        allergies: allergies || [],\n        preferences: preferences || []\n      });\n\n      // Automatically assign the new meal plan to the user\n      await storage.assignMealPlan({\n        userId,\n        mealPlanId: mealPlan.id,\n        startDate: new Date(),\n        isActive: true\n      });\n\n      res.json({ mealPlan, message: \"Meal plan generated and assigned successfully!\" });\n    } catch (error) {\n      console.error(\"Error generating meal plan:\", error);\n      res.status(500).json({ message: \"Failed to generate meal plan. Please try again.\" });\n    }\n  });\n\n  // Generate weekly meal plans for users (background task)\n  app.post(\"/api/generate-weekly-meal-plans\", async (req, res) => {\n    try {\n      const usersForGeneration = await storage.getUsersForWeeklyMealPlanGeneration();\n      const results = [];\n\n      for (const { userId, preferences } of usersForGeneration) {\n        try {\n          const generatedPlan = await generateWeeklyMealPlan(userId, {\n            goal: preferences.goal as \"weight_loss\" | \"weight_gain\" | \"maintenance\",\n            dailyCalories: preferences.dailyCalories,\n            dietaryRestrictions: preferences.dietaryRestrictions || [],\n            preferences: preferences.preferences || [],\n            allergies: preferences.allergies || []\n          });\n\n          // Save the generated meal plan\n          const mealPlan = await storage.createAIMealPlan(\n            {\n              name: generatedPlan.name,\n              description: generatedPlan.description,\n              goal: generatedPlan.goal,\n              dailyCalories: generatedPlan.dailyCalories,\n              dailyProtein: generatedPlan.dailyProtein,\n              dailyCarbs: generatedPlan.dailyCarbs,\n              dailyFat: generatedPlan.dailyFat,\n              duration: generatedPlan.duration,\n            },\n            generatedPlan.days\n          );\n\n          // Assign to user\n          await storage.assignMealPlan({\n            userId,\n            mealPlanId: mealPlan.id,\n            startDate: new Date(),\n            isActive: true\n          });\n\n          // Update last generation date\n          await storage.updateUserMealPreferences(userId, {\n            lastGeneratedAt: new Date()\n          });\n\n          results.push({ userId, success: true, mealPlanId: mealPlan.id });\n        } catch (error) {\n          console.error(`Error generating meal plan for user ${userId}:`, error);\n          results.push({ userId, success: false, error: (error as Error).message });\n        }\n      }\n\n      res.json({ \n        message: `Generated meal plans for ${results.filter(r => r.success).length}/${results.length} users`,\n        results \n      });\n    } catch (error) {\n      console.error(\"Error in weekly meal plan generation:\", error);\n      res.status(500).json({ message: \"Failed to generate weekly meal plans\" });\n    }\n  });\n\n  // Commission tracking routes\n\n  // Commission tracking routes - DISABLED\n  // Trainer payment tracking features have been removed per user request\n\n  // Trainer subscription management routes - DISABLED\n  // Trainer payment/subscription features have been removed per user request\n\n  // User Subscription Routes\n\n  // Get user subscription status\n  app.get(\"/api/user/subscription\", authenticateToken, async (req, res) => {\n    try {\n      const userId = getAuthUserId(req);\n      if (!userId) {\n        return res.status(401).json({ message: \"User not authenticated\" });\n      }\n      const user = await storage.getUser(userId);\n      if (!user) {\n        return res.status(404).json({ message: \"User not found\" });\n      }\n\n      const now = new Date();\n      const isExpired = user.subscriptionExpiresAt && user.subscriptionExpiresAt < now;\n      \n      let effectiveStatus = user.subscriptionStatus;\n      if (isExpired && user.subscriptionStatus !== \"inactive\") {\n        effectiveStatus = \"expired\";\n      }\n\n      const subscriptionInfo = {\n        subscriptionStatus: effectiveStatus,\n        subscriptionStartDate: user.subscriptionStartDate,\n        lastPaymentDate: user.lastPaymentDate,\n        subscriptionExpiresAt: user.subscriptionExpiresAt,\n        isActive: effectiveStatus === \"free_trial\" || effectiveStatus === \"active\",\n        isFreeTrialActive: effectiveStatus === \"free_trial\" && !isExpired,\n        daysRemaining: user.subscriptionExpiresAt \n          ? Math.max(0, Math.ceil((user.subscriptionExpiresAt.getTime() - now.getTime()) / (1000 * 60 * 60 * 24)))\n          : 0,\n        monthlyFee: 15.99 // $15.99 per month for users\n      };\n\n      res.json(subscriptionInfo);\n    } catch (error) {\n      console.error(\"Error fetching user subscription:\", error);\n      res.status(500).json({ message: \"Failed to fetch subscription status\" });\n    }\n  });\n\n  // Verify Apple App Store receipt and activate subscription\n  app.post(\"/api/user/subscription/verify-receipt\", authenticateToken, async (req, res) => {\n    try {\n      if (!appleStoreService) {\n        return res.status(503).json({ \n          message: \"Apple App Store integration not configured. Please contact support.\",\n          configured: false\n        });\n      }\n\n      const userId = getAuthUserId(req);\n      if (!userId) {\n        return res.status(401).json({ message: \"User not authenticated\" });\n      }\n\n      const { receipt, originalTransactionId } = req.body;\n      if (!receipt && !originalTransactionId) {\n        return res.status(400).json({ message: \"Receipt or original transaction ID required\" });\n      }\n\n      const user = await storage.getUser(userId);\n      if (!user) {\n        return res.status(404).json({ message: \"User not found\" });\n      }\n\n      let subscriptionInfo;\n      if (receipt) {\n        subscriptionInfo = await appleStoreService.verifyReceipt(receipt);\n      } else if (originalTransactionId) {\n        subscriptionInfo = await appleStoreService.getSubscriptionStatus(originalTransactionId);\n      }\n\n      if (!subscriptionInfo || !subscriptionInfo.isActive) {\n        return res.status(400).json({ \n          message: \"Invalid or expired subscription\",\n          isActive: false\n        });\n      }\n\n      const updatedUser = await storage.updateUser(userId, {\n        subscriptionStatus: \"active\",\n        lastPaymentDate: new Date(),\n        subscriptionExpiresAt: subscriptionInfo.expiresDate || null,\n        appleOriginalTransactionId: subscriptionInfo.originalTransactionId\n      });\n\n      if (!updatedUser) {\n        return res.status(500).json({ message: \"Failed to update subscription\" });\n      }\n\n      res.json({\n        message: \"Subscription verified and activated successfully\",\n        subscriptionStatus: \"active\",\n        isActive: subscriptionInfo.isActive,\n        expiresDate: subscriptionInfo.expiresDate,\n        productId: subscriptionInfo.productId\n      });\n    } catch (error) {\n      console.error(\"Error verifying App Store receipt:\", error);\n      res.status(500).json({ \n        message: \"Failed to verify receipt\",\n        error: error instanceof Error ? error.message : \"Unknown error\"\n      });\n    }\n  });\n\n  // Apple App Store Server Notification Webhook\n  app.post(\"/api/webhooks/appstore\", async (req, res) => {\n    try {\n      if (!appleStoreService) {\n        console.warn('App Store webhook received but service not configured');\n        return res.status(503).json({ message: \"Service not configured\" });\n      }\n\n      const { signedPayload } = req.body;\n      if (!signedPayload) {\n        return res.status(400).json({ message: \"Missing signedPayload\" });\n      }\n\n      const notification = await appleStoreService.verifyAndDecodeNotification(signedPayload);\n      const result = await appleStoreService.handleNotification(notification);\n\n      if (result.originalTransactionId) {\n        const usersWithTransaction = await storage.getUsersByAppleTransactionId(result.originalTransactionId);\n        \n        for (const user of usersWithTransaction) {\n          switch (result.action) {\n            case 'renewed':\n              const renewedInfo = await appleStoreService.getSubscriptionStatus(result.originalTransactionId);\n              await storage.updateUser(user.id, {\n                subscriptionStatus: 'active',\n                lastPaymentDate: new Date(),\n                subscriptionExpiresAt: renewedInfo.expiresDate || null\n              });\n              console.log(`Subscription renewed for user ${user.id}`);\n              break;\n\n            case 'expired':\n              await storage.updateUser(user.id, {\n                subscriptionStatus: 'expired'\n              });\n              console.log(`Subscription expired for user ${user.id}`);\n              break;\n\n            case 'cancelled':\n              await storage.updateUser(user.id, {\n                subscriptionStatus: 'inactive'\n              });\n              console.log(`Subscription cancelled for user ${user.id}`);\n              break;\n\n            case 'refunded':\n              await storage.updateUser(user.id, {\n                subscriptionStatus: 'inactive',\n                subscriptionExpiresAt: new Date()\n              });\n              console.log(`Subscription refunded for user ${user.id}`);\n              break;\n          }\n        }\n      }\n\n      res.status(200).json({ message: \"Notification processed\" });\n    } catch (error) {\n      console.error(\"Error processing App Store notification:\", error);\n      res.status(500).json({ \n        message: \"Failed to process notification\",\n        error: error instanceof Error ? error.message : \"Unknown error\"\n      });\n    }\n  });\n\n  // Cancel user subscription\n  app.post(\"/api/user/subscription/cancel\", authenticateToken, async (req, res) => {\n    try {\n      const userId = getAuthUserId(req);\n      if (!userId) {\n        return res.status(401).json({ message: \"User not authenticated\" });\n      }\n\n      const user = await storage.getUser(userId);\n      if (!user) {\n        return res.status(404).json({ message: \"User not found\" });\n      }\n\n      // Update local status to inactive\n      await storage.updateUser(userId, {\n        subscriptionStatus: \"inactive\"\n      });\n      \n      res.json({ message: \"Subscription cancelled successfully\" });\n    } catch (error) {\n      console.error(\"Error cancelling user subscription:\", error);\n      res.status(500).json({ message: \"Failed to cancel subscription\" });\n    }\n  });\n\n  // Delete user account and all associated data\n  app.delete(\"/api/user/account\", authenticateToken, async (req, res) => {\n    try {\n      const userId = getAuthUserId(req);\n      if (!userId) {\n        return res.status(401).json({ message: \"User not authenticated\" });\n      }\n\n      const user = await storage.getUser(userId);\n      if (!user) {\n        return res.status(404).json({ message: \"User not found\" });\n      }\n\n      // Delete all user-related data\n      // This includes: workouts, workout_exercises, goals, payments, trainers, bookings, \n      // trainer_reviews, user_activity_log, workout_preferences, workout_plans, planned_workouts,\n      // food_entries, mile_tracker_sessions, mile_tracker_splits, community_posts,\n      // meal_plans (through user_meal_plans), user_meal_plans, user_food_preferences,\n      // calendar_notes, user_meal_preferences, ai_difficulty_adjustments, meal_entries, progress_photos\n\n      await db.transaction(async (tx) => {\n        // Delete progress photos\n        await tx.delete(progressPhotos).where(eq(progressPhotos.userId, userId));\n        \n        // Delete meal entries\n        await tx.delete(mealEntries).where(eq(mealEntries.userId, userId));\n        \n        // Delete AI difficulty adjustments\n        await tx.delete(aiDifficultyAdjustments).where(eq(aiDifficultyAdjustments.userId, userId));\n        \n        // Delete user meal preferences\n        await tx.delete(userMealPreferences).where(eq(userMealPreferences.userId, userId));\n        \n        // Delete calendar notes\n        await tx.delete(calendarNotes).where(eq(calendarNotes.userId, userId));\n        \n        // Delete user food preferences\n        await tx.delete(userFoodPreferences).where(eq(userFoodPreferences.userId, userId));\n        \n        // Delete user meal plans\n        await tx.delete(userMealPlans).where(eq(userMealPlans.userId, userId));\n        \n        // Delete community posts\n        await tx.delete(communityPosts).where(eq(communityPosts.userId, userId));\n        \n        // Delete mile tracker splits (through sessions)\n        const sessions = await tx.select().from(mileTrackerSessions).where(eq(mileTrackerSessions.userId, userId));\n        for (const session of sessions) {\n          await tx.delete(mileTrackerSplits).where(eq(mileTrackerSplits.sessionId, session.id));\n        }\n        \n        // Delete mile tracker sessions\n        await tx.delete(mileTrackerSessions).where(eq(mileTrackerSessions.userId, userId));\n        \n        // Delete food entries\n        await tx.delete(foodEntries).where(eq(foodEntries.userId, userId));\n        \n        // Delete planned workouts (through workout plans)\n        const plans = await tx.select().from(workoutPlans).where(eq(workoutPlans.userId, userId));\n        for (const plan of plans) {\n          await tx.delete(plannedWorkouts).where(eq(plannedWorkouts.planId, plan.id));\n        }\n        \n        // Delete workout plans\n        await tx.delete(workoutPlans).where(eq(workoutPlans.userId, userId));\n        \n        // Delete workout preferences\n        await tx.delete(workoutPreferences).where(eq(workoutPreferences.userId, userId));\n        \n        // Delete user activity log\n        await tx.delete(userActivityLog).where(eq(userActivityLog.userId, userId));\n        \n        // Delete trainer reviews\n        await tx.delete(trainerReviews).where(eq(trainerReviews.userId, userId));\n        \n        // Delete bookings\n        await tx.delete(bookings).where(eq(bookings.userId, userId));\n        \n        // Delete trainer services and trainer profile if user is a trainer\n        const trainer = await tx.select().from(trainers).where(eq(trainers.userId, userId)).limit(1);\n        if (trainer.length > 0) {\n          await tx.delete(trainerServices).where(eq(trainerServices.trainerId, trainer[0].id));\n          await tx.delete(trainers).where(eq(trainers.userId, userId));\n        }\n        \n        // Delete payments\n        await tx.delete(payments).where(eq(payments.userId, userId));\n        \n        // Delete workout exercises (through workouts)\n        const userWorkouts = await tx.select().from(workouts).where(eq(workouts.userId, userId));\n        for (const workout of userWorkouts) {\n          await tx.delete(workoutExercises).where(eq(workoutExercises.workoutId, workout.id));\n        }\n        \n        // Delete workouts\n        await tx.delete(workouts).where(eq(workouts.userId, userId));\n        \n        // Delete goals\n        await tx.delete(goals).where(eq(goals.userId, userId));\n        \n        // Finally, delete the user\n        await tx.delete(users).where(eq(users.id, userId));\n      });\n\n      // Log out the user by destroying the session\n      req.session.destroy((err) => {\n        if (err) {\n          console.error(\"Error destroying session:\", err);\n        }\n      });\n\n      res.json({ message: \"Account deleted successfully\" });\n    } catch (error) {\n      console.error(\"Error deleting user account:\", error);\n      res.status(500).json({ message: \"Failed to delete account\" });\n    }\n  });\n\n  // Get user subscription revenue (admin endpoint)\n  app.get(\"/api/admin/user-subscription-revenue\", async (req, res) => {\n    try {\n      const users = await storage.getUsers();\n      const activeUsers = users.filter(user => \n        user.subscriptionStatus === \"active\" && \n        user.subscriptionExpiresAt && \n        user.subscriptionExpiresAt > new Date()\n      );\n      \n      const totalMonthlyRevenue = activeUsers.length * 15.99; // $15.99 per user\n\n      res.json({\n        totalMonthlyRevenue: totalMonthlyRevenue,\n        activeUsers: activeUsers.length,\n        monthlyFeePerUser: 15.99, // $15.99 per user per month\n        usersInFreeTrial: users.filter(user => user.subscriptionStatus === \"free_trial\").length\n      });\n    } catch (error) {\n      console.error(\"Error fetching user subscription revenue:\", error);\n      res.status(500).json({ message: \"Failed to fetch user subscription revenue\" });\n    }\n  });\n\n  // Food Items and Preferences API Routes\n  \n  // Get all food items with optional category filter\n  app.get(\"/api/food-items\", authenticateToken, async (req, res) => {\n    try {\n      const category = req.query.category as string | undefined;\n      const foodItems = await storage.getFoodItems(category);\n      res.json(foodItems);\n    } catch (error) {\n      console.error(\"Error fetching food items:\", error);\n      res.status(500).json({ message: \"Failed to fetch food items\" });\n    }\n  });\n\n  // Get food items with user preferences\n  app.get(\"/api/food-items-with-preferences\", authenticateToken, async (req, res) => {\n    try {\n      const userId = getAuthUserId(req);\n      if (!userId) {\n        return res.status(401).json({ message: \"User not authenticated\" });\n      }\n      \n      const category = req.query.category as string | undefined;\n      const foodItems = await storage.getFoodItemsWithUserPreferences(userId, category);\n      res.json(foodItems);\n    } catch (error) {\n      console.error(\"Error fetching food items with preferences:\", error);\n      res.status(500).json({ message: \"Failed to fetch food items\" });\n    }\n  });\n\n  // Get user food preferences\n  app.get(\"/api/user-food-preferences\", authenticateToken, async (req, res) => {\n    try {\n      const userId = getAuthUserId(req);\n      if (!userId) {\n        return res.status(401).json({ message: \"User not authenticated\" });\n      }\n      \n      const preferences = await storage.getUserFoodPreferences(userId);\n      res.json(preferences);\n    } catch (error) {\n      console.error(\"Error fetching user food preferences:\", error);\n      res.status(500).json({ message: \"Failed to fetch food preferences\" });\n    }\n  });\n\n  // Set user food preference\n  app.post(\"/api/user-food-preference\", authenticateToken, async (req, res) => {\n    try {\n      const userId = getAuthUserId(req);\n      if (!userId) {\n        return res.status(401).json({ message: \"User not authenticated\" });\n      }\n      \n      const data = insertUserFoodPreferenceSchema.parse({\n        ...req.body,\n        userId: userId\n      });\n      \n      const preference = await storage.setUserFoodPreference(data);\n      res.status(201).json(preference);\n    } catch (error) {\n      if (error instanceof z.ZodError) {\n        return res.status(400).json({ message: \"Invalid preference data\", errors: error.errors });\n      }\n      console.error(\"Error setting food preference:\", error);\n      res.status(500).json({ message: \"Failed to set food preference\" });\n    }\n  });\n\n  // Generate AI meal plan based on food preferences\n  app.post(\"/api/generate-personalized-meal-plan\", authenticateToken, requireFeatureAccess(PREMIUM_FEATURES.MEAL_PLANS), async (req, res) => {\n    try {\n      const userId = getAuthUserId(req);\n      if (!userId) {\n        return res.status(401).json({ message: \"User not authenticated\" });\n      }\n\n      const { goal, dailyCalories, duration = 7 } = req.body;\n      \n      if (!goal || !dailyCalories) {\n        return res.status(400).json({ message: \"Goal and daily calories are required\" });\n      }\n\n      // Ensure dailyCalories is a number\n      const calories = typeof dailyCalories === 'number' ? dailyCalories : Number(dailyCalories);\n      if (isNaN(calories)) {\n        return res.status(400).json({ message: \"Daily calories must be a valid number\" });\n      }\n\n      // Get user food preferences\n      const userPreferences = await storage.getUserFoodPreferences(userId);\n      const likedFoods = userPreferences\n        .filter(pref => pref.preference === \"like\" || pref.preference === \"love\")\n        .map(pref => pref.foodItemId);\n      \n      const dislikedFoods = userPreferences\n        .filter(pref => pref.preference === \"dislike\" || pref.preference === \"never\")\n        .map(pref => pref.foodItemId);\n\n      // Get the actual food items\n      const allFoodItems = await storage.getFoodItems();\n      const likedFoodItems = allFoodItems.filter(item => likedFoods.includes(item.id));\n      const dislikedFoodItems = allFoodItems.filter(item => dislikedFoods.includes(item.id));\n\n      // Generate personalized meal plan using OpenAI\n      const generatedPlan = await generatePersonalizedMealPlan({\n        goal,\n        dailyCalories: calories,\n        duration,\n        likedFoods: likedFoodItems.map(item => item.name),\n        dislikedFoods: dislikedFoodItems.map(item => item.name),\n        userId\n      });\n\n      // Create the meal plan in storage\n      const mealPlan = await storage.createAIMealPlan(\n        {\n          name: generatedPlan.name,\n          description: generatedPlan.description,\n          goal: generatedPlan.goal,\n          dailyCalories: generatedPlan.dailyCalories,\n          dailyProtein: generatedPlan.dailyProtein,\n          dailyCarbs: generatedPlan.dailyCarbs,\n          dailyFat: generatedPlan.dailyFat,\n          duration: generatedPlan.duration,\n          isActive: true,\n        },\n        generatedPlan.days\n      );\n\n      // Assign to user\n      await storage.assignMealPlan({\n        userId,\n        mealPlanId: mealPlan.id,\n        startDate: new Date(),\n        isActive: true,\n      });\n\n      res.status(201).json({ \n        message: \"Personalized meal plan generated successfully!\", \n        mealPlan \n      });\n    } catch (error: any) {\n      console.error(\"Error generating personalized meal plan:\", error);\n      res.status(500).json({ \n        message: \"Failed to generate personalized meal plan\",\n        details: error.message \n      });\n    }\n  });\n\n  // Workout Planner API routes\n  \n  // Get user workout preferences\n  app.get(\"/api/workout-preferences\", authenticateToken, requireFeatureAccess(PREMIUM_FEATURES.WORKOUT_PLANNER), async (req, res) => {\n    try {\n      const userId = getAuthUserId(req);\n      if (!userId) {\n        return res.status(401).json({ message: \"User not authenticated\" });\n      }\n      \n      const preferences = await storage.getWorkoutPreferences(userId);\n      res.json(preferences);\n    } catch (error) {\n      console.error('Get workout preferences error:', error);\n      res.status(500).json({ message: \"Failed to fetch workout preferences\" });\n    }\n  });\n\n  // Save user workout preferences\n  app.post(\"/api/workout-preferences\", authenticateToken, requireFeatureAccess(PREMIUM_FEATURES.WORKOUT_PLANNER), async (req, res) => {\n    try {\n      const userId = getAuthUserId(req);\n      if (!userId) {\n        return res.status(401).json({ message: \"User not authenticated\" });\n      }\n      \n      const preferences = {\n        userId,\n        fitnessLevel: req.body.fitnessLevel,\n        primaryGoals: req.body.primaryGoals,\n        workoutDaysPerWeek: req.body.workoutDaysPerWeek,\n        sessionDuration: req.body.sessionDuration,\n        availableEquipment: req.body.availableEquipment,\n        preferredWorkoutTypes: req.body.preferredWorkoutTypes,\n        injuriesOrLimitations: req.body.injuriesOrLimitations || []\n      };\n      \n      const savedPreferences = await storage.saveWorkoutPreferences(preferences);\n      res.json(savedPreferences);\n    } catch (error) {\n      console.error('Save workout preferences error:', error);\n      res.status(500).json({ message: \"Failed to save workout preferences\" });\n    }\n  });\n\n  // Get user workout plan\n  app.get(\"/api/workout-plan\", authenticateToken, requireFeatureAccess(PREMIUM_FEATURES.WORKOUT_PLANNER), async (req, res) => {\n    try {\n      const userId = getAuthUserId(req);\n      if (!userId) {\n        return res.status(401).json({ message: \"User not authenticated\" });\n      }\n      \n      const workoutPlan = await storage.getWorkoutPlan(userId);\n      res.json(workoutPlan);\n    } catch (error) {\n      console.error('Get workout plan error:', error);\n      res.status(500).json({ message: \"Failed to fetch workout plan\" });\n    }\n  });\n\n  // Generate new workout plan\n  app.post(\"/api/workout-plan/generate\", authenticateToken, requireFeatureAccess(PREMIUM_FEATURES.WORKOUT_PLANNER), async (req, res) => {\n    try {\n      const userId = getAuthUserId(req);\n      if (!userId) {\n        return res.status(401).json({ message: \"User not authenticated\" });\n      }\n      \n      // Fetch user's workout preferences\n      const preferences = await storage.getWorkoutPreferences(userId);\n      if (!preferences) {\n        return res.status(400).json({ message: \"Please complete the workout questionnaire first\" });\n      }\n      \n      // Generate AI-powered personalized workout plan with specific exercises\n      const { aiWorkoutGenerator } = await import(\"./services/ai-workout-generator\");\n      const plannedWorkouts = await aiWorkoutGenerator.generatePersonalizedPlan({\n        fitnessLevel: preferences.fitnessLevel,\n        primaryGoals: preferences.primaryGoals,\n        workoutDaysPerWeek: preferences.workoutDaysPerWeek,\n        sessionDuration: preferences.sessionDuration,\n        availableEquipment: preferences.availableEquipment,\n        preferredWorkoutTypes: preferences.preferredWorkoutTypes,\n        injuriesOrLimitations: preferences.injuriesOrLimitations || []\n      });\n      \n      const workoutPlan = {\n        userId,\n        name: \"AI-Powered Workout Plan\",\n        description: `A personalized ${preferences.workoutDaysPerWeek}-day workout plan tailored to your ${preferences.fitnessLevel} fitness level and goals`,\n        durationWeeks: 4,\n        isActive: true,\n        startDate: new Date(),\n        endDate: new Date(Date.now() + 28 * 24 * 60 * 60 * 1000), // 4 weeks from now\n      };\n      \n      // Save the workout plan and planned workouts\n      const savedPlan = await storage.createWorkoutPlan(workoutPlan);\n      await storage.createPlannedWorkouts(plannedWorkouts.map(workout => ({\n        ...workout,\n        planId: savedPlan.id\n      })));\n      \n      // Return the complete plan with workouts\n      const completePlan = {\n        ...savedPlan,\n        plannedWorkouts\n      };\n      \n      res.json(completePlan);\n    } catch (error) {\n      console.error('Generate workout plan error:', error);\n      res.status(500).json({ message: \"Failed to generate workout plan\" });\n    }\n  });\n\n  // Meal Tracking API routes\n  \n  // Lookup nutrition data by barcode\n  app.post(\"/api/meal-entries/barcode-lookup\", authenticateToken, requireFeatureAccess(PREMIUM_FEATURES.MEAL_TRACKER), async (req, res) => {\n    try {\n      const { barcode } = req.body;\n      \n      if (!barcode) {\n        return res.status(400).json({ message: \"Barcode is required\" });\n      }\n\n      // Use Open Food Facts API for real nutrition data\n      const nutritionData = await lookupBarcodeNutrition(barcode);\n      \n      res.json(nutritionData);\n    } catch (error) {\n      console.error('Barcode lookup error:', error);\n      res.status(500).json({ \n        message: \"Failed to lookup nutrition data\",\n        details: error instanceof Error ? error.message : 'Unknown error'\n      });\n    }\n  });\n\n  // Get meal entries for a user (optionally filtered by date)\n  app.get(\"/api/meal-entries\", authenticateToken, requireFeatureAccess(PREMIUM_FEATURES.MEAL_TRACKER), async (req, res) => {\n    try {\n      const userId = getAuthUserId(req);\n      if (!userId) {\n        return res.status(401).json({ message: \"User not authenticated\" });\n      }\n\n      const { date } = req.query;\n      const entries = await storage.getMealEntries(userId, date as string);\n      res.json(entries);\n    } catch (error) {\n      console.error('Get meal entries error:', error);\n      res.status(500).json({ message: \"Failed to fetch meal entries\" });\n    }\n  });\n\n  // Create a new meal entry\n  app.post(\"/api/meal-entries\", authenticateToken, requireFeatureAccess(PREMIUM_FEATURES.MEAL_TRACKER), async (req, res) => {\n    try {\n      const userId = getAuthUserId(req);\n      if (!userId) {\n        return res.status(401).json({ message: \"User not authenticated\" });\n      }\n\n      const mealData = { ...req.body, userId };\n      const entry = await storage.createMealEntry(mealData);\n      res.status(201).json(entry);\n    } catch (error) {\n      console.error('Create meal entry error:', error);\n      res.status(500).json({ message: \"Failed to save meal entry\" });\n    }\n  });\n\n  // Delete a meal entry\n  app.delete(\"/api/meal-entries/:id\", authenticateToken, requireFeatureAccess(PREMIUM_FEATURES.MEAL_TRACKER), async (req, res) => {\n    try {\n      const userId = getAuthUserId(req);\n      if (!userId) {\n        return res.status(401).json({ message: \"User not authenticated\" });\n      }\n\n      const { id } = req.params;\n      const success = await storage.deleteMealEntry(id);\n      \n      if (success) {\n        res.json({ message: \"Meal entry deleted successfully\" });\n      } else {\n        res.status(404).json({ message: \"Meal entry not found\" });\n      }\n    } catch (error) {\n      console.error('Delete meal entry error:', error);\n      res.status(500).json({ message: \"Failed to delete meal entry\" });\n    }\n  });\n\n  const httpServer = createServer(app);\n  return httpServer;\n}\n\n// Helper function to generate a personalized weekly schedule based on user preferences\nfunction generateWeeklySchedule(preferences: any) {\n  const workouts: any[] = [];\n  \n  // Determine workout types based on user goals\n  const workoutTypes = determineWorkoutTypes(preferences.primaryGoals, preferences.preferredWorkoutTypes);\n  const sessionDuration = parseInt(preferences.sessionDuration);\n  const workoutDaysPerWeek = parseInt(preferences.workoutDaysPerWeek);\n  \n  const workoutNames = {\n    strength: ['Upper Body Strength', 'Lower Body Power', 'Full Body Strength', 'Push Day', 'Pull Day', 'Leg Day'],\n    cardio: ['HIIT Cardio', 'Steady State Cardio', 'Interval Training', 'Fat Burn Cardio'],\n    yoga: ['Morning Flow', 'Evening Stretch', 'Power Yoga', 'Flexibility Focus'],\n    functional: ['Functional Movement', 'Core & Stability', 'Athletic Training', 'Mobility Work']\n  };\n  \n  // Create workout schedule based on days per week\n  const weeklyPattern = createWeeklyPattern(workoutDaysPerWeek, workoutTypes, preferences.fitnessLevel);\n  \n  // Generate 4 weeks of workouts\n  for (let week = 1; week <= 4; week++) {\n    weeklyPattern.forEach((dayPlan, dayIndex) => {\n      if (dayPlan.isRest) {\n        workouts.push({\n          id: `workout_${week}_${dayIndex}`,\n          dayOfWeek: dayIndex,\n          weekNumber: week,\n          workoutType: 'rest',\n          name: 'Rest Day',\n          description: 'Take a well-deserved rest or do some light stretching',\n          estimatedDuration: 0,\n          targetCalories: 0,\n          exercises: [],\n          isRestDay: true,\n          completed: false\n        });\n      } else {\n        const names = workoutNames[dayPlan.type as keyof typeof workoutNames];\n        const randomName = names[Math.floor(Math.random() * names.length)];\n        const adjustedDuration = adjustDurationForLevel(sessionDuration, preferences.fitnessLevel, week);\n        \n        workouts.push({\n          id: `workout_${week}_${dayIndex}`,\n          dayOfWeek: dayIndex,\n          weekNumber: week,\n          workoutType: dayPlan.type,\n          name: randomName,\n          description: generateWorkoutDescription(dayPlan.type, preferences),\n          estimatedDuration: adjustedDuration,\n          targetCalories: calculateTargetCalories(adjustedDuration, dayPlan.type, preferences.fitnessLevel),\n          exercises: [], // Would contain actual exercise IDs based on equipment\n          isRestDay: false,\n          completed: false\n        });\n      }\n    });\n  }\n  \n  return workouts;\n}\n\n// Helper function to determine workout types based on goals\nfunction determineWorkoutTypes(goals: string[], preferredTypes: string[]) {\n  const typeMapping: { [key: string]: string[] } = {\n    lose_weight: ['cardio', 'functional', 'strength'],\n    build_muscle: ['strength', 'functional'],\n    improve_endurance: ['cardio', 'functional'],\n    general_fitness: ['strength', 'cardio', 'yoga', 'functional'],\n    sport_specific: ['functional', 'strength', 'cardio']\n  };\n  \n  const recommendedTypes = new Set<string>();\n  goals.forEach(goal => {\n    typeMapping[goal]?.forEach(type => recommendedTypes.add(type));\n  });\n  \n  // Add preferred types\n  preferredTypes?.forEach((type: string) => recommendedTypes.add(type));\n  \n  // Ensure at least some variety\n  if (recommendedTypes.size === 0) {\n    return ['strength', 'cardio', 'functional'];\n  }\n  \n  return Array.from(recommendedTypes);\n}\n\n// Helper function to create weekly workout pattern\nfunction createWeeklyPattern(daysPerWeek: number, workoutTypes: string[], fitnessLevel: string) {\n  const pattern = Array(7).fill({ isRest: true });\n  \n  const workoutDays: number[] = [];\n  \n  // Distribute workout days based on frequency\n  switch (daysPerWeek) {\n    case 2:\n      workoutDays.push(1, 4); // Monday, Thursday\n      break;\n    case 3:\n      workoutDays.push(1, 3, 5); // Monday, Wednesday, Friday\n      break;\n    case 4:\n      workoutDays.push(1, 2, 4, 5); // Monday, Tuesday, Thursday, Friday\n      break;\n    case 5:\n      workoutDays.push(1, 2, 3, 4, 5); // Monday-Friday\n      break;\n    case 6:\n      workoutDays.push(1, 2, 3, 4, 5, 6); // Monday-Saturday\n      break;\n    default:\n      workoutDays.push(1, 3, 5); // Default to 3 days\n  }\n  \n  // Assign workout types to workout days\n  workoutDays.forEach((day, index) => {\n    const typeIndex = index % workoutTypes.length;\n    pattern[day] = {\n      isRest: false,\n      type: workoutTypes[typeIndex]\n    };\n  });\n  \n  return pattern;\n}\n\n// Helper function to adjust duration based on fitness level and progression\nfunction adjustDurationForLevel(baseDuration: number, fitnessLevel: string, week: number) {\n  let levelMultiplier = 1;\n  \n  switch (fitnessLevel) {\n    case 'beginner':\n      levelMultiplier = 0.8; // 20% shorter for beginners\n      break;\n    case 'intermediate':\n      levelMultiplier = 1;\n      break;\n    case 'advanced':\n      levelMultiplier = 1.2; // 20% longer for advanced\n      break;\n  }\n  \n  // Gradual progression over 4 weeks\n  const progressionMultiplier = 1 + (week - 1) * 0.05; // 5% increase per week\n  \n  return Math.round(baseDuration * levelMultiplier * progressionMultiplier);\n}\n\n// Helper function to generate workout descriptions\nfunction generateWorkoutDescription(workoutType: string, preferences: any) {\n  const level = preferences.fitnessLevel;\n  const equipment = preferences.availableEquipment?.join(', ') || 'bodyweight';\n  \n  const descriptions: { [key: string]: string } = {\n    strength: `${level} strength training session using ${equipment}`,\n    cardio: `${level} cardiovascular workout to improve endurance`,\n    yoga: `${level} yoga flow for flexibility and mindfulness`,\n    functional: `${level} functional movement training for everyday strength`\n  };\n  \n  return descriptions[workoutType] || `${level} workout session`;\n}\n\n// Helper function to calculate target calories\nfunction calculateTargetCalories(duration: number, workoutType: string, fitnessLevel: string) {\n  const baseRate: { [key: string]: number } = {\n    strength: 6,\n    cardio: 10,\n    yoga: 3,\n    functional: 8\n  };\n  \n  const levelMultiplier: { [key: string]: number } = {\n    beginner: 0.8,\n    intermediate: 1,\n    advanced: 1.2\n  };\n  \n  const rate = baseRate[workoutType] || 7;\n  const multiplier = levelMultiplier[fitnessLevel] || 1;\n  \n  return Math.round(duration * rate * multiplier);\n}\n\n// Helper function to lookup nutrition data from Open Food Facts API\nasync function lookupBarcodeNutrition(barcode: string) {\n  try {\n    // Call Open Food Facts API\n    const response = await fetch(`https://world.openfoodfacts.org/api/v2/product/${barcode}.json`);\n    const data = await response.json();\n    \n    if (data.status === 1 && data.product) {\n      const product = data.product;\n      const nutriments = product.nutriments || {};\n      \n      // Convert per 100g values to per serving if serving size is available\n      const servingSize = product.serving_size || product.product_quantity || \"100g\";\n      const servingMultiplier = parseFloat(servingSize) / 100 || 1;\n      \n      return {\n        success: true,\n        barcode,\n        product: {\n          name: product.product_name || product.product_name_en || \"Unknown Product\",\n          brand: product.brands || \"Unknown Brand\",\n          servingSize: servingSize,\n          calories: Math.round((nutriments.energy_kcal_100g || nutriments[\"energy-kcal_100g\"] || 0) * servingMultiplier),\n          protein: Math.round((nutriments.proteins_100g || 0) * servingMultiplier * 10) / 10,\n          carbs: Math.round((nutriments.carbohydrates_100g || 0) * servingMultiplier * 10) / 10,\n          fat: Math.round((nutriments.fat_100g || 0) * servingMultiplier * 10) / 10,\n          fiber: Math.round((nutriments.fiber_100g || 0) * servingMultiplier * 10) / 10,\n          sugar: Math.round((nutriments.sugars_100g || 0) * servingMultiplier * 10) / 10,\n          sodium: Math.round((nutriments.sodium_100g || 0) * servingMultiplier * 1000) // Convert g to mg\n        }\n      };\n    } else {\n      // Product not found in Open Food Facts database\n      return {\n        success: false,\n        barcode,\n        message: \"Product not found in nutrition database. Please add the nutritional information manually.\"\n      };\n    }\n  } catch (error) {\n    console.error('Open Food Facts API error:', error);\n    \n    // Fallback to generic food data if API fails\n    const genericCalories = 150 + Math.floor(Math.random() * 200);\n    return {\n      success: true,\n      barcode,\n      product: {\n        name: \"Unknown Food Item\",\n        brand: \"Please edit product name\",\n        servingSize: \"1 serving\",\n        calories: genericCalories,\n        protein: Math.round(genericCalories * 0.1 / 4),\n        carbs: Math.round(genericCalories * 0.6 / 4),\n        fat: Math.round(genericCalories * 0.3 / 9),\n        fiber: 2,\n        sugar: 5,\n        sodium: 100\n      },\n      note: \"Nutrition data is estimated. Please verify and edit as needed.\"\n    };\n  }\n}\n","size_bytes":105852},"server/foodRecognition.ts":{"content":"import OpenAI from \"openai\";\n\n// the newest OpenAI model is \"gpt-4o\" which was released May 13, 2024. do not change this unless explicitly requested by the user\nconst openai = new OpenAI({\n  apiKey: process.env.AI_INTEGRATIONS_OPENAI_API_KEY || process.env.OPENAI_API_KEY,\n  baseURL: process.env.AI_INTEGRATIONS_OPENAI_BASE_URL\n});\n\nexport interface FoodAnalysisResult {\n  name: string;\n  description: string;\n  calories: number;\n  protein: number;\n  carbs: number;\n  fat: number;\n  fiber: number;\n  sugar: number;\n  sodium: number;\n  servingSize: string;\n  confidence: number;\n}\n\nexport async function analyzeFoodImage(base64Image: string): Promise<FoodAnalysisResult> {\n  try {\n    const response = await openai.chat.completions.create({\n      model: \"gpt-5\", // the newest OpenAI model is \"gpt-5\" which was released August 7, 2025. do not change this unless explicitly requested by the user\n      messages: [\n        {\n          role: \"system\",\n          content: `You are a nutrition expert AI that analyzes food images. When given an image of food, you should:\n1. Identify the food items in the image\n2. Estimate the serving size/portion\n3. Provide detailed nutritional information per serving\n4. Rate your confidence in the analysis (0-100)\n\nRespond with JSON in this exact format:\n{\n  \"name\": \"Food name (e.g., 'Grilled Chicken Breast')\",\n  \"description\": \"Brief description of the food and preparation method\",\n  \"calories\": number,\n  \"protein\": number (grams),\n  \"carbs\": number (grams),\n  \"fat\": number (grams),\n  \"fiber\": number (grams),\n  \"sugar\": number (grams),\n  \"sodium\": number (milligrams),\n  \"servingSize\": \"Estimated serving size (e.g., '1 medium piece', '1 cup', '150g')\",\n  \"confidence\": number (0-100, how confident you are in this analysis)\n}`\n        },\n        {\n          role: \"user\",\n          content: [\n            {\n              type: \"text\",\n              text: \"Please analyze this food image and provide detailed nutritional information.\"\n            },\n            {\n              type: \"image_url\",\n              image_url: {\n                url: `data:image/jpeg;base64,${base64Image}`\n              }\n            }\n          ]\n        }\n      ],\n      response_format: { type: \"json_object\" },\n      max_tokens: 1000,\n    });\n\n    const result = JSON.parse(response.choices[0].message.content || \"{}\");\n    \n    // Validate required fields\n    const requiredFields = ['name', 'description', 'calories', 'protein', 'carbs', 'fat', 'fiber', 'sugar', 'sodium', 'servingSize', 'confidence'];\n    for (const field of requiredFields) {\n      if (!(field in result)) {\n        throw new Error(`Missing required field: ${field}`);\n      }\n    }\n\n    // Ensure numeric fields are numbers and within reasonable ranges\n    result.calories = Math.max(0, Math.min(5000, Number(result.calories) || 0));\n    result.protein = Math.max(0, Math.min(300, Number(result.protein) || 0));\n    result.carbs = Math.max(0, Math.min(500, Number(result.carbs) || 0));\n    result.fat = Math.max(0, Math.min(200, Number(result.fat) || 0));\n    result.fiber = Math.max(0, Math.min(100, Number(result.fiber) || 0));\n    result.sugar = Math.max(0, Math.min(300, Number(result.sugar) || 0));\n    result.sodium = Math.max(0, Math.min(10000, Number(result.sodium) || 0));\n    result.confidence = Math.max(0, Math.min(100, Number(result.confidence) || 0));\n\n    return result as FoodAnalysisResult;\n  } catch (error) {\n    console.error(\"Error analyzing food image:\", error);\n    throw new Error(\"Failed to analyze food image. Please try again.\");\n  }\n}","size_bytes":3557},"client/src/components/ui/navigation-menu.tsx":{"content":"import * as React from \"react\"\nimport * as NavigationMenuPrimitive from \"@radix-ui/react-navigation-menu\"\nimport { cva } from \"class-variance-authority\"\nimport { ChevronDown } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst NavigationMenu = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Root>\n>(({ className, children, ...props }, ref) => (\n  <NavigationMenuPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative z-10 flex max-w-max flex-1 items-center justify-center\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <NavigationMenuViewport />\n  </NavigationMenuPrimitive.Root>\n))\nNavigationMenu.displayName = NavigationMenuPrimitive.Root.displayName\n\nconst NavigationMenuList = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.List>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.List>\n>(({ className, ...props }, ref) => (\n  <NavigationMenuPrimitive.List\n    ref={ref}\n    className={cn(\n      \"group flex flex-1 list-none items-center justify-center space-x-1\",\n      className\n    )}\n    {...props}\n  />\n))\nNavigationMenuList.displayName = NavigationMenuPrimitive.List.displayName\n\nconst NavigationMenuItem = NavigationMenuPrimitive.Item\n\nconst navigationMenuTriggerStyle = cva(\n  \"group inline-flex h-10 w-max items-center justify-center rounded-md bg-background px-4 py-2 text-sm font-medium transition-colors hover:bg-accent hover:text-accent-foreground focus:bg-accent focus:text-accent-foreground focus:outline-none disabled:pointer-events-none disabled:opacity-50 data-[state=open]:text-accent-foreground data-[state=open]:bg-accent/50 data-[state=open]:hover:bg-accent data-[state=open]:focus:bg-accent\"\n)\n\nconst NavigationMenuTrigger = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Trigger>\n>(({ className, children, ...props }, ref) => (\n  <NavigationMenuPrimitive.Trigger\n    ref={ref}\n    className={cn(navigationMenuTriggerStyle(), \"group\", className)}\n    {...props}\n  >\n    {children}{\" \"}\n    <ChevronDown\n      className=\"relative top-[1px] ml-1 h-3 w-3 transition duration-200 group-data-[state=open]:rotate-180\"\n      aria-hidden=\"true\"\n    />\n  </NavigationMenuPrimitive.Trigger>\n))\nNavigationMenuTrigger.displayName = NavigationMenuPrimitive.Trigger.displayName\n\nconst NavigationMenuContent = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <NavigationMenuPrimitive.Content\n    ref={ref}\n    className={cn(\n      \"left-0 top-0 w-full data-[motion^=from-]:animate-in data-[motion^=to-]:animate-out data-[motion^=from-]:fade-in data-[motion^=to-]:fade-out data-[motion=from-end]:slide-in-from-right-52 data-[motion=from-start]:slide-in-from-left-52 data-[motion=to-end]:slide-out-to-right-52 data-[motion=to-start]:slide-out-to-left-52 md:absolute md:w-auto \",\n      className\n    )}\n    {...props}\n  />\n))\nNavigationMenuContent.displayName = NavigationMenuPrimitive.Content.displayName\n\nconst NavigationMenuLink = NavigationMenuPrimitive.Link\n\nconst NavigationMenuViewport = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Viewport>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Viewport>\n>(({ className, ...props }, ref) => (\n  <div className={cn(\"absolute left-0 top-full flex justify-center\")}>\n    <NavigationMenuPrimitive.Viewport\n      className={cn(\n        \"origin-top-center relative mt-1.5 h-[var(--radix-navigation-menu-viewport-height)] w-full overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-90 md:w-[var(--radix-navigation-menu-viewport-width)]\",\n        className\n      )}\n      ref={ref}\n      {...props}\n    />\n  </div>\n))\nNavigationMenuViewport.displayName =\n  NavigationMenuPrimitive.Viewport.displayName\n\nconst NavigationMenuIndicator = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Indicator>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Indicator>\n>(({ className, ...props }, ref) => (\n  <NavigationMenuPrimitive.Indicator\n    ref={ref}\n    className={cn(\n      \"top-full z-[1] flex h-1.5 items-end justify-center overflow-hidden data-[state=visible]:animate-in data-[state=hidden]:animate-out data-[state=hidden]:fade-out data-[state=visible]:fade-in\",\n      className\n    )}\n    {...props}\n  >\n    <div className=\"relative top-[60%] h-2 w-2 rotate-45 rounded-tl-sm bg-border shadow-md\" />\n  </NavigationMenuPrimitive.Indicator>\n))\nNavigationMenuIndicator.displayName =\n  NavigationMenuPrimitive.Indicator.displayName\n\nexport {\n  navigationMenuTriggerStyle,\n  NavigationMenu,\n  NavigationMenuList,\n  NavigationMenuItem,\n  NavigationMenuContent,\n  NavigationMenuTrigger,\n  NavigationMenuLink,\n  NavigationMenuIndicator,\n  NavigationMenuViewport,\n}\n","size_bytes":5128},"client/src/components/navigation-header.tsx":{"content":"import { Dumbbell, User, ChevronDown } from \"lucide-react\";\nimport { Link, useLocation } from \"wouter\";\nimport { useNewAuth } from \"@/hooks/useNewAuth\";\nimport PremiumBadge from \"@/components/premium-badge\";\nimport ProfileEditor from \"@/components/profile-editor\";\nimport {\n  DropdownMenu,\n  DropdownMenuContent,\n  DropdownMenuItem,\n  DropdownMenuLabel,\n  DropdownMenuSeparator,\n  DropdownMenuTrigger,\n} from \"@/components/ui/dropdown-menu\";\nimport { Button } from \"@/components/ui/button\";\nimport type { User as UserType } from \"@shared/schema\";\n\nexport default function NavigationHeader() {\n  const { user } = useNewAuth() as { user: UserType | null };\n  const [location] = useLocation();\n  const fullName = user ? `${user.firstName || \"\"} ${user.lastName || \"\"}`.trim() : \"\";\n  const displayName = fullName || user?.email || \"User\";\n\n  const isActive = (path: string) => location === path;\n  return (\n    <header className=\"bg-white shadow-sm border-b border-gray-200 sticky top-0 z-[70]\">\n      <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8\">\n        <div className=\"flex justify-between items-center h-16\">\n          <div className=\"flex items-center space-x-4\">\n            <div className=\"flex items-center space-x-2\">\n              <Dumbbell className=\"text-primary text-2xl\" />\n            </div>\n          </div>\n\n          <nav className=\"hidden lg:flex space-x-8\">\n            <Link\n              href=\"/\"\n              className={`transition-colors py-4 ${\n                isActive(\"/\")\n                  ? \"text-primary font-medium border-b-2 border-primary\"\n                  : \"text-gray-600 hover:text-primary\"\n              }`}\n              data-testid=\"nav-home\"\n            >\n              Home\n            </Link>\n            <Link\n              href=\"/workouts\"\n              className={`transition-colors py-4 ${\n                isActive(\"/workouts\")\n                  ? \"text-primary font-medium border-b-2 border-primary\"\n                  : \"text-gray-600 hover:text-primary\"\n              }`}\n              data-testid=\"nav-workouts\"\n            >\n              Workouts\n            </Link>\n            <Link\n              href=\"/progress\"\n              className={`transition-colors py-4 ${\n                isActive(\"/progress\")\n                  ? \"text-primary font-medium border-b-2 border-primary\"\n                  : \"text-gray-600 hover:text-primary\"\n              }`}\n              data-testid=\"nav-progress\"\n            >\n              Progress\n            </Link>\n            <Link\n              href=\"/calendar\"\n              className={`transition-colors py-4 ${\n                isActive(\"/calendar\")\n                  ? \"text-primary font-medium border-b-2 border-primary\"\n                  : \"text-gray-600 hover:text-primary\"\n              }`}\n              data-testid=\"nav-calendar\"\n            >\n              Calendar\n            </Link>\n          </nav>\n\n          <div className=\"flex items-center space-x-4\">\n            <PremiumBadge />\n            <div className=\"hidden lg:flex items-center space-x-3\">\n              <DropdownMenu>\n                <DropdownMenuTrigger asChild>\n                  <Button variant=\"ghost\" className=\"flex items-center space-x-2 hover:bg-gray-50\" data-testid=\"user-menu-trigger\">\n                    <span className=\"text-sm text-gray-700\">{displayName}</span>\n                    <div className=\"w-8 h-8 bg-primary rounded-full flex items-center justify-center overflow-hidden border-2 border-gray-200\">\n                      {user?.profileImageUrl ? (\n                        <img \n                          src={user.profileImageUrl} \n                          alt=\"Profile\" \n                          className=\"w-full h-full object-cover\"\n                          data-testid=\"nav-profile-image\"\n                        />\n                      ) : (\n                        <User className=\"text-white text-sm\" />\n                      )}\n                    </div>\n                    <ChevronDown className=\"w-4 h-4 text-gray-500\" />\n                  </Button>\n                </DropdownMenuTrigger>\n                <DropdownMenuContent align=\"end\" className=\"w-56\">\n                  <DropdownMenuLabel className=\"font-normal\">\n                    <div className=\"flex flex-col space-y-1\">\n                      <p className=\"text-sm font-medium leading-none\">\n                        {fullName || \"Welcome!\"}\n                      </p>\n                      <p className=\"text-xs leading-none text-muted-foreground\">\n                        {user?.email}\n                      </p>\n                    </div>\n                  </DropdownMenuLabel>\n                  <DropdownMenuSeparator />\n                  <DropdownMenuItem asChild>\n                    <ProfileEditor trigger={\n                      <div className=\"flex items-center w-full cursor-pointer\" data-testid=\"profile-menu-item\">\n                        <User className=\"w-4 h-4 mr-2\" />\n                        Edit Profile\n                      </div>\n                    } />\n                  </DropdownMenuItem>\n                </DropdownMenuContent>\n              </DropdownMenu>\n            </div>\n          </div>\n        </div>\n      </div>\n    </header>\n  );\n}\n","size_bytes":5239},"client/src/components/floating-action-button.tsx":{"content":"import { Plus } from \"lucide-react\";\nimport { useState } from \"react\";\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogTrigger } from \"@/components/ui/dialog\";\nimport { Button } from \"@/components/ui/button\";\nimport { useLocation } from \"wouter\";\n\nexport default function FloatingActionButton() {\n  const [isDialogOpen, setIsDialogOpen] = useState(false);\n  const [, setLocation] = useLocation();\n  \n  const quickActions = [\n    {\n      title: \"Log Quick Workout\",\n      description: \"Start tracking your workout now\",\n      action: () => {\n        setIsDialogOpen(false);\n        // Scroll to workout logger on dashboard\n        const element = document.getElementById('workout-logger');\n        if (element) {\n          element.scrollIntoView({ behavior: 'smooth' });\n        }\n      }\n    },\n    {\n      title: \"Browse Workouts\",\n      description: \"Explore workout routines and exercises\",\n      action: () => {\n        setIsDialogOpen(false);\n        setLocation('/workouts');\n      }\n    },\n    {\n      title: \"View Progress\",\n      description: \"Check your fitness progress and stats\",\n      action: () => {\n        setIsDialogOpen(false);\n        setLocation('/progress');\n      }\n    },\n    {\n      title: \"Check Calendar\",\n      description: \"View your workout schedule\",\n      action: () => {\n        setIsDialogOpen(false);\n        setLocation('/calendar');\n      }\n    }\n  ];\n\n  return (\n    <Dialog open={isDialogOpen} onOpenChange={setIsDialogOpen}>\n      <DialogTrigger asChild>\n        <button\n          className=\"fixed bottom-20 md:bottom-6 right-6 bg-accent hover:bg-orange-600 text-white w-14 h-14 rounded-full shadow-lg hover:shadow-xl transition-all duration-300 flex items-center justify-center z-30\"\n          data-testid=\"floating-action-button\"\n        >\n          <Plus className=\"text-xl\" />\n        </button>\n      </DialogTrigger>\n      <DialogContent className=\"sm:max-w-md\">\n        <DialogHeader>\n          <DialogTitle>Quick Actions</DialogTitle>\n        </DialogHeader>\n        <div className=\"space-y-3\">\n          {quickActions.map((action, index) => (\n            <Button\n              key={index}\n              variant=\"outline\"\n              className=\"w-full justify-start text-left h-auto p-4\"\n              onClick={action.action}\n              data-testid={`quick-action-${index}`}\n            >\n              <div>\n                <div className=\"font-medium\">{action.title}</div>\n                <div className=\"text-sm text-muted-foreground\">{action.description}</div>\n              </div>\n            </Button>\n          ))}\n        </div>\n      </DialogContent>\n    </Dialog>\n  );\n}\n","size_bytes":2650},"client/src/components/mobile-navigation.tsx":{"content":"import { Home, Dumbbell, TrendingUp, Calendar } from \"lucide-react\";\nimport { Link, useLocation } from \"wouter\";\n\nexport default function MobileNavigation() {\n  const [location] = useLocation();\n  \n  const isActive = (path: string) => location === path;\n  \n  return (\n    <div className=\"md:hidden bg-white border-t border-gray-200 fixed bottom-0 left-0 right-0 z-40\">\n      <div className=\"flex justify-around py-2\">\n        <Link\n          href=\"/\"\n          className={`flex flex-col items-center p-2 transition-colors ${\n            isActive(\"/\") ? \"text-primary\" : \"text-muted hover:text-primary\"\n          }`}\n          data-testid=\"mobile-nav-home\"\n        >\n          <Home className=\"text-lg\" />\n          <span className=\"text-xs mt-1\">Home</span>\n        </Link>\n        <Link\n          href=\"/workouts\"\n          className={`flex flex-col items-center p-2 transition-colors ${\n            isActive(\"/workouts\") ? \"text-primary\" : \"text-muted hover:text-primary\"\n          }`}\n          data-testid=\"mobile-nav-workouts\"\n        >\n          <Dumbbell className=\"text-lg\" />\n          <span className=\"text-xs mt-1\">Workouts</span>\n        </Link>\n        <Link\n          href=\"/progress\"\n          className={`flex flex-col items-center p-2 transition-colors ${\n            isActive(\"/progress\") ? \"text-primary\" : \"text-muted hover:text-primary\"\n          }`}\n          data-testid=\"mobile-nav-progress\"\n        >\n          <TrendingUp className=\"text-lg\" />\n          <span className=\"text-xs mt-1\">Progress</span>\n        </Link>\n        <Link\n          href=\"/calendar\"\n          className={`flex flex-col items-center p-2 transition-colors ${\n            isActive(\"/calendar\") ? \"text-primary\" : \"text-muted hover:text-primary\"\n          }`}\n          data-testid=\"mobile-nav-calendar\"\n        >\n          <Calendar className=\"text-lg\" />\n          <span className=\"text-xs mt-1\">Calendar</span>\n        </Link>\n      </div>\n    </div>\n  );\n}\n","size_bytes":1959},"client/src/components/ui/checkbox.tsx":{"content":"import * as React from \"react\"\nimport * as CheckboxPrimitive from \"@radix-ui/react-checkbox\"\nimport { Check } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Checkbox = React.forwardRef<\n  React.ElementRef<typeof CheckboxPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof CheckboxPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <CheckboxPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground\",\n      className\n    )}\n    {...props}\n  >\n    <CheckboxPrimitive.Indicator\n      className={cn(\"flex items-center justify-center text-current\")}\n    >\n      <Check className=\"h-4 w-4\" />\n    </CheckboxPrimitive.Indicator>\n  </CheckboxPrimitive.Root>\n))\nCheckbox.displayName = CheckboxPrimitive.Root.displayName\n\nexport { Checkbox }\n","size_bytes":1056},"client/src/components/ui/hover-card.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as HoverCardPrimitive from \"@radix-ui/react-hover-card\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst HoverCard = HoverCardPrimitive.Root\n\nconst HoverCardTrigger = HoverCardPrimitive.Trigger\n\nconst HoverCardContent = React.forwardRef<\n  React.ElementRef<typeof HoverCardPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof HoverCardPrimitive.Content>\n>(({ className, align = \"center\", sideOffset = 4, ...props }, ref) => (\n  <HoverCardPrimitive.Content\n    ref={ref}\n    align={align}\n    sideOffset={sideOffset}\n    className={cn(\n      \"z-50 w-64 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-hover-card-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nHoverCardContent.displayName = HoverCardPrimitive.Content.displayName\n\nexport { HoverCard, HoverCardTrigger, HoverCardContent }\n","size_bytes":1251},"client/src/pages/onboarding-plan.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { useLocation } from \"wouter\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Activity, Target, Clock, MapPin, Star, ArrowRight, CheckCircle, Zap } from \"lucide-react\";\n\ninterface PersonalizedPlan {\n  title: string;\n  description: string;\n  workoutsPerWeek: number;\n  sessionDuration: string;\n  equipment: string[];\n  features: string[];\n  planType: 'beginner' | 'intermediate' | 'advanced';\n  calories?: {\n    bmr: number;\n    tdee: number;\n    goal: number;\n    recommendation: string;\n  };\n}\n\nconst calculateCalories = (answers: any) => {\n  const age = parseInt(answers.age) || 25;\n  const heightFeet = parseInt(answers.heightFeet) || 5;\n  const heightInches = parseInt(answers.heightInches) || 8;\n  const weight = parseFloat(answers.weight) || 160;\n  const weightUnit = answers.weightUnit || 'lbs';\n  const goalWeight = parseFloat(answers.goalWeight) || weight;\n  const fitnessGoal = answers.fitnessGoal || '';\n  const workoutFrequency = answers.workoutFrequency || '';\n\n  // Convert height to cm\n  const heightCm = (heightFeet * 12 + heightInches) * 2.54;\n  \n  // Convert weight to kg if needed\n  const weightKg = weightUnit === 'lbs' ? weight * 0.453592 : weight;\n  const goalWeightKg = weightUnit === 'lbs' ? goalWeight * 0.453592 : goalWeight;\n\n  // Calculate BMR using Mifflin-St Jeor Equation\n  // For simplicity, using male formula as average (female formula subtracts 161 instead of adding 5)\n  const bmr = (10 * weightKg) + (6.25 * heightCm) - (5 * age) + 5;\n\n  // Determine activity multiplier based on workout frequency\n  let activityMultiplier = 1.2; // Sedentary\n  if (workoutFrequency.includes('2-3 times')) {\n    activityMultiplier = 1.375; // Lightly active\n  } else if (workoutFrequency.includes('3-4 times')) {\n    activityMultiplier = 1.55; // Moderately active\n  } else if (workoutFrequency.includes('4-5 times')) {\n    activityMultiplier = 1.725; // Very active\n  } else if (workoutFrequency.includes('5-6 times') || workoutFrequency.includes('6-7 times')) {\n    activityMultiplier = 1.9; // Extremely active\n  }\n\n  const tdee = bmr * activityMultiplier;\n\n  // Calculate goal calories based on fitness goal\n  let goalCalories = tdee;\n  let recommendation = '';\n\n  if (fitnessGoal.includes('weight') || fitnessGoal.includes('fat')) {\n    // Weight loss: 500-750 calorie deficit\n    goalCalories = tdee - 500;\n    recommendation = 'calorie deficit for healthy weight loss (1-2 lbs per week)';\n  } else if (fitnessGoal.includes('muscle') || fitnessGoal.includes('strength')) {\n    // Muscle gain: 300-500 calorie surplus\n    goalCalories = tdee + 300;\n    recommendation = 'calorie surplus for muscle building and strength gains';\n  } else if (fitnessGoal.includes('endurance') || fitnessGoal.includes('performance')) {\n    // Endurance: maintenance calories\n    goalCalories = tdee;\n    recommendation = 'maintenance calories to fuel your endurance training';\n  } else {\n    // General health: maintenance calories\n    goalCalories = tdee;\n    recommendation = 'maintenance calories for overall health and wellness';\n  }\n\n  return {\n    bmr: Math.round(bmr),\n    tdee: Math.round(tdee),\n    goal: Math.round(goalCalories),\n    recommendation\n  };\n};\n\nconst generatePlan = (answers: any): PersonalizedPlan => {\n  // Get the actual user answers\n  const fitnessGoal = answers.fitnessGoal || '';\n  const experience = answers.experience || '';\n  const consistency = answers.consistency || '';\n  const location = answers.location || '';\n  const workoutFrequency = answers.workoutFrequency || '';\n  const workoutDuration = answers.workoutDuration || '';\n\n  // Calculate personalized calorie recommendations\n  const calories = calculateCalories(answers);\n\n  // Determine plan complexity based on experience and consistency\n  let planType: 'beginner' | 'intermediate' | 'advanced' = 'beginner';\n  let workoutsPerWeek = 2;\n  let sessionDuration = \"20-30 minutes\";\n\n  // Use user's preferred workout frequency if provided\n  if (workoutFrequency.includes('2-3 times')) {\n    workoutsPerWeek = 3;\n  } else if (workoutFrequency.includes('3-4 times')) {\n    workoutsPerWeek = 4;\n  } else if (workoutFrequency.includes('4-5 times')) {\n    workoutsPerWeek = 5;\n  } else if (workoutFrequency.includes('5-6 times')) {\n    workoutsPerWeek = 6;\n  } else if (workoutFrequency.includes('6-7 times')) {\n    workoutsPerWeek = 7;\n  }\n\n  // Use user's preferred session duration if provided\n  if (workoutDuration.includes('15-30 minutes')) {\n    sessionDuration = \"15-30 minutes\";\n  } else if (workoutDuration.includes('30-45 minutes')) {\n    sessionDuration = \"30-45 minutes\";\n  } else if (workoutDuration.includes('45-60 minutes')) {\n    sessionDuration = \"45-60 minutes\";\n  } else if (workoutDuration.includes('60-75 minutes')) {\n    sessionDuration = \"60-75 minutes\";\n  } else if (workoutDuration.includes('75+ minutes')) {\n    sessionDuration = \"75+ minutes\";\n  }\n\n  // Experience-based adjustments\n  if (experience.includes('Advanced') || experience.includes('5+ years')) {\n    planType = 'advanced';\n    workoutsPerWeek = 6;\n    sessionDuration = \"60-75 minutes\";\n  } else if (experience.includes('Experienced') || experience.includes('2+ years')) {\n    planType = 'intermediate';\n    workoutsPerWeek = 5;\n    sessionDuration = \"45-60 minutes\";\n  } else if (experience.includes('Moderate') || experience.includes('6 months to 2 years')) {\n    planType = 'intermediate';\n    workoutsPerWeek = 4;\n    sessionDuration = \"40-50 minutes\";\n  } else if (experience.includes('Some experience')) {\n    planType = 'beginner';\n    workoutsPerWeek = 3;\n    sessionDuration = \"25-35 minutes\";\n  }\n\n  // Consistency-based adjustments\n  if (consistency.includes('Daily workouts')) {\n    workoutsPerWeek = Math.max(workoutsPerWeek, 6);\n    sessionDuration = \"45-60 minutes\";\n  } else if (consistency.includes('5-6 times')) {\n    workoutsPerWeek = Math.max(workoutsPerWeek, 5);\n  } else if (consistency.includes('3-4 times')) {\n    workoutsPerWeek = Math.max(workoutsPerWeek, 4);\n  } else if (consistency.includes('1-2 times')) {\n    workoutsPerWeek = Math.min(workoutsPerWeek, 3);\n    sessionDuration = \"30-40 minutes\";\n  } else if (consistency.includes('Just getting started')) {\n    workoutsPerWeek = 2;\n    sessionDuration = \"20-30 minutes\";\n  }\n\n  // Equipment recommendations based on workout location\n  let equipment: string[] = [];\n  if (location.includes('no equipment')) {\n    equipment = ['Bodyweight exercises', 'Resistance bands', 'Yoga mat', 'Water bottles as weights'];\n  } else if (location.includes('basic equipment')) {\n    equipment = ['Adjustable dumbbells', 'Resistance bands', 'Yoga mat', 'Pull-up bar', 'Kettlebell'];\n  } else if (location.includes('gym') || location.includes('fitness center')) {\n    equipment = ['Full gym access', 'Barbells & dumbbells', 'Cable machines', 'Cardio equipment', 'Free weights'];\n  } else if (location.includes('Outdoor')) {\n    equipment = ['Bodyweight exercises', 'Running/walking paths', 'Park benches & equipment', 'Resistance bands'];\n  } else if (location.includes('Multiple locations')) {\n    equipment = ['Adaptive equipment', 'Portable gear', 'Bodyweight routines', 'Gym & home options'];\n  }\n\n  // Goal-specific features and plan customization\n  let features: string[] = [];\n  let planTitle = '';\n  let planDescription = '';\n\n  if (fitnessGoal.includes('weight') || fitnessGoal.includes('fat')) {\n    planTitle = 'Fat Loss & Weight Management Plan';\n    planDescription = 'Designed to help you burn fat, lose weight, and improve your body composition through targeted cardio and strength training.';\n    features = [\n      'HIIT cardio workouts for maximum calorie burn',\n      'Strength training to preserve muscle mass',\n      'Nutrition guidance for calorie deficit',\n      'Progress tracking with body measurements',\n      'Metabolic conditioning circuits',\n      'Recovery and rest day planning'\n    ];\n  } else if (fitnessGoal.includes('muscle') || fitnessGoal.includes('strength')) {\n    planTitle = 'Muscle Building & Strength Plan';\n    planDescription = 'Focus on building lean muscle mass and increasing strength through progressive resistance training and optimal nutrition.';\n    features = [\n      'Progressive overload strength training',\n      'Compound movement focus (squats, deadlifts, bench)',\n      'Muscle-building nutrition protocols',\n      'Detailed workout logs and PR tracking',\n      'Hypertrophy-focused rep ranges',\n      'Strategic rest and recovery periods'\n    ];\n  } else if (fitnessGoal.includes('endurance') || fitnessGoal.includes('cardio')) {\n    planTitle = 'Endurance & Cardiovascular Plan';\n    planDescription = 'Build cardiovascular fitness, improve endurance, and enhance your aerobic capacity through structured cardio training.';\n    features = [\n      'Progressive cardio training zones',\n      'Long-distance and interval training',\n      'Heart rate monitoring guidance',\n      'Endurance nutrition strategies',\n      'Running, cycling, and swimming workouts',\n      'VO2 max improvement protocols'\n    ];\n  } else if (fitnessGoal.includes('Athletic') || fitnessGoal.includes('performance')) {\n    planTitle = 'Athletic Performance Enhancement Plan';\n    planDescription = 'Elite-level training designed to improve athletic performance, power, speed, and sport-specific skills.';\n    features = [\n      'Sport-specific movement patterns',\n      'Power and explosiveness training',\n      'Agility and speed development',\n      'Performance analytics and testing',\n      'Competition preparation protocols',\n      'Advanced recovery techniques'\n    ];\n  } else if (fitnessGoal.includes('health') || fitnessGoal.includes('wellness')) {\n    planTitle = 'General Health & Wellness Plan';\n    planDescription = 'A balanced approach to fitness focusing on overall health, mobility, and sustainable lifestyle habits.';\n    features = [\n      'Balanced strength and cardio training',\n      'Mobility and flexibility routines',\n      'Stress management through exercise',\n      'Sustainable healthy habits',\n      'Functional movement patterns',\n      'Holistic wellness approach'\n    ];\n  }\n\n  return {\n    title: planTitle,\n    description: planDescription,\n    workoutsPerWeek,\n    sessionDuration,\n    equipment,\n    features,\n    planType,\n    calories\n  };\n};\n\nexport default function OnboardingPlan() {\n  const [, setLocation] = useLocation();\n  const [plan, setPlan] = useState<PersonalizedPlan | null>(null);\n  const [loading, setLoading] = useState(true);\n\n  useEffect(() => {\n    // Get answers from URL parameters\n    const urlParams = new URLSearchParams(window.location.search);\n    const answers = {\n      fitnessGoal: urlParams.get('fitnessGoal') || '',\n      experience: urlParams.get('experience') || '',\n      consistency: urlParams.get('consistency') || '',\n      location: urlParams.get('location') || '',\n      age: urlParams.get('age') || '',\n      heightFeet: urlParams.get('heightFeet') || '',\n      heightInches: urlParams.get('heightInches') || '',\n      weight: urlParams.get('weight') || '',\n      weightUnit: urlParams.get('weightUnit') || 'lbs',\n      goalWeight: urlParams.get('goalWeight') || '',\n      workoutFrequency: urlParams.get('workoutFrequency') || '',\n      workoutDuration: urlParams.get('workoutDuration') || ''\n    };\n\n    // Generate plan based on actual user answers\n    setTimeout(() => {\n      const generatedPlan = generatePlan(answers);\n      setPlan(generatedPlan);\n      setLoading(false);\n    }, 1500); // Simulate plan generation time\n  }, []);\n\n  const handleCreateAccount = () => {\n    // Store the plan data in localStorage so it can be accessed during account creation\n    if (plan) {\n      const planData = {\n        plan,\n        onboardingAnswers: {\n          fitnessGoal: new URLSearchParams(window.location.search).get('fitnessGoal') || '',\n          experience: new URLSearchParams(window.location.search).get('experience') || '',\n          consistency: new URLSearchParams(window.location.search).get('consistency') || '',\n          location: new URLSearchParams(window.location.search).get('location') || '',\n          age: new URLSearchParams(window.location.search).get('age') || '',\n          heightFeet: new URLSearchParams(window.location.search).get('heightFeet') || '',\n          heightInches: new URLSearchParams(window.location.search).get('heightInches') || '',\n          weight: new URLSearchParams(window.location.search).get('weight') || '',\n          weightUnit: new URLSearchParams(window.location.search).get('weightUnit') || 'lbs',\n          goalWeight: new URLSearchParams(window.location.search).get('goalWeight') || '',\n          workoutFrequency: new URLSearchParams(window.location.search).get('workoutFrequency') || '',\n          workoutDuration: new URLSearchParams(window.location.search).get('workoutDuration') || ''\n        }\n      };\n      localStorage.setItem('pendingPersonalPlan', JSON.stringify(planData));\n    }\n    setLocation('/auth-selection?from=onboarding');\n  };\n\n  if (loading) {\n    return (\n      <div className=\"relative min-h-screen bg-gradient-to-br from-primary/5 via-white to-secondary/5 dark:from-gray-900 dark:via-gray-800 dark:to-gray-900 overflow-hidden\">\n        {/* Animated background */}\n        <div className=\"fixed inset-0 pointer-events-none z-0\">\n          <div className=\"absolute top-20 left-10 w-72 h-72 bg-gradient-to-br from-purple-400 to-blue-500 rounded-full blur-3xl opacity-20 animate-pulse\"></div>\n          <div className=\"absolute top-40 right-16 w-56 h-56 bg-gradient-to-br from-cyan-400 to-emerald-500 rounded-full blur-2xl opacity-25 animate-bounce\" style={{animationDuration: '4s'}}></div>\n        </div>\n\n        <header className=\"relative z-10 px-4 lg:px-6 h-14 flex items-center border-b bg-white/80 dark:bg-gray-800/80 backdrop-blur\">\n          <div className=\"flex items-center space-x-2\">\n            <Activity className=\"text-primary\" size={32} />\n            <h1 className=\"text-xl font-bold text-gray-900 dark:text-white\">FlexFlow</h1>\n          </div>\n        </header>\n\n        <div className=\"relative z-10 flex items-center justify-center min-h-[80vh]\">\n          <div className=\"text-center\">\n            <div className=\"animate-spin w-16 h-16 border-4 border-primary border-t-transparent rounded-full mx-auto mb-4\"></div>\n            <h2 className=\"text-2xl font-bold text-gray-900 dark:text-white mb-2\">Creating Your Personal Plan</h2>\n            <p className=\"text-gray-600 dark:text-gray-300\">Analyzing your answers to build the perfect fitness routine...</p>\n          </div>\n        </div>\n      </div>\n    );\n  }\n\n  if (!plan) return null;\n\n  return (\n    <div className=\"relative min-h-screen bg-gradient-to-br from-primary/5 via-white to-secondary/5 dark:from-gray-900 dark:via-gray-800 dark:to-gray-900 overflow-hidden\">\n      {/* Animated background elements */}\n      <div className=\"fixed inset-0 pointer-events-none z-0\">\n        <div className=\"absolute top-20 left-10 w-72 h-72 bg-gradient-to-br from-purple-400 to-blue-500 rounded-full blur-3xl opacity-20 animate-pulse\"></div>\n        <div className=\"absolute top-40 right-16 w-56 h-56 bg-gradient-to-br from-cyan-400 to-emerald-500 rounded-full blur-2xl opacity-25 animate-bounce\" style={{animationDuration: '4s'}}></div>\n        <div className=\"absolute bottom-20 left-1/4 w-64 h-64 bg-gradient-to-br from-pink-400 to-purple-500 rounded-full blur-3xl opacity-15 animate-ping\" style={{animationDuration: '6s'}}></div>\n      </div>\n\n      {/* Header */}\n      <header className=\"relative z-10 px-4 lg:px-6 h-14 flex items-center border-b bg-white/80 dark:bg-gray-800/80 backdrop-blur\">\n        <div className=\"flex items-center space-x-2\">\n          <Activity className=\"text-primary\" size={32} />\n          <h1 className=\"text-xl font-bold text-gray-900 dark:text-white\">FlexFlow</h1>\n        </div>\n      </header>\n\n      {/* Main Content */}\n      <div className=\"relative z-10 container mx-auto px-4 py-16 max-w-4xl\">\n        <div className=\"text-center mb-8\">\n          <div className=\"flex items-center justify-center mb-4\">\n            <CheckCircle className=\"text-green-500 w-16 h-16\" />\n          </div>\n          <h1 className=\"text-3xl md:text-4xl font-bold text-gray-900 dark:text-white mb-4\">\n            Your Personal Plan is Ready!\n          </h1>\n          <p className=\"text-lg text-gray-600 dark:text-gray-300\">\n            Based on your answers, we've created a customized fitness plan just for you.\n          </p>\n        </div>\n\n        {/* Plan Card */}\n        <Card className=\"mb-8 bg-white/80 dark:bg-gray-800/80 backdrop-blur border-0 shadow-xl\">\n          <CardHeader className=\"text-center pb-4\">\n            <div className=\"flex items-center justify-center mb-3\">\n              <Badge variant={plan.planType === 'advanced' ? 'default' : plan.planType === 'intermediate' ? 'secondary' : 'outline'} \n                     className=\"text-sm px-4 py-1\">\n                {plan.planType.charAt(0).toUpperCase() + plan.planType.slice(1)} Level\n              </Badge>\n            </div>\n            <CardTitle className=\"text-2xl mb-2\">{plan.title}</CardTitle>\n            <CardDescription className=\"text-lg\">{plan.description}</CardDescription>\n          </CardHeader>\n          <CardContent>\n            {/* Plan Overview */}\n            <div className=\"grid md:grid-cols-3 gap-6 mb-8\">\n              <div className=\"text-center p-4 bg-primary/10 rounded-lg\">\n                <Target className=\"text-primary w-8 h-8 mx-auto mb-2\" />\n                <div className=\"text-2xl font-bold text-primary\">{plan.workoutsPerWeek}</div>\n                <div className=\"text-sm text-gray-600 dark:text-gray-400\">Workouts per week</div>\n              </div>\n              <div className=\"text-center p-4 bg-secondary/10 rounded-lg\">\n                <Clock className=\"text-secondary w-8 h-8 mx-auto mb-2\" />\n                <div className=\"text-lg font-bold text-secondary\">{plan.sessionDuration}</div>\n                <div className=\"text-sm text-gray-600 dark:text-gray-400\">Per session</div>\n              </div>\n              <div className=\"text-center p-4 bg-accent/10 rounded-lg\">\n                <MapPin className=\"text-accent w-8 h-8 mx-auto mb-2\" />\n                <div className=\"text-lg font-bold text-accent\">Flexible</div>\n                <div className=\"text-sm text-gray-600 dark:text-gray-400\">Location options</div>\n              </div>\n            </div>\n\n            {/* Personalized Calorie Recommendations */}\n            {plan.calories && (\n              <div className=\"mb-8 p-6 bg-gradient-to-r from-green-50 to-blue-50 dark:from-green-900/20 dark:to-blue-900/20 rounded-lg border border-green-200 dark:border-green-700\">\n                <h3 className=\"text-lg font-semibold mb-4 flex items-center\">\n                  <Zap className=\"w-5 h-5 mr-2 text-green-600\" />\n                  Your Personalized Calorie Plan\n                </h3>\n                <div className=\"grid md:grid-cols-3 gap-4 mb-4\">\n                  <div className=\"text-center\">\n                    <div className=\"text-2xl font-bold text-green-600\">{plan.calories.bmr}</div>\n                    <div className=\"text-sm text-gray-600 dark:text-gray-400\">BMR (Base Metabolic Rate)</div>\n                  </div>\n                  <div className=\"text-center\">\n                    <div className=\"text-2xl font-bold text-blue-600\">{plan.calories.tdee}</div>\n                    <div className=\"text-sm text-gray-600 dark:text-gray-400\">TDEE (Total Daily Energy)</div>\n                  </div>\n                  <div className=\"text-center\">\n                    <div className=\"text-2xl font-bold text-purple-600\">{plan.calories.goal}</div>\n                    <div className=\"text-sm text-gray-600 dark:text-gray-400\">Goal Calories</div>\n                  </div>\n                </div>\n                <div className=\"text-center\">\n                  <p className=\"text-gray-700 dark:text-gray-300\">\n                    We recommend consuming <strong>{plan.calories.goal} calories per day</strong> - a {plan.calories.recommendation}\n                  </p>\n                </div>\n              </div>\n            )}\n\n            {/* Equipment */}\n            <div className=\"mb-6\">\n              <h3 className=\"text-lg font-semibold mb-3 flex items-center\">\n                <Star className=\"w-5 h-5 mr-2 text-primary\" />\n                Recommended Equipment\n              </h3>\n              <div className=\"flex flex-wrap gap-2\">\n                {plan.equipment.map((item, index) => (\n                  <Badge key={index} variant=\"outline\" className=\"px-3 py-1\">\n                    {item}\n                  </Badge>\n                ))}\n              </div>\n            </div>\n\n            {/* Features */}\n            <div className=\"mb-8\">\n              <h3 className=\"text-lg font-semibold mb-4 flex items-center\">\n                <CheckCircle className=\"w-5 h-5 mr-2 text-green-500\" />\n                What's Included\n              </h3>\n              <div className=\"grid md:grid-cols-2 gap-3\">\n                {plan.features.map((feature, index) => (\n                  <div key={index} className=\"flex items-center space-x-2\">\n                    <CheckCircle className=\"w-4 h-4 text-green-500 flex-shrink-0\" />\n                    <span className=\"text-gray-700 dark:text-gray-300\">{feature}</span>\n                  </div>\n                ))}\n              </div>\n            </div>\n\n            {/* CTA */}\n            <div className=\"text-center\">\n              <Button \n                size=\"lg\" \n                className=\"text-lg px-8 py-4 mb-4\" \n                onClick={handleCreateAccount}\n                data-testid=\"create-account-button\"\n              >\n                Create Your Account\n                <ArrowRight className=\"ml-2\" size={20} />\n              </Button>\n              <p className=\"text-sm text-gray-500 dark:text-gray-400\">\n                Get started with your personalized fitness plan\n              </p>\n            </div>\n          </CardContent>\n        </Card>\n      </div>\n    </div>\n  );\n}","size_bytes":22269},"client/src/pages/not-found.tsx":{"content":"import { Card, CardContent } from \"@/components/ui/card\";\nimport { AlertCircle } from \"lucide-react\";\n\nexport default function NotFound() {\n  return (\n    <div className=\"min-h-screen w-full flex items-center justify-center bg-gray-50\">\n      <Card className=\"w-full max-w-md mx-4\">\n        <CardContent className=\"pt-6\">\n          <div className=\"flex mb-4 gap-2\">\n            <AlertCircle className=\"h-8 w-8 text-red-500\" />\n            <h1 className=\"text-2xl font-bold text-gray-900\">404 Page Not Found</h1>\n          </div>\n\n          <p className=\"mt-4 text-sm text-gray-600\">\n            Did you forget to add the page to the router?\n          </p>\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n","size_bytes":711},"client/src/components/profile-editor.tsx":{"content":"import { useState, useEffect, useRef } from \"react\";\nimport { useMutation, useQueryClient, useQuery } from \"@tanstack/react-query\";\nimport { User2, Edit2, Save, X, Camera, Upload } from \"lucide-react\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogDescription,\n  DialogFooter,\n  DialogHeader,\n  DialogTitle,\n  DialogTrigger,\n} from \"@/components/ui/dialog\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport type { User } from \"@shared/schema\";\n\ninterface ProfileEditorProps {\n  trigger?: React.ReactNode;\n  isOpen?: boolean;\n  setIsOpen?: (open: boolean) => void;\n}\n\nexport default function ProfileEditor({ trigger, isOpen: externalIsOpen, setIsOpen: externalSetIsOpen }: ProfileEditorProps) {\n  const [internalIsOpen, setInternalIsOpen] = useState(false);\n  \n  // Use external control if provided, otherwise use internal state\n  const isOpen = externalIsOpen !== undefined ? externalIsOpen : internalIsOpen;\n  const setIsOpen = externalSetIsOpen || setInternalIsOpen;\n  const [firstName, setFirstName] = useState(\"\");\n  const [lastName, setLastName] = useState(\"\");\n  const [profileImage, setProfileImage] = useState<File | null>(null);\n  const [profileImagePreview, setProfileImagePreview] = useState<string | null>(null);\n  const fileInputRef = useRef<HTMLInputElement>(null);\n  \n  const { toast } = useToast();\n  const queryClient = useQueryClient();\n\n  // Get current user data\n  const { data: user } = useQuery<User>({\n    queryKey: [\"/api/auth/user\"],\n  });\n\n  // Set form values when user data loads\n  useEffect(() => {\n    if (user && isOpen) {\n      setFirstName(user.firstName || \"\");\n      setLastName(user.lastName || \"\");\n      setProfileImagePreview(user.profileImageUrl || null);\n      setProfileImage(null);\n    }\n  }, [user, isOpen]);\n\n  // Mutation for updating profile\n  const updateProfileMutation = useMutation({\n    mutationFn: async (profileData: { firstName: string; lastName: string; profileImage?: File }) => {\n      if (profileData.profileImage) {\n        // Upload image first\n        const formData = new FormData();\n        formData.append('profileImage', profileData.profileImage);\n        formData.append('firstName', profileData.firstName);\n        formData.append('lastName', profileData.lastName);\n        \n        const token = localStorage.getItem('auth-token');\n        const headers: Record<string, string> = {};\n        if (token) {\n          headers[\"Authorization\"] = `Bearer ${token}`;\n        }\n        \n        const response = await fetch('/api/user/profile/upload', {\n          method: 'POST',\n          headers,\n          body: formData,\n          credentials: 'include',\n        });\n        \n        if (!response.ok) {\n          throw new Error('Failed to upload profile image');\n        }\n        \n        return response.json();\n      } else {\n        // Update name only\n        const response = await apiRequest(\"PATCH\", \"/api/user/profile\", {\n          firstName: profileData.firstName,\n          lastName: profileData.lastName\n        });\n        return response.json();\n      }\n    },\n    onSuccess: (updatedUser, profileData) => {\n      // Update the cached user data\n      queryClient.setQueryData([\"/api/auth/user\"], updatedUser);\n      queryClient.invalidateQueries({ queryKey: [\"/api/auth/user\"] });\n      \n      toast({\n        title: \"Profile Updated\", \n        description: profileData.profileImage ? \"Your profile picture and information have been updated successfully!\" : \"Your profile information has been updated successfully!\",\n      });\n      \n      setIsOpen(false);\n    },\n    onError: (error: any) => {\n      toast({\n        title: \"Update Failed\",\n        description: error.message || \"Failed to update your profile. Please try again.\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const handleImageSelect = (e: React.ChangeEvent<HTMLInputElement>) => {\n    const file = e.target.files?.[0];\n    if (file) {\n      console.log('File selected:', file.name, file.type, file.size);\n      \n      // Validate file type\n      if (!file.type.startsWith('image/')) {\n        toast({\n          title: \"Invalid File Type\",\n          description: \"Please select an image file (PNG, JPG, GIF, etc.).\",\n          variant: \"destructive\",\n        });\n        return;\n      }\n      \n      // Validate file size (5MB limit)\n      if (file.size > 5 * 1024 * 1024) {\n        toast({\n          title: \"File Too Large\",\n          description: \"Please select an image smaller than 5MB.\",\n          variant: \"destructive\",\n        });\n        return;\n      }\n      \n      setProfileImage(file);\n      \n      // Create preview\n      const reader = new FileReader();\n      reader.onload = () => {\n        setProfileImagePreview(reader.result as string);\n        toast({\n          title: \"Image Selected\",\n          description: \"Profile picture ready to upload!\",\n        });\n      };\n      reader.onerror = () => {\n        toast({\n          title: \"Error Reading File\",\n          description: \"Failed to process the selected image.\",\n          variant: \"destructive\",\n        });\n      };\n      reader.readAsDataURL(file);\n    }\n  };\n\n  const handleSubmit = (e: React.FormEvent) => {\n    e.preventDefault();\n    \n    if (!firstName.trim() && !lastName.trim() && !profileImage) {\n      toast({\n        title: \"Update Required\",\n        description: \"Please enter at least your name or select a profile picture.\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    updateProfileMutation.mutate({\n      firstName: firstName.trim(),\n      lastName: lastName.trim(),\n      profileImage: profileImage || undefined,\n    });\n  };\n\n  const handleCancel = () => {\n    setFirstName(user?.firstName || \"\");\n    setLastName(user?.lastName || \"\");\n    setProfileImage(null);\n    setProfileImagePreview(user?.profileImageUrl || null);\n    if (fileInputRef.current) {\n      fileInputRef.current.value = '';\n    }\n    setIsOpen(false);\n  };\n\n  const currentName = user ? `${user.firstName || ''} ${user.lastName || ''}`.trim() : null;\n  const displayName = currentName || user?.email || \"User\";\n\n  return (\n    <Dialog open={isOpen} onOpenChange={setIsOpen}>\n      <DialogTrigger asChild>\n        {trigger || (\n          <Button variant=\"ghost\" size=\"sm\" className=\"text-gray-600 hover:text-gray-800\" data-testid=\"edit-profile-button\">\n            <User2 className=\"w-4 h-4 mr-2\" />\n            Edit Profile\n          </Button>\n        )}\n      </DialogTrigger>\n      <DialogContent className=\"sm:max-w-[425px]\" data-testid=\"profile-editor-dialog\">\n        <form onSubmit={handleSubmit}>\n          <DialogHeader>\n            <DialogTitle className=\"flex items-center gap-2\">\n              <User2 className=\"w-5 h-5 text-primary\" />\n              Edit Your Profile\n            </DialogTitle>\n            <DialogDescription>\n              Update your profile picture and name to personalize your experience.\n              Currently greeting as: <strong>{displayName}</strong>\n            </DialogDescription>\n          </DialogHeader>\n          \n          <div className=\"grid gap-4 py-4\">\n            {/* Profile Picture Section */}\n            <div className=\"grid gap-2\">\n              <Label>Profile Picture</Label>\n              <div className=\"flex items-center gap-4\">\n                <div className=\"relative\">\n                  <div className=\"w-20 h-20 rounded-full overflow-hidden bg-gray-100 border-2 border-gray-200 flex items-center justify-center\">\n                    {profileImagePreview ? (\n                      <img \n                        src={profileImagePreview} \n                        alt=\"Profile preview\" \n                        className=\"w-full h-full object-cover\"\n                        data-testid=\"profile-image-preview\"\n                      />\n                    ) : (\n                      <User2 className=\"w-8 h-8 text-gray-400\" />\n                    )}\n                  </div>\n                  <button\n                    type=\"button\"\n                    onClick={(e) => {\n                      e.preventDefault();\n                      e.stopPropagation();\n                      fileInputRef.current?.click();\n                    }}\n                    className=\"absolute -bottom-1 -right-1 w-6 h-6 bg-primary rounded-full flex items-center justify-center text-white hover:bg-primary/90 transition-colors\"\n                    data-testid=\"upload-image-button\"\n                  >\n                    <Camera className=\"w-3 h-3\" />\n                  </button>\n                </div>\n                <div className=\"flex-1\">\n                  <button\n                    type=\"button\"\n                    onClick={(e) => {\n                      e.preventDefault();\n                      e.stopPropagation();\n                      fileInputRef.current?.click();\n                    }}\n                    className=\"flex items-center gap-2 text-sm text-primary hover:text-primary/80 transition-colors\"\n                    data-testid=\"choose-image-button\"\n                  >\n                    <Upload className=\"w-4 h-4\" />\n                    Choose New Image\n                  </button>\n                  <p className=\"text-xs text-gray-500 mt-1\">\n                    PNG, JPG, GIF up to 5MB\n                  </p>\n                </div>\n              </div>\n              <input\n                ref={fileInputRef}\n                type=\"file\"\n                accept=\"image/*\"\n                onChange={handleImageSelect}\n                className=\"hidden\"\n                data-testid=\"file-input\"\n              />\n            </div>\n            <div className=\"grid gap-2\">\n              <Label htmlFor=\"firstName\">First Name</Label>\n              <Input\n                id=\"firstName\"\n                type=\"text\"\n                value={firstName}\n                onChange={(e) => setFirstName(e.target.value)}\n                placeholder=\"Enter your first name\"\n                maxLength={50}\n                data-testid=\"input-first-name\"\n              />\n            </div>\n            \n            <div className=\"grid gap-2\">\n              <Label htmlFor=\"lastName\">Last Name</Label>\n              <Input\n                id=\"lastName\"\n                type=\"text\"\n                value={lastName}\n                onChange={(e) => setLastName(e.target.value)}\n                placeholder=\"Enter your last name\"\n                maxLength={50}\n                data-testid=\"input-last-name\"\n              />\n            </div>\n            \n            {(firstName.trim() || lastName.trim() || profileImage) && (\n              <div className=\"p-3 bg-blue-50 border border-blue-200 rounded-lg\">\n                <p className=\"text-sm text-blue-800\">\n                  <strong>Preview:</strong> Your greeting will be \"Good [time], {firstName.trim()} {lastName.trim()}!\"\n                  {profileImage && (\n                    <span className=\"block mt-1\">✓ New profile picture will be uploaded</span>\n                  )}\n                </p>\n              </div>\n            )}\n          </div>\n          \n          <DialogFooter className=\"gap-2\">\n            <Button \n              type=\"button\" \n              variant=\"outline\" \n              onClick={handleCancel}\n              disabled={updateProfileMutation.isPending}\n              data-testid=\"button-cancel\"\n            >\n              <X className=\"w-4 h-4 mr-2\" />\n              Cancel\n            </Button>\n            <Button \n              type=\"submit\" \n              disabled={updateProfileMutation.isPending || (!firstName.trim() && !lastName.trim() && !profileImage)}\n              data-testid=\"button-save\"\n            >\n              <Save className=\"w-4 h-4 mr-2\" />\n              {updateProfileMutation.isPending ? \"Uploading...\" : \"Save Changes\"}\n            </Button>\n          </DialogFooter>\n        </form>\n      </DialogContent>\n    </Dialog>\n  );\n}","size_bytes":12035},"server/db.ts":{"content":"import { Pool, neonConfig } from '@neondatabase/serverless';\nimport { drizzle } from 'drizzle-orm/neon-serverless';\nimport ws from \"ws\";\nimport * as schema from \"@shared/schema\";\n\nneonConfig.webSocketConstructor = ws;\n\nif (!process.env.DATABASE_URL) {\n  throw new Error(\n    \"DATABASE_URL must be set. Did you forget to provision a database?\",\n  );\n}\n\nexport const pool = new Pool({ connectionString: process.env.DATABASE_URL });\nexport const db = drizzle({ client: pool, schema });\n","size_bytes":483},"server/weeklyMealPlanScheduler.ts":{"content":"import { storage } from \"./storage\";\nimport { generateWeeklyMealPlan } from \"./mealPlanGenerator\";\n\nexport class WeeklyMealPlanScheduler {\n  private isRunning = false;\n\n  // Generate meal plans for all users who have auto-generation enabled\n  async generateWeeklyMealPlans(): Promise<{ success: number; failed: number; results: any[] }> {\n    if (this.isRunning) {\n      console.log(\"Weekly meal plan generation already running, skipping...\");\n      return { success: 0, failed: 0, results: [] };\n    }\n\n    this.isRunning = true;\n    const results = [];\n    let successCount = 0;\n    let failedCount = 0;\n\n    try {\n      console.log(\"Starting weekly meal plan generation...\");\n      const usersForGeneration = await storage.getUsersForWeeklyMealPlanGeneration();\n      \n      console.log(`Found ${usersForGeneration.length} users for meal plan generation`);\n\n      for (const { userId, preferences } of usersForGeneration) {\n        try {\n          console.log(`Generating meal plan for user ${userId}`);\n          \n          const generatedPlan = await generateWeeklyMealPlan(userId, {\n            goal: preferences.goal as \"weight_loss\" | \"weight_gain\" | \"maintenance\",\n            dailyCalories: preferences.dailyCalories,\n            dietaryRestrictions: preferences.dietaryRestrictions || [],\n            preferences: preferences.preferences || [],\n            allergies: preferences.allergies || []\n          });\n\n          // Save the generated meal plan\n          const mealPlan = await storage.createAIMealPlan(\n            {\n              name: `${generatedPlan.name} (Auto-Generated)`,\n              description: `${generatedPlan.description} - Auto-generated weekly meal plan`,\n              goal: generatedPlan.goal,\n              dailyCalories: generatedPlan.dailyCalories,\n              dailyProtein: generatedPlan.dailyProtein,\n              dailyCarbs: generatedPlan.dailyCarbs,\n              dailyFat: generatedPlan.dailyFat,\n              duration: generatedPlan.duration,\n            },\n            generatedPlan.days\n          );\n\n          // Assign to user\n          await storage.assignMealPlan({\n            userId,\n            mealPlanId: mealPlan.id,\n            startDate: new Date(),\n            isActive: true\n          });\n\n          // Update last generation date\n          await storage.updateUserMealPreferences(userId, {\n            lastGeneratedAt: new Date()\n          });\n\n          results.push({ userId, success: true, mealPlanId: mealPlan.id, mealPlanName: mealPlan.name });\n          successCount++;\n          \n          console.log(`Successfully generated meal plan for user ${userId}: ${mealPlan.name}`);\n        } catch (error) {\n          console.error(`Error generating meal plan for user ${userId}:`, error);\n          results.push({ userId, success: false, error: error.message });\n          failedCount++;\n        }\n      }\n\n      console.log(`Weekly meal plan generation completed: ${successCount} successful, ${failedCount} failed`);\n      return { success: successCount, failed: failedCount, results };\n    } finally {\n      this.isRunning = false;\n    }\n  }\n\n  // Start a simple interval-based scheduler (runs every 7 days)\n  startScheduler(): void {\n    const SEVEN_DAYS = 7 * 24 * 60 * 60 * 1000; // 7 days in milliseconds\n    \n    // Run immediately on startup\n    setTimeout(() => {\n      this.generateWeeklyMealPlans().catch(error => {\n        console.error(\"Error in scheduled weekly meal plan generation:\", error);\n      });\n    }, 5000); // Wait 5 seconds after startup\n\n    // Then run every 7 days\n    setInterval(() => {\n      this.generateWeeklyMealPlans().catch(error => {\n        console.error(\"Error in scheduled weekly meal plan generation:\", error);\n      });\n    }, SEVEN_DAYS);\n\n    console.log(\"Weekly meal plan scheduler started - will run every 7 days\");\n  }\n\n  // For testing - generate immediately for a specific user\n  async generateForUser(userId: string): Promise<any> {\n    const preferences = await storage.getUserMealPreferences(userId);\n    if (!preferences) {\n      throw new Error(\"User meal preferences not found\");\n    }\n\n    const generatedPlan = await generateWeeklyMealPlan(userId, {\n      goal: preferences.goal as \"weight_loss\" | \"weight_gain\" | \"maintenance\",\n      dailyCalories: preferences.dailyCalories,\n      dietaryRestrictions: preferences.dietaryRestrictions || [],\n      preferences: preferences.preferences || [],\n      allergies: preferences.allergies || []\n    });\n\n    const mealPlan = await storage.createAIMealPlan(\n      {\n        name: `${generatedPlan.name} (Manual Generation)`,\n        description: `${generatedPlan.description} - Manually generated meal plan`,\n        goal: generatedPlan.goal,\n        dailyCalories: generatedPlan.dailyCalories,\n        dailyProtein: generatedPlan.dailyProtein,\n        dailyCarbs: generatedPlan.dailyCarbs,\n        dailyFat: generatedPlan.dailyFat,\n        duration: generatedPlan.duration,\n      },\n      generatedPlan.days\n    );\n\n    await storage.assignMealPlan({\n      userId,\n      mealPlanId: mealPlan.id,\n      startDate: new Date(),\n      isActive: true\n    });\n\n    await storage.updateUserMealPreferences(userId, {\n      lastGeneratedAt: new Date()\n    });\n\n    return { mealPlan, message: \"Meal plan generated successfully!\" };\n  }\n}\n\nexport const weeklyMealPlanScheduler = new WeeklyMealPlanScheduler();","size_bytes":5370},"client/src/pages/auth-selection.tsx":{"content":"import { useState } from \"react\";\nimport { Activity, User, Mail, ArrowLeft } from \"lucide-react\";\nimport { Button } from \"@/components/ui/button\";\nimport AuthPage from \"@/pages/auth\";\nimport { useNewAuth } from \"@/hooks/useNewAuth\";\nimport { useLocation } from \"wouter\";\n\nexport default function AuthSelection() {\n  const [authMode, setAuthMode] = useState<\"selection\" | \"signin\" | \"signup\">(() => {\n    // Check if user came from onboarding flow, default to signup\n    const urlParams = new URLSearchParams(window.location.search);\n    if (urlParams.get('from') === 'onboarding') {\n      return \"signup\";\n    }\n    return \"selection\";\n  });\n  const { signIn } = useNewAuth();\n  const [, setLocation] = useLocation();\n\n  const handleAuthSuccess = (user: any, token: string) => {\n    signIn(user, token);\n    setLocation(\"/\");\n  };\n\n  const handleBackToSelection = () => {\n    setAuthMode(\"selection\");\n  };\n\n  if (authMode === \"signin\" || authMode === \"signup\") {\n    return (\n      <div>\n        <div className=\"absolute top-4 left-4 z-50\">\n          <Button\n            variant=\"ghost\"\n            onClick={handleBackToSelection}\n            className=\"text-white hover:bg-white/10\"\n          >\n            <ArrowLeft className=\"w-4 h-4 mr-2\" />\n            Back\n          </Button>\n        </div>\n        <AuthPage mode={authMode} />\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"min-h-screen bg-gradient-to-br from-red-600 via-red-700 to-black flex items-center justify-center p-4\">\n      <div className=\"w-full max-w-lg\">\n        {/* Logo and Header */}\n        <div className=\"text-center mb-8\">\n          <div className=\"flex items-center justify-center mb-4\">\n            <div className=\"bg-white rounded-full p-3\">\n              <Activity className=\"w-8 h-8 text-red-600\" />\n            </div>\n          </div>\n          <h1 className=\"text-3xl font-bold text-white mb-2\">Welcome to FlexFlow</h1>\n          <p className=\"text-black font-semibold text-lg mb-2\">Eat Clean, Think Smart, Train HARD!</p>\n          <p className=\"text-red-100\">Choose how you'd like to access your account</p>\n        </div>\n\n        {/* Auth Selection Card */}\n        <div className=\"bg-white rounded-2xl shadow-2xl p-8 space-y-4\">\n          <h2 className=\"text-2xl font-bold text-gray-900 text-center mb-6\">Sign In Options</h2>\n          \n          {/* Create Account with Username/Password */}\n          <Button\n            onClick={() => setAuthMode(\"signup\")}\n            className=\"w-full h-16 bg-red-600 hover:bg-red-700 text-white text-lg font-medium\"\n            data-testid=\"create-account-button\"\n          >\n            <div className=\"flex items-center justify-center space-x-3\">\n              <User className=\"w-6 h-6\" />\n              <div className=\"text-left\">\n                <div>Create New Account</div>\n                <div className=\"text-sm text-red-100 font-normal\">Set up with username & password</div>\n              </div>\n            </div>\n          </Button>\n\n          {/* Sign In with Username/Password */}\n          <Button\n            onClick={() => setAuthMode(\"signin\")}\n            variant=\"outline\"\n            className=\"w-full h-16 border-2 border-red-600 text-red-600 hover:bg-red-50 text-lg font-medium\"\n            data-testid=\"signin-button\"\n          >\n            <div className=\"flex items-center justify-center space-x-3\">\n              <Mail className=\"w-6 h-6\" />\n              <div className=\"text-left\">\n                <div>Sign In to Existing Account</div>\n                <div className=\"text-sm text-gray-600 font-normal\">Use username/email & password</div>\n              </div>\n            </div>\n          </Button>\n\n\n        </div>\n\n        {/* Footer */}\n        <div className=\"text-center mt-8\">\n          <p className=\"text-red-100 text-sm\">\nChoose your preferred sign-in method to access all FlexFlow features.\n          </p>\n          <p className=\"text-red-200 text-xs mt-2\">\n            By continuing, you agree to our Terms of Service and Privacy Policy.\n          </p>\n        </div>\n      </div>\n    </div>\n  );\n}","size_bytes":4079},"server/activity-logger.ts":{"content":"import { storage } from \"./storage\";\nimport type { InsertUserActivityLog } from \"@shared/schema\";\nimport { badgeService } from \"./badge-service\";\n\nexport class ActivityLogger {\n  static async logActivity({\n    userId,\n    actionType,\n    actionDetails,\n    ipAddress,\n    userAgent,\n    sessionId\n  }: {\n    userId: string;\n    actionType: string;\n    actionDetails?: object;\n    ipAddress?: string;\n    userAgent?: string;\n    sessionId?: string;\n  }): Promise<void> {\n    try {\n      const activityData: InsertUserActivityLog = {\n        userId,\n        actionType,\n        actionDetails: actionDetails ? JSON.stringify(actionDetails) : null,\n        ipAddress: ipAddress || null,\n        userAgent: userAgent || null,\n        sessionId: sessionId || null,\n      };\n\n      await storage.createUserActivity(activityData);\n    } catch (error) {\n      console.error('Failed to log user activity:', error);\n      // Don't throw - logging should not break the main functionality\n    }\n  }\n\n  static async getUserActivities(userId: string, limit: number = 100): Promise<any[]> {\n    try {\n      return await storage.getUserActivities(userId, limit);\n    } catch (error) {\n      console.error('Failed to get user activities:', error);\n      return [];\n    }\n  }\n\n  // Common activity logging methods\n  static async logLogin(userId: string, ipAddress?: string, userAgent?: string): Promise<void> {\n    return this.logActivity({\n      userId,\n      actionType: 'login',\n      actionDetails: { timestamp: new Date().toISOString() },\n      ipAddress,\n      userAgent\n    });\n  }\n\n  static async logLogout(userId: string, sessionId?: string): Promise<void> {\n    return this.logActivity({\n      userId,\n      actionType: 'logout',\n      actionDetails: { timestamp: new Date().toISOString() },\n      sessionId\n    });\n  }\n\n  static async logWorkout(userId: string, workoutData: any): Promise<void> {\n    await this.logActivity({\n      userId,\n      actionType: 'workout_logged',\n      actionDetails: {\n        workoutName: workoutData.name,\n        duration: workoutData.duration,\n        caloriesBurned: workoutData.caloriesBurned,\n        exerciseCount: workoutData.exercises?.length || 0\n      }\n    });\n    \n    // Check for new badge achievements after workout\n    await this.checkForBadges(userId);\n  }\n\n  static async checkForBadges(userId: string): Promise<void> {\n    try {\n      await badgeService.checkAndAwardBadges(userId);\n    } catch (error) {\n      console.error('Failed to check for badge achievements:', error);\n      // Don't throw - badge checking should not break the main functionality\n    }\n  }\n\n  static async logGoalSet(userId: string, goalData: any): Promise<void> {\n    return this.logActivity({\n      userId,\n      actionType: 'goal_set',\n      actionDetails: {\n        goalType: goalData.type,\n        target: goalData.target,\n        period: goalData.period\n      }\n    });\n  }\n\n  static async logProfileUpdate(userId: string, updatedFields: string[]): Promise<void> {\n    return this.logActivity({\n      userId,\n      actionType: 'profile_updated',\n      actionDetails: {\n        updatedFields,\n        timestamp: new Date().toISOString()\n      }\n    });\n  }\n\n  static async logSubscriptionChange(userId: string, subscriptionData: any): Promise<void> {\n    return this.logActivity({\n      userId,\n      actionType: 'subscription_changed',\n      actionDetails: {\n        newStatus: subscriptionData.status,\n        previousStatus: subscriptionData.previousStatus,\n        plan: subscriptionData.plan\n      }\n    });\n  }\n\n  static async logMealLogged(userId: string, mealData: any): Promise<void> {\n    return this.logActivity({\n      userId,\n      actionType: 'meal_logged',\n      actionDetails: {\n        foodName: mealData.name,\n        calories: mealData.calories,\n        mealType: mealData.mealType\n      }\n    });\n  }\n\n  static async logPersonalPlanCreated(userId: string, planData: any): Promise<void> {\n    return this.logActivity({\n      userId,\n      actionType: 'personal_plan_created',\n      actionDetails: {\n        planType: planData.type,\n        workoutsPerWeek: planData.workoutsPerWeek,\n        sessionDuration: planData.sessionDuration,\n        goals: planData.goals\n      }\n    });\n  }\n}","size_bytes":4226},"client/src/pages/user-subscription.tsx":{"content":"import { useQuery, useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport { Calendar, CheckCircle, XCircle, AlertCircle, Gift, Sparkles, Zap, Crown, Star, TrendingUp, Heart, Award, Target } from \"lucide-react\";\nimport { format } from \"date-fns\";\nimport { Card, CardContent, CardHeader, CardTitle, CardDescription } from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Button } from \"@/components/ui/button\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport { Alert, AlertDescription } from \"@/components/ui/alert\";\n\ninterface UserSubscriptionStatus {\n  subscriptionStatus: string;\n  subscriptionStartDate?: string;\n  lastPaymentDate?: string;\n  subscriptionExpiresAt?: string;\n  isActive: boolean;\n  isFreeTrialActive: boolean;\n  daysRemaining: number;\n  monthlyFee: number;\n}\n\nexport default function UserSubscription() {\n  const { toast } = useToast();\n  const queryClient = useQueryClient();\n\n  const { data: subscriptionData, isLoading } = useQuery<UserSubscriptionStatus>({\n    queryKey: [\"/api/user/subscription\"],\n    retry: false,\n  });\n\n  const cancelSubscriptionMutation = useMutation({\n    mutationFn: async () => {\n      const response = await apiRequest(\"POST\", \"/api/user/subscription/cancel\", {});\n      return response.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/user/subscription\"] });\n      toast({\n        title: \"Subscription Cancelled\",\n        description: \"Your subscription has been cancelled.\",\n      });\n    },\n    onError: () => {\n      toast({\n        title: \"Error\",\n        description: \"Failed to cancel subscription\",\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const getStatusColor = (status: string, isActive: boolean, isFreeTrialActive: boolean) => {\n    if (isFreeTrialActive) {\n      return \"bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-300\";\n    }\n    if (isActive) {\n      return \"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-300\";\n    }\n    switch (status) {\n      case \"expired\":\n        return \"bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-300\";\n      case \"inactive\":\n        return \"bg-gray-100 text-gray-800 dark:bg-gray-900 dark:text-gray-300\";\n      default:\n        return \"bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-300\";\n    }\n  };\n\n  const getStatusIcon = (status: string, isActive: boolean, isFreeTrialActive: boolean) => {\n    if (isFreeTrialActive) return <Gift size={20} className=\"text-blue-600\" />;\n    if (isActive) return <CheckCircle size={20} className=\"text-green-600\" />;\n    if (status === \"expired\") return <XCircle size={20} className=\"text-red-600\" />;\n    return <AlertCircle size={20} className=\"text-gray-600\" />;\n  };\n\n  const getStatusText = (status: string, isFreeTrialActive: boolean) => {\n    if (isFreeTrialActive) return \"Free Trial\";\n    switch (status) {\n      case \"active\": return \"Premium\";\n      case \"expired\": return \"Expired\";\n      case \"inactive\": return \"Inactive\";\n      default: return \"Unknown\";\n    }\n  };\n\n  if (isLoading) {\n    return (\n      <div className=\"min-h-screen bg-gray-50 dark:bg-black flex items-center justify-center\">\n        <div className=\"animate-spin w-8 h-8 border-4 border-primary border-t-transparent rounded-full\" />\n      </div>\n    );\n  }\n\n  if (!subscriptionData) {\n    return (\n      <div className=\"min-h-screen bg-gray-50 dark:bg-black p-8\">\n        <div className=\"max-w-4xl mx-auto\">\n          <Card>\n            <CardContent className=\"p-12 text-center\">\n              <p className=\"text-gray-600 dark:text-gray-400\">Unable to load subscription information</p>\n            </CardContent>\n          </Card>\n        </div>\n      </div>\n    );\n  }\n\n  const premiumFeatures = [\n    {\n      icon: Sparkles,\n      title: \"AI Workout Planner\",\n      description: \"Get personalized workout plans tailored to your goals\",\n      color: \"from-purple-500 to-pink-500\"\n    },\n    {\n      icon: Target,\n      title: \"AI Meal Plans\",\n      description: \"Custom nutrition plans based on your preferences\",\n      color: \"from-blue-500 to-cyan-500\"\n    },\n    {\n      icon: Zap,\n      title: \"Barcode Scanner\",\n      description: \"Instantly log food with professional scanning\",\n      color: \"from-yellow-500 to-orange-500\"\n    },\n    {\n      icon: TrendingUp,\n      title: \"Advanced Analytics\",\n      description: \"Deep insights into your progress and trends\",\n      color: \"from-green-500 to-emerald-500\"\n    },\n    {\n      icon: Award,\n      title: \"Priority Support\",\n      description: \"Get help faster with premium support\",\n      color: \"from-red-500 to-rose-500\"\n    },\n    {\n      icon: Heart,\n      title: \"Unlimited Everything\",\n      description: \"No limits on tracking, plans, or features\",\n      color: \"from-pink-500 to-purple-500\"\n    }\n  ];\n\n  return (\n    <div className=\"min-h-screen bg-gradient-to-br from-gray-50 via-red-50 to-orange-50 dark:from-black dark:via-gray-900 dark:to-red-950 p-4 md:p-6 pb-24 md:pb-8 overflow-hidden relative\">\n      {/* Animated background elements */}\n      <div className=\"absolute inset-0 overflow-hidden pointer-events-none\">\n        <div className=\"absolute top-20 left-10 w-72 h-72 bg-red-500/10 rounded-full blur-3xl lg:desktop-fade-in mobile-pulse\" style={{ animationDelay: '0s' }}></div>\n        <div className=\"absolute bottom-20 right-10 w-96 h-96 bg-orange-500/10 rounded-full blur-3xl lg:desktop-fade-in mobile-pulse\" style={{ animationDelay: '0.5s' }}></div>\n        <div className=\"absolute top-1/2 left-1/2 w-64 h-64 bg-purple-500/10 rounded-full blur-3xl lg:desktop-fade-in mobile-pulse\" style={{ animationDelay: '1s' }}></div>\n      </div>\n\n      <div className=\"max-w-6xl mx-auto space-y-6 md:space-y-8 relative z-10\">\n        {/* Hero Header - mobile-native */}\n        <div className=\"text-center lg:desktop-scale-in mobile-bounce-in\">\n          <div className=\"flex items-center justify-center gap-2 md:gap-3 mb-3 md:mb-4\">\n            <Crown className=\"w-10 h-10 md:w-12 md:h-12 text-yellow-500 lg:desktop-glow mobile-pulse\" />\n            <h1 className=\"mobile-large-title md:text-5xl font-bold bg-gradient-to-r from-red-600 via-orange-600 to-yellow-600 bg-clip-text text-transparent\">\n              Premium\n            </h1>\n            <Crown className=\"w-10 h-10 md:w-12 md:h-12 text-yellow-500 lg:desktop-glow mobile-pulse\" />\n          </div>\n          <p className=\"mobile-subtitle md:text-xl text-gray-700 dark:text-gray-300 max-w-2xl mx-auto px-4\">\n            Unlock AI-powered fitness and nutrition\n          </p>\n        </div>\n\n        {/* Current Status Card - Redesigned */}\n        <Card className=\"bg-gradient-to-br from-white to-gray-50 dark:from-gray-900 dark:to-black border-2 border-primary/20 shadow-2xl lg:desktop-scale-in mobile-bounce-in overflow-hidden relative\">\n          <div className=\"absolute top-0 right-0 w-32 h-32 bg-gradient-to-br from-primary/20 to-transparent rounded-full blur-2xl\"></div>\n          <CardHeader>\n            <CardTitle className=\"flex items-center gap-3 text-2xl\">\n              <div className=\"p-3 bg-gradient-to-br from-primary to-orange-600 rounded-xl shadow-lg mobile-pulse\">\n                {getStatusIcon(subscriptionData.subscriptionStatus, subscriptionData.isActive, subscriptionData.isFreeTrialActive)}\n              </div>\n              <span className=\"bg-gradient-to-r from-gray-900 to-gray-700 dark:from-white dark:to-gray-300 bg-clip-text text-transparent\">\n                Your Status\n              </span>\n            </CardTitle>\n          </CardHeader>\n          <CardContent className=\"space-y-6\">\n            <div className=\"flex items-start justify-between flex-wrap gap-4\">\n              <div className=\"space-y-4 flex-1\">\n                <div className=\"flex items-center gap-3 flex-wrap\">\n                  <Badge className={`${getStatusColor(subscriptionData.subscriptionStatus, subscriptionData.isActive, subscriptionData.isFreeTrialActive)} text-base px-4 py-2 lg:desktop-slide-from-left mobile-pop`}>\n                    {getStatusText(subscriptionData.subscriptionStatus, subscriptionData.isFreeTrialActive)}\n                  </Badge>\n                  {subscriptionData.isFreeTrialActive && (\n                    <div className=\"flex items-center gap-2 bg-blue-100 dark:bg-blue-900 px-3 py-1 rounded-full\">\n                      <Gift size={16} className=\"text-blue-600 mobile-pulse\" />\n                      <span className=\"text-sm font-medium text-blue-900 dark:text-blue-100\">\n                        {subscriptionData.daysRemaining} days remaining\n                      </span>\n                    </div>\n                  )}\n                </div>\n\n                {subscriptionData.isActive && (\n                  <div className=\"space-y-2 bg-gray-50 dark:bg-gray-800 p-4 rounded-xl\">\n                    {subscriptionData.subscriptionStartDate && (\n                      <div className=\"flex items-center gap-3\">\n                        <div className=\"p-2 bg-primary/10 rounded-lg\">\n                          <Calendar size={18} className=\"text-primary\" />\n                        </div>\n                        <div>\n                          <div className=\"text-xs text-gray-500 dark:text-gray-400\">Started</div>\n                          <div className=\"font-medium text-gray-900 dark:text-white\">\n                            {format(new Date(subscriptionData.subscriptionStartDate), \"MMM d, yyyy\")}\n                          </div>\n                        </div>\n                      </div>\n                    )}\n                    {subscriptionData.subscriptionExpiresAt && (\n                      <div className=\"flex items-center gap-3\">\n                        <div className=\"p-2 bg-orange-100 dark:bg-orange-900 rounded-lg\">\n                          <Calendar size={18} className=\"text-orange-600\" />\n                        </div>\n                        <div>\n                          <div className=\"text-xs text-gray-500 dark:text-gray-400\">Expires</div>\n                          <div className=\"font-medium text-gray-900 dark:text-white\">\n                            {format(new Date(subscriptionData.subscriptionExpiresAt), \"MMM d, yyyy\")}\n                          </div>\n                        </div>\n                      </div>\n                    )}\n                  </div>\n                )}\n              </div>\n\n              {subscriptionData.isActive && (\n                <div className=\"text-center lg:text-right bg-gradient-to-br from-primary to-orange-600 p-6 rounded-2xl shadow-xl lg:desktop-glow mobile-bounce-in\">\n                  <div className=\"text-4xl font-bold text-white mb-1\">\n                    ${subscriptionData.monthlyFee}\n                  </div>\n                  <div className=\"text-sm text-white/90 font-medium\">per month</div>\n                  <div className=\"mt-2 flex items-center justify-center gap-1\">\n                    <Star size={14} className=\"text-yellow-300 fill-yellow-300\" />\n                    <Star size={14} className=\"text-yellow-300 fill-yellow-300\" />\n                    <Star size={14} className=\"text-yellow-300 fill-yellow-300\" />\n                  </div>\n                </div>\n              )}\n            </div>\n          </CardContent>\n        </Card>\n\n        {/* Premium Features Grid */}\n        <div>\n          <h2 className=\"text-3xl font-bold text-center mb-8 bg-gradient-to-r from-red-600 to-orange-600 bg-clip-text text-transparent lg:desktop-scale-in mobile-bounce-in\">\n            Premium Features\n          </h2>\n          <div className=\"grid md:grid-cols-2 lg:grid-cols-3 gap-6\">\n            {premiumFeatures.map((feature, index) => {\n              const Icon = feature.icon;\n              return (\n                <Card \n                  key={feature.title} \n                  className={`bg-gradient-to-br ${feature.color} border-0 shadow-xl hover:shadow-2xl transition-all duration-300 group relative overflow-hidden lg:desktop-scale-in mobile-bounce-in`}\n                  style={{ animationDelay: `${index * 0.1}s` }}\n                >\n                  <div className=\"absolute inset-0 bg-gradient-to-br from-white/20 to-transparent opacity-0 group-hover:opacity-100 transition-opacity\"></div>\n                  <CardContent className=\"p-6 text-white relative\">\n                    <div className=\"bg-white/20 backdrop-blur-sm w-16 h-16 rounded-2xl flex items-center justify-center mb-4 group-hover:scale-110 transition-transform mobile-pulse\">\n                      <Icon size={32} />\n                    </div>\n                    <h3 className=\"text-xl font-bold mb-2\">{feature.title}</h3>\n                    <p className=\"text-white/90 text-sm\">{feature.description}</p>\n                  </CardContent>\n                </Card>\n              );\n            })}\n          </div>\n        </div>\n\n        {/* Upgrade Section - App Store Integration */}\n        {!subscriptionData.isActive && (\n          <Card className=\"border-0 bg-gradient-to-br from-red-600 via-orange-600 to-yellow-600 shadow-2xl overflow-hidden relative lg:desktop-scale-in mobile-bounce-in\">\n            <div className=\"absolute inset-0 bg-[url('data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNjAiIGhlaWdodD0iNjAiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PGNpcmNsZSBjeD0iMzAiIGN5PSIzMCIgcj0iMiIgZmlsbD0iI2ZmZiIgZmlsbC1vcGFjaXR5PSIwLjEiLz48L3N2Zz4=')] opacity-50\"></div>\n            <CardHeader className=\"relative\">\n              <div className=\"flex items-center justify-center gap-2 mb-4\">\n                <Sparkles className=\"w-8 h-8 text-white mobile-pulse\" />\n                <CardTitle className=\"text-3xl md:text-4xl text-white text-center\">Upgrade to Premium</CardTitle>\n                <Sparkles className=\"w-8 h-8 text-white mobile-pulse\" />\n              </div>\n              <CardDescription className=\"text-white/90 text-center text-lg\">\n                Subscribe through the App Store to unlock all premium features\n              </CardDescription>\n            </CardHeader>\n            <CardContent className=\"space-y-6 relative\">\n              <div className=\"bg-white/10 backdrop-blur-md rounded-2xl p-6 border border-white/20\">\n                <div className=\"flex items-center justify-center gap-3 mb-6\">\n                  <div className=\"text-5xl font-bold text-white\">$15.99</div>\n                  <div className=\"text-white/90\">\n                    <div className=\"font-semibold\">per month</div>\n                    <div className=\"text-sm\">Cancel anytime</div>\n                  </div>\n                </div>\n\n                <div className=\"grid sm:grid-cols-2 gap-3 text-white\">\n                  {premiumFeatures.map((feature, index) => (\n                    <div \n                      key={feature.title} \n                      className=\"flex items-center gap-2 lg:desktop-fade-in mobile-slide-up\"\n                      style={{ animationDelay: `${index * 0.05}s` }}\n                    >\n                      <CheckCircle size={18} className=\"flex-shrink-0 text-green-300\" />\n                      <span className=\"text-sm font-medium\">{feature.title}</span>\n                    </div>\n                  ))}\n                </div>\n              </div>\n\n              <div className=\"space-y-4\">\n                <div className=\"bg-white/10 backdrop-blur-md rounded-xl p-6 border border-white/20\">\n                  <div className=\"flex items-start gap-3 mb-4\">\n                    <div className=\"p-2 bg-blue-500 rounded-lg\">\n                      <svg className=\"w-5 h-5 text-white\" fill=\"currentColor\" viewBox=\"0 0 20 20\">\n                        <path fillRule=\"evenodd\" d=\"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z\" clipRule=\"evenodd\" />\n                      </svg>\n                    </div>\n                    <div className=\"flex-1\">\n                      <h3 className=\"text-white font-semibold mb-2\">Native iOS App Required</h3>\n                      <p className=\"text-sm text-white/90 mb-3\">\n                        App Store subscriptions are only available through the native iOS app. Download FlexFlow from the App Store to subscribe with your Apple ID.\n                      </p>\n                      <p className=\"text-xs text-white/80\">\n                        💡 Once you subscribe in the iOS app, your premium features will automatically sync across all your devices including this web app.\n                      </p>\n                    </div>\n                  </div>\n                  <Button \n                    className=\"w-full bg-white/20 backdrop-blur-md text-white border-2 border-white hover:bg-white/30 shadow-lg text-base py-6\"\n                    data-testid=\"button-download-ios-app\"\n                    asChild\n                  >\n                    <a href=\"https://apps.apple.com\" target=\"_blank\" rel=\"noopener noreferrer\">\n                      <Crown className=\"w-5 h-5 mr-2\" />\n                      Download iOS App\n                    </a>\n                  </Button>\n                </div>\n                <div className=\"bg-white/10 backdrop-blur-md rounded-xl p-4 border border-white/20\">\n                  <p className=\"text-sm text-white/90 text-center\">\n                    🔒 Secure payment through Apple. Manage subscription anytime in your App Store settings.\n                  </p>\n                </div>\n              </div>\n            </CardContent>\n          </Card>\n        )}\n\n        {/* Cancel Section - Redesigned */}\n        {subscriptionData.isActive && (\n          <Card className=\"bg-gradient-to-br from-gray-100 to-gray-200 dark:from-gray-800 dark:to-gray-900 border-2 border-gray-300 dark:border-gray-700 lg:desktop-fade-in mobile-slide-up\">\n            <CardHeader>\n              <CardTitle className=\"text-red-600 dark:text-red-400 flex items-center gap-2\">\n                <AlertCircle size={24} />\n                Cancel Subscription\n              </CardTitle>\n              <CardDescription className=\"text-gray-700 dark:text-gray-300\">\n                We'd hate to see you go! You can cancel your premium subscription at any time.\n              </CardDescription>\n            </CardHeader>\n            <CardContent className=\"space-y-4\">\n              <Alert className=\"bg-yellow-50 dark:bg-yellow-900/20 border-yellow-200 dark:border-yellow-800\">\n                <AlertCircle className=\"h-4 w-4 text-yellow-600\" />\n                <AlertDescription className=\"text-yellow-800 dark:text-yellow-200\">\n                  Cancelling will remove access to all premium features at the end of your billing period.\n                </AlertDescription>\n              </Alert>\n              <Button\n                variant=\"destructive\"\n                onClick={() => cancelSubscriptionMutation.mutate()}\n                disabled={cancelSubscriptionMutation.isPending}\n                data-testid=\"cancel-subscription-button\"\n                className=\"w-full sm:w-auto\"\n              >\n                {cancelSubscriptionMutation.isPending ? \"Cancelling...\" : \"Cancel Subscription\"}\n              </Button>\n            </CardContent>\n          </Card>\n        )}\n      </div>\n    </div>\n  );\n}\n","size_bytes":19265},"client/src/components/ui/input.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Input = React.forwardRef<HTMLInputElement, React.ComponentProps<\"input\">>(\n  ({ className, type, ...props }, ref) => {\n    return (\n      <input\n        type={type}\n        className={cn(\n          \"flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm\",\n          className\n        )}\n        ref={ref}\n        {...props}\n      />\n    )\n  }\n)\nInput.displayName = \"Input\"\n\nexport { Input }\n","size_bytes":791},"client/src/components/ui/drawer.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport { Drawer as DrawerPrimitive } from \"vaul\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Drawer = ({\n  shouldScaleBackground = true,\n  ...props\n}: React.ComponentProps<typeof DrawerPrimitive.Root>) => (\n  <DrawerPrimitive.Root\n    shouldScaleBackground={shouldScaleBackground}\n    {...props}\n  />\n)\nDrawer.displayName = \"Drawer\"\n\nconst DrawerTrigger = DrawerPrimitive.Trigger\n\nconst DrawerPortal = DrawerPrimitive.Portal\n\nconst DrawerClose = DrawerPrimitive.Close\n\nconst DrawerOverlay = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <DrawerPrimitive.Overlay\n    ref={ref}\n    className={cn(\"fixed inset-0 z-50 bg-black/80\", className)}\n    {...props}\n  />\n))\nDrawerOverlay.displayName = DrawerPrimitive.Overlay.displayName\n\nconst DrawerContent = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Content>\n>(({ className, children, ...props }, ref) => (\n  <DrawerPortal>\n    <DrawerOverlay />\n    <DrawerPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"fixed inset-x-0 bottom-0 z-50 mt-24 flex h-auto flex-col rounded-t-[10px] border bg-background\",\n        className\n      )}\n      {...props}\n    >\n      <div className=\"mx-auto mt-4 h-2 w-[100px] rounded-full bg-muted\" />\n      {children}\n    </DrawerPrimitive.Content>\n  </DrawerPortal>\n))\nDrawerContent.displayName = \"DrawerContent\"\n\nconst DrawerHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\"grid gap-1.5 p-4 text-center sm:text-left\", className)}\n    {...props}\n  />\n)\nDrawerHeader.displayName = \"DrawerHeader\"\n\nconst DrawerFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\"mt-auto flex flex-col gap-2 p-4\", className)}\n    {...props}\n  />\n)\nDrawerFooter.displayName = \"DrawerFooter\"\n\nconst DrawerTitle = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <DrawerPrimitive.Title\n    ref={ref}\n    className={cn(\n      \"text-lg font-semibold leading-none tracking-tight\",\n      className\n    )}\n    {...props}\n  />\n))\nDrawerTitle.displayName = DrawerPrimitive.Title.displayName\n\nconst DrawerDescription = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <DrawerPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nDrawerDescription.displayName = DrawerPrimitive.Description.displayName\n\nexport {\n  Drawer,\n  DrawerPortal,\n  DrawerOverlay,\n  DrawerTrigger,\n  DrawerClose,\n  DrawerContent,\n  DrawerHeader,\n  DrawerFooter,\n  DrawerTitle,\n  DrawerDescription,\n}\n","size_bytes":3021},"server/objectAcl.ts":{"content":"import { File } from \"@google-cloud/storage\";\n\nconst ACL_POLICY_METADATA_KEY = \"custom:aclPolicy\";\n\n// The type of the access group.\n//\n// Can be flexibly defined according to the use case.\n//\n// Examples:\n// - USER_LIST: the users from a list stored in the database;\n// - EMAIL_DOMAIN: the users whose email is in a specific domain;\n// - GROUP_MEMBER: the users who are members of a specific group;\n// - SUBSCRIBER: the users who are subscribers of a specific service / content\n//   creator.\nexport enum ObjectAccessGroupType {}\n\n// The logic user group that can access the object.\nexport interface ObjectAccessGroup {\n  // The type of the access group.\n  type: ObjectAccessGroupType;\n  // The logic id that is enough to identify the qualified group members.\n  //\n  // It may have different format for different types. For example:\n  // - for USER_LIST, the id could be the user list db entity id, and the\n  //   user list db entity could contain a bunch of user ids. User needs\n  //   to be a member of the user list to be able to access the object.\n  // - for EMAIL_DOMAIN, the id could be the email domain, and the user needs\n  //   to have an email with the domain to be able to access the object.\n  // - for GROUP_MEMBER, the id could be the group db entity id, and the\n  //   group db entity could contain a bunch of user ids. User needs to be\n  //   a member of the group to be able to access the object.\n  // - for SUBSCRIBER, the id could be the subscriber db entity id, and the\n  //   subscriber db entity could contain a bunch of user ids. User needs to\n  //   be a subscriber to be able to access the object.\n  id: string;\n}\n\nexport enum ObjectPermission {\n  READ = \"read\",\n  WRITE = \"write\",\n}\n\nexport interface ObjectAclRule {\n  group: ObjectAccessGroup;\n  permission: ObjectPermission;\n}\n\n// The ACL policy of the object.\n// This would be set as part of the object custom metadata:\n// - key: \"custom:aclPolicy\"\n// - value: JSON string of the ObjectAclPolicy object.\nexport interface ObjectAclPolicy {\n  owner: string;\n  visibility: \"public\" | \"private\";\n  aclRules?: Array<ObjectAclRule>;\n}\n\n// Check if the requested permission is allowed based on the granted permission.\nfunction isPermissionAllowed(\n  requested: ObjectPermission,\n  granted: ObjectPermission,\n): boolean {\n  // Users granted with read or write permissions can read the object.\n  if (requested === ObjectPermission.READ) {\n    return [ObjectPermission.READ, ObjectPermission.WRITE].includes(granted);\n  }\n\n  // Only users granted with write permissions can write the object.\n  return granted === ObjectPermission.WRITE;\n}\n\n// The base class for all access groups.\n//\n// Different types of access groups can be implemented according to the use case.\nabstract class BaseObjectAccessGroup implements ObjectAccessGroup {\n  constructor(\n    public readonly type: ObjectAccessGroupType,\n    public readonly id: string,\n  ) {}\n\n  // Check if the user is a member of the group.\n  public abstract hasMember(userId: string): Promise<boolean>;\n}\n\nfunction createObjectAccessGroup(\n  group: ObjectAccessGroup,\n): BaseObjectAccessGroup {\n  switch (group.type) {\n    // Implement the case for each type of access group to instantiate.\n    //\n    // For example:\n    // case \"USER_LIST\":\n    //   return new UserListAccessGroup(group.id);\n    // case \"EMAIL_DOMAIN\":\n    //   return new EmailDomainAccessGroup(group.id);\n    // case \"GROUP_MEMBER\":\n    //   return new GroupMemberAccessGroup(group.id);\n    // case \"SUBSCRIBER\":\n    //   return new SubscriberAccessGroup(group.id);\n    default:\n      throw new Error(`Unknown access group type: ${group.type}`);\n  }\n}\n\n// Sets the ACL policy to the object metadata.\nexport async function setObjectAclPolicy(\n  objectFile: File,\n  aclPolicy: ObjectAclPolicy,\n): Promise<void> {\n  const [exists] = await objectFile.exists();\n  if (!exists) {\n    throw new Error(`Object not found: ${objectFile.name}`);\n  }\n\n  await objectFile.setMetadata({\n    metadata: {\n      [ACL_POLICY_METADATA_KEY]: JSON.stringify(aclPolicy),\n    },\n  });\n}\n\n// Gets the ACL policy from the object metadata.\nexport async function getObjectAclPolicy(\n  objectFile: File,\n): Promise<ObjectAclPolicy | null> {\n  const [metadata] = await objectFile.getMetadata();\n  const aclPolicy = metadata?.metadata?.[ACL_POLICY_METADATA_KEY];\n  if (!aclPolicy) {\n    return null;\n  }\n  return JSON.parse(aclPolicy as string);\n}\n\n// Checks if the user can access the object.\nexport async function canAccessObject({\n  userId,\n  objectFile,\n  requestedPermission,\n}: {\n  userId?: string;\n  objectFile: File;\n  requestedPermission: ObjectPermission;\n}): Promise<boolean> {\n  // When this function is called, the acl policy is required.\n  const aclPolicy = await getObjectAclPolicy(objectFile);\n  if (!aclPolicy) {\n    return false;\n  }\n\n  // Public objects are always accessible for read.\n  if (\n    aclPolicy.visibility === \"public\" &&\n    requestedPermission === ObjectPermission.READ\n  ) {\n    return true;\n  }\n\n  // Access control requires the user id.\n  if (!userId) {\n    return false;\n  }\n\n  // The owner of the object can always access it.\n  if (aclPolicy.owner === userId) {\n    return true;\n  }\n\n  // Go through the ACL rules to check if the user has the required permission.\n  for (const rule of aclPolicy.aclRules || []) {\n    const accessGroup = createObjectAccessGroup(rule.group);\n    if (\n      (await accessGroup.hasMember(userId)) &&\n      isPermissionAllowed(requestedPermission, rule.permission)\n    ) {\n      return true;\n    }\n  }\n\n  return false;\n}","size_bytes":5543},"client/src/index.css":{"content":"@import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');\n@tailwind base;\n@tailwind components;\n@tailwind utilities;\n\n@layer utilities {\n  .bg-gradient-radial {\n    background-image: radial-gradient(var(--tw-gradient-stops));\n  }\n  \n  .hexagon-bg {\n    background-image: \n      radial-gradient(circle at 50% 50%, rgba(220, 38, 38, 0.1) 0%, transparent 50%),\n      radial-gradient(circle at 25% 25%, rgba(0, 0, 0, 0.8) 0%, transparent 50%),\n      radial-gradient(circle at 75% 75%, rgba(220, 38, 38, 0.15) 0%, transparent 50%);\n    background-size: 120px 104px, 80px 69px, 100px 87px;\n    background-position: 0 0, 60px 52px, 30px 26px;\n    animation: hexagon-float 20s ease-in-out infinite;\n  }\n  \n  .hexagon-pattern {\n    background-image: url(\"data:image/svg+xml,%3Csvg width='120' height='104' viewBox='0 0 120 104' xmlns='http://www.w3.org/2000/svg'%3E%3Cpolygon points='30,2 90,2 120,52 90,102 30,102 0,52' fill='none' stroke='%23dc2626' stroke-width='1' opacity='0.1'/%3E%3C/svg%3E\");\n    background-size: 120px 104px;\n    background-repeat: repeat;\n  }\n  \n  @keyframes hexagon-float {\n    0%, 100% { transform: translateY(0px) rotate(0deg); }\n    33% { transform: translateY(-10px) rotate(1deg); }\n    66% { transform: translateY(5px) rotate(-1deg); }\n  }\n\n  /* Mobile-specific animations (playful, energetic) */\n  @keyframes mobile-slide-up {\n    0% { \n      opacity: 0; \n      transform: translateY(30px); \n    }\n    100% { \n      opacity: 1; \n      transform: translateY(0); \n    }\n  }\n\n  @keyframes mobile-bounce-in {\n    0% { \n      opacity: 0; \n      transform: scale(0.8) translateY(20px); \n    }\n    50% { \n      transform: scale(1.05) translateY(-5px); \n    }\n    100% { \n      opacity: 1; \n      transform: scale(1) translateY(0); \n    }\n  }\n\n  @keyframes mobile-pop {\n    0% { transform: scale(1); }\n    50% { transform: scale(1.15); }\n    100% { transform: scale(1); }\n  }\n\n  @keyframes mobile-pulse {\n    0%, 100% { \n      transform: scale(1);\n      opacity: 1;\n    }\n    50% { \n      transform: scale(1.05);\n      opacity: 0.9;\n    }\n  }\n\n  /* Desktop-specific animations (smooth, professional) */\n  @keyframes desktop-fade-in {\n    0% { \n      opacity: 0; \n    }\n    100% { \n      opacity: 1; \n    }\n  }\n\n  @keyframes desktop-scale-in {\n    0% { \n      opacity: 0; \n      transform: scale(0.95); \n    }\n    100% { \n      opacity: 1; \n      transform: scale(1); \n    }\n  }\n\n  @keyframes desktop-slide-from-left {\n    0% { \n      opacity: 0; \n      transform: translateX(-20px); \n    }\n    100% { \n      opacity: 1; \n      transform: translateX(0); \n    }\n  }\n\n  @keyframes desktop-glow {\n    0%, 100% { \n      box-shadow: 0 0 5px rgba(220, 38, 38, 0.3);\n    }\n    50% { \n      box-shadow: 0 0 20px rgba(220, 38, 38, 0.5);\n    }\n  }\n\n  /* Mobile animation classes */\n  .mobile-slide-up {\n    animation: mobile-slide-up 0.4s ease-out forwards;\n  }\n\n  .mobile-bounce-in {\n    animation: mobile-bounce-in 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55) forwards;\n  }\n\n  .mobile-pop {\n    animation: mobile-pop 0.3s ease-in-out;\n  }\n\n  .mobile-pulse {\n    animation: mobile-pulse 2s ease-in-out infinite;\n  }\n\n  /* Desktop animation classes */\n  .desktop-fade-in {\n    animation: desktop-fade-in 0.3s ease-out forwards;\n  }\n\n  .desktop-scale-in {\n    animation: desktop-scale-in 0.4s ease-out forwards;\n  }\n\n  .desktop-slide-from-left {\n    animation: desktop-slide-from-left 0.3s ease-out forwards;\n  }\n\n  .desktop-glow {\n    animation: desktop-glow 2s ease-in-out infinite;\n  }\n\n  /* Mobile app utilities */\n  .pb-safe {\n    padding-bottom: env(safe-area-inset-bottom, 0px);\n  }\n  \n  .safe-area-inset-bottom {\n    padding-bottom: env(safe-area-inset-bottom, 0px);\n  }\n\n  /* Mobile-native large titles */\n  .mobile-large-title {\n    font-size: 2rem;\n    font-weight: 700;\n    line-height: 1.2;\n    letter-spacing: -0.02em;\n  }\n\n  .mobile-subtitle {\n    font-size: 0.9rem;\n    font-weight: 400;\n    opacity: 0.7;\n    line-height: 1.4;\n  }\n\n  /* Floating Action Button */\n  .fab {\n    @apply fixed bottom-20 right-4 md:bottom-6 md:right-6 w-14 h-14 rounded-full shadow-2xl flex items-center justify-center z-40;\n    @apply bg-gradient-to-br from-primary to-orange-600 text-white;\n    @apply transition-all duration-300 hover:scale-110 active:scale-95;\n  }\n\n  /* Touch ripple effect */\n  @keyframes ripple {\n    0% {\n      transform: scale(0);\n      opacity: 0.6;\n    }\n    100% {\n      transform: scale(2.5);\n      opacity: 0;\n    }\n  }\n\n  .touch-ripple {\n    position: relative;\n    overflow: hidden;\n  }\n\n  .touch-ripple::after {\n    content: '';\n    position: absolute;\n    top: 50%;\n    left: 50%;\n    width: 100%;\n    height: 100%;\n    background: rgba(255, 255, 255, 0.3);\n    border-radius: 50%;\n    transform: translate(-50%, -50%) scale(0);\n    pointer-events: none;\n  }\n\n  .touch-ripple:active::after {\n    animation: ripple 0.6s ease-out;\n  }\n\n  /* Pull to refresh loader */\n  @keyframes pull-refresh-spin {\n    to { transform: rotate(360deg); }\n  }\n\n  .pull-refresh-spinner {\n    animation: pull-refresh-spin 1s linear infinite;\n  }\n\n  /* Mobile card with better touch affordances */\n  .mobile-card {\n    @apply rounded-2xl p-4 shadow-lg;\n    @apply transition-all duration-200 active:scale-[0.98];\n    min-height: 44px; /* iOS minimum touch target */\n  }\n\n  /* Backdrop blur for native feel */\n  .mobile-header-blur {\n    backdrop-filter: blur(20px);\n    -webkit-backdrop-filter: blur(20px);\n    background: rgba(255, 255, 255, 0.8);\n  }\n\n  .dark .mobile-header-blur {\n    background: rgba(0, 0, 0, 0.8);\n  }\n\n  /* 8pt grid spacing system */\n  .spacing-xs { margin: 8px; }\n  .spacing-sm { margin: 16px; }\n  .spacing-md { margin: 24px; }\n  .spacing-lg { margin: 32px; }\n  .spacing-xl { margin: 40px; }\n\n  /* Swipeable item indicator */\n  .swipe-indicator {\n    @apply absolute right-0 top-0 bottom-0 w-20;\n    @apply bg-gradient-to-l from-red-500 to-transparent;\n    @apply flex items-center justify-end pr-4;\n    transform: translateX(100%);\n    transition: transform 0.3s ease;\n  }\n\n  .swipe-item:hover .swipe-indicator {\n    transform: translateX(0);\n  }\n}\n\n:root {\n  --background: hsl(0 0% 6%);\n  --foreground: hsl(0 0% 95%);\n  --card: hsl(0 0% 8%);\n  --card-foreground: hsl(0 0% 90%);\n  --popover: hsl(0 0% 4%);\n  --popover-foreground: hsl(0 0% 95%);\n  --primary: hsl(0 84% 60%);\n  --primary-foreground: hsl(0 0% 100%);\n  --secondary: hsl(0 0% 15%);\n  --secondary-foreground: hsl(0 84% 60%);\n  --muted: hsl(0 0% 12%);\n  --muted-foreground: hsl(0 0% 60%);\n  --accent: hsl(0 84% 60%);\n  --accent-foreground: hsl(0 0% 100%);\n  --destructive: hsl(0 90% 54%);\n  --destructive-foreground: hsl(0 0% 100%);\n  --border: hsl(0 0% 20%);\n  --input: hsl(0 0% 10%);\n  --ring: hsl(0 84% 60%);\n  --chart-1: hsl(0 84% 60%);\n  --chart-2: hsl(0 0% 30%);\n  --chart-3: hsl(0 84% 45%);\n  --chart-4: hsl(0 0% 40%);\n  --chart-5: hsl(0 84% 70%);\n  --sidebar: hsl(0 0% 8%);\n  --sidebar-foreground: hsl(0 0% 90%);\n  --sidebar-primary: hsl(0 84% 60%);\n  --sidebar-primary-foreground: hsl(0 0% 100%);\n  --sidebar-accent: hsl(0 0% 12%);\n  --sidebar-accent-foreground: hsl(0 84% 60%);\n  --sidebar-border: hsl(0 0% 15%);\n  --sidebar-ring: hsl(0 84% 60%);\n  --font-sans: 'Inter', sans-serif;\n  --font-serif: Georgia, serif;\n  --font-mono: Menlo, monospace;\n  --radius: 1.3rem;\n  --shadow-2xs: 0px 2px 0px 0px hsl(0 84% 60% / 0.20);\n  --shadow-xs: 0px 2px 0px 0px hsl(0 84% 60% / 0.20);\n  --shadow-sm: 0px 2px 0px 0px hsl(0 84% 60% / 0.20), 0px 1px 2px -1px hsl(0 0% 0% / 0.40);\n  --shadow: 0px 2px 0px 0px hsl(0 84% 60% / 0.20), 0px 1px 2px -1px hsl(0 0% 0% / 0.40);\n  --shadow-md: 0px 2px 0px 0px hsl(0 84% 60% / 0.20), 0px 2px 4px -1px hsl(0 0% 0% / 0.40);\n  --shadow-lg: 0px 2px 0px 0px hsl(0 84% 60% / 0.20), 0px 4px 6px -1px hsl(0 0% 0% / 0.40);\n  --shadow-xl: 0px 2px 0px 0px hsl(0 84% 60% / 0.20), 0px 8px 10px -1px hsl(0 0% 0% / 0.40);\n  --shadow-2xl: 0px 2px 0px 0px hsl(0 84% 60% / 0.20);\n  --tracking-normal: 0em;\n  --spacing: 0.25rem;\n}\n\n.dark {\n  --background: hsl(0 0% 4%);\n  --foreground: hsl(0 0% 95%);\n  --card: hsl(0 0% 6%);\n  --card-foreground: hsl(0 0% 90%);\n  --popover: hsl(0 0% 2%);\n  --popover-foreground: hsl(0 0% 95%);\n  --primary: hsl(0 84% 60%);\n  --primary-foreground: hsl(0 0% 100%);\n  --secondary: hsl(0 0% 12%);\n  --secondary-foreground: hsl(0 84% 60%);\n  --muted: hsl(0 0% 8%);\n  --muted-foreground: hsl(0 0% 60%);\n  --accent: hsl(0 84% 60%);\n  --accent-foreground: hsl(0 0% 100%);\n  --destructive: hsl(0 90% 54%);\n  --destructive-foreground: hsl(0 0% 100%);\n  --border: hsl(0 0% 15%);\n  --input: hsl(0 0% 8%);\n  --ring: hsl(0 84% 60%);\n  --chart-1: hsl(0 84% 60%);\n  --chart-2: hsl(0 0% 25%);\n  --chart-3: hsl(0 84% 45%);\n  --chart-4: hsl(0 0% 35%);\n  --chart-5: hsl(0 84% 70%);\n  --sidebar: hsl(0 0% 6%);\n  --sidebar-foreground: hsl(0 0% 90%);\n  --sidebar-primary: hsl(0 84% 60%);\n  --sidebar-primary-foreground: hsl(0 0% 100%);\n  --sidebar-accent: hsl(0 0% 10%);\n  --sidebar-accent-foreground: hsl(0 84% 60%);\n  --sidebar-border: hsl(0 0% 12%);\n  --sidebar-ring: hsl(0 84% 60%);\n  --font-sans: 'Inter', sans-serif;\n  --font-serif: Georgia, serif;\n  --font-mono: Menlo, monospace;\n  --radius: 1.3rem;\n  --shadow-2xs: 0px 2px 0px 0px hsl(0 84% 60% / 0.30);\n  --shadow-xs: 0px 2px 0px 0px hsl(0 84% 60% / 0.30);\n  --shadow-sm: 0px 2px 0px 0px hsl(0 84% 60% / 0.30), 0px 1px 2px -1px hsl(0 0% 0% / 0.60);\n  --shadow: 0px 2px 0px 0px hsl(0 84% 60% / 0.30), 0px 1px 2px -1px hsl(0 0% 0% / 0.60);\n  --shadow-md: 0px 2px 0px 0px hsl(0 84% 60% / 0.30), 0px 2px 4px -1px hsl(0 0% 0% / 0.60);\n  --shadow-lg: 0px 2px 0px 0px hsl(0 84% 60% / 0.30), 0px 4px 6px -1px hsl(0 0% 0% / 0.60);\n  --shadow-xl: 0px 2px 0px 0px hsl(0 84% 60% / 0.30), 0px 8px 10px -1px hsl(0 0% 0% / 0.60);\n  --shadow-2xl: 0px 2px 0px 0px hsl(0 84% 60% / 0.30);\n}\n\n@layer base {\n  * {\n    @apply border-border;\n  }\n\n  body {\n    @apply font-sans antialiased bg-background text-foreground;\n    -webkit-tap-highlight-color: transparent;\n    -webkit-touch-callout: none;\n    overscroll-behavior-y: contain; /* Prevent pull-to-refresh on whole page */\n  }\n\n  /* Mobile-first typography and spacing */\n  @media (max-width: 768px) {\n    html {\n      font-size: 16px; /* iOS standard */\n    }\n    \n    body {\n      padding-bottom: env(safe-area-inset-bottom, 0px);\n    }\n\n    /* Mobile-optimized headings */\n    h1 {\n      @apply text-3xl font-bold tracking-tight;\n      letter-spacing: -0.02em;\n    }\n\n    h2 {\n      @apply text-2xl font-semibold tracking-tight;\n      letter-spacing: -0.01em;\n    }\n\n    h3 {\n      @apply text-xl font-semibold;\n    }\n\n    /* Better button touch targets */\n    button, a {\n      min-height: 44px; /* iOS minimum touch target */\n      min-width: 44px;\n    }\n\n    /* Improve spacing consistency */\n    .container {\n      @apply px-4;\n    }\n\n    /* Card improvements */\n    .card {\n      @apply rounded-2xl shadow-lg;\n    }\n  }\n\n  /* Desktop refinements */\n  @media (min-width: 769px) {\n    .container {\n      @apply px-8;\n    }\n  }\n}\n\n.font-inter {\n  font-family: 'Inter', sans-serif;\n}\n\n/* Fix Uppy Dashboard Modal scrolling */\n.uppy-Dashboard-inner {\n  max-height: 90vh !important;\n  overflow-y: auto !important;\n}\n\n.uppy-Dashboard-AddFiles {\n  max-height: calc(90vh - 120px) !important;\n  overflow-y: auto !important;\n}\n\n.uppy-Dashboard-files {\n  max-height: calc(90vh - 200px) !important;\n  overflow-y: auto !important;\n}","size_bytes":11385},"client/src/lib/utils.ts":{"content":"import { clsx, type ClassValue } from \"clsx\"\nimport { twMerge } from \"tailwind-merge\"\n\nexport function cn(...inputs: ClassValue[]) {\n  return twMerge(clsx(inputs))\n}\n","size_bytes":166},"client/src/components/ui/textarea.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Textarea = React.forwardRef<\n  HTMLTextAreaElement,\n  React.ComponentProps<\"textarea\">\n>(({ className, ...props }, ref) => {\n  return (\n    <textarea\n      className={cn(\n        \"flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm\",\n        className\n      )}\n      ref={ref}\n      {...props}\n    />\n  )\n})\nTextarea.displayName = \"Textarea\"\n\nexport { Textarea }\n","size_bytes":689},"client/src/hooks/useAuth.ts":{"content":"import { useQuery } from \"@tanstack/react-query\";\n\nexport function useAuth() {\n  const { data: user, isLoading } = useQuery({\n    queryKey: [\"/api/auth/user\"],\n    retry: false,\n  });\n\n  return {\n    user,\n    isLoading,\n    isAuthenticated: !!user,\n  };\n}","size_bytes":256},"client/src/components/ui/collapsible.tsx":{"content":"\"use client\"\n\nimport * as CollapsiblePrimitive from \"@radix-ui/react-collapsible\"\n\nconst Collapsible = CollapsiblePrimitive.Root\n\nconst CollapsibleTrigger = CollapsiblePrimitive.CollapsibleTrigger\n\nconst CollapsibleContent = CollapsiblePrimitive.CollapsibleContent\n\nexport { Collapsible, CollapsibleTrigger, CollapsibleContent }\n","size_bytes":329},"server/vite.ts":{"content":"import express, { type Express } from \"express\";\nimport fs from \"fs\";\nimport path from \"path\";\nimport { createServer as createViteServer, createLogger } from \"vite\";\nimport { type Server } from \"http\";\nimport viteConfig from \"../vite.config\";\nimport { nanoid } from \"nanoid\";\n\nconst viteLogger = createLogger();\n\nexport function log(message: string, source = \"express\") {\n  const formattedTime = new Date().toLocaleTimeString(\"en-US\", {\n    hour: \"numeric\",\n    minute: \"2-digit\",\n    second: \"2-digit\",\n    hour12: true,\n  });\n\n  console.log(`${formattedTime} [${source}] ${message}`);\n}\n\nexport async function setupVite(app: Express, server: Server) {\n  const serverOptions = {\n    middlewareMode: true,\n    hmr: { server },\n    allowedHosts: true as const,\n  };\n\n  const vite = await createViteServer({\n    ...viteConfig,\n    configFile: false,\n    customLogger: {\n      ...viteLogger,\n      error: (msg, options) => {\n        viteLogger.error(msg, options);\n        process.exit(1);\n      },\n    },\n    server: serverOptions,\n    appType: \"custom\",\n  });\n\n  app.use(vite.middlewares);\n  app.use(\"*\", async (req, res, next) => {\n    const url = req.originalUrl;\n\n    try {\n      const clientTemplate = path.resolve(\n        import.meta.dirname,\n        \"..\",\n        \"client\",\n        \"index.html\",\n      );\n\n      // always reload the index.html file from disk incase it changes\n      let template = await fs.promises.readFile(clientTemplate, \"utf-8\");\n      template = template.replace(\n        `src=\"/src/main.tsx\"`,\n        `src=\"/src/main.tsx?v=${nanoid()}\"`,\n      );\n      const page = await vite.transformIndexHtml(url, template);\n      res.status(200).set({ \"Content-Type\": \"text/html\" }).end(page);\n    } catch (e) {\n      vite.ssrFixStacktrace(e as Error);\n      next(e);\n    }\n  });\n}\n\nexport function serveStatic(app: Express) {\n  const distPath = path.resolve(import.meta.dirname, \"public\");\n\n  if (!fs.existsSync(distPath)) {\n    throw new Error(\n      `Could not find the build directory: ${distPath}, make sure to build the client first`,\n    );\n  }\n\n  app.use(express.static(distPath));\n\n  // fall through to index.html if the file doesn't exist\n  app.use(\"*\", (_req, res) => {\n    res.sendFile(path.resolve(distPath, \"index.html\"));\n  });\n}\n","size_bytes":2263},"client/src/components/ui/toaster.tsx":{"content":"import { useToast } from \"@/hooks/use-toast\"\nimport {\n  Toast,\n  ToastClose,\n  ToastDescription,\n  ToastProvider,\n  ToastTitle,\n  ToastViewport,\n} from \"@/components/ui/toast\"\n\nexport function Toaster() {\n  const { toasts } = useToast()\n\n  return (\n    <ToastProvider>\n      {toasts.map(function ({ id, title, description, action, ...props }) {\n        return (\n          <Toast key={id} {...props}>\n            <div className=\"grid gap-1\">\n              {title && <ToastTitle>{title}</ToastTitle>}\n              {description && (\n                <ToastDescription>{description}</ToastDescription>\n              )}\n            </div>\n            {action}\n            <ToastClose />\n          </Toast>\n        )\n      })}\n      <ToastViewport />\n    </ToastProvider>\n  )\n}\n","size_bytes":772},"client/src/components/ui/progress.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as ProgressPrimitive from \"@radix-ui/react-progress\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Progress = React.forwardRef<\n  React.ElementRef<typeof ProgressPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof ProgressPrimitive.Root>\n>(({ className, value, ...props }, ref) => (\n  <ProgressPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative h-4 w-full overflow-hidden rounded-full bg-secondary\",\n      className\n    )}\n    {...props}\n  >\n    <ProgressPrimitive.Indicator\n      className=\"h-full w-full flex-1 bg-primary transition-all\"\n      style={{ transform: `translateX(-${100 - (value || 0)}%)` }}\n    />\n  </ProgressPrimitive.Root>\n))\nProgress.displayName = ProgressPrimitive.Root.displayName\n\nexport { Progress }\n","size_bytes":791},"client/src/hooks/useNewAuth.ts":{"content":"import { useState, useEffect } from \"react\";\nimport { useQuery, useQueryClient } from \"@tanstack/react-query\";\nimport { apiRequest } from \"@/lib/queryClient\";\n\ninterface AuthUser {\n  id: string;\n  email: string | null;\n  username: string | null;\n  firstName: string | null;\n  lastName: string | null;\n  profileImageUrl: string | null;\n  authProvider: string | null;\n  isEmailVerified: boolean | null;\n  subscriptionStatus?: string;\n  trialStartDate?: Date | null;\n  trialEndDate?: Date | null;\n  subscriptionStartDate?: Date | null;\n  subscriptionExpiresAt?: Date | null;\n  lastPaymentDate?: Date | null;\n  stripeCustomerId?: string | null;\n  stripeSubscriptionId?: string | null;\n}\n\nexport function useNewAuth() {\n  const [token, setToken] = useState<string | null>(() => {\n    return localStorage.getItem('auth-token');\n  });\n  const queryClient = useQueryClient();\n\n  // Fetch user data with JWT token (supports both Bearer and cookie auth)\n  const { data: user, isLoading, error } = useQuery({\n    queryKey: [\"/api/auth/user\"],\n    queryFn: async () => {\n      // Try cookie-based auth first, then fall back to token in localStorage\n      let response = await fetch('/api/auth/status', {\n        credentials: 'include' // Include cookies\n      });\n      \n      if (response.ok) {\n        const data = await response.json();\n        if (data.authenticated) {\n          return data.user;\n        }\n      }\n      \n      // Fall back to Bearer token if cookie auth failed and we have a stored token\n      if (token) {\n        response = await fetch('/api/auth/user', {\n          headers: {\n            'Authorization': `Bearer ${token}`,\n          },\n        });\n        \n        if (response.ok) {\n          return response.json();\n        } else if (response.status === 401) {\n          // Token is invalid, clear it\n          localStorage.removeItem('auth-token');\n          setToken(null);\n        }\n      }\n      \n      return null;\n    },\n    retry: false,\n  });\n\n\n  const signIn = (user: AuthUser, authToken: string) => {\n    localStorage.setItem('auth-token', authToken);\n    setToken(authToken);\n    queryClient.setQueryData([\"/api/auth/user\"], user);\n  };\n\n  const signOut = async () => {\n    try {\n      // Call logout endpoint to clear cookie\n      await fetch('/api/auth/logout', {\n        method: 'POST',\n        credentials: 'include'\n      });\n    } catch (error) {\n      console.error('Failed to logout:', error);\n    }\n    \n    localStorage.removeItem('auth-token');\n    setToken(null);\n    queryClient.clear();\n    window.location.href = '/';\n  };\n\n  const refreshToken = async () => {\n    if (!token) return null;\n    \n    try {\n      const response = await apiRequest(\"POST\", \"/api/auth/refresh\", { token });\n      const data = await response.json();\n      \n      const newToken = data.token;\n      localStorage.setItem('auth-token', newToken);\n      setToken(newToken);\n      \n      return newToken;\n    } catch (error) {\n      console.error('Failed to refresh token:', error);\n      signOut();\n      return null;\n    }\n  };\n\n  return {\n    user: user || null,\n    isLoading,\n    isAuthenticated: !!user,\n    token,\n    signIn,\n    signOut,\n    refreshToken,\n    error,\n  };\n}","size_bytes":3198},"drizzle.config.ts":{"content":"import { defineConfig } from \"drizzle-kit\";\n\nif (!process.env.DATABASE_URL) {\n  throw new Error(\"DATABASE_URL, ensure the database is provisioned\");\n}\n\nexport default defineConfig({\n  out: \"./migrations\",\n  schema: \"./shared/schema.ts\",\n  dialect: \"postgresql\",\n  dbCredentials: {\n    url: process.env.DATABASE_URL,\n  },\n});\n","size_bytes":325},"server/openai-service.ts":{"content":"import OpenAI from \"openai\";\n\n// IMPORTANT: from the OpenAI blueprint:\n// the newest OpenAI model is \"gpt-5\" which was released August 7, 2025. do not change this unless explicitly requested by the user\n\nconst openai = new OpenAI({ \n  apiKey: process.env.AI_INTEGRATIONS_OPENAI_API_KEY || process.env.OPENAI_API_KEY,\n  baseURL: process.env.AI_INTEGRATIONS_OPENAI_BASE_URL\n});\n\nexport interface NutritionalAnalysis {\n  mealName: string;\n  description: string;\n  totalCalories: number;\n  protein: number;\n  carbs: number;\n  fat: number;\n  fiber: number;\n  sugar: number;\n  sodium: number;\n  confidence: number;\n}\n\nexport async function analyzeMealImage(base64Image: string, mealType: string, customDescription?: string): Promise<NutritionalAnalysis> {\n  try {\n    const prompt = `Analyze this ${mealType} image and provide detailed nutritional information. ${customDescription ? `Additional context: ${customDescription}` : ''}\n\nPlease provide your response in JSON format with these exact fields:\n{\n  \"mealName\": \"descriptive name of the meal\",\n  \"description\": \"brief description of the meal and its components\",\n  \"totalCalories\": number (estimated total calories),\n  \"protein\": number (grams),\n  \"carbs\": number (grams),\n  \"fat\": number (grams),\n  \"fiber\": number (grams),\n  \"sugar\": number (grams),\n  \"sodium\": number (milligrams),\n  \"confidence\": number (confidence score between 0.1 and 1.0)\n}\n\nGuidelines:\n- Be as accurate as possible with portion size estimation\n- Consider typical serving sizes for the meal type\n- If multiple items are visible, analyze the entire meal\n- Provide realistic nutritional values based on visible ingredients\n- Set confidence lower if the image quality is poor or ingredients are unclear\n- For ${mealType}, consider appropriate portion sizes for that meal type`;\n\n    const response = await openai.chat.completions.create({\n      model: \"gpt-4o\",\n      messages: [\n        {\n          role: \"system\",\n          content: \"You are a professional nutritionist and food analysis expert. Analyze food images and provide accurate nutritional information in JSON format.\"\n        },\n        {\n          role: \"user\",\n          content: [\n            {\n              type: \"text\",\n              text: prompt\n            },\n            {\n              type: \"image_url\",\n              image_url: {\n                url: `data:image/jpeg;base64,${base64Image}`\n              }\n            }\n          ],\n        },\n      ],\n      response_format: { type: \"json_object\" },\n      max_tokens: 1000,\n    });\n\n    const result = JSON.parse(response.choices[0].message.content || '{}');\n\n    // Validate and sanitize the response\n    const analysis: NutritionalAnalysis = {\n      mealName: result.mealName || 'Unknown Meal',\n      description: result.description || 'Nutritional analysis of uploaded meal',\n      totalCalories: Math.max(0, Math.round(result.totalCalories || 0)),\n      protein: Math.max(0, Math.round((result.protein || 0) * 100) / 100),\n      carbs: Math.max(0, Math.round((result.carbs || 0) * 100) / 100),\n      fat: Math.max(0, Math.round((result.fat || 0) * 100) / 100),\n      fiber: Math.max(0, Math.round((result.fiber || 0) * 100) / 100),\n      sugar: Math.max(0, Math.round((result.sugar || 0) * 100) / 100),\n      sodium: Math.max(0, Math.round(result.sodium || 0)),\n      confidence: Math.min(1.0, Math.max(0.1, result.confidence || 0.85))\n    };\n\n    return analysis;\n  } catch (error) {\n    console.error('OpenAI analysis error:', error);\n    throw new Error('Failed to analyze meal image. Please try again.');\n  }\n}","size_bytes":3566},"client/src/components/ui/accordion.tsx":{"content":"import * as React from \"react\"\nimport * as AccordionPrimitive from \"@radix-ui/react-accordion\"\nimport { ChevronDown } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Accordion = AccordionPrimitive.Root\n\nconst AccordionItem = React.forwardRef<\n  React.ElementRef<typeof AccordionPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Item>\n>(({ className, ...props }, ref) => (\n  <AccordionPrimitive.Item\n    ref={ref}\n    className={cn(\"border-b\", className)}\n    {...props}\n  />\n))\nAccordionItem.displayName = \"AccordionItem\"\n\nconst AccordionTrigger = React.forwardRef<\n  React.ElementRef<typeof AccordionPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Trigger>\n>(({ className, children, ...props }, ref) => (\n  <AccordionPrimitive.Header className=\"flex\">\n    <AccordionPrimitive.Trigger\n      ref={ref}\n      className={cn(\n        \"flex flex-1 items-center justify-between py-4 font-medium transition-all hover:underline [&[data-state=open]>svg]:rotate-180\",\n        className\n      )}\n      {...props}\n    >\n      {children}\n      <ChevronDown className=\"h-4 w-4 shrink-0 transition-transform duration-200\" />\n    </AccordionPrimitive.Trigger>\n  </AccordionPrimitive.Header>\n))\nAccordionTrigger.displayName = AccordionPrimitive.Trigger.displayName\n\nconst AccordionContent = React.forwardRef<\n  React.ElementRef<typeof AccordionPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Content>\n>(({ className, children, ...props }, ref) => (\n  <AccordionPrimitive.Content\n    ref={ref}\n    className=\"overflow-hidden text-sm transition-all data-[state=closed]:animate-accordion-up data-[state=open]:animate-accordion-down\"\n    {...props}\n  >\n    <div className={cn(\"pb-4 pt-0\", className)}>{children}</div>\n  </AccordionPrimitive.Content>\n))\n\nAccordionContent.displayName = AccordionPrimitive.Content.displayName\n\nexport { Accordion, AccordionItem, AccordionTrigger, AccordionContent }\n","size_bytes":1977},"client/src/lib/queryClient.ts":{"content":"import { QueryClient, QueryFunction } from \"@tanstack/react-query\";\n\nasync function throwIfResNotOk(res: Response) {\n  if (!res.ok) {\n    const text = (await res.text()) || res.statusText;\n    throw new Error(`${res.status}: ${text}`);\n  }\n}\n\nexport async function apiRequest(\n  method: string,\n  url: string,\n  data?: unknown | undefined,\n): Promise<Response> {\n  const token = localStorage.getItem('auth-token');\n  const headers: Record<string, string> = {};\n  \n  if (data) {\n    headers[\"Content-Type\"] = \"application/json\";\n  }\n  \n  if (token) {\n    headers[\"Authorization\"] = `Bearer ${token}`;\n  }\n\n  const res = await fetch(url, {\n    method,\n    headers,\n    body: data ? JSON.stringify(data) : undefined,\n    credentials: \"include\",\n  });\n\n  await throwIfResNotOk(res);\n  return res;\n}\n\ntype UnauthorizedBehavior = \"returnNull\" | \"throw\";\nexport const getQueryFn: <T>(options: {\n  on401: UnauthorizedBehavior;\n}) => QueryFunction<T> =\n  ({ on401: unauthorizedBehavior }) =>\n  async ({ queryKey }) => {\n    const token = localStorage.getItem('auth-token');\n    const headers: Record<string, string> = {};\n    \n    if (token) {\n      headers[\"Authorization\"] = `Bearer ${token}`;\n    }\n\n    // Build URL with proper query parameters\n    let url = queryKey[0] as string;\n    \n    // If there's a second element and it's an object, convert to query params\n    if (queryKey.length > 1 && typeof queryKey[1] === 'object' && queryKey[1] !== null) {\n      const params = new URLSearchParams();\n      const queryParams = queryKey[1] as Record<string, string>;\n      \n      Object.entries(queryParams).forEach(([key, value]) => {\n        if (value !== undefined && value !== null && value !== '') {\n          params.append(key, String(value));\n        }\n      });\n      \n      const queryString = params.toString();\n      if (queryString) {\n        url += `?${queryString}`;\n      }\n    }\n\n    const res = await fetch(url, {\n      headers,\n      credentials: \"include\",\n    });\n\n    if (unauthorizedBehavior === \"returnNull\" && res.status === 401) {\n      return null;\n    }\n\n    await throwIfResNotOk(res);\n    return await res.json();\n  };\n\nexport const queryClient = new QueryClient({\n  defaultOptions: {\n    queries: {\n      queryFn: getQueryFn({ on401: \"throw\" }),\n      refetchInterval: false,\n      refetchOnWindowFocus: false,\n      staleTime: Infinity,\n      retry: false,\n    },\n    mutations: {\n      retry: false,\n    },\n  },\n});\n","size_bytes":2441},"client/src/components/ui/toggle-group.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as ToggleGroupPrimitive from \"@radix-ui/react-toggle-group\"\nimport { type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\nimport { toggleVariants } from \"@/components/ui/toggle\"\n\nconst ToggleGroupContext = React.createContext<\n  VariantProps<typeof toggleVariants>\n>({\n  size: \"default\",\n  variant: \"default\",\n})\n\nconst ToggleGroup = React.forwardRef<\n  React.ElementRef<typeof ToggleGroupPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof ToggleGroupPrimitive.Root> &\n    VariantProps<typeof toggleVariants>\n>(({ className, variant, size, children, ...props }, ref) => (\n  <ToggleGroupPrimitive.Root\n    ref={ref}\n    className={cn(\"flex items-center justify-center gap-1\", className)}\n    {...props}\n  >\n    <ToggleGroupContext.Provider value={{ variant, size }}>\n      {children}\n    </ToggleGroupContext.Provider>\n  </ToggleGroupPrimitive.Root>\n))\n\nToggleGroup.displayName = ToggleGroupPrimitive.Root.displayName\n\nconst ToggleGroupItem = React.forwardRef<\n  React.ElementRef<typeof ToggleGroupPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof ToggleGroupPrimitive.Item> &\n    VariantProps<typeof toggleVariants>\n>(({ className, children, variant, size, ...props }, ref) => {\n  const context = React.useContext(ToggleGroupContext)\n\n  return (\n    <ToggleGroupPrimitive.Item\n      ref={ref}\n      className={cn(\n        toggleVariants({\n          variant: context.variant || variant,\n          size: context.size || size,\n        }),\n        className\n      )}\n      {...props}\n    >\n      {children}\n    </ToggleGroupPrimitive.Item>\n  )\n})\n\nToggleGroupItem.displayName = ToggleGroupPrimitive.Item.displayName\n\nexport { ToggleGroup, ToggleGroupItem }\n","size_bytes":1753},"server/auth-service.ts":{"content":"import * as bcrypt from \"bcrypt\";\nimport jwt from \"jsonwebtoken\";\nimport { storage } from \"./storage\";\nimport { signUpSchema, signInSchema, type SignUpData, type SignInData } from \"@shared/schema\";\n\n// JWT secret - in production, this should be a long, random secret\nconst JWT_SECRET = process.env.JWT_SECRET || \"your-super-secret-jwt-key-change-in-production\";\nconst JWT_EXPIRES_IN = \"7d\"; // Token expires in 7 days\n\nexport interface AuthResult {\n  user: {\n    id: string;\n    email: string | null;\n    username: string | null;\n    firstName: string | null;\n    lastName: string | null;\n    profileImageUrl: string | null;\n    authProvider: string | null;\n    isEmailVerified: boolean | null;\n    subscriptionStatus?: string | null;\n    trialStartDate?: Date | null;\n    trialEndDate?: Date | null;\n    subscriptionStartDate?: Date | null;\n    subscriptionExpiresAt?: Date | null;\n    lastPaymentDate?: Date | null;\n    stripeCustomerId?: string | null;\n    stripeSubscriptionId?: string | null;\n  };\n  token: string;\n}\n\nexport class AuthService {\n  /**\n   * Register a new user with username and password\n   */\n  async signUp(userData: SignUpData): Promise<AuthResult> {\n    // Validate input data\n    const validatedData = signUpSchema.parse(userData);\n    \n    try {\n      \n      // Create user in storage with personal plan data if provided\n      const user = await storage.createUserWithPassword(validatedData);\n      \n      \n      // Generate JWT token\n      const token = jwt.sign(\n        { \n          userId: user.id, \n          email: user.email,\n          username: user.username,\n          authProvider: user.authProvider \n        },\n        JWT_SECRET,\n        { expiresIn: JWT_EXPIRES_IN }\n      );\n\n\n      return {\n        user: {\n          id: user.id,\n          email: user.email,\n          username: user.username,\n          firstName: user.firstName,\n          lastName: user.lastName,\n          profileImageUrl: user.profileImageUrl,\n          authProvider: user.authProvider,\n          isEmailVerified: user.isEmailVerified,\n          subscriptionStatus: user.subscriptionStatus,\n          trialStartDate: user.trialStartDate,\n          trialEndDate: user.trialEndDate,\n          subscriptionStartDate: user.subscriptionStartDate,\n          subscriptionExpiresAt: user.subscriptionExpiresAt,\n          lastPaymentDate: user.lastPaymentDate,\n          stripeCustomerId: user.stripeCustomerId,\n          stripeSubscriptionId: user.stripeSubscriptionId,\n        },\n        token\n      };\n    } catch (error: any) {\n      \n      if (error.message === \"Username or email already exists\") {\n        throw new Error(\"An account with this username or email already exists\");\n      }\n      throw new Error(\"Failed to create account. Please try again.\");\n    }\n  }\n\n  /**\n   * Sign in user with username/email and password\n   */\n  async signIn(credentials: SignInData): Promise<AuthResult> {\n    // Validate input data\n    const validatedCredentials = signInSchema.parse(credentials);\n    \n    // Find user by username or email\n    const user = await storage.getUserByUsernameOrEmail(validatedCredentials.identifier);\n    \n    if (!user) {\n      throw new Error(\"Invalid username/email or password\");\n    }\n\n    // Check if user has a password (not OAuth-only user)\n    if (!user.passwordHash) {\n      throw new Error(\"This account requires a password. Please set a password to sign in.\");\n    }\n\n    // Verify password\n    const isPasswordValid = await bcrypt.compare(validatedCredentials.password, user.passwordHash);\n    \n    if (!isPasswordValid) {\n      throw new Error(\"Invalid username/email or password\");\n    }\n\n    // Generate JWT token\n    const token = jwt.sign(\n      { \n        userId: user.id, \n        email: user.email,\n        username: user.username,\n        authProvider: user.authProvider \n      },\n      JWT_SECRET,\n      { expiresIn: JWT_EXPIRES_IN }\n    );\n\n    return {\n      user: {\n        id: user.id,\n        email: user.email,\n        username: user.username,\n        firstName: user.firstName,\n        lastName: user.lastName,\n        profileImageUrl: user.profileImageUrl,\n        authProvider: user.authProvider,\n        isEmailVerified: user.isEmailVerified,\n        subscriptionStatus: user.subscriptionStatus,\n        trialStartDate: user.trialStartDate,\n        trialEndDate: user.trialEndDate,\n        subscriptionStartDate: user.subscriptionStartDate,\n        subscriptionExpiresAt: user.subscriptionExpiresAt,\n        lastPaymentDate: user.lastPaymentDate,\n        stripeCustomerId: user.stripeCustomerId,\n        stripeSubscriptionId: user.stripeSubscriptionId,\n      },\n      token\n    };\n  }\n\n\n  /**\n   * Verify JWT token and return user data\n   */\n  async verifyToken(token: string): Promise<{ userId: string; email: string | null; username: string | null; authProvider: string | null }> {\n    try {\n      const decoded = jwt.verify(token, JWT_SECRET) as any;\n      return {\n        userId: decoded.userId,\n        email: decoded.email || null,\n        username: decoded.username || null,\n        authProvider: decoded.authProvider || null,\n      };\n    } catch (error) {\n      throw new Error(\"Invalid or expired token\");\n    }\n  }\n\n  /**\n   * Get user by token\n   */\n  async getUserByToken(token: string): Promise<AuthResult['user'] | null> {\n    try {\n      const tokenData = await this.verifyToken(token);\n      const user = await storage.getUser(tokenData.userId);\n      \n      if (!user) {\n        return null;\n      }\n\n      return {\n        id: user.id,\n        email: user.email,\n        username: user.username,\n        firstName: user.firstName,\n        lastName: user.lastName,\n        profileImageUrl: user.profileImageUrl,\n        authProvider: user.authProvider,\n        isEmailVerified: user.isEmailVerified,\n        subscriptionStatus: user.subscriptionStatus,\n        trialStartDate: user.trialStartDate,\n        trialEndDate: user.trialEndDate,\n        subscriptionStartDate: user.subscriptionStartDate,\n        subscriptionExpiresAt: user.subscriptionExpiresAt,\n        lastPaymentDate: user.lastPaymentDate,\n        stripeCustomerId: user.stripeCustomerId,\n        stripeSubscriptionId: user.stripeSubscriptionId,\n      };\n    } catch (error) {\n      return null;\n    }\n  }\n\n  /**\n   * Refresh JWT token\n   */\n  async refreshToken(oldToken: string): Promise<string> {\n    const tokenData = await this.verifyToken(oldToken);\n    \n    // Generate new token with same data\n    return jwt.sign(\n      { \n        userId: tokenData.userId, \n        email: tokenData.email,\n        username: tokenData.username,\n        authProvider: tokenData.authProvider \n      },\n      JWT_SECRET,\n      { expiresIn: JWT_EXPIRES_IN }\n    );\n  }\n\n  /**\n   * Change user password\n   */\n  async changePassword(userId: string, currentPassword: string, newPassword: string): Promise<void> {\n    const user = await storage.getUser(userId);\n    \n    if (!user) {\n      throw new Error(\"User not found\");\n    }\n\n    if (!user.passwordHash) {\n      throw new Error(\"This account doesn't have a password set. Please contact support to reset your password.\");\n    }\n\n    // Verify current password\n    const isCurrentPasswordValid = await bcrypt.compare(currentPassword, user.passwordHash);\n    \n    if (!isCurrentPasswordValid) {\n      throw new Error(\"Current password is incorrect\");\n    }\n\n    // Hash new password\n    const saltRounds = 12;\n    const newPasswordHash = await bcrypt.hash(newPassword, saltRounds);\n\n    // Update user with new password hash\n    await storage.updateUser(userId, { passwordHash: newPasswordHash, updatedAt: new Date() });\n  }\n}\n\nexport const authService = new AuthService();","size_bytes":7656},"server/ai-difficulty-service.ts":{"content":"import OpenAI from \"openai\";\nimport { storage } from \"./storage\";\nimport type { \n  Workout, \n  WorkoutExercise, \n  AiDifficultyAdjustment, \n  InsertAiDifficultyAdjustment \n} from \"../shared/schema\";\n\n// the newest OpenAI model is \"gpt-5\" which was released August 7, 2025. do not change this unless explicitly requested by the user\nconst openai = new OpenAI({ \n  apiKey: process.env.AI_INTEGRATIONS_OPENAI_API_KEY || process.env.OPENAI_API_KEY,\n  baseURL: process.env.AI_INTEGRATIONS_OPENAI_BASE_URL\n});\n\nexport interface PerformanceAnalysis {\n  userId: string;\n  exerciseId: string;\n  currentDifficulty: number;\n  suggestedDifficulty: number;\n  confidenceScore: number;\n  performanceTrend: \"improving\" | \"declining\" | \"stable\";\n  reasoningFactors: {\n    recentCompletionRate: number;\n    progressTrend: string;\n    consistencyScore: number;\n    exertionPattern: string;\n    recommendations: string[];\n  };\n}\n\nexport class AiDifficultyService {\n  /**\n   * Analyzes user performance data for a specific exercise and suggests difficulty adjustments\n   */\n  async analyzePerformanceAndSuggestDifficulty(\n    userId: string, \n    exerciseId: string\n  ): Promise<PerformanceAnalysis | null> {\n    try {\n      // Get recent workout data for this user and exercise (last 10 workouts)\n      const recentWorkouts = await storage.getRecentWorkoutsForExercise(userId, exerciseId, 10);\n      \n      if (recentWorkouts.length < 3) {\n        // Need at least 3 workouts to make meaningful analysis\n        return null;\n      }\n\n      // Prepare performance data for AI analysis\n      const performanceData = this.preparePerformanceData(recentWorkouts);\n      \n      // Use AI to analyze the data and suggest improvements\n      const aiAnalysis = await this.getAiAnalysis(performanceData);\n      \n      // Calculate confidence score based on data quality and consistency\n      const confidenceScore = this.calculateConfidenceScore(recentWorkouts);\n      \n      const analysis: PerformanceAnalysis = {\n        userId,\n        exerciseId,\n        currentDifficulty: recentWorkouts[0].difficultyLevel || 3,\n        suggestedDifficulty: aiAnalysis.suggestedDifficulty,\n        confidenceScore,\n        performanceTrend: aiAnalysis.performanceTrend,\n        reasoningFactors: {\n          recentCompletionRate: this.calculateCompletionRate(recentWorkouts),\n          progressTrend: aiAnalysis.progressTrend,\n          consistencyScore: this.calculateConsistencyScore(recentWorkouts),\n          exertionPattern: aiAnalysis.exertionPattern,\n          recommendations: aiAnalysis.recommendations\n        }\n      };\n\n      // Store the AI suggestion in the database\n      await this.storeDifficultyAdjustment(analysis);\n      \n      return analysis;\n    } catch (error) {\n      console.error('Error analyzing performance:', error);\n      return null;\n    }\n  }\n\n  /**\n   * Gets AI analysis using OpenAI GPT\n   */\n  private async getAiAnalysis(performanceData: any) {\n    const prompt = `Analyze this fitness performance data and suggest difficulty adjustments:\n\n${JSON.stringify(performanceData, null, 2)}\n\nPlease provide your analysis in the following JSON format:\n{\n  \"suggestedDifficulty\": number (1-5 scale),\n  \"performanceTrend\": \"improving\" | \"declining\" | \"stable\",\n  \"progressTrend\": \"string describing the trend\",\n  \"exertionPattern\": \"string describing exertion patterns\",\n  \"recommendations\": [\"array\", \"of\", \"specific\", \"recommendations\"]\n}\n\nConsider factors like:\n- Completion rates over time\n- Perceived exertion ratings\n- Performance consistency\n- Progressive overload principles\n- Recovery and adaptation patterns\n\nProvide specific, actionable recommendations for difficulty adjustment.`;\n\n    const response = await openai.chat.completions.create({\n      model: \"gpt-5\", // the newest OpenAI model is \"gpt-5\" which was released August 7, 2025. do not change this unless explicitly requested by the user\n      messages: [\n        {\n          role: \"system\",\n          content: \"You are an expert fitness coach and exercise physiologist. Analyze workout performance data to suggest optimal difficulty adjustments for progressive training.\"\n        },\n        {\n          role: \"user\",\n          content: prompt\n        }\n      ],\n      response_format: { type: \"json_object\" },\n      temperature: 0.3 // Lower temperature for more consistent analysis\n    });\n\n    return JSON.parse(response.choices[0].message.content || '{}');\n  }\n\n  /**\n   * Prepares workout data for AI analysis\n   */\n  private preparePerformanceData(workouts: (Workout & { exercises: WorkoutExercise[] })[]) {\n    return {\n      totalWorkouts: workouts.length,\n      timeSpan: {\n        start: workouts[workouts.length - 1].date,\n        end: workouts[0].date\n      },\n      workouts: workouts.map((workout, index) => ({\n        date: workout.date,\n        difficultyLevel: workout.difficultyLevel,\n        perceivedExertion: workout.perceivedExertion,\n        completionRate: workout.completionRate,\n        duration: workout.duration,\n        exercises: workout.exercises.map(ex => ({\n          sets: ex.sets,\n          reps: ex.reps,\n          weight: ex.weight,\n          targetSets: ex.targetSets,\n          targetReps: ex.targetReps,\n          targetWeight: ex.targetWeight,\n          completed: ex.completed,\n          difficultyAdjustment: ex.difficultyAdjustment\n        })),\n        workoutNumber: workouts.length - index // Most recent is #1\n      }))\n    };\n  }\n\n  /**\n   * Calculates completion rate from recent workouts\n   */\n  private calculateCompletionRate(workouts: (Workout & { exercises: WorkoutExercise[] })[]): number {\n    if (workouts.length === 0) return 100;\n    \n    const totalCompletionRate = workouts.reduce((sum, workout) => sum + (workout.completionRate || 100), 0);\n    return Math.round(totalCompletionRate / workouts.length);\n  }\n\n  /**\n   * Calculates consistency score based on performance variance\n   */\n  private calculateConsistencyScore(workouts: (Workout & { exercises: WorkoutExercise[] })[]): number {\n    if (workouts.length < 2) return 100;\n\n    // Calculate variance in completion rates\n    const completionRates = workouts.map(w => w.completionRate || 100);\n    const mean = completionRates.reduce((sum, rate) => sum + rate, 0) / completionRates.length;\n    const variance = completionRates.reduce((sum, rate) => sum + Math.pow(rate - mean, 2), 0) / completionRates.length;\n    \n    // Convert variance to consistency score (lower variance = higher consistency)\n    const consistencyScore = Math.max(0, Math.min(100, 100 - (variance / 10)));\n    return Math.round(consistencyScore);\n  }\n\n  /**\n   * Calculates confidence score for AI recommendation\n   */\n  private calculateConfidenceScore(workouts: (Workout & { exercises: WorkoutExercise[] })[]): number {\n    let score = 50; // Base score\n    \n    // More workouts = higher confidence\n    score += Math.min(30, workouts.length * 3);\n    \n    // Recent data = higher confidence\n    const daysSinceLastWorkout = (Date.now() - new Date(workouts[0].date).getTime()) / (1000 * 60 * 60 * 24);\n    if (daysSinceLastWorkout <= 7) score += 15;\n    else if (daysSinceLastWorkout <= 14) score += 10;\n    \n    // Consistent data = higher confidence\n    const consistency = this.calculateConsistencyScore(workouts);\n    score += consistency * 0.05;\n    \n    return Math.min(100, Math.max(10, Math.round(score)));\n  }\n\n  /**\n   * Stores the difficulty adjustment suggestion in the database\n   */\n  private async storeDifficultyAdjustment(analysis: PerformanceAnalysis): Promise<void> {\n    const adjustment: InsertAiDifficultyAdjustment = {\n      userId: analysis.userId,\n      exerciseId: analysis.exerciseId,\n      currentDifficulty: analysis.currentDifficulty,\n      suggestedDifficulty: analysis.suggestedDifficulty,\n      confidenceScore: analysis.confidenceScore,\n      reasoningFactors: analysis.reasoningFactors,\n      performanceTrend: analysis.performanceTrend,\n      applied: false\n    };\n\n    await storage.createAiDifficultyAdjustment(adjustment);\n  }\n\n  /**\n   * Gets pending difficulty adjustments for a user\n   */\n  async getPendingAdjustments(userId: string): Promise<AiDifficultyAdjustment[]> {\n    return await storage.getPendingAiAdjustments(userId);\n  }\n\n  /**\n   * Applies a difficulty adjustment suggestion\n   */\n  async applyDifficultyAdjustment(adjustmentId: string): Promise<boolean> {\n    try {\n      await storage.applyAiDifficultyAdjustment(adjustmentId);\n      return true;\n    } catch (error) {\n      console.error('Error applying difficulty adjustment:', error);\n      return false;\n    }\n  }\n}\n\nexport const aiDifficultyService = new AiDifficultyService();","size_bytes":8637},"client/src/components/ui/select.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as SelectPrimitive from \"@radix-ui/react-select\"\nimport { Check, ChevronDown, ChevronUp } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Select = SelectPrimitive.Root\n\nconst SelectGroup = SelectPrimitive.Group\n\nconst SelectValue = SelectPrimitive.Value\n\nconst SelectTrigger = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Trigger>\n>(({ className, children, ...props }, ref) => (\n  <SelectPrimitive.Trigger\n    ref={ref}\n    className={cn(\n      \"flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background data-[placeholder]:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <SelectPrimitive.Icon asChild>\n      <ChevronDown className=\"h-4 w-4 opacity-50\" />\n    </SelectPrimitive.Icon>\n  </SelectPrimitive.Trigger>\n))\nSelectTrigger.displayName = SelectPrimitive.Trigger.displayName\n\nconst SelectScrollUpButton = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.ScrollUpButton>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.ScrollUpButton>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.ScrollUpButton\n    ref={ref}\n    className={cn(\n      \"flex cursor-default items-center justify-center py-1\",\n      className\n    )}\n    {...props}\n  >\n    <ChevronUp className=\"h-4 w-4\" />\n  </SelectPrimitive.ScrollUpButton>\n))\nSelectScrollUpButton.displayName = SelectPrimitive.ScrollUpButton.displayName\n\nconst SelectScrollDownButton = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.ScrollDownButton>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.ScrollDownButton>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.ScrollDownButton\n    ref={ref}\n    className={cn(\n      \"flex cursor-default items-center justify-center py-1\",\n      className\n    )}\n    {...props}\n  >\n    <ChevronDown className=\"h-4 w-4\" />\n  </SelectPrimitive.ScrollDownButton>\n))\nSelectScrollDownButton.displayName =\n  SelectPrimitive.ScrollDownButton.displayName\n\nconst SelectContent = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Content>\n>(({ className, children, position = \"popper\", ...props }, ref) => (\n  <SelectPrimitive.Portal>\n    <SelectPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"relative z-50 max-h-[--radix-select-content-available-height] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-select-content-transform-origin]\",\n        position === \"popper\" &&\n          \"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1\",\n        className\n      )}\n      position={position}\n      {...props}\n    >\n      <SelectScrollUpButton />\n      <SelectPrimitive.Viewport\n        className={cn(\n          \"p-1\",\n          position === \"popper\" &&\n            \"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]\"\n        )}\n      >\n        {children}\n      </SelectPrimitive.Viewport>\n      <SelectScrollDownButton />\n    </SelectPrimitive.Content>\n  </SelectPrimitive.Portal>\n))\nSelectContent.displayName = SelectPrimitive.Content.displayName\n\nconst SelectLabel = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Label>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.Label\n    ref={ref}\n    className={cn(\"py-1.5 pl-8 pr-2 text-sm font-semibold\", className)}\n    {...props}\n  />\n))\nSelectLabel.displayName = SelectPrimitive.Label.displayName\n\nconst SelectItem = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Item>\n>(({ className, children, ...props }, ref) => (\n  <SelectPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <SelectPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </SelectPrimitive.ItemIndicator>\n    </span>\n\n    <SelectPrimitive.ItemText>{children}</SelectPrimitive.ItemText>\n  </SelectPrimitive.Item>\n))\nSelectItem.displayName = SelectPrimitive.Item.displayName\n\nconst SelectSeparator = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-muted\", className)}\n    {...props}\n  />\n))\nSelectSeparator.displayName = SelectPrimitive.Separator.displayName\n\nexport {\n  Select,\n  SelectGroup,\n  SelectValue,\n  SelectTrigger,\n  SelectContent,\n  SelectLabel,\n  SelectItem,\n  SelectSeparator,\n  SelectScrollUpButton,\n  SelectScrollDownButton,\n}\n","size_bytes":5742},"server/auth-middleware.ts":{"content":"import { Request, Response, NextFunction } from \"express\";\nimport { authService } from \"./auth-service\";\n\n// Extend Express Request type to include user\ndeclare global {\n  namespace Express {\n    interface Request {\n      user?: {\n        id: string;\n        email: string | null;\n        username: string | null;\n        firstName: string | null;\n        lastName: string | null;\n        profileImageUrl: string | null;\n        authProvider: string | null;\n        isEmailVerified: boolean | null;\n      };\n    }\n  }\n}\n\n/**\n * Middleware to authenticate JWT tokens (supports both Bearer header and httpOnly cookies)\n */\nexport const authenticateToken = async (req: Request, res: Response, next: NextFunction) => {\n  try {\n    // Try to get token from Authorization header first, then from cookies\n    const authHeader = req.headers.authorization;\n    const headerToken = authHeader && authHeader.split(' ')[1]; // Bearer TOKEN\n    const cookieToken = req.cookies && req.cookies['auth-token'];\n    \n    const token = headerToken || cookieToken;\n\n    if (!token) {\n      return res.status(401).json({ message: \"Access token required\" });\n    }\n\n    // Verify token and get user data\n    const user = await authService.getUserByToken(token);\n    \n    if (!user) {\n      return res.status(401).json({ message: \"Invalid or expired token\" });\n    }\n\n    // Add user to request object\n    req.user = user;\n    next();\n  } catch (error) {\n    console.error(\"Token verification error:\", error);\n    return res.status(401).json({ message: \"Unauthorized\" });\n  }\n};\n\n/**\n * Middleware to optionally authenticate JWT tokens (doesn't fail if no token)\n */\nexport const optionalAuth = async (req: Request, res: Response, next: NextFunction) => {\n  try {\n    // Try to get token from Authorization header first, then from cookies\n    const authHeader = req.headers.authorization;\n    const headerToken = authHeader && authHeader.split(' ')[1]; // Bearer TOKEN\n    const cookieToken = req.cookies && req.cookies['auth-token'];\n    \n    const token = headerToken || cookieToken;\n\n    if (token) {\n      // Try to verify token and get user data\n      const user = await authService.getUserByToken(token);\n      if (user) {\n        req.user = user;\n      }\n    }\n    \n    // Continue regardless of token verification result\n    next();\n  } catch (error) {\n    // Continue without authentication if token verification fails\n    next();\n  }\n};\n\n/**\n * Utility function to get current user ID from request\n */\nexport const getCurrentUserId = (req: Request): string | null => {\n  return req.user?.id || null;\n};\n\n/**\n * Utility function to get current user from request\n */\nexport const getCurrentUser = (req: Request) => {\n  return req.user || null;\n};","size_bytes":2731},"client/src/components/ui/separator.tsx":{"content":"import * as React from \"react\"\nimport * as SeparatorPrimitive from \"@radix-ui/react-separator\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Separator = React.forwardRef<\n  React.ElementRef<typeof SeparatorPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof SeparatorPrimitive.Root>\n>(\n  (\n    { className, orientation = \"horizontal\", decorative = true, ...props },\n    ref\n  ) => (\n    <SeparatorPrimitive.Root\n      ref={ref}\n      decorative={decorative}\n      orientation={orientation}\n      className={cn(\n        \"shrink-0 bg-border\",\n        orientation === \"horizontal\" ? \"h-[1px] w-full\" : \"h-full w-[1px]\",\n        className\n      )}\n      {...props}\n    />\n  )\n)\nSeparator.displayName = SeparatorPrimitive.Root.displayName\n\nexport { Separator }\n","size_bytes":756},"client/src/components/feature-gate.tsx":{"content":"import { Lock, Crown, Calendar, Zap } from \"lucide-react\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Link } from \"wouter\";\nimport { useNewAuth } from \"@/hooks/useNewAuth\";\n\ninterface FeatureGateProps {\n  feature: 'workout_planner' | 'mile_tracker' | 'meal_plans' | 'meal_tracker' | 'progress_photos';\n  children: React.ReactNode;\n  fallback?: React.ReactNode;\n}\n\nconst FEATURE_INFO = {\n  workout_planner: {\n    name: \"AI Workout Planner\",\n    description: \"Get personalized workout plans tailored to your fitness level and goals\",\n    icon: <Zap className=\"w-5 h-5\" />\n  },\n  mile_tracker: {\n    name: \"Mile Tracker\",\n    description: \"Track your running progress with detailed split times and performance analytics\",\n    icon: <Calendar className=\"w-5 h-5\" />\n  },\n  meal_plans: {\n    name: \"AI Meal Plans\",\n    description: \"Generate customized meal plans based on your dietary preferences and goals\",\n    icon: <Crown className=\"w-5 h-5\" />\n  },\n  meal_tracker: {\n    name: \"Professional Barcode Scanner\",\n    description: \"Log and analyze your meals with AI-powered nutrition tracking\",\n    icon: <Crown className=\"w-5 h-5\" />\n  },\n  progress_photos: {\n    name: \"Progress Photos\",\n    description: \"Track your physical transformation with before/after photo comparisons\",\n    icon: <Camera className=\"w-5 h-5\" />\n  }\n} as const;\n\nfunction Camera({ className }: { className?: string }) {\n  return (\n    <svg className={className} fill=\"none\" viewBox=\"0 0 24 24\" stroke=\"currentColor\">\n      <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z\" />\n      <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M15 13a3 3 0 11-6 0 3 3 0 016 0z\" />\n    </svg>\n  );\n}\n\n// Premium-only features that require active subscription (no trial access)\nconst PREMIUM_ONLY_FEATURES = ['workout_planner', 'meal_tracker'];\n\nexport default function FeatureGate({ feature, children, fallback }: FeatureGateProps) {\n  const { user } = useNewAuth();\n\n  // Check if user has access to the feature\n  const hasAccess = (() => {\n    if (!user) return false;\n    \n    // Active premium subscription has access to everything\n    if (user.subscriptionStatus === \"active\") return true;\n    \n    // Check if feature is premium-only (requires subscription, no trial access)\n    if (PREMIUM_ONLY_FEATURES.includes(feature)) return false;\n    \n    // For non-premium-only features, free trial users have access if trial hasn't expired\n    if (user.subscriptionStatus === \"free_trial\") {\n      if (!user.trialEndDate) return false;\n      const trialEndDate = new Date(user.trialEndDate);\n      const now = new Date();\n      return now <= trialEndDate;\n    }\n    \n    // All other statuses (expired, inactive, etc.) don't have access\n    return false;\n  })();\n\n  // Calculate remaining trial days\n  const trialDaysRemaining = (() => {\n    if (!user?.trialEndDate || user.subscriptionStatus !== \"free_trial\") return 0;\n    const trialEndDate = new Date(user.trialEndDate);\n    const now = new Date();\n    const diffTime = trialEndDate.getTime() - now.getTime();\n    const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));\n    return Math.max(0, diffDays);\n  })();\n\n  // If user has access, render children normally\n  if (hasAccess) {\n    return <>{children}</>;\n  }\n\n  // If custom fallback is provided, use it\n  if (fallback) {\n    return <>{fallback}</>;\n  }\n\n  // Default locked feature UI - Full screen lock page\n  const featureInfo = FEATURE_INFO[feature];\n  const isTrialUser = user?.subscriptionStatus === \"free_trial\";\n  const isExpired = user?.subscriptionStatus === \"expired\";\n  const isPremiumOnly = PREMIUM_ONLY_FEATURES.includes(feature);\n\n  return (\n    <div className=\"fixed inset-0 z-50 bg-black/95 flex items-center justify-center p-4\" data-testid={`feature-gate-${feature}`}>\n      {/* Animated lock icon background */}\n      <div className=\"absolute inset-0 overflow-hidden pointer-events-none\">\n        <div className=\"absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-96 h-96 opacity-5\">\n          <Lock className=\"w-full h-full text-red-500 animate-pulse\" />\n        </div>\n      </div>\n\n      {/* Lock Page Content */}\n      <div className=\"relative w-full max-w-2xl\">\n        <Card className=\"bg-gradient-to-br from-gray-900 to-black border-2 border-red-500/30 shadow-2xl shadow-red-500/20\">\n          <CardHeader className=\"text-center pb-6\">\n            {/* Lock Icon */}\n            <div className=\"mx-auto w-24 h-24 bg-gradient-to-r from-red-500 to-red-700 rounded-full flex items-center justify-center mb-6 animate-bounce\">\n              <Lock className=\"w-12 h-12 text-white\" />\n            </div>\n\n            {/* Feature Title */}\n            <CardTitle className=\"flex items-center gap-3 justify-center text-3xl text-white mb-3\">\n              {featureInfo.icon}\n              {featureInfo.name}\n            </CardTitle>\n            \n            <CardDescription className=\"text-lg text-gray-300\">\n              {featureInfo.description}\n            </CardDescription>\n          </CardHeader>\n          \n          <CardContent className=\"space-y-6\">\n            {/* Subscription Status Message */}\n            {isPremiumOnly && isTrialUser && (\n              <div className=\"text-center p-6 bg-gradient-to-r from-purple-900/50 to-red-900/50 rounded-xl border-2 border-purple-500/50\">\n                <Badge className=\"mb-3 bg-purple-600 hover:bg-purple-700 text-white px-4 py-2 text-base\">\n                  <Crown className=\"w-4 h-4 mr-2\" />\n                  Premium Subscription Required\n                </Badge>\n                <p className=\"text-xl font-bold text-white mb-2\">\n                  This Feature Requires an Active Subscription\n                </p>\n                <p className=\"text-base text-gray-300\">\n                  {featureInfo.name} is a premium-only feature. Subscribe now to unlock this and other exclusive features.\n                </p>\n              </div>\n            )}\n\n            {isExpired && (\n              <div className=\"text-center p-6 bg-gradient-to-r from-red-900/50 to-orange-900/50 rounded-xl border-2 border-red-500/50\">\n                <Badge className=\"mb-3 bg-red-600 hover:bg-red-700 text-white px-4 py-2 text-base\">\n                  <Lock className=\"w-4 h-4 mr-2\" />\n                  Subscription Expired\n                </Badge>\n                <p className=\"text-xl font-bold text-white mb-2\">\n                  Your Premium Access Has Ended\n                </p>\n                <p className=\"text-base text-gray-300\">\n                  Renew your subscription to continue using {featureInfo.name} and all other premium features.\n                </p>\n              </div>\n            )}\n\n            {!isPremiumOnly && isTrialUser && trialDaysRemaining > 0 && (\n              <div className=\"text-center p-6 bg-gradient-to-r from-amber-900/50 to-orange-900/50 rounded-xl border-2 border-amber-500/50\">\n                <Badge className=\"mb-3 bg-amber-600 hover:bg-amber-700 text-white px-4 py-2 text-base\">\n                  <Calendar className=\"w-4 h-4 mr-2\" />\n                  Trial Ending Soon\n                </Badge>\n                <p className=\"text-xl font-bold text-white mb-2\">\n                  {trialDaysRemaining} {trialDaysRemaining === 1 ? 'Day' : 'Days'} Left in Your Trial\n                </p>\n                <p className=\"text-base text-gray-300\">\n                  Upgrade now to keep using premium features after your trial expires!\n                </p>\n              </div>\n            )}\n\n            {!isPremiumOnly && isTrialUser && trialDaysRemaining === 0 && (\n              <div className=\"text-center p-6 bg-gradient-to-r from-red-900/50 to-orange-900/50 rounded-xl border-2 border-red-500/50\">\n                <Badge className=\"mb-3 bg-red-600 hover:bg-red-700 text-white px-4 py-2 text-base\">\n                  <Lock className=\"w-4 h-4 mr-2\" />\n                  Trial Expired\n                </Badge>\n                <p className=\"text-xl font-bold text-white mb-2\">\n                  Your Free Trial Has Ended\n                </p>\n                <p className=\"text-base text-gray-300\">\n                  Upgrade to premium to continue using {featureInfo.name} and all advanced features.\n                </p>\n              </div>\n            )}\n\n            {!isPremiumOnly && !isTrialUser && !isExpired && (\n              <div className=\"text-center p-6 bg-gradient-to-r from-purple-900/50 to-blue-900/50 rounded-xl border-2 border-purple-500/50\">\n                <Badge className=\"mb-3 bg-purple-600 hover:bg-purple-700 text-white px-4 py-2 text-base\">\n                  <Crown className=\"w-4 h-4 mr-2\" />\n                  Premium Feature\n                </Badge>\n                <p className=\"text-xl font-bold text-white mb-2\">\n                  This Feature Requires Premium Access\n                </p>\n                <p className=\"text-base text-gray-300\">\n                  Upgrade to unlock {featureInfo.name} and all other premium features.\n                </p>\n              </div>\n            )}\n\n            {/* Upgrade Buttons */}\n            <div className=\"flex flex-col gap-4 pt-4\">\n              <Button\n                asChild\n                size=\"lg\"\n                className=\"w-full bg-gradient-to-r from-red-600 to-red-700 hover:from-red-700 hover:to-red-800 text-white font-bold py-6 text-lg shadow-lg shadow-red-500/50 border-2 border-red-500/50\"\n                data-testid=\"upgrade-to-premium\"\n              >\n                <Link href=\"/subscription\">\n                  <Crown className=\"w-5 h-5 mr-3\" />\n                  {isExpired ? \"Renew Premium Subscription\" : \"Upgrade to Premium Now\"}\n                </Link>\n              </Button>\n              \n              <Button\n                asChild\n                variant=\"outline\"\n                size=\"lg\"\n                className=\"w-full border-2 border-gray-600 text-white hover:bg-gray-800 hover:text-white py-6 text-lg\"\n                data-testid=\"learn-more-premium\"\n              >\n                <Link href=\"/subscription\">\n                  View Premium Features & Pricing\n                </Link>\n              </Button>\n            </div>\n\n            {/* Premium Benefits */}\n            <div className=\"text-center pt-4 border-t border-gray-700\">\n              <p className=\"text-sm text-gray-400 mb-3\">\n                Premium includes:\n              </p>\n              <div className=\"flex flex-wrap gap-2 justify-center\">\n                <Badge variant=\"secondary\" className=\"bg-gray-800 text-gray-300\">AI Workout Plans</Badge>\n                <Badge variant=\"secondary\" className=\"bg-gray-800 text-gray-300\">Mile Tracker</Badge>\n                <Badge variant=\"secondary\" className=\"bg-gray-800 text-gray-300\">Meal Planning</Badge>\n                <Badge variant=\"secondary\" className=\"bg-gray-800 text-gray-300\">Meal Tracking</Badge>\n                <Badge variant=\"secondary\" className=\"bg-gray-800 text-gray-300\">Priority Support</Badge>\n              </div>\n            </div>\n          </CardContent>\n        </Card>\n      </div>\n    </div>\n  );\n}","size_bytes":11421},"client/src/components/goals-widget.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery, useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport { Trophy, Plus, Edit2, Trash2 } from \"lucide-react\";\nimport { Progress } from \"@/components/ui/progress\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport {\n  Dialog,\n  DialogContent,\n  DialogDescription,\n  DialogFooter,\n  DialogHeader,\n  DialogTitle,\n  DialogTrigger,\n} from \"@/components/ui/dialog\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport type { Goal, InsertGoal } from \"@shared/schema\";\n\nexport default function GoalsWidget() {\n  const [isEditDialogOpen, setIsEditDialogOpen] = useState(false);\n  const [editingGoal, setEditingGoal] = useState<Goal | null>(null);\n  const [goalType, setGoalType] = useState<string>(\"workouts\");\n  const [goalTarget, setGoalTarget] = useState<string>(\"5\");\n  \n  const queryClient = useQueryClient();\n  \n  const { data: goals, isLoading } = useQuery<Goal[]>({\n    queryKey: [\"/api/goals\"],\n  });\n  \n  // Get user stats to calculate current progress\n  const { data: userStats } = useQuery<{totalWorkouts: number, totalHours: number, caloriesBurned: number}>({\n    queryKey: [\"/api/stats\"],\n  });\n  \n  // Mutation for creating goals\n  const createGoalMutation = useMutation({\n    mutationFn: async (goal: Omit<InsertGoal, 'userId'>) => {\n      const response = await apiRequest(\"POST\", \"/api/goals\", goal);\n      return response.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/goals\"] });\n      setIsEditDialogOpen(false);\n      setGoalType(\"workouts\");\n      setGoalTarget(\"5\");\n    },\n  });\n  \n  // Mutation for updating goals  \n  const updateGoalMutation = useMutation({\n    mutationFn: async ({ id, ...goal }: Partial<Goal> & { id: string }) => {\n      const response = await apiRequest(\"PATCH\", `/api/goals/${id}`, goal);\n      return response.json();\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/goals\"] });\n      setIsEditDialogOpen(false);\n      setEditingGoal(null);\n    },\n  });\n  \n  // Mutation for deleting goals\n  const deleteGoalMutation = useMutation({\n    mutationFn: async (id: string) => {\n      const response = await apiRequest(\"DELETE\", `/api/goals/${id}`);\n      return response;\n    },\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: [\"/api/goals\"] });\n    },\n  });\n\n  if (isLoading) {\n    return (\n      <section className=\"relative bg-gradient-to-br from-black via-red-900/30 to-black rounded-3xl shadow-2xl border border-red-600/50 p-8 overflow-hidden hexagon-bg hexagon-pattern\">\n        {/* Animated red and black background elements */}\n        <div className=\"absolute inset-0\">\n          {/* Floating red hexagons */}\n          <div className=\"absolute top-0 left-0 w-32 h-28 opacity-30 animate-pulse\" style={{animationDuration: '4s'}}>\n            <svg viewBox=\"0 0 120 104\" className=\"w-full h-full\">\n              <polygon points=\"30,2 90,2 120,52 90,102 30,102 0,52\" fill=\"#dc2626\" stroke=\"#dc2626\" strokeWidth=\"2\" opacity=\"0.6\"/>\n            </svg>\n          </div>\n          <div className=\"absolute top-1/4 right-0 w-24 h-21 opacity-20 animate-bounce\" style={{animationDuration: '6s'}}>\n            <svg viewBox=\"0 0 120 104\" className=\"w-full h-full\">\n              <polygon points=\"30,2 90,2 120,52 90,102 30,102 0,52\" fill=\"none\" stroke=\"#dc2626\" strokeWidth=\"2\" opacity=\"0.8\"/>\n            </svg>\n          </div>\n          <div className=\"absolute bottom-0 left-1/3 w-28 h-24 opacity-25 animate-ping\" style={{animationDuration: '8s', animationDelay: '1s'}}>\n            <svg viewBox=\"0 0 120 104\" className=\"w-full h-full\">\n              <polygon points=\"30,2 90,2 120,52 90,102 30,102 0,52\" fill=\"#000000\" stroke=\"#dc2626\" strokeWidth=\"1\" opacity=\"0.7\"/>\n            </svg>\n          </div>\n          <div className=\"absolute bottom-1/4 right-1/4 w-20 h-17 opacity-15 animate-pulse\" style={{animationDuration: '5s', animationDelay: '2s'}}>\n            <svg viewBox=\"0 0 120 104\" className=\"w-full h-full\">\n              <polygon points=\"30,2 90,2 120,52 90,102 30,102 0,52\" fill=\"#dc2626\" stroke=\"#000000\" strokeWidth=\"1\" opacity=\"0.5\"/>\n            </svg>\n          </div>\n          <div className=\"absolute top-1/2 left-10 w-22 h-19 opacity-20 animate-bounce\" style={{animationDuration: '7s', animationDelay: '0.5s'}}>\n            <svg viewBox=\"0 0 120 104\" className=\"w-full h-full\">\n              <polygon points=\"30,2 90,2 120,52 90,102 30,102 0,52\" fill=\"none\" stroke=\"#dc2626\" strokeWidth=\"2\" opacity=\"0.4\"/>\n            </svg>\n          </div>\n          \n          {/* Animated red gradient orbs */}\n          <div className=\"absolute top-1/3 right-1/3 w-40 h-40 bg-gradient-to-br from-red-600/20 to-black/40 rounded-full blur-3xl opacity-30 animate-pulse\" style={{animationDuration: '6s'}}></div>\n          <div className=\"absolute bottom-1/3 left-1/4 w-32 h-32 bg-gradient-to-br from-black/60 to-red-600/20 rounded-full blur-2xl opacity-20 animate-ping\" style={{animationDuration: '10s'}}></div>\n          <div className=\"absolute top-1/2 left-1/3 w-28 h-28 bg-gradient-to-br from-emerald-400 to-cyan-500 rounded-full blur-3xl opacity-10 animate-ping\" style={{animationDuration: '4s'}}></div>\n        </div>\n        {/* Content wrapper */}\n        <div className=\"relative z-10\">\n        <div className=\"flex items-center justify-between mb-6\">\n          <h3 className=\"text-2xl font-bold text-white drop-shadow-lg\">Weekly Goals</h3>\n        </div>\n        <div className=\"space-y-4\">\n          {[...Array(3)].map((_, i) => (\n            <div key={i} className=\"animate-pulse\">\n              <div className=\"flex items-center justify-between mb-2\">\n                <div className=\"h-4 bg-gray-200 rounded w-20\"></div>\n                <div className=\"h-4 bg-gray-200 rounded w-12\"></div>\n              </div>\n              <div className=\"w-full bg-gray-200 rounded-full h-2\"></div>\n            </div>\n          ))}\n        </div>\n        </div>\n      </section>\n    );\n  }\n\n  // Calculate current progress based on user stats\n  const getCurrentProgress = (type: string) => {\n    if (!userStats) return 0;\n    \n    switch (type) {\n      case \"workouts\":\n        return userStats.totalWorkouts || 0;\n      case \"minutes\":\n        return (userStats.totalHours || 0) * 60; // Convert hours back to minutes\n      case \"calories\":\n        return userStats.caloriesBurned || 0;\n      default:\n        return 0;\n    }\n  };\n  \n  // Update goals with real progress data from user's actual workouts\n  const displayGoals = goals && goals.length > 0 \n    ? goals.map(goal => ({\n        ...goal,\n        current: getCurrentProgress(goal.type)\n      }))\n    : [];\n    \n  // Initialize default goals for new users\n  const initializeDefaultGoals = async () => {\n    const defaultGoalTypes = [\n      { type: \"workouts\", target: 5 },\n      { type: \"minutes\", target: 200 },\n      { type: \"calories\", target: 1500 },\n    ];\n    \n    for (const defaultGoal of defaultGoalTypes) {\n      await createGoalMutation.mutateAsync({\n        type: defaultGoal.type,\n        target: defaultGoal.target,\n        current: 0,\n        period: \"weekly\",\n        isActive: true\n      });\n    }\n  };\n\n  const getGoalLabel = (type: string) => {\n    switch (type) {\n      case \"workouts\": return \"Workouts\";\n      case \"minutes\": return \"Active Minutes\";\n      case \"calories\": return \"Calories Burned\";\n      default: return type;\n    }\n  };\n\n  const getGoalColor = (type: string) => {\n    switch (type) {\n      case \"workouts\": return \"primary\";\n      case \"minutes\": return \"secondary\";\n      case \"calories\": return \"accent\";\n      default: return \"primary\";\n    }\n  };\n\n  const calculateProgress = (current: number, target: number) => {\n    return Math.min(Math.round((current / target) * 100), 100);\n  };\n\n  const isOnTrack = displayGoals.length > 0 && displayGoals.some(goal => calculateProgress(goal.current, goal.target) >= 80);\n  \n  const handleEditGoal = (goal?: Goal) => {\n    if (goal) {\n      setEditingGoal(goal);\n      setGoalType(goal.type);\n      setGoalTarget(goal.target.toString());\n    } else {\n      setEditingGoal(null);\n      setGoalType(\"workouts\");\n      setGoalTarget(\"5\");\n    }\n    setIsEditDialogOpen(true);\n  };\n  \n  const handleSaveGoal = () => {\n    const target = parseInt(goalTarget);\n    if (isNaN(target) || target <= 0) return;\n    \n    if (editingGoal) {\n      updateGoalMutation.mutate({\n        id: editingGoal.id,\n        target,\n        type: goalType,\n      });\n    } else {\n      createGoalMutation.mutate({\n        type: goalType,\n        target,\n        current: 0,\n        period: \"weekly\",\n        isActive: true\n      });\n    }\n  };\n\n  return (\n    <section className=\"relative bg-gradient-to-br from-black via-red-900/30 to-black rounded-3xl shadow-2xl border border-red-600/50 p-8 overflow-hidden hexagon-bg hexagon-pattern\">\n      {/* Animated red and black background elements */}\n      <div className=\"absolute inset-0\">\n        {/* Floating red hexagons */}\n        <div className=\"absolute top-0 left-0 w-32 h-28 opacity-30 animate-pulse\" style={{animationDuration: '4s'}}>\n          <svg viewBox=\"0 0 120 104\" className=\"w-full h-full\">\n            <polygon points=\"30,2 90,2 120,52 90,102 30,102 0,52\" fill=\"#dc2626\" stroke=\"#dc2626\" strokeWidth=\"2\" opacity=\"0.6\"/>\n          </svg>\n        </div>\n        <div className=\"absolute top-1/4 right-0 w-24 h-21 opacity-20 animate-bounce\" style={{animationDuration: '6s'}}>\n          <svg viewBox=\"0 0 120 104\" className=\"w-full h-full\">\n            <polygon points=\"30,2 90,2 120,52 90,102 30,102 0,52\" fill=\"none\" stroke=\"#dc2626\" strokeWidth=\"2\" opacity=\"0.8\"/>\n          </svg>\n        </div>\n        <div className=\"absolute bottom-0 left-1/3 w-28 h-24 opacity-25 animate-ping\" style={{animationDuration: '8s', animationDelay: '1s'}}>\n          <svg viewBox=\"0 0 120 104\" className=\"w-full h-full\">\n            <polygon points=\"30,2 90,2 120,52 90,102 30,102 0,52\" fill=\"#000000\" stroke=\"#dc2626\" strokeWidth=\"1\" opacity=\"0.7\"/>\n          </svg>\n        </div>\n        <div className=\"absolute bottom-1/4 right-1/4 w-20 h-17 opacity-15 animate-pulse\" style={{animationDuration: '5s', animationDelay: '2s'}}>\n          <svg viewBox=\"0 0 120 104\" className=\"w-full h-full\">\n            <polygon points=\"30,2 90,2 120,52 90,102 30,102 0,52\" fill=\"#dc2626\" stroke=\"#000000\" strokeWidth=\"1\" opacity=\"0.5\"/>\n          </svg>\n        </div>\n        <div className=\"absolute top-1/2 left-10 w-22 h-19 opacity-20 animate-bounce\" style={{animationDuration: '7s', animationDelay: '0.5s'}}>\n          <svg viewBox=\"0 0 120 104\" className=\"w-full h-full\">\n            <polygon points=\"30,2 90,2 120,52 90,102 30,102 0,52\" fill=\"none\" stroke=\"#dc2626\" strokeWidth=\"2\" opacity=\"0.4\"/>\n          </svg>\n        </div>\n        \n        {/* Animated red gradient orbs */}\n        <div className=\"absolute top-1/3 right-1/3 w-40 h-40 bg-gradient-to-br from-red-600/20 to-black/40 rounded-full blur-3xl opacity-30 animate-pulse\" style={{animationDuration: '6s'}}></div>\n        <div className=\"absolute bottom-1/3 left-1/4 w-32 h-32 bg-gradient-to-br from-black/60 to-red-600/20 rounded-full blur-2xl opacity-20 animate-ping\" style={{animationDuration: '10s'}}></div>\n        \n        {/* Dynamic radial gradient overlay */}\n        <div className=\"absolute inset-0 bg-gradient-radial from-transparent via-red-900/10 to-black/60 animate-pulse\" style={{animationDuration: '8s'}}></div>\n      </div>\n      {/* Content wrapper */}\n      <div className=\"relative z-10\">\n      <div className=\"flex items-center justify-between mb-6\">\n        <h3 className=\"text-2xl font-bold text-white drop-shadow-lg\">Weekly Goals</h3>\n        <div className=\"flex gap-2\">\n          {displayGoals.length === 0 && (\n            <Button \n              size=\"sm\" \n              variant=\"outline\"\n              onClick={initializeDefaultGoals}\n              disabled={createGoalMutation.isPending}\n            >\n              <Plus className=\"w-4 h-4 mr-1\" />\n              Setup Goals\n            </Button>\n          )}\n          <Dialog open={isEditDialogOpen} onOpenChange={setIsEditDialogOpen}>\n            <DialogTrigger asChild>\n              <Button \n                size=\"sm\" \n                variant=\"ghost\" \n                onClick={() => handleEditGoal()}\n                className=\"text-primary hover:text-primary/80\"\n              >\n                <Edit2 className=\"w-4 h-4 mr-1\" />\n                {displayGoals.length > 0 ? 'Edit' : 'Add Goal'}\n              </Button>\n            </DialogTrigger>\n            <DialogContent className=\"sm:max-w-[425px]\">\n              <DialogHeader>\n                <DialogTitle>\n                  {editingGoal ? 'Edit Goal' : 'Add New Goal'}\n                </DialogTitle>\n                <DialogDescription>\n                  Set your weekly fitness target to stay motivated and track progress.\n                </DialogDescription>\n              </DialogHeader>\n              <div className=\"grid gap-4 py-4\">\n                <div className=\"grid grid-cols-4 items-center gap-4\">\n                  <Label htmlFor=\"goal-type\" className=\"text-right\">\n                    Type\n                  </Label>\n                  <Select value={goalType} onValueChange={setGoalType}>\n                    <SelectTrigger className=\"col-span-3\">\n                      <SelectValue placeholder=\"Select goal type\" />\n                    </SelectTrigger>\n                    <SelectContent>\n                      <SelectItem value=\"workouts\">Workouts</SelectItem>\n                      <SelectItem value=\"minutes\">Active Minutes</SelectItem>\n                      <SelectItem value=\"calories\">Calories Burned</SelectItem>\n                    </SelectContent>\n                  </Select>\n                </div>\n                <div className=\"grid grid-cols-4 items-center gap-4\">\n                  <Label htmlFor=\"goal-target\" className=\"text-right\">\n                    Target\n                  </Label>\n                  <Input\n                    id=\"goal-target\"\n                    type=\"number\"\n                    value={goalTarget}\n                    onChange={(e) => setGoalTarget(e.target.value)}\n                    className=\"col-span-3\"\n                    placeholder=\"e.g., 5 workouts\"\n                  />\n                </div>\n              </div>\n              <DialogFooter>\n                <Button \n                  type=\"submit\" \n                  onClick={handleSaveGoal}\n                  disabled={createGoalMutation.isPending || updateGoalMutation.isPending}\n                >\n                  {editingGoal ? 'Update Goal' : 'Create Goal'}\n                </Button>\n              </DialogFooter>\n            </DialogContent>\n          </Dialog>\n        </div>\n      </div>\n\n      {displayGoals.length === 0 ? (\n        <div className=\"text-center py-8 text-gray-500\">\n          <Trophy className=\"mx-auto h-12 w-12 text-gray-300 mb-4\" />\n          <p className=\"text-lg font-medium mb-2\">No goals set yet</p>\n          <p className=\"text-sm mb-4\">Set up your weekly fitness goals to track your progress!</p>\n        </div>\n      ) : (\n        <div className=\"space-y-4\">\n          {displayGoals.map((goal) => {\n            const progress = calculateProgress(goal.current, goal.target);\n            const colorClass = getGoalColor(goal.type);\n\n            return (\n              <div key={goal.id} className=\"group\">\n                <div className=\"flex items-center justify-between mb-2\">\n                  <span className=\"text-sm font-medium text-gray-800\">\n                    {getGoalLabel(goal.type)}\n                  </span>\n                  <div className=\"flex items-center gap-2\">\n                    <span className=\"text-sm text-muted\">\n                      {goal.current}/{goal.target}\n                    </span>\n                    <div className=\"flex items-center gap-1 opacity-0 group-hover:opacity-100 transition-opacity\">\n                      <Button\n                        size=\"sm\"\n                        variant=\"ghost\"\n                        className=\"p-1 h-6 w-6\"\n                        onClick={() => handleEditGoal(goal)}\n                        data-testid={`edit-goal-${goal.id}`}\n                      >\n                        <Edit2 className=\"w-3 h-3\" />\n                      </Button>\n                      <Button\n                        size=\"sm\"\n                        variant=\"ghost\"\n                        className=\"p-1 h-6 w-6 text-red-500 hover:text-red-700 hover:bg-red-50\"\n                        onClick={() => deleteGoalMutation.mutate(goal.id)}\n                        disabled={deleteGoalMutation.isPending}\n                        data-testid={`delete-goal-${goal.id}`}\n                      >\n                        <Trash2 className=\"w-3 h-3\" />\n                      </Button>\n                    </div>\n                  </div>\n                </div>\n                <Progress value={progress} className=\"h-2\" />\n                {progress >= 100 && (\n                  <div className=\"flex items-center mt-2 text-green-600\">\n                    <Trophy className=\"w-4 h-4 mr-1\" />\n                    <span className=\"text-xs font-medium\">Goal achieved!</span>\n                  </div>\n                )}\n              </div>\n            );\n          })}\n        </div>\n      )}\n\n      {isOnTrack && (\n        <div className=\"mt-6 p-4 bg-green-50 border border-green-200 rounded-xl\">\n          <div className=\"flex items-center space-x-3\">\n            <Trophy className=\"text-green-500 text-lg\" />\n            <div>\n              <p className=\"font-medium text-green-800\">Great progress!</p>\n              <p className=\"text-sm text-green-600\">You're on track to exceed your weekly goals.</p>\n            </div>\n          </div>\n        </div>\n      )}\n      </div>\n    </section>\n  );\n}\n","size_bytes":18078},"client/src/pages/auth.tsx":{"content":"import { useState } from \"react\";\nimport { useForm } from \"react-hook-form\";\nimport { zodResolver } from \"@hookform/resolvers/zod\";\nimport { useMutation } from \"@tanstack/react-query\";\nimport { Eye, EyeOff, User, Mail, Lock, Dumbbell } from \"lucide-react\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Label } from \"@/components/ui/label\";\nimport { useToast } from \"@/hooks/use-toast\";\nimport { apiRequest } from \"@/lib/queryClient\";\nimport { signUpSchema, signInSchema, type SignUpData, type SignInData } from \"@shared/schema\";\nimport { useNewAuth } from \"@/hooks/useNewAuth\";\nimport { useLocation } from \"wouter\";\nimport { z } from \"zod\";\n\ninterface AuthPageProps {\n  mode?: \"signin\" | \"signup\";\n}\n\nexport default function AuthPage({ mode = \"signup\" }: AuthPageProps) {\n  const [isSignIn, setIsSignIn] = useState(mode === \"signin\");\n  const [showPassword, setShowPassword] = useState(false);\n  const [isLoading, setIsLoading] = useState(false);\n  const { toast } = useToast();\n  const { signIn } = useNewAuth();\n  const [, setLocation] = useLocation();\n\n  // Sign up form\n  const signUpForm = useForm<SignUpData>({\n    resolver: zodResolver(signUpSchema),\n    defaultValues: {\n      username: \"\",\n      email: \"\",\n      password: \"\",\n      firstName: \"\",\n      lastName: \"\",\n    },\n  });\n\n  // Sign in form\n  const signInForm = useForm<SignInData>({\n    resolver: zodResolver(signInSchema),\n    defaultValues: {\n      identifier: \"\",\n      password: \"\",\n    },\n  });\n\n  // Sign up mutation\n  const signUpMutation = useMutation({\n    mutationFn: async (userData: SignUpData) => {\n      // Include personal plan data if available\n      const personalPlanData = localStorage.getItem('pendingPersonalPlan');\n      const signUpPayload = {\n        ...userData,\n        personalPlanData: personalPlanData ? JSON.parse(personalPlanData) : null\n      };\n      \n      const response = await apiRequest(\"POST\", \"/api/auth/signup\", signUpPayload);\n      return response.json();\n    },\n    onSuccess: (data) => {\n      // Clear the pending plan data after successful signup\n      localStorage.removeItem('pendingPersonalPlan');\n      \n      toast({\n        title: \"🎉 Welcome to FlexFlow!\",\n        description: \"Your account has been created successfully.\",\n      });\n      signIn(data.user, data.token);\n      \n      // Redirect new users to tutorial page\n      setTimeout(() => setLocation('/tutorial'), 100);\n    },\n    onError: (error: any) => {\n      const errorMessage = error.message || \"Failed to create account\";\n      toast({\n        title: \"Sign Up Failed\",\n        description: errorMessage,\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  // Sign in mutation\n  const signInMutation = useMutation({\n    mutationFn: async (credentials: SignInData) => {\n      const response = await apiRequest(\"POST\", \"/api/auth/signin\", credentials);\n      return response.json();\n    },\n    onSuccess: (data) => {\n      toast({\n        title: \"Welcome back!\",\n        description: \"You've been signed in successfully.\",\n      });\n      signIn(data.user, data.token);\n      // Small delay to ensure state updates before navigation\n      setTimeout(() => setLocation('/'), 100);\n    },\n    onError: (error: any) => {\n      const errorMessage = error.message || \"Invalid credentials\";\n      toast({\n        title: \"Sign In Failed\",\n        description: errorMessage,\n        variant: \"destructive\",\n      });\n    },\n  });\n\n  const handleSignUp = (data: SignUpData) => {\n    signUpMutation.mutate(data);\n  };\n\n  const handleSignIn = (data: SignInData) => {\n    signInMutation.mutate(data);\n  };\n\n\n  const toggleMode = () => {\n    setIsSignIn(!isSignIn);\n    signUpForm.reset();\n    signInForm.reset();\n  };\n\n  return (\n    <div className=\"min-h-screen bg-gradient-to-br from-red-600 via-red-700 to-black flex items-center justify-center p-4\">\n      <div className=\"w-full max-w-md\">\n        {/* Logo and Header */}\n        <div className=\"text-center mb-8\">\n          <div className=\"flex items-center justify-center mb-4\">\n            <div className=\"bg-white rounded-full p-3\">\n              <Dumbbell className=\"w-8 h-8 text-red-600\" />\n            </div>\n          </div>\n          <h1 className=\"text-3xl font-bold text-white mb-2\">FlexFlow</h1>\n          <p className=\"text-red-100\">\n            {isSignIn ? \"Welcome back! Sign in to continue your fitness journey.\" : \"Join thousands of users transforming their fitness.\"}\n          </p>\n        </div>\n\n        {/* Auth Card */}\n        <div className=\"bg-white rounded-2xl shadow-2xl p-6\">\n          <div className=\"text-center mb-6\">\n            <h2 className=\"text-2xl font-bold text-gray-900\">\n              {isSignIn ? \"Sign In\" : \"Create Account\"}\n            </h2>\n            <p className=\"text-gray-600 mt-1\">\n              {isSignIn ? \"Enter your credentials to access your account\" : \"Fill in your details to get started\"}\n            </p>\n          </div>\n\n\n          {/* Sign In Form */}\n          {isSignIn ? (\n            <form onSubmit={signInForm.handleSubmit(handleSignIn)} className=\"space-y-4\">\n              <div>\n                <Label htmlFor=\"identifier\">Username or Email</Label>\n                <div className=\"relative\">\n                  <User className=\"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4\" />\n                  <Input\n                    id=\"identifier\"\n                    type=\"text\"\n                    placeholder=\"Enter username or email\"\n                    className=\"pl-10\"\n                    {...signInForm.register(\"identifier\")}\n                    data-testid=\"signin-identifier\"\n                  />\n                </div>\n                {signInForm.formState.errors.identifier && (\n                  <p className=\"text-red-500 text-sm mt-1\">{signInForm.formState.errors.identifier.message}</p>\n                )}\n              </div>\n\n              <div>\n                <Label htmlFor=\"password\">Password</Label>\n                <div className=\"relative\">\n                  <Lock className=\"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4\" />\n                  <Input\n                    id=\"password\"\n                    type={showPassword ? \"text\" : \"password\"}\n                    placeholder=\"Enter your password\"\n                    className=\"pl-10 pr-10\"\n                    {...signInForm.register(\"password\")}\n                    data-testid=\"signin-password\"\n                  />\n                  <button\n                    type=\"button\"\n                    onClick={() => setShowPassword(!showPassword)}\n                    className=\"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400\"\n                    data-testid=\"toggle-password\"\n                  >\n                    {showPassword ? <EyeOff className=\"w-4 h-4\" /> : <Eye className=\"w-4 h-4\" />}\n                  </button>\n                </div>\n                {signInForm.formState.errors.password && (\n                  <p className=\"text-red-500 text-sm mt-1\">{signInForm.formState.errors.password.message}</p>\n                )}\n              </div>\n\n              <Button\n                type=\"submit\"\n                className=\"w-full bg-red-600 hover:bg-red-700\"\n                disabled={signInMutation.isPending}\n                data-testid=\"signin-submit\"\n              >\n                {signInMutation.isPending ? \"Signing In...\" : \"Sign In\"}\n              </Button>\n            </form>\n          ) : (\n            /* Sign Up Form */\n            <form onSubmit={signUpForm.handleSubmit(handleSignUp)} className=\"space-y-4\">\n              <div className=\"grid grid-cols-2 gap-4\">\n                <div>\n                  <Label htmlFor=\"firstName\">First Name</Label>\n                  <Input\n                    id=\"firstName\"\n                    type=\"text\"\n                    placeholder=\"John\"\n                    {...signUpForm.register(\"firstName\")}\n                    data-testid=\"signup-firstname\"\n                  />\n                  {signUpForm.formState.errors.firstName && (\n                    <p className=\"text-red-500 text-sm mt-1\">{signUpForm.formState.errors.firstName.message}</p>\n                  )}\n                </div>\n\n                <div>\n                  <Label htmlFor=\"lastName\">Last Name</Label>\n                  <Input\n                    id=\"lastName\"\n                    type=\"text\"\n                    placeholder=\"Doe\"\n                    {...signUpForm.register(\"lastName\")}\n                    data-testid=\"signup-lastname\"\n                  />\n                  {signUpForm.formState.errors.lastName && (\n                    <p className=\"text-red-500 text-sm mt-1\">{signUpForm.formState.errors.lastName.message}</p>\n                  )}\n                </div>\n              </div>\n\n              <div>\n                <Label htmlFor=\"username\">Username</Label>\n                <div className=\"relative\">\n                  <User className=\"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4\" />\n                  <Input\n                    id=\"username\"\n                    type=\"text\"\n                    placeholder=\"Choose a username\"\n                    className=\"pl-10\"\n                    {...signUpForm.register(\"username\")}\n                    data-testid=\"signup-username\"\n                  />\n                </div>\n                {signUpForm.formState.errors.username && (\n                  <p className=\"text-red-500 text-sm mt-1\">{signUpForm.formState.errors.username.message}</p>\n                )}\n              </div>\n\n              <div>\n                <Label htmlFor=\"email\">Email</Label>\n                <div className=\"relative\">\n                  <Mail className=\"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4\" />\n                  <Input\n                    id=\"email\"\n                    type=\"email\"\n                    placeholder=\"Enter your email\"\n                    className=\"pl-10\"\n                    {...signUpForm.register(\"email\")}\n                    data-testid=\"signup-email\"\n                  />\n                </div>\n                {signUpForm.formState.errors.email && (\n                  <p className=\"text-red-500 text-sm mt-1\">{signUpForm.formState.errors.email.message}</p>\n                )}\n              </div>\n\n              <div>\n                <Label htmlFor=\"signup-password\">Password</Label>\n                <div className=\"relative\">\n                  <Lock className=\"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4\" />\n                  <Input\n                    id=\"signup-password\"\n                    type={showPassword ? \"text\" : \"password\"}\n                    placeholder=\"Create a password\"\n                    className=\"pl-10 pr-10\"\n                    {...signUpForm.register(\"password\")}\n                    data-testid=\"signup-password\"\n                  />\n                  <button\n                    type=\"button\"\n                    onClick={() => setShowPassword(!showPassword)}\n                    className=\"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400\"\n                  >\n                    {showPassword ? <EyeOff className=\"w-4 h-4\" /> : <Eye className=\"w-4 h-4\" />}\n                  </button>\n                </div>\n                {signUpForm.formState.errors.password && (\n                  <p className=\"text-red-500 text-sm mt-1\">{signUpForm.formState.errors.password.message}</p>\n                )}\n                <p className=\"text-xs text-gray-500 mt-1\">\n                  Must contain at least 8 characters, one uppercase, one lowercase, and one number.\n                </p>\n              </div>\n\n              <Button\n                type=\"submit\"\n                className=\"w-full bg-red-600 hover:bg-red-700\"\n                disabled={signUpMutation.isPending}\n                data-testid=\"signup-submit\"\n              >\n                {signUpMutation.isPending ? \"Creating Account...\" : \"Create Account\"}\n              </Button>\n            </form>\n          )}\n\n          {/* Toggle Mode */}\n          <div className=\"text-center mt-6\">\n            <p className=\"text-gray-600\">\n              {isSignIn ? \"Don't have an account? \" : \"Already have an account? \"}\n              <button\n                onClick={toggleMode}\n                className=\"text-red-600 hover:text-red-700 font-medium\"\n                data-testid=\"toggle-auth-mode\"\n              >\n                {isSignIn ? \"Sign up\" : \"Sign in\"}\n              </button>\n            </p>\n          </div>\n        </div>\n\n        {/* Footer */}\n        <div className=\"text-center mt-8\">\n          <p className=\"text-red-100 text-sm\">\n            By signing up, you agree to our Terms of Service and Privacy Policy.\n          </p>\n        </div>\n      </div>\n    </div>\n  );\n}","size_bytes":12899},"client/src/components/progress-overview.tsx":{"content":"import { useQuery } from \"@tanstack/react-query\";\nimport { TrendingUp, Calendar, Target, Award, BarChart3, Flame } from \"lucide-react\";\nimport { Progress } from \"@/components/ui/progress\";\n\ninterface ProgressMetrics {\n  currentStreak: number;\n  longestStreak: number;\n  totalWorkoutDays: number;\n  consistencyPercentage30Days: number;\n  consistencyPercentage7Days: number;\n  workoutFrequency: { date: string; count: number }[];\n  streakHistory: { start: string; end: string; length: number }[];\n}\n\nexport default function ProgressOverview() {\n  const { data: metrics, isLoading } = useQuery<ProgressMetrics>({\n    queryKey: [\"/api/progress/metrics\"],\n  });\n\n  if (isLoading) {\n    return (\n      <section className=\"relative bg-gradient-to-br from-slate-50 via-blue-50 to-indigo-100 rounded-2xl shadow-lg border border-slate-200 p-6 overflow-hidden\">\n        <div className=\"flex items-center justify-between mb-6\">\n          <h3 className=\"text-xl font-bold text-gray-800\">Progress Overview</h3>\n        </div>\n        <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6\">\n          {[...Array(6)].map((_, i) => (\n            <div key={i} className=\"animate-pulse\">\n              <div className=\"bg-gray-100 rounded-xl p-4\">\n                <div className=\"flex items-center justify-between mb-3\">\n                  <div className=\"h-5 bg-gray-200 rounded w-24\"></div>\n                  <div className=\"w-6 h-6 bg-gray-200 rounded\"></div>\n                </div>\n                <div className=\"h-8 bg-gray-200 rounded w-16 mb-2\"></div>\n                <div className=\"h-3 bg-gray-200 rounded w-full\"></div>\n              </div>\n            </div>\n          ))}\n        </div>\n      </section>\n    );\n  }\n\n  if (!metrics) {\n    return (\n      <section className=\"relative bg-gradient-to-br from-slate-50 via-blue-50 to-indigo-100 rounded-2xl shadow-lg border border-slate-200 p-6 overflow-hidden\">\n        <div className=\"text-center py-8 text-gray-500\">\n          <BarChart3 className=\"mx-auto h-12 w-12 text-gray-300 mb-4\" />\n          <p className=\"text-lg font-medium mb-2\">Unable to load progress data</p>\n          <p className=\"text-sm\">Start working out to see your progress overview!</p>\n        </div>\n      </section>\n    );\n  }\n\n  // Get consistency status and color\n  const getConsistencyStatus = (percentage: number) => {\n    if (percentage >= 80) return { status: \"Excellent\", color: \"text-green-600\", bgColor: \"bg-green-50\" };\n    if (percentage >= 60) return { status: \"Good\", color: \"text-blue-600\", bgColor: \"bg-blue-50\" };\n    if (percentage >= 40) return { status: \"Fair\", color: \"text-yellow-600\", bgColor: \"bg-yellow-50\" };\n    return { status: \"Needs Work\", color: \"text-red-600\", bgColor: \"bg-red-50\" };\n  };\n\n  const consistency30 = getConsistencyStatus(metrics.consistencyPercentage30Days);\n  const consistency7 = getConsistencyStatus(metrics.consistencyPercentage7Days);\n\n  // Get recent workout frequency for mini chart\n  const recentWorkouts = metrics.workoutFrequency.slice(-14); // Last 14 days\n  const maxWorkouts = Math.max(...recentWorkouts.map(w => w.count), 1);\n\n  return (\n    <section className=\"relative bg-gradient-to-br from-black via-red-900/30 to-black rounded-3xl shadow-2xl border border-red-600/50 p-8 overflow-hidden hexagon-bg hexagon-pattern\" data-testid=\"progress-overview\">\n      {/* Animated red and black background elements */}\n      <div className=\"absolute inset-0\">\n        {/* Floating red hexagons */}\n        <div className=\"absolute top-0 left-0 w-32 h-28 opacity-30 animate-pulse\" style={{animationDuration: '4s'}}>\n          <svg viewBox=\"0 0 120 104\" className=\"w-full h-full\">\n            <polygon points=\"30,2 90,2 120,52 90,102 30,102 0,52\" fill=\"#dc2626\" stroke=\"#dc2626\" strokeWidth=\"2\" opacity=\"0.6\"/>\n          </svg>\n        </div>\n        <div className=\"absolute top-1/4 right-0 w-24 h-21 opacity-20 animate-bounce\" style={{animationDuration: '6s'}}>\n          <svg viewBox=\"0 0 120 104\" className=\"w-full h-full\">\n            <polygon points=\"30,2 90,2 120,52 90,102 30,102 0,52\" fill=\"none\" stroke=\"#dc2626\" strokeWidth=\"2\" opacity=\"0.8\"/>\n          </svg>\n        </div>\n        <div className=\"absolute bottom-0 left-1/3 w-28 h-24 opacity-25 animate-ping\" style={{animationDuration: '8s', animationDelay: '1s'}}>\n          <svg viewBox=\"0 0 120 104\" className=\"w-full h-full\">\n            <polygon points=\"30,2 90,2 120,52 90,102 30,102 0,52\" fill=\"#000000\" stroke=\"#dc2626\" strokeWidth=\"1\" opacity=\"0.7\"/>\n          </svg>\n        </div>\n        <div className=\"absolute bottom-1/4 right-1/4 w-20 h-17 opacity-15 animate-pulse\" style={{animationDuration: '5s', animationDelay: '2s'}}>\n          <svg viewBox=\"0 0 120 104\" className=\"w-full h-full\">\n            <polygon points=\"30,2 90,2 120,52 90,102 30,102 0,52\" fill=\"#dc2626\" stroke=\"#000000\" strokeWidth=\"1\" opacity=\"0.5\"/>\n          </svg>\n        </div>\n        <div className=\"absolute top-1/2 left-10 w-22 h-19 opacity-20 animate-bounce\" style={{animationDuration: '7s', animationDelay: '0.5s'}}>\n          <svg viewBox=\"0 0 120 104\" className=\"w-full h-full\">\n            <polygon points=\"30,2 90,2 120,52 90,102 30,102 0,52\" fill=\"none\" stroke=\"#dc2626\" strokeWidth=\"2\" opacity=\"0.4\"/>\n          </svg>\n        </div>\n        \n        {/* Animated red gradient orbs */}\n        <div className=\"absolute top-1/3 right-1/3 w-40 h-40 bg-gradient-to-br from-red-600/20 to-black/40 rounded-full blur-3xl opacity-30 animate-pulse\" style={{animationDuration: '6s'}}></div>\n        <div className=\"absolute bottom-1/3 left-1/4 w-32 h-32 bg-gradient-to-br from-black/60 to-red-600/20 rounded-full blur-2xl opacity-20 animate-ping\" style={{animationDuration: '10s'}}></div>\n        \n        {/* Dynamic radial gradient overlay */}\n        <div className=\"absolute inset-0 bg-gradient-radial from-transparent via-red-900/10 to-black/60 animate-pulse\" style={{animationDuration: '8s'}}></div>\n      </div>\n      \n      {/* Content wrapper with relative positioning */}\n      <div className=\"relative z-10\">\n        <div className=\"flex items-center justify-between mb-8\">\n          <h3 className=\"text-3xl font-bold text-white drop-shadow-lg\">Progress Overview</h3>\n          <div className=\"p-3 bg-white/10 backdrop-blur-md rounded-xl shadow-lg border border-white/20\">\n            <TrendingUp className=\"text-cyan-300 w-8 h-8\" />\n          </div>\n        </div>\n\n      {/* Main Metrics Grid */}\n      <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-8\">\n        {/* Current Streak */}\n        <div className=\"bg-gradient-to-br from-orange-500/20 to-red-500/20 rounded-2xl p-6 border border-orange-400/30 shadow-2xl backdrop-blur-md bg-white/10 hover:bg-white/15 transition-all duration-300 hover:scale-105\">\n          <div className=\"flex items-center justify-between mb-3\">\n            <h4 className=\"font-semibold text-white drop-shadow-sm\">Current Streak</h4>\n            <Flame className=\"text-orange-300 w-6 h-6 drop-shadow-sm\" />\n          </div>\n          <div className=\"text-4xl font-bold text-orange-200 mb-2 drop-shadow-lg\" data-testid=\"current-streak\">\n            {metrics.currentStreak === 0 ? \"Start today!\" : `${metrics.currentStreak} ${metrics.currentStreak === 1 ? 'day' : 'days'}`}\n          </div>\n          <p className=\"text-sm text-orange-100/80 drop-shadow-sm\">Keep the momentum going!</p>\n        </div>\n\n        {/* Longest Streak */}\n        <div className=\"bg-gradient-to-br from-green-500/20 to-emerald-500/20 rounded-2xl p-6 border border-green-400/30 shadow-2xl backdrop-blur-md bg-white/10 hover:bg-white/15 transition-all duration-300 hover:scale-105\">\n          <div className=\"flex items-center justify-between mb-3\">\n            <h4 className=\"font-semibold text-white drop-shadow-sm\">Personal Best</h4>\n            <Award className=\"text-green-300 w-6 h-6 drop-shadow-sm\" />\n          </div>\n          <div className=\"text-4xl font-bold text-green-200 mb-2 drop-shadow-lg\" data-testid=\"longest-streak\">\n            {metrics.longestStreak} days\n          </div>\n          <p className=\"text-sm text-green-100/80 drop-shadow-sm\">Your longest streak</p>\n        </div>\n\n        {/* Total Workout Days */}\n        <div className=\"bg-gradient-to-br from-blue-500/20 to-indigo-500/20 rounded-2xl p-6 border border-blue-400/30 shadow-2xl backdrop-blur-md bg-white/10 hover:bg-white/15 transition-all duration-300 hover:scale-105\">\n          <div className=\"flex items-center justify-between mb-3\">\n            <h4 className=\"font-semibold text-white drop-shadow-sm\">Total Active Days</h4>\n            <Calendar className=\"text-blue-300 w-6 h-6 drop-shadow-sm\" />\n          </div>\n          <div className=\"text-4xl font-bold text-blue-200 mb-2 drop-shadow-lg\" data-testid=\"total-workout-days\">\n            {metrics.totalWorkoutDays}\n          </div>\n          <p className=\"text-sm text-blue-100/80 drop-shadow-sm\">Days you've exercised</p>\n        </div>\n      </div>\n\n      {/* Consistency Metrics */}\n      <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6 mb-8\">\n        {/* 7-Day Consistency */}\n        <div className=\"bg-gradient-to-br from-purple-500/20 to-pink-500/20 rounded-2xl p-6 border border-purple-400/30 shadow-2xl backdrop-blur-md bg-white/10 hover:bg-white/15 transition-all duration-300\">\n          <div className=\"flex items-center justify-between mb-3\">\n            <h4 className=\"font-semibold text-white drop-shadow-sm\">7-Day Consistency</h4>\n            <Target className=\"text-purple-300 w-6 h-6 drop-shadow-sm\" />\n          </div>\n          <div className=\"flex items-center justify-between mb-2\">\n            <span className=\"text-3xl font-bold text-purple-200 drop-shadow-lg\" data-testid=\"consistency-7-days\">\n              {metrics.consistencyPercentage7Days}%\n            </span>\n            <span className=\"text-sm font-medium text-purple-100/90 drop-shadow-sm\">\n              {consistency7.status}\n            </span>\n          </div>\n          <Progress value={metrics.consistencyPercentage7Days} className=\"h-2\" />\n          <p className=\"text-sm text-purple-100/70 mt-2 drop-shadow-sm\">Last 7 days performance</p>\n        </div>\n\n        {/* 30-Day Consistency */}\n        <div className=\"bg-gradient-to-br from-cyan-500/20 to-teal-500/20 rounded-2xl p-6 border border-cyan-400/30 shadow-2xl backdrop-blur-md bg-white/10 hover:bg-white/15 transition-all duration-300\">\n          <div className=\"flex items-center justify-between mb-3\">\n            <h4 className=\"font-semibold text-white drop-shadow-sm\">30-Day Consistency</h4>\n            <Target className=\"text-cyan-300 w-6 h-6 drop-shadow-sm\" />\n          </div>\n          <div className=\"flex items-center justify-between mb-2\">\n            <span className=\"text-3xl font-bold text-cyan-200 drop-shadow-lg\" data-testid=\"consistency-30-days\">\n              {metrics.consistencyPercentage30Days}%\n            </span>\n            <span className=\"text-sm font-medium text-cyan-100/90 drop-shadow-sm\">\n              {consistency30.status}\n            </span>\n          </div>\n          <Progress value={metrics.consistencyPercentage30Days} className=\"h-2\" />\n          <p className=\"text-sm text-cyan-100/70 mt-2 drop-shadow-sm\">Last 30 days performance</p>\n        </div>\n      </div>\n\n      {/* Workout Frequency Chart */}\n      <div className=\"bg-gradient-to-br from-slate-800/40 to-gray-800/40 rounded-2xl p-6 border border-slate-600/30 shadow-2xl backdrop-blur-md bg-black/20\">\n        <h4 className=\"font-semibold text-white drop-shadow-sm mb-6 text-lg\">Recent Activity (Last 14 Days)</h4>\n        <div className=\"flex items-end justify-between space-x-1\" style={{ height: '60px' }}>\n          {recentWorkouts.map((day, index) => {\n            const height = Math.max((day.count / maxWorkouts) * 100, day.count > 0 ? 20 : 8);\n            const date = new Date(day.date);\n            const dayLabel = date.getDate();\n            \n            return (\n              <div key={index} className=\"flex-1 flex flex-col items-center\">\n                <div \n                  className={`w-full rounded-md ${day.count > 0 ? 'bg-gradient-to-t from-cyan-500 to-blue-400 shadow-lg' : 'bg-slate-600/50'}`}\n                  style={{ height: `${height}%` }}\n                  data-testid={`workout-bar-${index}`}\n                />\n                <span className=\"text-xs text-slate-300 mt-2 font-medium\">{dayLabel}</span>\n              </div>\n            );\n          })}\n        </div>\n        <div className=\"flex justify-between items-center mt-4 text-xs text-slate-300\">\n          <span>2 weeks ago</span>\n          <span>Today</span>\n        </div>\n      </div>\n\n      {/* Progress Insights */}\n      {metrics.currentStreak > 0 && metrics.longestStreak > 0 && (\n        <div className=\"mt-8 p-6 bg-gradient-to-br from-emerald-500/20 to-cyan-500/20 border border-emerald-400/30 rounded-2xl shadow-2xl backdrop-blur-md bg-white/10\">\n          <div className=\"flex items-center space-x-3\">\n            <TrendingUp className=\"text-emerald-300 w-6 h-6\" />\n            <div>\n              <p className=\"font-medium text-white drop-shadow-sm\">\n                {metrics.currentStreak === metrics.longestStreak \n                  ? \"🎉 You're on your best streak ever!\" \n                  : `${metrics.longestStreak - metrics.currentStreak} days away from your personal best!`\n                }\n              </p>\n              <p className=\"text-sm text-emerald-100/80 drop-shadow-sm\">\n                Keep up the amazing consistency to reach new milestones.\n              </p>\n            </div>\n          </div>\n        </div>\n      )}\n      </div>\n    </section>\n  );\n}","size_bytes":13659},"client/src/components/ui/switch.tsx":{"content":"import * as React from \"react\"\nimport * as SwitchPrimitives from \"@radix-ui/react-switch\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Switch = React.forwardRef<\n  React.ElementRef<typeof SwitchPrimitives.Root>,\n  React.ComponentPropsWithoutRef<typeof SwitchPrimitives.Root>\n>(({ className, ...props }, ref) => (\n  <SwitchPrimitives.Root\n    className={cn(\n      \"peer inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=unchecked]:bg-input\",\n      className\n    )}\n    {...props}\n    ref={ref}\n  >\n    <SwitchPrimitives.Thumb\n      className={cn(\n        \"pointer-events-none block h-5 w-5 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-5 data-[state=unchecked]:translate-x-0\"\n      )}\n    />\n  </SwitchPrimitives.Root>\n))\nSwitch.displayName = SwitchPrimitives.Root.displayName\n\nexport { Switch }\n","size_bytes":1139},"client/src/components/ui/tooltip.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as TooltipPrimitive from \"@radix-ui/react-tooltip\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst TooltipProvider = TooltipPrimitive.Provider\n\nconst Tooltip = TooltipPrimitive.Root\n\nconst TooltipTrigger = TooltipPrimitive.Trigger\n\nconst TooltipContent = React.forwardRef<\n  React.ElementRef<typeof TooltipPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof TooltipPrimitive.Content>\n>(({ className, sideOffset = 4, ...props }, ref) => (\n  <TooltipPrimitive.Content\n    ref={ref}\n    sideOffset={sideOffset}\n    className={cn(\n      \"z-50 overflow-hidden rounded-md border bg-popover px-3 py-1.5 text-sm text-popover-foreground shadow-md animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 origin-[--radix-tooltip-content-transform-origin]\",\n      className\n    )}\n    {...props}\n  />\n))\nTooltipContent.displayName = TooltipPrimitive.Content.displayName\n\nexport { Tooltip, TooltipTrigger, TooltipContent, TooltipProvider }\n","size_bytes":1209},"client/src/pages/calendar.tsx":{"content":"import { Calendar, Plus, Clock, TrendingUp } from \"lucide-react\";\nimport { Button } from \"@/components/ui/button\";\nimport CalendarView from \"@/components/calendar-view\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport type { Workout } from \"@shared/schema\";\n\nexport default function CalendarPage() {\n  const { data: workouts } = useQuery<Workout[]>({\n    queryKey: [\"/api/workouts\"],\n  });\n\n  const thisMonth = new Date();\n  const thisMonthWorkouts = workouts?.filter(workout => {\n    const workoutDate = new Date(workout.date);\n    return workoutDate.getMonth() === thisMonth.getMonth() && \n           workoutDate.getFullYear() === thisMonth.getFullYear();\n  }) || [];\n\n  const totalWorkouts = thisMonthWorkouts.length;\n  const totalDuration = thisMonthWorkouts.reduce((sum, workout) => sum + workout.duration, 0);\n  const totalCalories = thisMonthWorkouts.reduce((sum, workout) => sum + workout.caloriesBurned, 0);\n\n  return (\n    <div className=\"font-inter bg-gray-50 dark:bg-gray-900 text-gray-800 dark:text-gray-200 min-h-screen\">      \n      <main className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6\">\n        {/* Page Header */}\n        <div className=\"flex items-center justify-between mb-8\">\n          <div className=\"flex items-center gap-3\">\n            <Calendar className=\"w-8 h-8 text-primary\" />\n            <div>\n              <h1 className=\"text-3xl font-bold text-gray-900 dark:text-white\" data-testid=\"calendar-title\">\n                Workout Calendar\n              </h1>\n              <p className=\"text-gray-600 dark:text-gray-400\">\n                View your workout schedule and track your consistency\n              </p>\n            </div>\n          </div>\n          <Button \n            onClick={() => {\n              // Navigate to workouts page with focus on workout logger\n              window.location.href = '/workouts';\n            }}\n            className=\"flex items-center gap-2\"\n            data-testid=\"schedule-workout-button\"\n          >\n            <Plus className=\"w-4 h-4\" />\n            Schedule Workout\n          </Button>\n        </div>\n\n        {/* Monthly Stats */}\n        <div className=\"grid grid-cols-1 md:grid-cols-3 gap-6 mb-8\">\n          <div className=\"bg-white dark:bg-gray-800 rounded-2xl shadow-sm border border-gray-100 dark:border-gray-700 p-6\">\n            <div className=\"flex items-center gap-3\">\n              <div className=\"w-10 h-10 bg-primary/10 rounded-full flex items-center justify-center\">\n                <TrendingUp className=\"w-5 h-5 text-primary\" />\n              </div>\n              <div>\n                <p className=\"text-sm text-gray-600 dark:text-gray-400\">This Month</p>\n                <p className=\"text-2xl font-bold text-gray-900 dark:text-white\" data-testid=\"monthly-workouts\">\n                  {totalWorkouts} Workouts\n                </p>\n              </div>\n            </div>\n          </div>\n\n          <div className=\"bg-white dark:bg-gray-800 rounded-2xl shadow-sm border border-gray-100 dark:border-gray-700 p-6\">\n            <div className=\"flex items-center gap-3\">\n              <div className=\"w-10 h-10 bg-secondary/10 rounded-full flex items-center justify-center\">\n                <Clock className=\"w-5 h-5 text-secondary\" />\n              </div>\n              <div>\n                <p className=\"text-sm text-gray-600 dark:text-gray-400\">Total Duration</p>\n                <p className=\"text-2xl font-bold text-gray-900 dark:text-white\" data-testid=\"monthly-duration\">\n                  {Math.round(totalDuration / 60 * 10) / 10}h\n                </p>\n              </div>\n            </div>\n          </div>\n\n          <div className=\"bg-white dark:bg-gray-800 rounded-2xl shadow-sm border border-gray-100 dark:border-gray-700 p-6\">\n            <div className=\"flex items-center gap-3\">\n              <div className=\"w-10 h-10 bg-accent/10 rounded-full flex items-center justify-center\">\n                <Calendar className=\"w-5 h-5 text-accent\" />\n              </div>\n              <div>\n                <p className=\"text-sm text-gray-600 dark:text-gray-400\">Calories Burned</p>\n                <p className=\"text-2xl font-bold text-gray-900 dark:text-white\" data-testid=\"monthly-calories\">\n                  {totalCalories.toLocaleString()}\n                </p>\n              </div>\n            </div>\n          </div>\n        </div>\n\n        {/* Main Content Grid */}\n        <div className=\"grid lg:grid-cols-4 gap-8\">\n          {/* Calendar View */}\n          <div className=\"lg:col-span-3\">\n            <CalendarView />\n          </div>\n          \n          {/* Sidebar */}\n          <div className=\"space-y-6\">\n            {/* Legend */}\n            <section className=\"bg-white dark:bg-gray-800 rounded-2xl shadow-sm border border-gray-100 dark:border-gray-700 p-6\">\n              <h3 className=\"text-lg font-bold text-gray-800 dark:text-white mb-4\">Workout Types</h3>\n              <div className=\"space-y-3\">\n                <div className=\"flex items-center gap-3\">\n                  <div className=\"w-3 h-3 bg-primary rounded-full\"></div>\n                  <span className=\"text-sm text-gray-600 dark:text-gray-400\">Strength Training</span>\n                </div>\n                <div className=\"flex items-center gap-3\">\n                  <div className=\"w-3 h-3 bg-secondary rounded-full\"></div>\n                  <span className=\"text-sm text-gray-600 dark:text-gray-400\">Cardio</span>\n                </div>\n                <div className=\"flex items-center gap-3\">\n                  <div className=\"w-3 h-3 bg-accent rounded-full\"></div>\n                  <span className=\"text-sm text-gray-600 dark:text-gray-400\">Yoga</span>\n                </div>\n                <div className=\"flex items-center gap-3\">\n                  <div className=\"w-3 h-3 bg-blue-500 rounded-full\"></div>\n                  <span className=\"text-sm text-gray-600 dark:text-gray-400\">Swimming</span>\n                </div>\n              </div>\n            </section>\n\n            {/* Upcoming Goals */}\n            <section className=\"bg-white dark:bg-gray-800 rounded-2xl shadow-sm border border-gray-100 dark:border-gray-700 p-6\">\n              <h3 className=\"text-lg font-bold text-gray-800 dark:text-white mb-4\">Calendar Tips</h3>\n              <div className=\"space-y-3 text-sm text-gray-600 dark:text-gray-400\">\n                <p>💡 Click on any day to see your workout details</p>\n                <p>🎯 Aim for 3-4 workouts per week for best results</p>\n                <p>🔥 Colored dots indicate different workout types</p>\n                <p>📅 Plan ahead by scheduling future workouts</p>\n              </div>\n            </section>\n          </div>\n        </div>\n      </main>\n    </div>\n  );\n}","size_bytes":6727},"client/src/pages/tutorial.tsx":{"content":"import { useState, useEffect } from \"react\";\nimport { useLocation } from \"wouter\";\nimport { useNewAuth } from \"@/hooks/useNewAuth\";\nimport { Button } from \"@/components/ui/button\";\nimport { Card, CardContent, CardDescription, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { \n  Dumbbell, \n  Target, \n  TrendingUp, \n  Users, \n  Camera, \n  Calendar,\n  Trophy,\n  PlayCircle,\n  ChevronLeft,\n  ChevronRight,\n  Home\n} from \"lucide-react\";\n\ninterface TutorialStep {\n  id: number;\n  title: string;\n  description: string;\n  icon: React.ReactNode;\n  features: string[];\n}\n\nconst tutorialSteps: TutorialStep[] = [\n  {\n    id: 1,\n    title: \"Welcome to FlexFlow!\",\n    description: \"Your complete fitness companion is ready to help you achieve your health goals.\",\n    icon: <Dumbbell className=\"h-12 w-12 text-red-500\" />,\n    features: [\n      \"AI-powered workout recommendations\",\n      \"Personalized meal planning\",\n      \"Progress tracking and analytics\",\n      \"Community support and challenges\"\n    ]\n  },\n  {\n    id: 2,\n    title: \"Track Your Workouts\",\n    description: \"Log exercises, sets, reps, and weights. Track your progress over time with detailed analytics.\",\n    icon: <TrendingUp className=\"h-12 w-12 text-blue-500\" />,\n    features: [\n      \"Extensive exercise database with instructions\",\n      \"Custom workout creation\",\n      \"Progress photos and measurements\",\n      \"Performance analytics and charts\"\n    ]\n  },\n  {\n    id: 3,\n    title: \"Set and Achieve Goals\",\n    description: \"Create specific fitness goals and track your progress with smart reminders and milestones.\",\n    icon: <Target className=\"h-12 w-12 text-green-500\" />,\n    features: [\n      \"Weight loss/gain targets\",\n      \"Strength improvement goals\",\n      \"Consistency tracking\",\n      \"Achievement badges and rewards\"\n    ]\n  },\n  {\n    id: 4,\n    title: \"AI-Powered Meal Planning\",\n    description: \"Get personalized meal plans based on your goals, preferences, and dietary restrictions.\",\n    icon: <Camera className=\"h-12 w-12 text-orange-500\" />,\n    features: [\n      \"Food scanning and nutrition tracking\",\n      \"Custom meal plan generation\",\n      \"Dietary restriction support\",\n      \"Calorie and macro tracking\"\n    ]\n  },\n  {\n    id: 5,\n    title: \"Community & Trainers\",\n    description: \"Connect with other fitness enthusiasts and find professional trainers to guide your journey.\",\n    icon: <Users className=\"h-12 w-12 text-purple-500\" />,\n    features: [\n      \"Community challenges and leaderboards\",\n      \"Share progress and achievements\",\n      \"Book sessions with certified trainers\",\n      \"Get expert advice and motivation\"\n    ]\n  },\n  {\n    id: 6,\n    title: \"Ready to Start!\",\n    description: \"You're all set to begin your fitness journey. Let's explore your personalized home.\",\n    icon: <Trophy className=\"h-12 w-12 text-yellow-500\" />,\n    features: [\n      \"Access your personalized home\",\n      \"View your fitness plan and goals\",\n      \"Start logging workouts today\",\n      \"Explore all features at your own pace\"\n    ]\n  }\n];\n\nexport default function TutorialPage() {\n  const [currentStep, setCurrentStep] = useState(0);\n  const [, setLocation] = useLocation();\n  const { isAuthenticated, isLoading } = useNewAuth();\n\n  // Redirect to auth if not authenticated\n  useEffect(() => {\n    if (!isLoading && !isAuthenticated) {\n      setLocation('/auth');\n    }\n  }, [isAuthenticated, isLoading, setLocation]);\n\n  // Show loading while checking auth\n  if (isLoading) {\n    return (\n      <div className=\"h-screen flex items-center justify-center bg-gray-900\">\n        <div className=\"animate-spin w-8 h-8 border-4 border-red-500 border-t-transparent rounded-full\" />\n      </div>\n    );\n  }\n\n  // Don't render if not authenticated (will redirect)\n  if (!isAuthenticated) {\n    return null;\n  }\n\n  const currentTutorial = tutorialSteps[currentStep];\n  const isLastStep = currentStep === tutorialSteps.length - 1;\n  const isFirstStep = currentStep === 0;\n\n  const handleNext = () => {\n    if (isLastStep) {\n      // Complete tutorial and go to home\n      setLocation('/');\n    } else {\n      setCurrentStep(prev => Math.min(prev + 1, tutorialSteps.length - 1));\n    }\n  };\n\n  const handlePrevious = () => {\n    setCurrentStep(prev => Math.max(prev - 1, 0));\n  };\n\n  const handleSkip = () => {\n    setLocation('/');\n  };\n\n  return (\n    <div className=\"min-h-screen bg-gradient-to-br from-gray-900 via-gray-800 to-black text-white\">\n      {/* Header */}\n      <div className=\"bg-black/20 border-b border-gray-700\">\n        <div className=\"max-w-4xl mx-auto px-4 py-4 flex items-center justify-between\">\n          <div className=\"flex items-center space-x-3\">\n            <div className=\"flex items-center space-x-2\">\n              <Dumbbell className=\"h-8 w-8 text-red-500\" />\n              <span className=\"text-2xl font-bold\">FlexFlow</span>\n            </div>\n            <Badge variant=\"secondary\" className=\"bg-red-500/20 text-red-300 border-red-500/30\">\n              Tutorial\n            </Badge>\n          </div>\n          <Button \n            variant=\"ghost\" \n            onClick={handleSkip}\n            className=\"text-gray-400 hover:text-white\"\n            data-testid=\"button-skip-tutorial\"\n          >\n            Skip Tutorial\n          </Button>\n        </div>\n      </div>\n\n      <div className=\"max-w-4xl mx-auto px-4 py-8\">\n        {/* Progress Indicator */}\n        <div className=\"mb-8\">\n          <div className=\"flex items-center justify-between mb-4\">\n            <span className=\"text-sm text-gray-400\">\n              Step {currentStep + 1} of {tutorialSteps.length}\n            </span>\n            <span className=\"text-sm text-gray-400\">\n              {Math.round(((currentStep + 1) / tutorialSteps.length) * 100)}% Complete\n            </span>\n          </div>\n          <div className=\"w-full bg-gray-700 rounded-full h-2\">\n            <div \n              className=\"bg-gradient-to-r from-red-500 to-orange-500 h-2 rounded-full transition-all duration-300 ease-out\"\n              style={{ width: `${((currentStep + 1) / tutorialSteps.length) * 100}%` }}\n            />\n          </div>\n        </div>\n\n        {/* Tutorial Content */}\n        <Card className=\"bg-gray-800/50 border-gray-700 backdrop-blur-sm\">\n          <CardHeader className=\"text-center pb-6\">\n            <div className=\"flex justify-center mb-4\">\n              {currentTutorial.icon}\n            </div>\n            <CardTitle className=\"text-3xl font-bold text-white mb-2\">\n              {currentTutorial.title}\n            </CardTitle>\n            <CardDescription className=\"text-lg text-gray-300 max-w-2xl mx-auto\">\n              {currentTutorial.description}\n            </CardDescription>\n          </CardHeader>\n          \n          <CardContent>\n            <div className=\"grid md:grid-cols-2 gap-4 mb-8\">\n              {currentTutorial.features.map((feature, index) => (\n                <div \n                  key={index}\n                  className=\"flex items-center space-x-3 p-3 bg-gray-700/30 rounded-lg border border-gray-600/30\"\n                >\n                  <PlayCircle className=\"h-5 w-5 text-green-400 flex-shrink-0\" />\n                  <span className=\"text-gray-200\">{feature}</span>\n                </div>\n              ))}\n            </div>\n\n            {/* Navigation */}\n            <div className=\"flex items-center justify-between pt-6 border-t border-gray-700\">\n              <Button \n                variant=\"outline\" \n                onClick={handlePrevious}\n                disabled={isFirstStep}\n                className=\"border-gray-600 text-gray-300 hover:bg-gray-700 disabled:opacity-50\"\n                data-testid=\"button-previous-step\"\n              >\n                <ChevronLeft className=\"h-4 w-4 mr-1\" />\n                Previous\n              </Button>\n\n              <div className=\"flex space-x-2\">\n                {tutorialSteps.map((_, index) => (\n                  <button\n                    key={index}\n                    onClick={() => setCurrentStep(index)}\n                    className={`w-3 h-3 rounded-full transition-all duration-200 ${\n                      index === currentStep \n                        ? 'bg-red-500' \n                        : index < currentStep \n                          ? 'bg-green-500' \n                          : 'bg-gray-600'\n                    }`}\n                    data-testid={`button-step-${index + 1}`}\n                  />\n                ))}\n              </div>\n\n              <Button \n                onClick={handleNext}\n                className=\"bg-red-500 hover:bg-red-600 text-white\"\n                data-testid={isLastStep ? \"button-go-to-home\" : \"button-next-step\"}\n              >\n                {isLastStep ? (\n                  <>\n                    Go to Home\n                    <Home className=\"h-4 w-4 ml-1\" />\n                  </>\n                ) : (\n                  <>\n                    Next\n                    <ChevronRight className=\"h-4 w-4 ml-1\" />\n                  </>\n                )}\n              </Button>\n            </div>\n          </CardContent>\n        </Card>\n\n        {/* Quick Actions Preview */}\n        {isLastStep && (\n          <Card className=\"mt-6 bg-gradient-to-r from-red-500/10 to-orange-500/10 border-red-500/30\">\n            <CardContent className=\"pt-6\">\n              <div className=\"text-center\">\n                <h3 className=\"text-xl font-semibold text-white mb-2\">\n                  🎉 You're Ready to Begin!\n                </h3>\n                <p className=\"text-gray-300 mb-4\">\n                  Your personalized fitness home is waiting. Start by setting your first goal or logging a workout.\n                </p>\n                <div className=\"flex justify-center space-x-3\">\n                  <Badge variant=\"secondary\" className=\"bg-red-500/20 text-red-300 border-red-500/30\">\n                    <Target className=\"h-3 w-3 mr-1\" />\n                    Set Goals\n                  </Badge>\n                  <Badge variant=\"secondary\" className=\"bg-blue-500/20 text-blue-300 border-blue-500/30\">\n                    <Dumbbell className=\"h-3 w-3 mr-1\" />\n                    Log Workouts\n                  </Badge>\n                  <Badge variant=\"secondary\" className=\"bg-green-500/20 text-green-300 border-green-500/30\">\n                    <Calendar className=\"h-3 w-3 mr-1\" />\n                    Plan Meals\n                  </Badge>\n                </div>\n              </div>\n            </CardContent>\n          </Card>\n        )}\n      </div>\n    </div>\n  );\n}","size_bytes":10621},"postcss.config.js":{"content":"export default {\n  plugins: {\n    tailwindcss: {},\n    autoprefixer: {},\n  },\n}\n","size_bytes":80},"client/src/components/performance-analytics.tsx":{"content":"import { useState } from \"react\";\nimport { useQuery } from \"@tanstack/react-query\";\nimport { TrendingUp, TrendingDown, Minus, Target, Zap, Award, BarChart3, Brain } from \"lucide-react\";\nimport { Button } from \"@/components/ui/button\";\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from \"@/components/ui/select\";\nimport { apiRequest } from \"@/lib/queryClient\";\n\ninterface WorkoutPerformanceData {\n  workouts: Array<{\n    id: string;\n    name: string;\n    date: string;\n    difficultyLevel: number;\n    perceivedExertion: number;\n    completionRate: number;\n    performanceScore: number;\n    category: string;\n  }>;\n  trends: {\n    difficultyTrend: \"improving\" | \"declining\" | \"stable\";\n    consistencyScore: number;\n    averageDifficulty: number;\n    averageExertion: number;\n    completionRate: number;\n  };\n}\n\nexport default function PerformanceAnalytics() {\n  const [selectedTimeframe, setSelectedTimeframe] = useState(\"7d\");\n\n  const { data: performanceData, isLoading } = useQuery<WorkoutPerformanceData>({\n    queryKey: [\"/api/performance-analytics\", selectedTimeframe],\n    enabled: true,\n  });\n\n  const getTrendIcon = (trend: string) => {\n    switch (trend) {\n      case \"improving\":\n        return <TrendingUp className=\"w-5 h-5 text-green-500\" />;\n      case \"declining\":\n        return <TrendingDown className=\"w-5 h-5 text-red-500\" />;\n      default:\n        return <Minus className=\"w-5 h-5 text-yellow-500\" />;\n    }\n  };\n\n  const getTrendColor = (trend: string) => {\n    switch (trend) {\n      case \"improving\":\n        return \"text-green-600 bg-green-50 border-green-200\";\n      case \"declining\":\n        return \"text-red-600 bg-red-50 border-red-200\";\n      default:\n        return \"text-yellow-600 bg-yellow-50 border-yellow-200\";\n    }\n  };\n\n  const getConsistencyColor = (score: number) => {\n    if (score >= 80) return \"text-green-600\";\n    if (score >= 60) return \"text-yellow-600\";\n    return \"text-red-600\";\n  };\n\n  if (isLoading) {\n    return (\n      <section className=\"relative bg-gradient-to-br from-black via-red-900/30 to-black rounded-3xl shadow-2xl border border-red-600/50 p-8 overflow-hidden hexagon-bg\">\n        <div className=\"flex items-center justify-center h-64\">\n          <div className=\"animate-spin w-8 h-8 border-4 border-red-600 border-t-transparent rounded-full\"></div>\n        </div>\n      </section>\n    );\n  }\n\n  return (\n    <section className=\"relative bg-gradient-to-br from-black via-red-900/30 to-black rounded-3xl shadow-2xl border border-red-600/50 p-8 overflow-hidden hexagon-bg hexagon-pattern\">\n      {/* Animated Background Elements */}\n      <div className=\"absolute inset-0\">\n        <div className=\"absolute top-0 right-0 w-32 h-28 opacity-25 animate-pulse\" style={{animationDuration: '6s'}}>\n          <svg viewBox=\"0 0 120 104\" className=\"w-full h-full\">\n            <polygon points=\"30,2 90,2 120,52 90,102 30,102 0,52\" fill=\"#dc2626\" stroke=\"#dc2626\" strokeWidth=\"2\" opacity=\"0.5\"/>\n          </svg>\n        </div>\n        <div className=\"absolute bottom-1/4 left-0 w-24 h-21 opacity-20 animate-bounce\" style={{animationDuration: '8s'}}>\n          <svg viewBox=\"0 0 120 104\" className=\"w-full h-full\">\n            <polygon points=\"30,2 90,2 120,52 90,102 30,102 0,52\" fill=\"none\" stroke=\"#dc2626\" strokeWidth=\"2\" opacity=\"0.7\"/>\n          </svg>\n        </div>\n      </div>\n\n      {/* Header */}\n      <div className=\"relative z-10 mb-8\">\n        <div className=\"flex items-center justify-between\">\n          <div>\n            <h2 className=\"text-3xl font-bold text-white flex items-center gap-3\">\n              <Brain className=\"w-8 h-8 text-red-400\" />\n              AI Performance Analytics\n            </h2>\n            <p className=\"text-red-200/80 mt-2\">Track your progress with intelligent insights</p>\n          </div>\n          \n          {/* Timeframe Selector */}\n          <div className=\"w-40\">\n            <Select value={selectedTimeframe} onValueChange={setSelectedTimeframe}>\n              <SelectTrigger \n                className=\"bg-black/50 border-red-600/30 text-white focus:ring-red-600 focus:border-red-600\"\n                data-testid=\"timeframe-selector\"\n              >\n                <SelectValue placeholder=\"Select timeframe\" />\n              </SelectTrigger>\n              <SelectContent className=\"bg-black/90 border-red-600/30\">\n                <SelectItem \n                  value=\"7d\" \n                  className=\"text-white hover:bg-red-600/20 focus:bg-red-600/30\"\n                  data-testid=\"timeframe-7d\"\n                >\n                  7 Days\n                </SelectItem>\n                <SelectItem \n                  value=\"30d\" \n                  className=\"text-white hover:bg-red-600/20 focus:bg-red-600/30\"\n                  data-testid=\"timeframe-30d\"\n                >\n                  30 Days\n                </SelectItem>\n                <SelectItem \n                  value=\"90d\" \n                  className=\"text-white hover:bg-red-600/20 focus:bg-red-600/30\"\n                  data-testid=\"timeframe-90d\"\n                >\n                  3 Months\n                </SelectItem>\n              </SelectContent>\n            </Select>\n          </div>\n        </div>\n      </div>\n\n      {/* Performance Metrics Grid */}\n      <div className=\"relative z-10 grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8\">\n        {/* Performance Trend */}\n        <div className=\"bg-white/10 backdrop-blur-sm rounded-2xl p-6 border border-red-600/30\">\n          <div className=\"flex items-center gap-3 mb-3\">\n            {getTrendIcon(performanceData?.trends.difficultyTrend || \"stable\")}\n            <h3 className=\"font-semibold text-white\">Performance Trend</h3>\n          </div>\n          <div className={`inline-flex items-center px-3 py-1 rounded-full text-sm font-medium border ${getTrendColor(performanceData?.trends.difficultyTrend || \"stable\")}`}>\n            {performanceData?.trends.difficultyTrend ? \n              performanceData.trends.difficultyTrend.charAt(0).toUpperCase() + performanceData.trends.difficultyTrend.slice(1) : \n              \"Stable\"\n            }\n          </div>\n        </div>\n\n        {/* Consistency Score */}\n        <div className=\"bg-white/10 backdrop-blur-sm rounded-2xl p-6 border border-red-600/30\">\n          <div className=\"flex items-center gap-3 mb-3\">\n            <Target className=\"w-5 h-5 text-blue-400\" />\n            <h3 className=\"font-semibold text-white\">Consistency</h3>\n          </div>\n          <div className=\"text-2xl font-bold text-white mb-1\">\n            {performanceData?.trends.consistencyScore || 0}%\n          </div>\n          <div className={`text-sm font-medium ${getConsistencyColor(performanceData?.trends.consistencyScore || 0)}`}>\n            {(performanceData?.trends.consistencyScore || 0) >= 80 ? \"Excellent\" : \n             (performanceData?.trends.consistencyScore || 0) >= 60 ? \"Good\" : \"Needs Improvement\"}\n          </div>\n        </div>\n\n        {/* Average Difficulty */}\n        <div className=\"bg-white/10 backdrop-blur-sm rounded-2xl p-6 border border-red-600/30\">\n          <div className=\"flex items-center gap-3 mb-3\">\n            <Zap className=\"w-5 h-5 text-yellow-400\" />\n            <h3 className=\"font-semibold text-white\">Avg Difficulty</h3>\n          </div>\n          <div className=\"text-2xl font-bold text-white mb-1\">\n            {performanceData?.trends.averageDifficulty?.toFixed(1) || \"0.0\"}/5.0\n          </div>\n          <div className=\"text-sm text-red-200/70\">\n            {(performanceData?.trends.averageDifficulty || 0) >= 4 ? \"High Intensity\" : \n             (performanceData?.trends.averageDifficulty || 0) >= 3 ? \"Moderate\" : \"Light Training\"}\n          </div>\n        </div>\n\n        {/* Completion Rate */}\n        <div className=\"bg-white/10 backdrop-blur-sm rounded-2xl p-6 border border-red-600/30\">\n          <div className=\"flex items-center gap-3 mb-3\">\n            <Award className=\"w-5 h-5 text-green-400\" />\n            <h3 className=\"font-semibold text-white\">Completion Rate</h3>\n          </div>\n          <div className=\"text-2xl font-bold text-white mb-1\">\n            {performanceData?.trends.completionRate || 0}%\n          </div>\n          <div className=\"text-sm text-red-200/70\">\n            Workouts finished\n          </div>\n        </div>\n      </div>\n\n      {/* Recent Workouts Performance */}\n      <div className=\"relative z-10\">\n        <h3 className=\"text-xl font-bold text-white mb-6 flex items-center gap-2\">\n          <BarChart3 className=\"w-6 h-6 text-red-400\" />\n          Recent Performance History\n        </h3>\n        \n        <div className=\"space-y-4 max-h-80 overflow-y-auto\">\n          {performanceData?.workouts && performanceData.workouts.length > 0 ? (\n            performanceData.workouts.map((workout) => (\n              <div key={workout.id} className=\"bg-white/10 backdrop-blur-sm rounded-xl p-4 border border-red-600/20\">\n                <div className=\"flex items-center justify-between\">\n                  <div>\n                    <h4 className=\"font-medium text-white\">{workout.name}</h4>\n                    <p className=\"text-sm text-red-200/70\">{workout.category} • {new Date(workout.date).toLocaleDateString()}</p>\n                  </div>\n                  <div className=\"flex gap-4 text-sm\">\n                    <div className=\"text-center\">\n                      <div className=\"text-yellow-400 font-semibold\">{workout.difficultyLevel}/5</div>\n                      <div className=\"text-red-200/60\">Difficulty</div>\n                    </div>\n                    <div className=\"text-center\">\n                      <div className=\"text-blue-400 font-semibold\">{workout.perceivedExertion}/10</div>\n                      <div className=\"text-red-200/60\">RPE</div>\n                    </div>\n                    <div className=\"text-center\">\n                      <div className=\"text-green-400 font-semibold\">{workout.completionRate}%</div>\n                      <div className=\"text-red-200/60\">Complete</div>\n                    </div>\n                    {workout.performanceScore && (\n                      <div className=\"text-center\">\n                        <div className=\"text-purple-400 font-semibold\">{workout.performanceScore}</div>\n                        <div className=\"text-red-200/60\">AI Score</div>\n                      </div>\n                    )}\n                  </div>\n                </div>\n              </div>\n            ))\n          ) : (\n            <div className=\"text-center py-8\">\n              <div className=\"text-red-200/60 mb-4\">\n                <BarChart3 className=\"w-12 h-12 mx-auto opacity-50\" />\n              </div>\n              <p className=\"text-red-200/80\">No performance data yet</p>\n              <p className=\"text-sm text-red-200/60\">Complete workouts to see your analytics</p>\n            </div>\n          )}\n        </div>\n      </div>\n\n      {/* AI Insights */}\n      <div className=\"relative z-10 mt-8 p-6 bg-gradient-to-r from-purple-900/30 to-blue-900/30 rounded-2xl border border-purple-600/30\">\n        <h3 className=\"text-lg font-bold text-white mb-4 flex items-center gap-2\">\n          🧠 AI Performance Insights\n        </h3>\n        <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm\">\n          <div className=\"text-purple-200\">\n            <strong>Trend Analysis:</strong> {performanceData?.trends.difficultyTrend === \"improving\" ? \n              \"You're progressively challenging yourself - great job!\" :\n              performanceData?.trends.difficultyTrend === \"declining\" ?\n              \"Consider gradually increasing workout intensity.\" :\n              \"Your performance is stable. Try varying difficulty levels.\"\n            }\n          </div>\n          <div className=\"text-blue-200\">\n            <strong>Recommendation:</strong> {(performanceData?.trends.consistencyScore || 0) < 60 ?\n              \"Focus on consistency - aim for regular workout schedule.\" :\n              \"Excellent consistency! Consider progressive overload for continued growth.\"\n            }\n          </div>\n        </div>\n      </div>\n    </section>\n  );\n}","size_bytes":12143},"server/services/content-moderation.ts":{"content":"import OpenAI from \"openai\";\n\n// This is using OpenAI's API, which points to OpenAI's API servers and requires your own API key.\nconst openai = new OpenAI({ \n  apiKey: process.env.AI_INTEGRATIONS_OPENAI_API_KEY || process.env.OPENAI_API_KEY,\n  baseURL: process.env.AI_INTEGRATIONS_OPENAI_BASE_URL\n});\n\ninterface ModerationResult {\n  isAppropriate: boolean;\n  reason?: string;\n  categories?: string[];\n}\n\n/**\n * Moderates text content for inappropriate language\n */\nexport async function moderateText(text: string): Promise<ModerationResult> {\n  try {\n    // Use OpenAI's moderation endpoint\n    const moderation = await openai.moderations.create({\n      input: text,\n    });\n\n    const result = moderation.results[0];\n    \n    // Check if content is flagged\n    if (result.flagged) {\n      const flaggedCategories = Object.keys(result.categories).filter(\n        key => result.categories[key as keyof typeof result.categories]\n      );\n\n      return {\n        isAppropriate: false,\n        reason: \"Content contains inappropriate language or themes\",\n        categories: flaggedCategories\n      };\n    }\n\n    return { isAppropriate: true };\n  } catch (error) {\n    console.error(\"Error moderating text:\", error);\n    // In case of error, allow content but log the error\n    return { isAppropriate: true };\n  }\n}\n\n/**\n * Moderates image content for inappropriate visuals\n */\nexport async function moderateImage(imageUrl: string): Promise<ModerationResult> {\n  try {\n    // the newest OpenAI model is \"gpt-5\" which was released August 7, 2025. do not change this unless explicitly requested by the user\n    const response = await openai.chat.completions.create({\n      model: \"gpt-5\",\n      messages: [\n        {\n          role: \"system\",\n          content: \"You are a content moderation expert. Analyze the image and determine if it contains any inappropriate, explicit, violent, or offensive content. Respond with JSON in this format: { 'isAppropriate': boolean, 'reason': string, 'categories': string[] }\"\n        },\n        {\n          role: \"user\",\n          content: [\n            {\n              type: \"text\",\n              text: \"Is this image appropriate for a fitness community platform? Check for nudity, violence, hate symbols, or other inappropriate content.\"\n            },\n            {\n              type: \"image_url\",\n              image_url: { url: imageUrl }\n            }\n          ]\n        }\n      ],\n      response_format: { type: \"json_object\" },\n      max_completion_tokens: 500\n    });\n\n    const result = JSON.parse(response.choices[0].message.content || '{\"isAppropriate\": true}');\n    \n    return {\n      isAppropriate: result.isAppropriate,\n      reason: result.reason,\n      categories: result.categories || []\n    };\n  } catch (error) {\n    console.error(\"Error moderating image:\", error);\n    // In case of error, allow content but log the error\n    return { isAppropriate: true };\n  }\n}\n","size_bytes":2919},"server/services/ai-workout-generator.ts":{"content":"import OpenAI from \"openai\";\n\n// the newest OpenAI model is \"gpt-5\" which was released August 7, 2025. do not change this unless explicitly requested by the user\nconst openai = new OpenAI({ \n  apiKey: process.env.AI_INTEGRATIONS_OPENAI_API_KEY || process.env.OPENAI_API_KEY,\n  baseURL: process.env.AI_INTEGRATIONS_OPENAI_BASE_URL\n});\n\ninterface WorkoutPreferences {\n  fitnessLevel: string;\n  primaryGoals: string[];\n  workoutDaysPerWeek: number;\n  sessionDuration: number;\n  availableEquipment: string[];\n  preferredWorkoutTypes: string[];\n  injuriesOrLimitations: string[];\n}\n\ninterface Exercise {\n  name: string;\n  sets: number;\n  reps: string;\n  restSeconds: number;\n  notes: string;\n}\n\ninterface DailyWorkout {\n  dayOfWeek: number;\n  weekNumber: number;\n  workoutType: string;\n  name: string;\n  description: string;\n  exercises: Exercise[];\n  estimatedDuration: number;\n  targetCalories: number;\n  isRestDay: boolean;\n}\n\nexport class AIWorkoutGenerator {\n  async generatePersonalizedPlan(preferences: WorkoutPreferences): Promise<DailyWorkout[]> {\n    try {\n      const prompt = this.buildWorkoutPrompt(preferences);\n      \n      const response = await openai.chat.completions.create({\n        model: \"gpt-5\",\n        messages: [\n          {\n            role: \"system\",\n            content: \"You are an expert personal trainer and exercise physiologist. Create safe, effective, and personalized workout plans based on user preferences, goals, and limitations. Always provide specific exercises with sets, reps, and proper form cues.\"\n          },\n          {\n            role: \"user\",\n            content: prompt\n          }\n        ],\n        response_format: { type: \"json_object\" }\n      });\n\n      const aiPlan = JSON.parse(response.choices[0].message.content || '{}');\n      return this.formatWorkoutPlan(aiPlan, preferences);\n    } catch (error) {\n      console.error(\"Error generating AI workout plan:\", error);\n      throw new Error(\"Failed to generate personalized workout plan\");\n    }\n  }\n\n  private buildWorkoutPrompt(preferences: WorkoutPreferences): string {\n    const equipmentList = preferences.availableEquipment.join(', ') || 'bodyweight only';\n    const goalsList = preferences.primaryGoals.join(', ');\n    const limitations = preferences.injuriesOrLimitations.filter(l => l !== 'none').join(', ') || 'none';\n    const workoutTypes = preferences.preferredWorkoutTypes.join(', ') || 'any';\n\n    return `Create a personalized 4-week workout plan with the following requirements:\n\n**User Profile:**\n- Fitness Level: ${preferences.fitnessLevel}\n- Primary Goals: ${goalsList}\n- Workout Days Per Week: ${preferences.workoutDaysPerWeek}\n- Session Duration: ${preferences.sessionDuration} minutes\n- Available Equipment: ${equipmentList}\n- Preferred Workout Types: ${workoutTypes}\n- Injuries/Limitations: ${limitations}\n\n**Requirements:**\n1. Generate exactly ${preferences.workoutDaysPerWeek} workout days per week (distribute them properly throughout the week)\n2. Each workout should fit within ${preferences.sessionDuration} minutes\n3. Include specific exercises with sets, reps/duration, and rest periods\n4. Consider the user's limitations and avoid exercises that may cause injury\n5. Progressive overload - gradually increase difficulty over the 4 weeks\n6. Balance muscle groups and workout types based on goals\n7. Include rest days on non-workout days\n\n**Output Format (JSON):**\n{\n  \"plan\": {\n    \"weeks\": [\n      {\n        \"weekNumber\": 1,\n        \"workouts\": [\n          {\n            \"dayOfWeek\": 1,  // 0=Sunday, 1=Monday, etc.\n            \"isRestDay\": false,\n            \"workoutType\": \"strength|cardio|yoga|functional\",\n            \"name\": \"Workout Name\",\n            \"description\": \"Brief workout description\",\n            \"estimatedDuration\": ${preferences.sessionDuration},\n            \"targetCalories\": 300,\n            \"exercises\": [\n              {\n                \"name\": \"Exercise name\",\n                \"sets\": 3,\n                \"reps\": \"12\" or \"30 seconds\" for timed exercises,\n                \"restSeconds\": 60,\n                \"notes\": \"Form cues and tips\"\n              }\n            ]\n          }\n        ]\n      }\n    ]\n  }\n}\n\nFocus on exercises that:\n- Match available equipment: ${equipmentList}\n- Are safe for limitations: ${limitations}\n- Align with goals: ${goalsList}\n- Suit fitness level: ${preferences.fitnessLevel}\n\nMake the plan progressive, balanced, and achievable!`;\n  }\n\n  private formatWorkoutPlan(aiPlan: any, preferences: WorkoutPreferences): DailyWorkout[] {\n    const formattedWorkouts: DailyWorkout[] = [];\n    \n    if (!aiPlan.plan?.weeks) {\n      throw new Error(\"Invalid AI response format\");\n    }\n\n    // Process all 4 weeks\n    aiPlan.plan.weeks.forEach((week: any) => {\n      const weekNumber = week.weekNumber;\n      \n      // Create a full week array (7 days)\n      const weekDays = Array(7).fill(null).map((_, dayIndex) => {\n        // Find if there's a workout for this day\n        const workout = week.workouts?.find((w: any) => w.dayOfWeek === dayIndex);\n        \n        if (workout && !workout.isRestDay) {\n          return {\n            dayOfWeek: dayIndex,\n            weekNumber,\n            workoutType: workout.workoutType,\n            name: workout.name,\n            description: workout.description,\n            exercises: workout.exercises || [],\n            estimatedDuration: workout.estimatedDuration || preferences.sessionDuration,\n            targetCalories: workout.targetCalories || this.estimateCalories(workout.estimatedDuration, workout.workoutType),\n            isRestDay: false\n          };\n        } else {\n          // Rest day\n          return {\n            dayOfWeek: dayIndex,\n            weekNumber,\n            workoutType: 'rest',\n            name: 'Rest Day',\n            description: 'Recovery day - light stretching or walking optional',\n            exercises: [],\n            estimatedDuration: 0,\n            targetCalories: 0,\n            isRestDay: true\n          };\n        }\n      });\n\n      formattedWorkouts.push(...weekDays);\n    });\n\n    return formattedWorkouts;\n  }\n\n  private estimateCalories(duration: number, workoutType: string): number {\n    const caloriesPerMinute: { [key: string]: number } = {\n      strength: 5,\n      cardio: 8,\n      yoga: 3,\n      functional: 6,\n      rest: 0\n    };\n\n    const rate = caloriesPerMinute[workoutType] || 5;\n    return Math.round(duration * rate);\n  }\n}\n\nexport const aiWorkoutGenerator = new AIWorkoutGenerator();\n","size_bytes":6476},"client/src/components/app-footer.tsx":{"content":"import { MedicalDisclaimer } from \"@/components/medical-disclaimer\";\n\nexport function AppFooter() {\n  return (\n    <footer className=\"bg-white dark:bg-gray-950 border-t border-gray-200 dark:border-gray-800 mt-12\">\n      <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8\">\n        <div className=\"mb-6\">\n          <MedicalDisclaimer />\n        </div>\n        \n        <div className=\"text-center text-sm text-gray-600 dark:text-gray-400\">\n          <p>\n            © {new Date().getFullYear()} FlexFlow. For educational purposes only.{\" \"}\n            <span className=\"font-semibold\">Always consult healthcare professionals before making health changes.</span>\n          </p>\n          <div className=\"mt-2 space-x-4\">\n            <a href=\"/terms-of-service\" className=\"hover:text-primary\">Terms of Service</a>\n            <span>•</span>\n            <a href=\"/privacy-policy\" className=\"hover:text-primary\">Privacy Policy</a>\n          </div>\n        </div>\n      </div>\n    </footer>\n  );\n}\n","size_bytes":1004},"client/src/components/health-sources.tsx":{"content":"import { BookOpen, ExternalLink } from \"lucide-react\";\nimport { Card, CardContent, CardHeader, CardTitle } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { useState } from \"react\";\n\nexport function HealthSources() {\n  const [isExpanded, setIsExpanded] = useState(false);\n\n  const sources = [\n    {\n      title: \"USDA Dietary Guidelines for Americans\",\n      description: \"Evidence-based nutritional and dietary information for healthy eating patterns\",\n      url: \"https://www.dietaryguidelines.gov/\",\n    },\n    {\n      title: \"American College of Sports Medicine (ACSM)\",\n      description: \"Exercise guidelines and physical activity recommendations\",\n      url: \"https://www.acsm.org/\",\n    },\n    {\n      title: \"National Institutes of Health (NIH) - Nutrition\",\n      description: \"Scientific research on nutrition, calories, and healthy eating\",\n      url: \"https://www.nih.gov/health-information/diet-nutrition\",\n    },\n    {\n      title: \"CDC Physical Activity Guidelines\",\n      description: \"Federal guidelines for physical activity and exercise recommendations\",\n      url: \"https://www.cdc.gov/physicalactivity/basics/index.htm\",\n    },\n    {\n      title: \"Academy of Nutrition and Dietetics\",\n      description: \"Professional organization providing evidence-based nutrition information\",\n      url: \"https://www.eatright.org/\",\n    },\n  ];\n\n  return (\n    <Card className=\"mt-6\">\n      <CardHeader className=\"pb-3\">\n        <div className=\"flex items-center justify-between\">\n          <CardTitle className=\"text-lg flex items-center\">\n            <BookOpen className=\"w-5 h-5 mr-2\" />\n            Health & Fitness Sources\n          </CardTitle>\n          <Button\n            variant=\"ghost\"\n            size=\"sm\"\n            onClick={() => setIsExpanded(!isExpanded)}\n            data-testid=\"button-toggle-sources\"\n          >\n            {isExpanded ? \"Hide\" : \"Show\"} Sources\n          </Button>\n        </div>\n      </CardHeader>\n      {isExpanded && (\n        <CardContent className=\"space-y-3\">\n          <p className=\"text-sm text-gray-600 dark:text-gray-400 mb-4\">\n            Our health and fitness recommendations are based on guidelines from the following authoritative sources:\n          </p>\n          {sources.map((source, index) => (\n            <div key={index} className=\"border-l-4 border-blue-500 pl-4 py-2\">\n              <div className=\"flex items-start justify-between\">\n                <div className=\"flex-1\">\n                  <h4 className=\"font-semibold text-sm text-gray-900 dark:text-white\">\n                    {source.title}\n                  </h4>\n                  <p className=\"text-xs text-gray-600 dark:text-gray-400 mt-1\">\n                    {source.description}\n                  </p>\n                </div>\n                <a\n                  href={source.url}\n                  target=\"_blank\"\n                  rel=\"noopener noreferrer\"\n                  className=\"ml-2 text-blue-600 hover:text-blue-800 dark:text-blue-400 dark:hover:text-blue-300\"\n                  data-testid={`link-source-${index}`}\n                >\n                  <ExternalLink className=\"w-4 h-4\" />\n                </a>\n              </div>\n            </div>\n          ))}\n          <p className=\"text-xs text-gray-500 dark:text-gray-400 mt-4 pt-4 border-t\">\n            Last updated: October 2025. Always consult healthcare professionals for personalized medical advice.\n          </p>\n        </CardContent>\n      )}\n    </Card>\n  );\n}\n","size_bytes":3513},"client/src/components/medical-disclaimer.tsx":{"content":"import { AlertTriangle } from \"lucide-react\";\nimport { Alert, AlertDescription } from \"@/components/ui/alert\";\n\nexport function MedicalDisclaimer() {\n  return (\n    <Alert className=\"border-amber-200 bg-amber-50 dark:border-amber-800 dark:bg-amber-950\">\n      <AlertTriangle className=\"h-4 w-4 text-amber-600 dark:text-amber-400\" />\n      <AlertDescription className=\"text-amber-800 dark:text-amber-200\">\n        <strong>Medical Disclaimer:</strong> This app provides general fitness and nutritional information for educational purposes only. \n        It is not a substitute for professional medical advice, diagnosis, or treatment. Always consult with a qualified healthcare provider \n        before starting any new diet, exercise program, or making changes to your health routine, especially if you have existing health conditions.\n      </AlertDescription>\n    </Alert>\n  );\n}\n\nexport function PageMedicalDisclaimer({ type = \"general\" }: { type?: \"general\" | \"nutrition\" | \"exercise\" }) {\n  const getMessage = () => {\n    switch (type) {\n      case \"nutrition\":\n        return \"The nutritional information and meal plans provided are general guidelines. Calorie and macro recommendations should be verified with a registered dietitian or healthcare provider, especially if you have dietary restrictions, allergies, or medical conditions.\";\n      case \"exercise\":\n        return \"The workout recommendations and exercise plans are general fitness guidelines. Consult with a physician before beginning any exercise program, especially if you have cardiovascular conditions, joint issues, or other health concerns.\";\n      default:\n        return \"The health and fitness information provided is for educational purposes only and should not replace professional medical advice.\";\n    }\n  };\n\n  return (\n    <Alert className=\"border-blue-200 bg-blue-50 dark:border-blue-800 dark:bg-blue-950 mb-6\">\n      <AlertTriangle className=\"h-4 w-4 text-blue-600 dark:text-blue-400\" />\n      <AlertDescription className=\"text-blue-800 dark:text-blue-200 text-sm\">\n        {getMessage()}\n      </AlertDescription>\n    </Alert>\n  );\n}\n\nexport function AIGeneratedDisclaimer() {\n  return (\n    <Alert className=\"border-purple-200 bg-purple-50 dark:border-purple-800 dark:bg-purple-950\">\n      <AlertTriangle className=\"h-4 w-4 text-purple-600 dark:text-purple-400\" />\n      <AlertDescription className=\"text-purple-800 dark:text-purple-200 text-sm\">\n        <strong>AI-Generated Content:</strong> This plan was created by artificial intelligence based on your inputs. \n        AI-generated recommendations should be reviewed and verified with qualified health professionals before implementation.\n      </AlertDescription>\n    </Alert>\n  );\n}\n","size_bytes":2728},"client/src/components/bottom-nav.tsx":{"content":"import { Link, useLocation } from \"wouter\";\nimport { Home, Dumbbell, TrendingUp, Users, MoreHorizontal, ChefHat, MapPin, Settings, Star, Target, Apple, Camera, Newspaper } from \"lucide-react\";\nimport {\n  Sheet,\n  SheetContent,\n  SheetHeader,\n  SheetTitle,\n  SheetTrigger,\n} from \"@/components/ui/sheet\";\nimport { useState } from \"react\";\nimport { Button } from \"@/components/ui/button\";\nimport { useNewAuth } from \"@/hooks/useNewAuth\";\n\nexport default function BottomNav() {\n  const [location] = useLocation();\n  const [moreSheetOpen, setMoreSheetOpen] = useState(false);\n  const { signOut } = useNewAuth();\n\n  const mainNavItems = [\n    { path: \"/\", label: \"Home\", icon: Home },\n    { path: \"/workouts\", label: \"Workouts\", icon: Dumbbell },\n    { path: \"/progress\", label: \"Progress\", icon: TrendingUp },\n    { path: \"/community\", label: \"Community\", icon: Users },\n  ];\n\n  const moreItems = [\n    { path: \"/subscription\", label: \"Premium\", icon: Star },\n    { path: \"/news\", label: \"What's New\", icon: Newspaper },\n    { path: \"/meal-plans\", label: \"Meal Plans\", icon: ChefHat },\n    { path: \"/workout-planner\", label: \"Workout Planner\", icon: Target },\n    { path: \"/meal-tracker\", label: \"Barcode Scanner\", icon: Apple },\n    { path: \"/mile-tracker\", label: \"Mile Tracker\", icon: MapPin },\n    { path: \"/progress-photos\", label: \"Progress Photos\", icon: Camera },\n    { path: \"/settings\", label: \"Settings\", icon: Settings },\n  ];\n\n  const isActive = (path: string) => {\n    if (path === \"/\") return location === \"/\" || location === \"/home\";\n    return location.startsWith(path);\n  };\n\n  const isMoreActive = moreItems.some(item => isActive(item.path));\n\n  return (\n    <>\n      {/* Bottom Navigation - Mobile and Tablet with bounce animation */}\n      <div className=\"lg:hidden fixed bottom-0 left-0 right-0 bg-white dark:bg-gray-900 border-t border-gray-200 dark:border-gray-800 z-50 safe-area-inset-bottom mobile-slide-up\">\n        <nav className=\"grid grid-cols-5 h-16\" aria-label=\"Main navigation\">\n          {mainNavItems.map((item) => {\n            const Icon = item.icon;\n            const active = isActive(item.path);\n            \n            return (\n              <Link \n                key={item.path}\n                href={item.path}\n                className=\"flex flex-col items-center justify-center space-y-1 active:mobile-pop\"\n                data-testid={`bottom-nav-${item.label.toLowerCase()}`}\n                aria-label={`Navigate to ${item.label}`}\n                aria-current={active ? \"page\" : undefined}\n              >\n                <Icon \n                  size={22} \n                  className={`transition-all duration-300 ${\n                    active \n                      ? \"text-primary mobile-pulse\" \n                      : \"text-gray-500 dark:text-gray-400\"\n                  }`}\n                  strokeWidth={active ? 2.5 : 2}\n                  aria-hidden=\"true\"\n                />\n                <span \n                  className={`text-xs font-medium transition-colors ${\n                    active \n                      ? \"text-primary\" \n                      : \"text-gray-500 dark:text-gray-400\"\n                  }`}\n                >\n                  {item.label}\n                </span>\n              </Link>\n            );\n          })}\n\n          {/* More Sheet Trigger */}\n          <Sheet open={moreSheetOpen} onOpenChange={setMoreSheetOpen}>\n            <SheetTrigger asChild>\n              <button \n                className=\"flex flex-col items-center justify-center space-y-1\"\n                data-testid=\"bottom-nav-more\"\n                aria-label=\"Open more options menu\"\n              >\n                <MoreHorizontal \n                  size={22} \n                  className={`transition-colors ${\n                    isMoreActive \n                      ? \"text-primary\" \n                      : \"text-gray-500 dark:text-gray-400\"\n                  }`}\n                  strokeWidth={isMoreActive ? 2.5 : 2}\n                  aria-hidden=\"true\"\n                />\n                <span \n                  className={`text-xs font-medium ${\n                    isMoreActive \n                      ? \"text-primary\" \n                      : \"text-gray-500 dark:text-gray-400\"\n                  }`}\n                >\n                  More\n                </span>\n              </button>\n            </SheetTrigger>\n            <SheetContent side=\"bottom\" className=\"h-[80vh] rounded-t-3xl z-[80]\">\n              <SheetHeader className=\"mb-6\">\n                <SheetTitle className=\"text-center text-xl\">More Options</SheetTitle>\n              </SheetHeader>\n              <div className=\"grid grid-cols-3 gap-4 px-2\">\n                {moreItems.map((item) => {\n                  const Icon = item.icon;\n                  const active = isActive(item.path);\n                  \n                  return (\n                    <Link \n                      key={item.path}\n                      href={item.path}\n                      onClick={() => setMoreSheetOpen(false)}\n                      data-testid={`more-menu-${item.label.toLowerCase().replace(/\\s+/g, '-')}`}\n                      aria-label={`Navigate to ${item.label}`}\n                    >\n                      <div \n                        className={`flex flex-col items-center justify-center p-4 rounded-2xl transition-all ${\n                          active \n                            ? \"bg-primary/10 text-primary\" \n                            : \"bg-gray-50 dark:bg-gray-800 text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700\"\n                        }`}\n                      >\n                        <Icon size={28} className=\"mb-2\" aria-hidden=\"true\" />\n                        <span className=\"text-xs font-medium text-center leading-tight\">\n                          {item.label}\n                        </span>\n                      </div>\n                    </Link>\n                  );\n                })}\n              </div>\n              \n              <div className=\"mt-8 px-4\">\n                <Button\n                  variant=\"outline\"\n                  className=\"w-full justify-center text-red-600 border-red-600 hover:bg-red-50 dark:hover:bg-red-900/20\"\n                  onClick={() => {\n                    setMoreSheetOpen(false);\n                    signOut();\n                  }}\n                  data-testid=\"more-menu-signout\"\n                  aria-label=\"Sign out of your account\"\n                >\n                  Sign Out\n                </Button>\n              </div>\n            </SheetContent>\n          </Sheet>\n        </nav>\n      </div>\n\n      {/* Spacer for bottom nav on mobile and tablet */}\n      <div className=\"lg:hidden h-16\" />\n    </>\n  );\n}\n","size_bytes":6759},"client/src/hooks/useNotifications.ts":{"content":"import { useEffect, useCallback } from 'react';\nimport { useQuery } from '@tanstack/react-query';\nimport { apiRequest } from '@/lib/queryClient';\n\ninterface NotificationPreferences {\n  id: string;\n  userId: string;\n  workoutRemindersEnabled: boolean;\n  mealNotificationsEnabled: boolean;\n  breakfastTime: string;\n  lunchTime: string;\n  dinnerTime: string;\n  notificationPermissionGranted: boolean;\n  lastWorkoutReminderSent?: Date;\n  createdAt: Date;\n  updatedAt: Date;\n}\n\nexport function useNotifications() {\n  // Fetch notification preferences\n  const { data: preferences } = useQuery<NotificationPreferences>({\n    queryKey: ['/api/notification-preferences'],\n    refetchInterval: 60000, // Refetch every minute\n  });\n\n  // Function to show browser notification\n  const showNotification = useCallback((title: string, body: string, icon?: string) => {\n    if ('Notification' in window && Notification.permission === 'granted') {\n      new Notification(title, {\n        body,\n        icon: icon || '/favicon.ico',\n        badge: '/favicon.ico',\n        tag: 'flexflow-notification',\n        requireInteraction: false,\n      });\n    }\n  }, []);\n\n  // Function to check if it's time for a meal notification\n  const checkMealNotification = useCallback((mealType: 'breakfast' | 'lunch' | 'dinner', mealTime: string) => {\n    const now = new Date();\n    const currentTime = `${String(now.getHours()).padStart(2, '0')}:${String(now.getMinutes()).padStart(2, '0')}`;\n    \n    // Check if current time matches meal time (within 1 minute window)\n    if (currentTime === mealTime) {\n      const mealNames = {\n        breakfast: 'Breakfast',\n        lunch: 'Lunch',\n        dinner: 'Dinner',\n      };\n      \n      const lastShownKey = `last-${mealType}-notification`;\n      const lastShown = localStorage.getItem(lastShownKey);\n      const today = now.toDateString();\n      \n      // Only show once per day\n      if (lastShown !== today) {\n        showNotification(\n          `${mealNames[mealType]} Time! 🍽️`,\n          `It's time for ${mealNames[mealType].toLowerCase()}. Don't forget to log your meal!`\n        );\n        localStorage.setItem(lastShownKey, today);\n      }\n    }\n  }, [showNotification]);\n\n  // Function to check if workout reminder is needed\n  const checkWorkoutReminder = useCallback(async () => {\n    if (!preferences?.workoutRemindersEnabled) return;\n    \n    try {\n      const response = await fetch('/api/notification-preferences/workout-reminder-needed', {\n        headers: {\n          'Authorization': `Bearer ${localStorage.getItem('authToken')}`,\n        },\n      });\n      \n      if (!response.ok) return;\n      \n      const data = await response.json();\n      \n      if (data.reminderNeeded) {\n        const lastShownKey = 'last-workout-reminder';\n        const lastShown = localStorage.getItem(lastShownKey);\n        const now = Date.now();\n        const oneHour = 60 * 60 * 1000;\n        \n        // Only show once per hour to avoid spam\n        if (!lastShown || now - parseInt(lastShown) > oneHour) {\n          showNotification(\n            'Workout Reminder 💪',\n            \"You haven't logged a workout in 24 hours. Time to get moving!\"\n          );\n          localStorage.setItem(lastShownKey, String(now));\n          \n          // Mark reminder as sent\n          await apiRequest('POST', '/api/notification-preferences/workout-reminder-sent', {});\n        }\n      }\n    } catch (error) {\n      console.error('Error checking workout reminder:', error);\n    }\n  }, [preferences?.workoutRemindersEnabled, showNotification]);\n\n  // Set up interval to check for notifications\n  useEffect(() => {\n    if (!preferences || !preferences.notificationPermissionGranted) return;\n\n    // Check immediately\n    if (preferences.workoutRemindersEnabled) {\n      checkWorkoutReminder();\n    }\n\n    // Set up interval to check every minute\n    const interval = setInterval(() => {\n      // Check meal notifications\n      if (preferences.mealNotificationsEnabled) {\n        checkMealNotification('breakfast', preferences.breakfastTime);\n        checkMealNotification('lunch', preferences.lunchTime);\n        checkMealNotification('dinner', preferences.dinnerTime);\n      }\n\n      // Check workout reminder\n      if (preferences.workoutRemindersEnabled) {\n        checkWorkoutReminder();\n      }\n    }, 60000); // Check every minute\n\n    return () => clearInterval(interval);\n  }, [preferences, checkMealNotification, checkWorkoutReminder]);\n\n  return {\n    preferences,\n    showNotification,\n    isEnabled: preferences?.notificationPermissionGranted ?? false,\n  };\n}\n","size_bytes":4585},"client/src/components/notification-manager.tsx":{"content":"import { useNotifications } from '@/hooks/useNotifications';\n\nexport default function NotificationManager() {\n  // This component uses the useNotifications hook to set up notification checking\n  // It doesn't render anything visible, just manages notifications in the background\n  useNotifications();\n  \n  return null;\n}\n","size_bytes":321},"client/src/components/voice-search-button.tsx":{"content":"import { useEffect } from 'react';\nimport { Mic, MicOff } from 'lucide-react';\nimport { Button } from '@/components/ui/button';\nimport { useVoiceInput } from '@/hooks/useVoiceInput';\nimport { useToast } from '@/hooks/use-toast';\nimport {\n  Tooltip,\n  TooltipContent,\n  TooltipTrigger,\n} from '@/components/ui/tooltip';\n\ninterface VoiceSearchButtonProps {\n  onTranscript: (text: string) => void;\n  className?: string;\n}\n\nexport default function VoiceSearchButton({ onTranscript, className }: VoiceSearchButtonProps) {\n  const { isListening, transcript, isSupported, startListening, stopListening } = useVoiceInput();\n  const { toast } = useToast();\n\n  // Update the search query when transcript changes\n  useEffect(() => {\n    if (transcript) {\n      onTranscript(transcript);\n    }\n  }, [transcript, onTranscript]);\n\n  const handleClick = () => {\n    if (!isSupported) {\n      toast({\n        title: \"Not Supported\",\n        description: \"Voice search is not supported in your browser. Try Chrome, Edge, or Safari.\",\n        variant: \"destructive\",\n      });\n      return;\n    }\n\n    if (isListening) {\n      stopListening();\n    } else {\n      startListening();\n      toast({\n        title: \"Listening...\",\n        description: \"Speak now to search\",\n      });\n    }\n  };\n\n  if (!isSupported) {\n    return null; // Don't show button if not supported\n  }\n\n  return (\n    <Tooltip>\n      <TooltipTrigger asChild>\n        <Button\n          type=\"button\"\n          variant={isListening ? \"default\" : \"ghost\"}\n          size=\"icon\"\n          onClick={handleClick}\n          className={className}\n          data-testid={isListening ? \"button-stop-voice\" : \"button-start-voice\"}\n        >\n          {isListening ? (\n            <MicOff className=\"h-4 w-4 animate-pulse\" />\n          ) : (\n            <Mic className=\"h-4 w-4\" />\n          )}\n        </Button>\n      </TooltipTrigger>\n      <TooltipContent>\n        <p>{isListening ? \"Stop listening\" : \"Voice search\"}</p>\n      </TooltipContent>\n    </Tooltip>\n  );\n}\n","size_bytes":2012},"client/src/hooks/useVoiceInput.ts":{"content":"import { useState, useCallback, useRef, useEffect } from 'react';\n\ninterface SpeechRecognitionEvent extends Event {\n  results: {\n    [index: number]: {\n      [index: number]: {\n        transcript: string;\n      };\n      isFinal: boolean;\n    };\n    length: number;\n  };\n}\n\ninterface SpeechRecognitionErrorEvent extends Event {\n  error: string;\n}\n\ninterface SpeechRecognition extends EventTarget {\n  continuous: boolean;\n  interimResults: boolean;\n  lang: string;\n  start: () => void;\n  stop: () => void;\n  abort: () => void;\n  onresult: ((event: SpeechRecognitionEvent) => void) | null;\n  onerror: ((event: SpeechRecognitionErrorEvent) => void) | null;\n  onend: (() => void) | null;\n  onstart: (() => void) | null;\n}\n\ndeclare global {\n  interface Window {\n    SpeechRecognition: new () => SpeechRecognition;\n    webkitSpeechRecognition: new () => SpeechRecognition;\n  }\n}\n\nexport function useVoiceInput() {\n  const [isListening, setIsListening] = useState(false);\n  const [transcript, setTranscript] = useState('');\n  const [isSupported, setIsSupported] = useState(false);\n  const recognitionRef = useRef<SpeechRecognition | null>(null);\n\n  useEffect(() => {\n    // Check if browser supports Speech Recognition\n    const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;\n    setIsSupported(!!SpeechRecognition);\n\n    if (SpeechRecognition) {\n      const recognition = new SpeechRecognition();\n      recognition.continuous = false;\n      recognition.interimResults = false;\n      recognition.lang = 'en-US';\n\n      recognition.onresult = (event: SpeechRecognitionEvent) => {\n        const current = event.results[event.results.length - 1];\n        const transcript = current[0].transcript;\n        setTranscript(transcript);\n      };\n\n      recognition.onerror = (event: SpeechRecognitionErrorEvent) => {\n        console.error('Speech recognition error:', event.error);\n        setIsListening(false);\n      };\n\n      recognition.onend = () => {\n        setIsListening(false);\n      };\n\n      recognition.onstart = () => {\n        setIsListening(true);\n      };\n\n      recognitionRef.current = recognition;\n    }\n\n    return () => {\n      if (recognitionRef.current) {\n        recognitionRef.current.abort();\n      }\n    };\n  }, []);\n\n  const startListening = useCallback(() => {\n    if (recognitionRef.current && !isListening) {\n      setTranscript('');\n      try {\n        recognitionRef.current.start();\n      } catch (error) {\n        console.error('Error starting speech recognition:', error);\n      }\n    }\n  }, [isListening]);\n\n  const stopListening = useCallback(() => {\n    if (recognitionRef.current && isListening) {\n      recognitionRef.current.stop();\n    }\n  }, [isListening]);\n\n  const resetTranscript = useCallback(() => {\n    setTranscript('');\n  }, []);\n\n  return {\n    isListening,\n    transcript,\n    isSupported,\n    startListening,\n    stopListening,\n    resetTranscript,\n  };\n}\n","size_bytes":2929},"server/badge-service.ts":{"content":"import { storage } from \"./storage\";\nimport type { Badge, UserBadge, InsertBadge } from \"@shared/schema\";\n\nexport interface BadgeAward {\n  badgeId: string;\n  badgeName: string;\n  description: string;\n  isNew: boolean;\n}\n\nexport class BadgeService {\n  // Consistency badges definition\n  private static readonly CONSISTENCY_BADGES: InsertBadge[] = [\n    {\n      name: \"Week Warrior\",\n      description: \"Used the app every day for 1 week\",\n      iconName: \"flame\",\n      category: \"consistency\",\n      requiredDays: 7,\n    },\n    {\n      name: \"Fortnight Champion\",\n      description: \"Used the app every day for 2 weeks\",\n      iconName: \"zap\",\n      category: \"consistency\",\n      requiredDays: 14,\n    },\n    {\n      name: \"Monthly Master\",\n      description: \"Used the app every day for 1 month\",\n      iconName: \"trophy\",\n      category: \"consistency\",\n      requiredDays: 30,\n    },\n  ];\n\n  /**\n   * Initialize default badges in the database\n   * Should be called once during app setup\n   */\n  static async initializeBadges(): Promise<void> {\n    try {\n      for (const badgeData of this.CONSISTENCY_BADGES) {\n        await storage.createBadgeIfNotExists(badgeData);\n      }\n    } catch (error) {\n      console.error(\"Failed to initialize badges:\", error);\n    }\n  }\n\n  /**\n   * Check and award badges to a user based on their current streak\n   * Returns array of newly earned badges\n   */\n  static async checkAndAwardBadges(userId: string): Promise<BadgeAward[]> {\n    try {\n      const awardedBadges: BadgeAward[] = [];\n      \n      // Get user's current streak\n      const user = await storage.getUser(userId);\n      if (!user) {\n        return [];\n      }\n      \n      const currentStreak = user.streak || 0;\n      \n      // Get all consistency badges\n      const allBadges = await storage.getAllBadges();\n      const consistencyBadges = allBadges.filter(b => b.category === \"consistency\");\n      \n      // Get user's existing badges\n      const userBadges = await storage.getUserBadges(userId);\n      const earnedBadgeIds = new Set(userBadges.map(ub => ub.badgeId));\n      \n      // Check each consistency badge\n      for (const badge of consistencyBadges) {\n        // Skip if user already has this badge\n        if (earnedBadgeIds.has(badge.id)) {\n          continue;\n        }\n        \n        // Check if user's streak qualifies for this badge\n        if (badge.requiredDays && currentStreak >= badge.requiredDays) {\n          // Award the badge\n          await storage.awardBadge(userId, badge.id);\n          \n          awardedBadges.push({\n            badgeId: badge.id,\n            badgeName: badge.name,\n            description: badge.description,\n            isNew: true,\n          });\n        }\n      }\n      \n      return awardedBadges;\n    } catch (error) {\n      console.error(\"Failed to check and award badges:\", error);\n      return [];\n    }\n  }\n\n  /**\n   * Get all badges earned by a user\n   */\n  static async getUserBadges(userId: string): Promise<UserBadge[]> {\n    try {\n      return await storage.getUserBadges(userId);\n    } catch (error) {\n      console.error(\"Failed to get user badges:\", error);\n      return [];\n    }\n  }\n\n  /**\n   * Get all available badges\n   */\n  static async getAllBadges(): Promise<Badge[]> {\n    try {\n      return await storage.getAllBadges();\n    } catch (error) {\n      console.error(\"Failed to get all badges:\", error);\n      return [];\n    }\n  }\n}\n\n// Export singleton instance\nexport const badgeService = BadgeService;\n","size_bytes":3483},"server/imageService.ts":{"content":"// Image service for fetching relevant food and ingredient images\n// Uses Pixabay API for food-specific images\n\nconst PIXABAY_API_KEY = process.env.PIXABAY_API_KEY;\nconst PIXABAY_BASE_URL = 'https://pixabay.com/api/';\n\ninterface PixabayImage {\n  id: number;\n  pageURL: string;\n  previewURL: string;\n  webformatURL: string;\n  largeImageURL: string;\n  imageWidth: number;\n  imageHeight: number;\n}\n\ninterface PixabayResponse {\n  total: number;\n  totalHits: number;\n  hits: PixabayImage[];\n}\n\n// In-memory cache to avoid duplicate API calls\nconst imageCache = new Map<string, string>();\n\n// Normalize query for better search results\nfunction normalizeQuery(text: string, type: 'meal' | 'ingredient'): string {\n  // Clean up the text\n  let cleaned = text\n    .toLowerCase()\n    .replace(/\\([^)]*\\)/g, '') // Remove parentheses and content\n    .replace(/,.*/, '') // Remove anything after comma\n    .replace(/\\d+\\s*(oz|cup|tbsp|tsp|gram|g|ml|lb)/gi, '') // Remove measurements\n    .trim();\n  \n  // For ingredients, just use the core ingredient name\n  if (type === 'ingredient') {\n    // Take first 2-3 words max\n    const words = cleaned.split(/\\s+/).slice(0, 2);\n    return words.join(' ');\n  }\n  \n  // For meals, extract key food terms\n  // Remove common cooking words\n  cleaned = cleaned.replace(/\\b(with|and|or|grilled|baked|roasted|steamed|fried)\\b/gi, '');\n  return cleaned.trim();\n}\n\n// Fetch image from Pixabay\nasync function fetchPixabayImage(query: string, type: 'meal' | 'ingredient'): Promise<string | null> {\n  if (!PIXABAY_API_KEY) {\n    console.warn('PIXABAY_API_KEY not set, using fallback images');\n    return null;\n  }\n\n  try {\n    const normalizedQuery = normalizeQuery(query, type);\n    const searchQuery = type === 'meal' \n      ? `${normalizedQuery} food meal` \n      : `${normalizedQuery} ingredient food`;\n\n    const url = new URL(PIXABAY_BASE_URL);\n    url.searchParams.set('key', PIXABAY_API_KEY);\n    url.searchParams.set('q', searchQuery);\n    url.searchParams.set('image_type', 'photo');\n    url.searchParams.set('category', 'food');\n    url.searchParams.set('orientation', 'horizontal');\n    url.searchParams.set('per_page', '3');\n    url.searchParams.set('safesearch', 'true');\n\n    const response = await fetch(url.toString());\n    \n    if (!response.ok) {\n      console.error(`Pixabay API error: ${response.status}`);\n      return null;\n    }\n\n    const data: PixabayResponse = await response.json();\n    \n    if (data.hits && data.hits.length > 0) {\n      // Return the first result's medium-sized image\n      return data.hits[0].webformatURL;\n    }\n    \n    return null;\n  } catch (error) {\n    console.error('Error fetching from Pixabay:', error);\n    return null;\n  }\n}\n\n// Get fallback image based on type\nfunction getFallbackImage(type: 'breakfast' | 'lunch' | 'dinner' | 'snack' | 'ingredient', seed: string): string {\n  // Use Picsum with seed for consistent placeholder images when API fails\n  const dimensions = type === 'ingredient' ? '200/200' : '400/300';\n  return `https://picsum.photos/seed/${seed}-${type}/` + dimensions;\n}\n\n// Main function to get meal image\nexport async function getMealImageUrl(mealType: string, mealName: string): Promise<string> {\n  const cacheKey = `meal-${mealName.toLowerCase()}`;\n  \n  // Check cache first\n  if (imageCache.has(cacheKey)) {\n    return imageCache.get(cacheKey)!;\n  }\n\n  // Try Pixabay\n  const pixabayUrl = await fetchPixabayImage(mealName, 'meal');\n  \n  if (pixabayUrl) {\n    imageCache.set(cacheKey, pixabayUrl);\n    return pixabayUrl;\n  }\n\n  // Fallback to placeholder\n  const seed = mealName.toLowerCase().replace(/\\s+/g, '-');\n  const fallbackUrl = getFallbackImage(mealType as any, seed);\n  imageCache.set(cacheKey, fallbackUrl);\n  return fallbackUrl;\n}\n\n// Main function to get ingredient image\nexport async function getIngredientImageUrl(ingredientName: string): Promise<string> {\n  const cacheKey = `ingredient-${ingredientName.toLowerCase()}`;\n  \n  // Check cache first\n  if (imageCache.has(cacheKey)) {\n    return imageCache.get(cacheKey)!;\n  }\n\n  // Try Pixabay\n  const pixabayUrl = await fetchPixabayImage(ingredientName, 'ingredient');\n  \n  if (pixabayUrl) {\n    imageCache.set(cacheKey, pixabayUrl);\n    return pixabayUrl;\n  }\n\n  // Fallback to placeholder\n  const seed = ingredientName.toLowerCase().replace(/\\s+/g, '-');\n  const fallbackUrl = getFallbackImage('ingredient', seed);\n  imageCache.set(cacheKey, fallbackUrl);\n  return fallbackUrl;\n}\n","size_bytes":4446},"client/src/hooks/use-pull-to-refresh.tsx":{"content":"import { useEffect, useRef, useState } from \"react\";\nimport { RefreshCw } from \"lucide-react\";\n\ninterface UsePullToRefreshOptions {\n  onRefresh: () => Promise<void> | void;\n  threshold?: number;\n  maxPull?: number;\n}\n\nexport function usePullToRefresh({ onRefresh, threshold = 80, maxPull = 120 }: UsePullToRefreshOptions) {\n  const [isPulling, setIsPulling] = useState(false);\n  const [isRefreshing, setIsRefreshing] = useState(false);\n  const [pullDistance, setPullDistance] = useState(0);\n  const startY = useRef(0);\n  const containerRef = useRef<HTMLDivElement>(null);\n  const pullDistanceRef = useRef(0);\n  const isRefreshingRef = useRef(false);\n\n  // Sync refs with state\n  useEffect(() => {\n    pullDistanceRef.current = pullDistance;\n  }, [pullDistance]);\n\n  useEffect(() => {\n    isRefreshingRef.current = isRefreshing;\n  }, [isRefreshing]);\n\n  useEffect(() => {\n    const container = containerRef.current;\n    if (!container) return;\n\n    let touchStartY = 0;\n    let scrollTop = 0;\n\n    const handleTouchStart = (e: TouchEvent) => {\n      touchStartY = e.touches[0].clientY;\n      scrollTop = window.scrollY || container.scrollTop;\n      startY.current = touchStartY;\n    };\n\n    const handleTouchMove = (e: TouchEvent) => {\n      // Only allow pull to refresh when at the top of the page\n      if (scrollTop > 5) return;\n      if (isRefreshingRef.current) return;\n\n      const currentY = e.touches[0].clientY;\n      const diff = currentY - touchStartY;\n\n      if (diff > 0) {\n        setIsPulling(true);\n        const distance = Math.min(diff * 0.5, maxPull);\n        pullDistanceRef.current = distance;\n        setPullDistance(distance);\n\n        // Prevent default scrolling when pulling\n        if (diff > 10) {\n          e.preventDefault();\n        }\n      }\n    };\n\n    const handleTouchEnd = async () => {\n      const currentPullDistance = pullDistanceRef.current;\n      if (currentPullDistance >= threshold && !isRefreshingRef.current) {\n        setIsRefreshing(true);\n        isRefreshingRef.current = true;\n        try {\n          await onRefresh();\n        } finally {\n          setTimeout(() => {\n            setIsRefreshing(false);\n            isRefreshingRef.current = false;\n            setIsPulling(false);\n            setPullDistance(0);\n            pullDistanceRef.current = 0;\n          }, 500);\n        }\n      } else {\n        setIsPulling(false);\n        setPullDistance(0);\n        pullDistanceRef.current = 0;\n      }\n    };\n\n    container.addEventListener('touchstart', handleTouchStart, { passive: true });\n    container.addEventListener('touchmove', handleTouchMove, { passive: false });\n    container.addEventListener('touchend', handleTouchEnd);\n\n    return () => {\n      container.removeEventListener('touchstart', handleTouchStart);\n      container.removeEventListener('touchmove', handleTouchMove);\n      container.removeEventListener('touchend', handleTouchEnd);\n    };\n  }, [threshold, maxPull, onRefresh]);\n\n  const PullToRefreshIndicator = () => {\n    if (!isPulling && !isRefreshing) return null;\n\n    const rotation = Math.min((pullDistance / threshold) * 360, 360);\n    const opacity = Math.min(pullDistance / threshold, 1);\n\n    return (\n      <div \n        className=\"fixed top-0 left-0 right-0 flex justify-center items-center z-50 transition-all duration-200\"\n        style={{ \n          transform: `translateY(${Math.min(pullDistance, maxPull)}px)`,\n          opacity: opacity\n        }}\n      >\n        <div className=\"bg-white dark:bg-gray-800 rounded-full p-3 shadow-xl\">\n          <RefreshCw \n            size={24} \n            className={`text-primary ${isRefreshing ? 'pull-refresh-spinner' : ''}`}\n            style={{ \n              transform: `rotate(${rotation}deg)`,\n              transition: isRefreshing ? 'none' : 'transform 0.2s'\n            }}\n          />\n        </div>\n      </div>\n    );\n  };\n\n  return {\n    containerRef,\n    PullToRefreshIndicator,\n    isRefreshing,\n    isPulling\n  };\n}\n","size_bytes":3964},"server/services/apple-store.ts":{"content":"import { \n  AppStoreServerAPIClient, \n  Environment, \n  ReceiptUtility,\n  SignedDataVerifier,\n  TransactionHistoryRequest,\n  Order,\n  ProductType,\n  ResponseBodyV2DecodedPayload,\n  JWSTransactionDecodedPayload,\n  GetTransactionHistoryVersion\n} from \"@apple/app-store-server-library\";\nimport { readFileSync } from \"fs\";\n\ninterface AppleStoreConfig {\n  privateKey: string;\n  keyId: string;\n  issuerId: string;\n  bundleId: string;\n  environment: 'sandbox' | 'production';\n  appleId?: string;\n}\n\nexport interface SubscriptionInfo {\n  isActive: boolean;\n  expiresDate?: Date;\n  originalTransactionId?: string;\n  productId?: string;\n  autoRenewStatus?: boolean;\n}\n\nexport class AppleStoreService {\n  private client: AppStoreServerAPIClient;\n  private verifier: SignedDataVerifier;\n  private receiptUtil: ReceiptUtility;\n  private config: AppleStoreConfig;\n\n  constructor(config: AppleStoreConfig) {\n    this.config = config;\n    \n    const environment = config.environment === 'production' \n      ? Environment.PRODUCTION \n      : Environment.SANDBOX;\n\n    this.client = new AppStoreServerAPIClient(\n      config.privateKey,\n      config.keyId,\n      config.issuerId,\n      config.bundleId,\n      environment\n    );\n\n    this.receiptUtil = new ReceiptUtility();\n\n    const rootCAs = this.loadAppleRootCAs();\n    const appleIdNum = config.appleId ? parseInt(config.appleId, 10) : undefined;\n    this.verifier = new SignedDataVerifier(\n      rootCAs,\n      true,\n      environment,\n      config.bundleId,\n      appleIdNum\n    );\n  }\n\n  private loadAppleRootCAs(): Buffer[] {\n    const rootCAG3 = `-----BEGIN CERTIFICATE-----\nMIICQzCCAcmgAwIBAgIILcX8iNLFS5UwCgYIKoZIzj0EAwMwZzEbMBkGA1UEAwwS\nQXBwbGUgUm9vdCBDQSAtIEczMSYwJAYDVQQLDB1BcHBsZSBDZXJ0aWZpY2F0aW9u\nIEF1dGhvcml0eTETMBEGA1UECgwKQXBwbGUgSW5jLjELMAkGA1UEBhMCVVMwHhcN\nMTQwNDMwMTgxOTA2WhcNMzkwNDMwMTgxOTA2WjBnMRswGQYDVQQDDBJBcHBsZSBS\nb290IENBIC0gRzMxJjAkBgNVBAsMHUFwcGxlIENlcnRpZmljYXRpb24gQXV0aG9y\naXR5MRMwEQYDVQQKDApBcHBsZSBJbmMuMQswCQYDVQQGEwJVUzB2MBAGByqGSM49\nAgEGBSuBBAAiA2IABJjpLz1AcqTtkyJygRMc3RCV8cWjTnHcFBbZDuWmBSp3ZHtf\nTjjTuxxEtX/1H7YyYl3J6YRbTzBPEVoA/VhYDKX1DyxNB0cTddqXl5dvMVztK517\nIDvYuVTZXpmkOlEKMaNCMEAwHQYDVR0OBBYEFLuw3qFYM4iapIqZ3r6966/ayySr\nMA8GA1UdEwEB/wQFMAMBAf8wDgYDVR0PAQH/BAQDAgEGMAoGCCqGSM49BAMDA2gA\nMGUCMQCD6cHEFl4aXTQY2e3v9GwOAEZLuN+yRhHFD/3meoyhpmvOwgPUnPWTxnS4\nat+qIxUCMG1mihDK1A3UT82NQz60imOlM27jbdoXt2QfyFMm+YhidDkLF1vLUagM\n6BgD56KyKA==\n-----END CERTIFICATE-----`;\n\n    const rootCAG2 = `-----BEGIN CERTIFICATE-----\nMIIEuzCCA6OgAwIBAgIBAjANBgkqhkiG9w0BAQUFADBiMQswCQYDVQQGEwJVUzET\nMBEGA1UEChMKQXBwbGUgSW5jLjEmMCQGA1UECxMdQXBwbGUgQ2VydGlmaWNhdGlv\nbiBBdXRob3JpdHkxFjAUBgNVBAMTDUFwcGxlIFJvb3QgQ0EwHhcNMDYwNDI1MjE0\nMDM2WhcNMzUwMjA5MjE0MDM2WjBiMQswCQYDVQQGEwJVUzETMBEGA1UEChMKQXBw\nbGUgSW5jLjEmMCQGA1UECxMdQXBwbGUgQ2VydGlmaWNhdGlvbiBBdXRob3JpdHkx\nFjAUBgNVBAMTDUFwcGxlIFJvb3QgQ0EwggEiMA0GCSqGSIb3DQEBAQUAA4IBDwAw\nggEKAoIBAQDkkakJH5HbHkdQ6wXtXnmELes2oldMVeyLGYne+Uts9QerIjAC6Bg+\n+FAJ039BqJj50cpmnCRrEdCju+QbKsMflZ56DKRHi1vUFjczy8QPTc4UadHJGXL1\nXQ7Vf1+b8iUDulWPTV0N8WQ1IxVLFVkds5T39pyez1C6wVhQZ48ItCD3y6wsIG9w\ntj8BMIy3Q88PnT3zK0koGsj+zrW5DtleHNbLPbU6rfQPDgCSC7EhFi501TwN22IW\nq6NxkkdTVcGvL0Gz+PvjcM3mo0xFfh9Ma1CWQYnEdGILEINBhzOKgbEwWOxaBDKM\naLOPHd5lc/9nXmW8Sdh2nzMUZaF3lMktAgMBAAGjggF6MIIBdjAOBgNVHQ8BAf8E\nBAMCAQYwDwYDVR0TAQH/BAUwAwEB/zAdBgNVHQ4EFgQUK9BpR5R2Cf70a40uQKb3\nR01/CF4wHwYDVR0jBBgwFoAUK9BpR5R2Cf70a40uQKb3R01/CF4wggERBgNVHSAE\nggEIMIIBBDCCAQAGCSqGSIb3Y2QFATCB8jAqBggrBgEFBQcCARYeaHR0cHM6Ly93\nd3cuYXBwbGUuY29tL2FwcGxlY2EvMIHDBggrBgEFBQcCAjCBthqBs1JlbGlhbmNl\nIG9uIHRoaXMgY2VydGlmaWNhdGUgYnkgYW55IHBhcnR5IGFzc3VtZXMgYWNjZXB0\nYW5jZSBvZiB0aGUgdGhlbiBhcHBsaWNhYmxlIHN0YW5kYXJkIHRlcm1zIGFuZCBj\nb25kaXRpb25zIG9mIHVzZSwgY2VydGlmaWNhdGUgcG9saWN5IGFuZCBjZXJ0aWZp\nY2F0aW9uIHByYWN0aWNlIHN0YXRlbWVudHMuMA0GCSqGSIb3DQEBBQUAA4IBAQBc\nNplMLXi37Yyb3PN3m/J20ncwT8EfhYOFG5k9RzfyqZtAjizUsZAS2L70c5vu0mQP\ny3lPNNiiPvl4/2vIB+x9OYOLUyDTOMSxv5pPCmv/K/xZpwUJfBdAVhEedNO3iyM7\nR6PVbyTi69G3cN8PReEnyvFteO3ntRcXqNx+IjXKJdXZD9Zr1KIkIxH3oayPc4Fg\nxhtbCS+SsvhESPBgOJ4V9T0mZyCKM2r3DYLP3uujL/lTaltkwGMzd/c6ByxW69oP\nIQ7aunMZT7XZNn/Bh1XZp5m5MkL72NVxnn6hUrcbvZNCJBIqxw8dtk2cXmPIS4AX\nUKqK1drk/NAJBzewdXUh\n-----END CERTIFICATE-----`;\n\n    return [\n      Buffer.from(rootCAG3, 'utf8'),\n      Buffer.from(rootCAG2, 'utf8')\n    ];\n  }\n\n  async verifyReceipt(receipt: string): Promise<SubscriptionInfo> {\n    try {\n      const transactionId = this.receiptUtil.extractTransactionIdFromAppReceipt(receipt);\n      \n      if (!transactionId) {\n        throw new Error('Unable to extract transaction ID from receipt');\n      }\n\n      return await this.getSubscriptionStatus(transactionId);\n    } catch (error) {\n      console.error('Error verifying receipt:', error);\n      throw new Error('Invalid receipt');\n    }\n  }\n\n  async getSubscriptionStatus(originalTransactionId: string): Promise<SubscriptionInfo> {\n    try {\n      const request: TransactionHistoryRequest = {\n        sort: Order.DESCENDING,\n        revoked: false,\n        productTypes: [ProductType.AUTO_RENEWABLE]\n      };\n\n      const response = await this.client.getTransactionHistory(\n        originalTransactionId,\n        null,\n        request,\n        GetTransactionHistoryVersion.V2\n      );\n\n      if (!response.signedTransactions || response.signedTransactions.length === 0) {\n        return { isActive: false };\n      }\n\n      const latestTransaction = await this.decodeTransaction(\n        response.signedTransactions[0]\n      );\n\n      const expiresDate = latestTransaction.expiresDate \n        ? new Date(latestTransaction.expiresDate) \n        : undefined;\n\n      const isActive = expiresDate ? expiresDate > new Date() : false;\n\n      return {\n        isActive,\n        expiresDate,\n        originalTransactionId: latestTransaction.originalTransactionId,\n        productId: latestTransaction.productId,\n        autoRenewStatus: true\n      };\n    } catch (error) {\n      console.error('Error getting subscription status:', error);\n      throw new Error('Failed to get subscription status');\n    }\n  }\n\n  private async decodeTransaction(signedTransaction: string): Promise<JWSTransactionDecodedPayload> {\n    return await this.verifier.verifyAndDecodeTransaction(signedTransaction);\n  }\n\n  async verifyAndDecodeNotification(signedPayload: string): Promise<ResponseBodyV2DecodedPayload> {\n    try {\n      return await this.verifier.verifyAndDecodeNotification(signedPayload);\n    } catch (error) {\n      console.error('Error verifying notification:', error);\n      throw new Error('Invalid notification payload');\n    }\n  }\n\n  async handleNotification(notification: ResponseBodyV2DecodedPayload): Promise<{\n    userId?: string;\n    action: 'renewed' | 'expired' | 'cancelled' | 'refunded' | 'unknown';\n    originalTransactionId?: string;\n  }> {\n    const notificationType = notification.notificationType;\n    const subtype = notification.subtype;\n    const data = notification.data;\n\n    const originalTransactionId = data?.signedTransactionInfo \n      ? (await this.decodeTransaction(data.signedTransactionInfo)).originalTransactionId\n      : undefined;\n\n    switch (notificationType) {\n      case 'DID_RENEW':\n        return {\n          action: 'renewed',\n          originalTransactionId\n        };\n      \n      case 'EXPIRED':\n        return {\n          action: 'expired',\n          originalTransactionId\n        };\n      \n      case 'DID_CHANGE_RENEWAL_STATUS':\n        if (subtype === 'AUTO_RENEW_DISABLED') {\n          return {\n            action: 'cancelled',\n            originalTransactionId\n          };\n        }\n        break;\n      \n      case 'REFUND':\n        return {\n          action: 'refunded',\n          originalTransactionId\n        };\n    }\n\n    return {\n      action: 'unknown',\n      originalTransactionId\n    };\n  }\n}\n\nexport function createAppleStoreService(): AppleStoreService | null {\n  try {\n    const privateKey = process.env.APPLE_PRIVATE_KEY;\n    const keyId = process.env.APPLE_KEY_ID;\n    const issuerId = process.env.APPLE_ISSUER_ID;\n    const bundleId = process.env.APPLE_BUNDLE_ID;\n    const environment = (process.env.APPLE_ENVIRONMENT || 'sandbox') as 'sandbox' | 'production';\n    const appleId = process.env.APPLE_APP_ID;\n\n    if (!privateKey || !keyId || !issuerId || !bundleId) {\n      console.warn('Apple App Store credentials not configured. Subscription features will be limited.');\n      return null;\n    }\n\n    return new AppleStoreService({\n      privateKey,\n      keyId,\n      issuerId,\n      bundleId,\n      environment,\n      appleId\n    });\n  } catch (error) {\n    console.error('Failed to initialize Apple Store service:', error);\n    return null;\n  }\n}\n","size_bytes":8606},"client/src/pages/news.tsx":{"content":"import { useQuery } from \"@tanstack/react-query\";\nimport { Card } from \"@/components/ui/card\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Newspaper, TrendingUp, Bug, Megaphone } from \"lucide-react\";\nimport { format } from \"date-fns\";\nimport type { News } from \"@shared/schema\";\n\nexport default function NewsPage() {\n  const { data: newsItems, isLoading } = useQuery<News[]>({\n    queryKey: [\"/api/news\"],\n  });\n\n  const getCategoryIcon = (category: string) => {\n    switch (category) {\n      case \"feature\":\n        return <TrendingUp className=\"w-4 h-4\" />;\n      case \"bug_fix\":\n        return <Bug className=\"w-4 h-4\" />;\n      case \"announcement\":\n        return <Megaphone className=\"w-4 h-4\" />;\n      default:\n        return <Newspaper className=\"w-4 h-4\" />;\n    }\n  };\n\n  const getCategoryColor = (category: string) => {\n    switch (category) {\n      case \"feature\":\n        return \"bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200\";\n      case \"bug_fix\":\n        return \"bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200\";\n      case \"announcement\":\n        return \"bg-purple-100 text-purple-800 dark:bg-purple-900 dark:text-purple-200\";\n      default:\n        return \"bg-gray-100 text-gray-800 dark:bg-gray-900 dark:text-gray-200\";\n    }\n  };\n\n  const getCategoryLabel = (category: string) => {\n    switch (category) {\n      case \"feature\":\n        return \"New Feature\";\n      case \"bug_fix\":\n        return \"Bug Fix\";\n      case \"announcement\":\n        return \"Announcement\";\n      default:\n        return \"Update\";\n    }\n  };\n\n  return (\n    <div className=\"min-h-screen bg-gradient-to-br from-slate-50 via-blue-50 to-indigo-50 dark:from-slate-950 dark:via-blue-950 dark:to-indigo-950\">\n      <div className=\"container max-w-4xl mx-auto px-4 py-6 pb-24\">\n        {/* Header - Mobile-first with large titles */}\n        <div className=\"mb-6 md:mb-8\">\n          <div className=\"flex items-center gap-3 mb-2\">\n            <div className=\"p-2 md:p-3 bg-gradient-to-br from-blue-500 to-indigo-600 rounded-2xl shadow-lg\">\n              <Newspaper className=\"w-6 h-6 md:w-8 md:h-8 text-white\" />\n            </div>\n            <h1 className=\"text-3xl md:text-4xl font-bold text-gray-900 dark:text-white\">\n              What's New\n            </h1>\n          </div>\n          <p className=\"text-base md:text-lg text-gray-600 dark:text-gray-400 ml-14 md:ml-16\">\n            Latest updates and improvements to FlexFlow\n          </p>\n        </div>\n\n        {/* News Feed */}\n        {isLoading ? (\n          <div className=\"space-y-4\">\n            {[1, 2, 3].map((i) => (\n              <Card key={i} className=\"p-4 md:p-6\">\n                <Skeleton className=\"h-6 w-3/4 mb-3\" />\n                <Skeleton className=\"h-4 w-full mb-2\" />\n                <Skeleton className=\"h-4 w-full mb-2\" />\n                <Skeleton className=\"h-4 w-2/3\" />\n              </Card>\n            ))}\n          </div>\n        ) : newsItems && newsItems.length > 0 ? (\n          <div className=\"space-y-4\">\n            {newsItems.map((item) => (\n              <Card\n                key={item.id}\n                className=\"overflow-hidden hover:shadow-lg transition-all duration-300 bg-white dark:bg-slate-900 border-slate-200 dark:border-slate-800\"\n                data-testid={`news-item-${item.id}`}\n              >\n                {/* Image if present */}\n                {item.imageUrl && (\n                  <div className=\"w-full h-48 md:h-56 overflow-hidden bg-gradient-to-br from-blue-100 to-indigo-100 dark:from-blue-900 dark:to-indigo-900\">\n                    <img\n                      src={item.imageUrl}\n                      alt={item.title}\n                      className=\"w-full h-full object-cover\"\n                      data-testid={`news-image-${item.id}`}\n                    />\n                  </div>\n                )}\n\n                <div className=\"p-5 md:p-6\">\n                  {/* Category Badge and Date */}\n                  <div className=\"flex items-center justify-between mb-3\">\n                    <Badge\n                      className={`${getCategoryColor(item.category)} flex items-center gap-1.5 px-3 py-1 text-xs md:text-sm font-medium`}\n                      data-testid={`news-category-${item.id}`}\n                    >\n                      {getCategoryIcon(item.category)}\n                      {getCategoryLabel(item.category)}\n                    </Badge>\n                    <span className=\"text-xs md:text-sm text-gray-500 dark:text-gray-400\" data-testid={`news-date-${item.id}`}>\n                      {format(new Date(item.publishedAt), \"MMM d, yyyy\")}\n                    </span>\n                  </div>\n\n                  {/* Title */}\n                  <h2\n                    className=\"text-xl md:text-2xl font-bold text-gray-900 dark:text-white mb-3 leading-tight\"\n                    data-testid={`news-title-${item.id}`}\n                  >\n                    {item.title}\n                  </h2>\n\n                  {/* Content */}\n                  <div\n                    className=\"text-base md:text-lg text-gray-700 dark:text-gray-300 leading-relaxed whitespace-pre-wrap\"\n                    data-testid={`news-content-${item.id}`}\n                  >\n                    {item.content}\n                  </div>\n                </div>\n              </Card>\n            ))}\n          </div>\n        ) : (\n          <Card className=\"p-12 text-center\">\n            <div className=\"flex flex-col items-center gap-4\">\n              <div className=\"p-4 bg-gradient-to-br from-blue-100 to-indigo-100 dark:from-blue-900 dark:to-indigo-900 rounded-full\">\n                <Newspaper className=\"w-12 h-12 text-blue-600 dark:text-blue-400\" />\n              </div>\n              <div>\n                <h3 className=\"text-xl font-semibold text-gray-900 dark:text-white mb-2\">\n                  No news yet\n                </h3>\n                <p className=\"text-gray-600 dark:text-gray-400\">\n                  Check back soon for updates and announcements!\n                </p>\n              </div>\n            </div>\n          </Card>\n        )}\n      </div>\n    </div>\n  );\n}\n","size_bytes":6208},"client/src/components/splash-screen.tsx":{"content":"import { useEffect, useState } from \"react\";\nimport { Dumbbell } from \"lucide-react\";\n\ninterface SplashScreenProps {\n  onComplete: () => void;\n}\n\nexport default function SplashScreen({ onComplete }: SplashScreenProps) {\n  const [fadeOut, setFadeOut] = useState(false);\n\n  useEffect(() => {\n    const fadeTimer = setTimeout(() => {\n      setFadeOut(true);\n    }, 2000);\n\n    const completeTimer = setTimeout(() => {\n      onComplete();\n    }, 2500);\n\n    return () => {\n      clearTimeout(fadeTimer);\n      clearTimeout(completeTimer);\n    };\n  }, [onComplete]);\n\n  return (\n    <div\n      className={`fixed inset-0 z-50 flex flex-col items-center justify-center bg-gradient-to-br from-black via-gray-900 to-black transition-opacity duration-500 ${\n        fadeOut ? \"opacity-0\" : \"opacity-100\"\n      }`}\n      data-testid=\"splash-screen\"\n    >\n      <div className=\"flex flex-col items-center space-y-6 animate-in fade-in zoom-in duration-700\">\n        <div className=\"relative\">\n          <div className=\"absolute inset-0 bg-primary/20 blur-3xl rounded-full animate-pulse\" />\n          <Dumbbell className=\"w-20 h-20 text-primary relative z-10\" strokeWidth={2.5} />\n        </div>\n        \n        <div className=\"text-center space-y-2\">\n          <h1 className=\"text-5xl md:text-6xl font-bold text-white tracking-tight\">\n            FlexFlow Fitness\n          </h1>\n          <p className=\"text-xl md:text-2xl text-gray-300 font-medium tracking-wide\">\n            Stay Strong Stay Fit\n          </p>\n        </div>\n        \n        <div className=\"flex space-x-1 mt-8\">\n          <div className=\"w-2 h-2 bg-primary rounded-full animate-bounce\" style={{ animationDelay: \"0ms\" }} />\n          <div className=\"w-2 h-2 bg-primary rounded-full animate-bounce\" style={{ animationDelay: \"150ms\" }} />\n          <div className=\"w-2 h-2 bg-primary rounded-full animate-bounce\" style={{ animationDelay: \"300ms\" }} />\n        </div>\n      </div>\n    </div>\n  );\n}\n","size_bytes":1955}},"version":2}